var k=(t,l,h)=>new Promise((B,A)=>{var I=m=>{try{g(h.next(m))}catch(s){A(s)}},p=m=>{try{g(h.throw(m))}catch(s){A(s)}},g=m=>m.done?B(m.value):Promise.resolve(m.value).then(I,p);g((h=h.apply(t,l)).next())});import{d as re,f as w,c as ce,r as j,a2 as pe,a3 as de,a4 as me,a5 as o,V as f,a6 as x,a7 as P,F as fe,ak as T,k as n,E as _e,ai as i,z as H,W as U,ae as ge,af as W}from"./vue-vendor-24c7dc61.js";import he from"./BasicTable-d435f501.js";import{u as ye}from"./useListPage-62a041ef.js";import{c as ke}from"./organization.data-23f4609c.js";import{e as Ce,a as ve,k as b,ap as we,l as Ae}from"./index-831af9dd.js";import{u as Fe}from"./useUndeveloped-598c4bd7.js";import{U as Ee}from"./UserAvatar-1a3df675.js";import{i as X}from"./antd-vue-vendor-0d72f01e.js";import"./index-1c3affea.js";import{U as xe}from"./UserSelectModal-d78c1490.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./index-621e597c.js";import"./renderUtils-7ad8f436.js";const be=re({name:"OrganApplicationForm",components:{BasicTable:he,UserAvatar:Ee,UserSelectModal:xe},setup(){const{tipUndeveloped:t}=Fe(),{createInfoModal:l,createMessage:h}=ve(),[B,{openModal:A,closeModal:I}]=Ce(),p=w(""),g=w(""),m=ce("myTenantInfo",j({})),s=j({field:"createTime",order:"descend"}),F=w(0),E=w(0);function z(){return k(this,null,function*(){const e="/online/lowApp/tenantAppList";if(!m)return;let u={tenantId:m.id};p.value&&(u.searchKeyWord=p.value),g.value&&(u.openStatus=g.value);const r=yield b.get({url:e,params:u},{isTransformResponse:!1});let c=[],L=0;if(r.success){c=r.result,O(c);for(let ue of c)L+=ue.formCount||0}return E.value=L,F.value=c.length,{records:c}})}function O(e){s.field=="createTime"?e.sort(function(a,u){let r=X(a[s.field]).unix(),c=X(u[s.field]).unix();return s.order=="descend"?c-r:r-c}):e.sort(function(a,u){let r=a[s.field],c=u[s.field];return s.order=="descend"?c-r:r-c})}const{tableContext:V,onExportXls:M,onImportXls:R}=ye({tableProps:{api:z,bordered:!1,columns:ke,canResize:!1,useSearchForm:!1,showTableSetting:!1,immediate:!0,actionColumn:{width:120,fixed:"right"},pagination:!1,onChange:y}}),[D,{reload:C,getDataSource:d}]=V;function v(){return k(this,null,function*(){yield C()})}function y(e,a,u,r){s.field=u.field,s.order=u.order}function S(){t()}const K=w(!1);function q({key:e}){t()}const G=[{label:"全部状态",value:""},{label:"开启",value:"1"},{label:"关闭",value:"0"}];function J(e){return we(e)}function Q(e,a){return k(this,null,function*(){e==0?l({title:"你确定关闭此应用吗？",content:"关闭应用后，所有人将无法再继续使用和查看此应用，应用下的工作流将全部关闭。",width:480,mask:!0,maskClosable:!0,closable:!0,icon:" ",okText:"关闭",okCancel:!0,onOk:function(){N(a.id,e)}}):l({title:"你确定开启此应用吗？",content:"重新开启应用后，你需要在应用中手动开启需要运行的工作流。",width:480,mask:!0,maskClosable:!0,closable:!0,icon:" ",okText:"开启",okCancel:!0,onOk:function(){N(a.id,e)}})})}function N(e,a){return k(this,null,function*(){const u="/online/lowApp/edit";let r={id:e,openStatus:a};(yield b.put({url:u,params:r},{isTransformResponse:!1})).success&&(yield C())})}const Y=pe();function Z(e){let a=`/myapp/${e.id}`;Y.push({path:a})}function ee(e){t()}function te(e,a){e.key=="delete"?ae(a):e.key=="owner"?ie(a):e.key=="manage"?oe(a):t()}function oe(e){l({title:`管理应用“${e.appName}”`,content:"如果你不是该应用的管理员角色，需要将自己添加至角色以获取该应用的管理权限",width:480,mask:!0,maskClosable:!0,closable:!0,icon:" ",okText:"加入管理员角色",okCancel:!1,onOk:function(){ne(e.id)}})}function ne(e){return k(this,null,function*(){const a="/online/lowAppAuth/doManage";let u=m.id,r={id:e,tenantId:u};const c=yield b.put({url:a,params:r},{isTransformResponse:!1});c.success?h.success(c.message):h.error(c.message)})}function ae(e){l({title:"你确定删除此应用吗？",content:"应用下所有数据将被删除，请确认所有应用成员都不再需要此应用后，再执行此操作",width:480,mask:!0,maskClosable:!0,closable:!0,icon:" ",okText:"删除",okButtonProps:{danger:!0},okCancel:!0,onOk:function(){se(e.id)}})}function se(e){return k(this,null,function*(){const a="/online/lowApp/edit";let u={id:e,delFlag:1};(yield b.put({url:a,params:u},{isTransformResponse:!1})).success&&(h.success("删除成功！"),yield C())})}const $=w("");function ie(e){$.value=e.id,A(!0,{list:[],excludeUserIdList:[e.ownerId]})}function le(e){return k(this,null,function*(){let a=e[0].id;const u="/online/lowApp/changeOwner",r={ownerId:a,id:$.value};yield b.put({url:u,params:r}),I(),$.value="",yield C()})}return{registerTable:D,reload:C,appCount:F,formCount:E,customIconClick:S,onlyAdminCanCreate:K,onAppAction:q,searchSelectOptions:G,searchSelectValue:g,onSearchValueChange:v,searchInputValue:p,getImageSrc:J,onChangeOpenStatus:Q,goAppPage:Z,goAnalysisPage:ee,onAppRecordAction:te,onExportXls:M,onImportXls:R,registerUserModal:B,doUpdateOwner:le}}});const _=t=>(de("data-v-f5ff27e1"),t=t(),me(),t),Be={class:"main-container"},Ie={class:"application flex-column",style:{flex:"1"}},Se={class:"application-header flex-flow"},Te={style:{"font-size":"17px",display:"flex",flex:"1"},class:"font-blob700"},Ue=_(()=>o("span",{class:"font-size13"},"只允许应用管理员创建应用",-1)),ze={style:{"margin-right":"20px"}},Oe=_(()=>o("span",{style:{"font-size":"13px"}},"导入应用",-1)),Ve=_(()=>o("span",{style:{"font-size":"13px"}},"批量导出",-1)),Me=_(()=>o("span",{style:{"font-size":"13px"}},"日志",-1)),Re=_(()=>o("span",{style:{"font-size":"13px"}},"回收站",-1)),De={key:0},$e=_(()=>o("span",{style:{color:"#9e9e9e"}},"已创建工作表",-1)),Pe={style:{margin:"0 10px 0 5px",color:"rgb(51, 51, 51)"}},Ne=_(()=>o("span",{style:{color:"#9e9e9e"}},"剩余",-1)),Le={style:{margin:"0 5px",color:"rgb(51, 51, 51)"}},je={class:"application-search flex-flow"},He={style:{width:"180px"}},We=_(()=>o("div",{style:{flex:"1"}},null,-1)),Xe={class:"search-name"},Ke={class:"appli-table"},qe=["onClick"],Ge={class:"app-name-text",style:{"margin-left":"5px","margin-top":"5px"}},Je={style:{display:"flex","justify-content":"center",width:"100%"}},Qe=_(()=>o("span",{style:{"font-size":"13px","margin-left":"8px"}},"管理应用",-1)),Ye=_(()=>o("span",{style:{"font-size":"13px","margin-left":"8px"}},"转交应用",-1)),Ze=_(()=>o("span",{style:{"font-size":"13px",color:"#f51744","margin-left":"8px"}},"删除",-1));function et(t,l,h,B,A,I){const p=f("Icon"),g=f("a-tooltip"),m=f("a-checkbox"),s=f("a-menu-item"),F=f("a-menu"),E=f("a-dropdown"),z=f("a-alert"),O=f("a-select"),V=f("a-input"),M=f("a-switch"),R=f("UserAvatar"),D=f("BasicTable"),C=f("user-select-modal");return x(),P(fe,null,[o("div",Be,[o("div",Ie,[o("div",Se,[o("div",Te,T("组织下的全部应用（"+t.appCount+"）"),1),o("div",{class:"pointer font-size13",style:{"margin-right":"20px"},onClick:l[0]||(l[0]=(...d)=>t.customIconClick&&t.customIconClick(...d))},[n(p,{style:{display:"inline","font-size":"18px"},icon:"ant-design:thunderbolt-outlined"}),_e(" 自定义图标 ")]),o("div",null,[n(m,{checked:t.onlyAdminCanCreate,"onUpdate:checked":l[1]||(l[1]=d=>t.onlyAdminCanCreate=d),disabled:""},{default:i(()=>[n(g,{title:"勾选后，只允许组织后台的应用管理员创建应用；不勾选则允许全员创建应用"},{default:i(()=>[Ue]),_:1})]),_:1},8,["checked"])]),o("div",ze,[n(E,{trigger:["click"]},{overlay:i(()=>[n(F,{onClick:t.onAppAction},{default:i(()=>[n(s,{key:"import"},{default:i(()=>[Oe]),_:1}),n(s,{key:"export"},{default:i(()=>[Ve]),_:1}),n(s,{key:"log"},{default:i(()=>[Me]),_:1}),n(s,{key:"recycleBin"},{default:i(()=>[Re]),_:1})]),_:1},8,["onClick"])]),default:i(()=>[o("div",{class:"ant-dropdown-link",onClick:l[2]||(l[2]=H(()=>{},["prevent"]))},[n(p,{class:"operation-color pointer",style:{"font-size":"24px"},icon:"ant-design:ellipsis-outlined"})])]),_:1})])]),t.formCount?(x(),P("div",De,[n(z,{type:"info","show-icon":"",class:"alert",style:{margin:"10px 20px 0"}},{message:i(()=>[$e,o("span",Pe,T(t.formCount),1),Ne,o("span",Le,T(100-t.formCount),1)]),_:1})])):U("",!0),o("div",je,[o("div",He,[n(O,{style:{width:"100%"},options:t.searchSelectOptions,value:t.searchSelectValue,"onUpdate:value":l[3]||(l[3]=d=>t.searchSelectValue=d),onChange:t.onSearchValueChange},null,8,["options","value","onChange"])]),We,o("div",Xe,[n(V,{value:t.searchInputValue,"onUpdate:value":l[4]||(l[4]=d=>t.searchInputValue=d),placeholder:"应用名称 / 拥有者",allowClear:"",onChange:t.onSearchValueChange},{prefix:i(()=>[n(p,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value","onChange"])])]),o("div",Ke,[n(D,{onRegister:t.registerTable},{bodyCell:i(({column:d,text:v,record:y})=>[d.dataIndex==="appName"?(x(),P("div",{key:0,style:{display:"flex"},class:"pointer",onClick:S=>t.goAppPage(y)},[o("div",{class:"icon-name",style:ge({"background-color":y.iconBackColor})},[n(p,{style:{color:"#FFFFFF"},size:24,icon:y.iconType?y.iconType:"ant-design:appstore-outlined"},null,8,["icon"])],4),o("span",Ge,T(v),1)],8,qe)):U("",!0),d.dataIndex==="openStatus"?(x(),W(M,{key:1,checked:y.openStatus,checkedValue:1,unCheckedValue:0,checkedChildren:"开启",unCheckedChildren:"关闭",onClick:S=>t.onChangeOpenStatus(S,y)},null,8,["checked","onClick"])):U("",!0),d.dataIndex==="realname"?(x(),W(R,{key:2,detail:y},null,8,["detail"])):U("",!0)]),action:i(({record:d})=>[o("div",Je,[n(g,{title:"使用分析"},{default:i(()=>[n(p,{class:"analysis operation-color pointer",style:{"font-size":"24px"},icon:"ant-design:bar-chart-outlined",onClick:v=>t.goAnalysisPage(d)},null,8,["onClick"])]),_:2},1024),n(E,{trigger:["click"],placement:"bottomRight",overlayStyle:{width:"120px"}},{overlay:i(()=>[n(F,{onClick:v=>t.onAppRecordAction(v,d)},{default:i(()=>[n(s,{key:"manage"},{default:i(()=>[n(p,{icon:"ant-design:setting-outlined"}),Qe]),_:1}),n(s,{key:"owner"},{default:i(()=>[n(p,{icon:"ant-design:swap-outlined"}),Ye]),_:1}),n(s,{key:"delete"},{default:i(()=>[n(p,{color:"#f51744",icon:"ant-design:delete-outlined"}),Ze]),_:1})]),_:2},1032,["onClick"])]),default:i(()=>[o("div",{class:"ant-dropdown-link",style:{"margin-left":"5px"},onClick:l[5]||(l[5]=H(()=>{},["prevent"]))},[n(p,{class:"operation-color pointer",style:{"font-size":"24px"},icon:"ant-design:more-outlined"})])]),_:2},1024)])]),_:1},8,["onRegister"])])])]),n(C,{multi:!1,onRegister:t.registerUserModal,onSelected:t.doUpdateOwner},null,8,["onRegister","onSelected"])],64)}const Zt=Ae(be,[["render",et],["__scopeId","data-v-f5ff27e1"]]);export{Zt as default};
