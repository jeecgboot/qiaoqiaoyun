var W=Object.defineProperty,j=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(e,n,o)=>n in e?W(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,k=(e,n)=>{for(var o in n||(n={}))T.call(n,o)&&A(e,o,n[o]);if(z)for(var o of z(n))G.call(n,o)&&A(e,o,n[o]);return e},D=(e,n)=>j(e,O(n));var R=(e,n,o)=>new Promise((F,f)=>{var c=a=>{try{t(o.next(a))}catch(l){f(l)}},m=a=>{try{t(o.throw(a))}catch(l){f(l)}},t=a=>a.done?F(a.value):Promise.resolve(a.value).then(c,m);t((o=o.apply(e,n)).next())});import{d as J,f as h,l as y,e as M,u as B,a5 as I,V as d,a6 as b,af as S,ap as K,aq as Q,ai as p,k as r,al as X,a7 as Y,F as Z,W as ee}from"./vue-vendor-24c7dc61.js";import{B as ne}from"./index-1c3affea.js";import{q as oe,j as se,a as te,k as ae,l as le}from"./index-831af9dd.js";import"./BasicModal-58413bab.js";import"./antd-vue-vendor-0d72f01e.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const re=J({name:"DesformRedoIndexModal",components:{BasicModal:ne},emits:["register"],setup(e){const n=oe(),{createMessage:o,createErrorModal:F,createWarningModal:f}=te(),c=h(!1),m=h(0),t=h([]),a=[{url:"/desform/redoAllIndex",title:"快速重置索引",content:["确定要开始快速重置索引吗？"]},{url:"/desform/redoAllIndexForce",title:"强制重置索引",content:[y("p",{},"确定要开始强制重置索引吗？"),y("p",{style:{color:"red"}},"强制重置索引会删除并重建所有索引，耗时较长！")]}],l=M(()=>a[m.value]),g=h(!1),C=h(1e3),P=M(()=>l.value.title),_=M(()=>()=>y("div",{},[...l.value.content])),[x,{closeModal:$,setModalProps:E}]=se(N),L=M(()=>{let s={width:500,minHeight:160,title:B(P),confirmLoading:B(c),centered:!0,canFullscreen:!1,maskClosable:!1,closeFunc:H};return D(k(k(k({},B(n)),s),e),{onOk:U,onCancel:q,onRegister:x})});function N(s){var v,i;g.value=!1,m.value=(v=s==null?void 0:s.modeIndex)!=null?v:0,t.value=(i=s==null?void 0:s.selections)!=null?i:[]}function V(){w(!1),$()}function q(){$()}function H(){return c.value?(o.warn("请等待结束..."),!1):!0}function U(){return R(this,null,function*(){let s={};t.value&&(s.selections=t.value),g.value&&(s.pageSize=C.value),w(!0);const v=o.loading("重置索引中...",0);try{const{success:i,message:u}=yield ae.put({url:l.value.url,params:s,timeout:6e5},{isTransformResponse:!1});if(i)V(),o.success("重置成功！");else throw u}catch(i){let u=i;typeof i!="string"&&(u=i.message),/timeout of \d+ms exceeded/.test(u)?(u="重置索引时间过长，已进入后台执行，请在后台查看日志结果！",f({title:"重置索引超时",content:u})):F({title:"重置索引失败",content:u})}finally{v(),w(!1)}})}function w(s){c.value=s,E({confirmLoading:s})}return{getProps:L,loading:c,content:_,pageSize:C,enabledPage:g}}}),ie=I("span",{style:{"line-height":"2"}},"分页重置：",-1),ce=I("span",{style:{"line-height":"2"}},"每页大小（条）：",-1);function ue(e,n,o,F,f,c){const m=d("a-divider"),t=d("a-col"),a=d("a-switch"),l=d("a-input-number"),g=d("a-row"),C=d("a-spin"),P=d("BasicModal");return b(),S(P,K(Q(e.getProps)),{default:p(()=>[r(C,{wrapperClassName:"p-2",spinning:e.loading},{default:p(()=>[I("div",null,[(b(),S(X(e.content)))]),r(m),r(g,{type:"flex"},{default:p(()=>[r(t,{span:4},{default:p(()=>[ie]),_:1}),r(t,{span:4},{default:p(()=>[r(a,{checked:e.enabledPage,"onUpdate:checked":n[0]||(n[0]=_=>e.enabledPage=_),checkedChildren:"开启",unCheckedChildren:"关闭"},null,8,["checked"])]),_:1}),e.enabledPage?(b(),Y(Z,{key:0},[r(t,{span:6},{default:p(()=>[ce]),_:1}),r(t,{span:6},{default:p(()=>[r(l,{value:e.pageSize,"onUpdate:value":n[1]||(n[1]=_=>e.pageSize=_),min:10},null,8,["value"])]),_:1})],64)):ee("",!0)]),_:1})]),_:1},8,["spinning"])]),_:1},16)}const Fe=le(re,[["render",ue]]);export{Fe as default};
