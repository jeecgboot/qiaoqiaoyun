var J=Object.defineProperty;var x=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var F=(l,o,s)=>o in l?J(l,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[o]=s,H=(l,o)=>{for(var s in o||(o={}))K.call(o,s)&&F(l,s,o[s]);if(x)for(var s of x(o))z.call(o,s)&&F(l,s,o[s]);return l};var b=(l,o,s)=>new Promise((p,D)=>{var M=n=>{try{g(s.next(n))}catch(v){D(v)}},S=n=>{try{g(s.throw(n))}catch(v){D(v)}},g=n=>n.done?p(n.value):Promise.resolve(n.value).then(M,S);g((s=s.apply(l,o)).next())});import{f as T,r as Q,a2 as V,as as W,n as Y}from"./vue-vendor-24c7dc61.js";import{k as N,a as G,M as _,f as X,N as Z,e as $}from"./index-831af9dd.js";import"./index-1c3affea.js";const ee=l=>{const o="/sys/annountCement/vue3List";return N.get({url:o,params:l})};function re(){const{createMessage:l}=G(),o=_("rangeDate"),s=T([]),p=T(1);let D=10;const M=Q({fromUser:"",rangeDateKey:"",rangeDate:[],starFlag:""});function S(){let{fromUser:r,rangeDateKey:m,rangeDate:y,starFlag:A}=M,h={fromUser:r,starFlag:A,rangeDateKey:m,beginDate:"",endDate:"",pageNo:p.value,pageSize:D};return m=="zdy"&&(h.beginDate=y[0]+" 00:00:00",h.endDate=y[1]+" 23:59:59"),h}const g=T(!1);function n(){return b(this,null,function*(){if(g.value===!0)return;let r=S();const m=yield ee(r);if(!m||m.length<=0){g.value=!0;return}m.length<D&&(g.value=!0),p.value=p.value+1;let y=s.value;y.push(...m),s.value=y})}function v(){s.value=[],p.value=1,g.value=!1}function I(r){return b(this,null,function*(){const m="/sys/sysAnnouncementSend/edit";let y="1";r.starFlag==y&&(y="0");const A={starFlag:y,id:r.sendId},h=yield N.put({url:m,params:A},{isTransformResponse:!1});h.success===!0||l.warning(h.message)})}const w=T(!1);function k(){return b(this,null,function*(){w.value=!0,yield n(),w.value=!1})}function R(r){return r.readFlag!=="1"}function O(r){return r.busType=="email"?"邮件提醒:":r.busType=="bpm"?"流程催办:":r.busType=="bpm_cc"?"流程抄送:":r.busType=="bpm_task"?"流程任务:":r.msgCategory=="2"?"系统消息:":r.msgCategory=="1"?"通知公告:":""}function P(r){return r.busType==="bpm"||r.busType==="bpm_task"||r.busType==="tenant_invite"?"去处理":"查看详情"}return{messageList:s,reset:v,loadData:n,loadEndStatus:g,searchParams:M,updateStarMessage:I,onLoadMore:k,noRead:R,getMsgCategory:O,getHrefText:P}}function oe(l,o){const s=_("messageHref"),p=V(),D=X(),M=W(),{close:S,closeSameRoute:g}=Z(),n=T(null),v=T({}),I=T({}),w=T({});function k(e,t){return b(this,null,function*(){switch(n.value=null,v.value=H({},t),e){case"task":w.value={actionType:"todo"},n.value="ProcessTaskHandleModal";break;case"history":w.value={},n.value="MyTaskHandleModal";break;case"design":n.value="DesformViewModal",w.value={showRecordCopy:!1,showRecordShare:!1,showRecordSysPrint:!1,showDesignFormBtn:!1};break;default:n.value=null;break}R(),yield Y(()=>{var a;(a=I.value[n.value])!=null&&a.isRegister&&I.value[n.value].modalMethods.openModal(!0,v.value)})})}function R(){if(n.value&&!I.value[n.value]){const[e,t]=$();I.value[n.value]={isRegister:!1,register:O(e,t),modalMethods:t}}}function O(e,t){return(...a)=>b(this,null,function*(){yield e(...a),t.openModal(!0,v.value),I.value[n.value].isRegister=!0})}function P(e,t){return b(this,null,function*(){if(!e.busType||e.busType=="msg_node")t?t():yield h(e);else if(e.busType=="comment"){let a=e.msgAbstract;if(a)try{let i=JSON.parse(a.toString());i.type=="designForm"&&r(i)}catch(i){t&&t()}}else e.busType=="tenant_invite"?o.isLowApp===!0?p.push({name:"myapps-settings-user",query:{page:"tenantSetting"}}):p.push({name:"system-usersetting",query:{page:"tenantSetting"}}):o&&o.isLowApp===!0?y(e):yield A(e)})}function r(e){k("design",{mode:"detail",desformCode:e.code,dataId:e.dataId,isOnline:!1})}function m(e){if(e.busType=="comment"){let t=e.msgAbstract;if(t)try{if(JSON.parse(t).type=="designForm")return!0}catch(a){}}return!1}function y(e){const{busType:t,busId:a,msgAbstract:i}=e;let u=s.filter(f=>f.value===t);if(!u||u.length==0||t.indexOf("bpm")<0)return;let c={detailId:a};if(i)try{let f=JSON.parse(i);Object.keys(f).map(d=>{c[d]=f[d]})}catch(f){}k("task",{record:{id:a,procInsId:c.procInsId,processDefinitionId:c.processDefinitionId,isDetail:c.taskDetail||t=="bpm_cc"}})}function A(e){return b(this,null,function*(){const{busType:t,busId:a,msgAbstract:i}=e;let u=s.filter(d=>d.value===t);if(!u||u.length==0)return;let c=u[0].text;c=c.replace("{DETAIL_ID}",a);let f={detailId:a};if(i)try{let d=JSON.parse(i);Object.keys(d).map(U=>{f[U]=d[U]})}catch(d){}f.taskDetail?yield C(f.procInsId):(D.setMessageHrefParams(f),M.path.indexOf(c)>=0?(yield S(),yield p.replace({path:c,query:{time:new Date().getTime()}})):(g(c),yield p.push({path:c})))})}function h(e){return b(this,null,function*(){l("detail",e)})}function C(e){return b(this,null,function*(){let{formData:t,formUrl:a}=yield j({processInstanceId:e});t.PROCESS_TAB_TYPE="history",k("history",{formData:t,formUrl:a,title:"流程历史"})})}const L="/act/process/extActProcessNode/getHisProcessNodeInfo",q=e=>N.get({url:L,params:e});function j(e){return b(this,null,function*(){let t={procInstId:e.processInstanceId};const a=yield q(t);let i={dataId:a.dataId,taskId:e.id,taskDefKey:e.taskId,procInsId:e.processInstanceId,tableName:a.tableName,vars:a.records},u=a.formUrl;return u&&u.indexOf("?")!=-1&&!E(u)&&u.indexOf("{{DOMAIN_URL}}")==-1&&(u=a.formUrl.split("?")[0],i.extendUrlParams=B(a.formUrl)),{formData:i,formUrl:u}})}function B(e){if(!e)return;let t,a,i,u=e.split("?")[1],c={};t=u.split("&"),i=null,a=null;for(let f in t){let d=t[f].indexOf("=");d!==-1&&(i=t[f].substr(0,d),a=t[f].substr(d+1),c[i]=a)}return c}function E(e){return/^http[s]?:\/\/.*/.test(e)}return{goPage:P,isDesignFormComment:m,modalRegCache:I,currentModal:n,bindParams:w}}export{re as a,oe as u};
