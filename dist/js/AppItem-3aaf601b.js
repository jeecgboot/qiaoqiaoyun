var fe=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Y=(e,o,i)=>o in e?fe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,Z=(e,o)=>{for(var i in o||(o={}))he.call(o,i)&&Y(e,i,o[i]);if(X)for(var i of X(o))Ce.call(o,i)&&Y(e,i,o[i]);return e},x=(e,o)=>me(e,ge(o));var C=(e,o,i)=>new Promise((v,O)=>{var B=f=>{try{h(i.next(f))}catch(c){O(c)}},k=f=>{try{h(i.throw(f))}catch(c){O(c)}},h=f=>f.done?v(f.value):Promise.resolve(f.value).then(B,k);h((i=i.apply(e,o)).next())});import{bP as ye,bQ as ve,n as ke,a_ as we,bR as _e,a$ as Ae,bS as Ie,bT as Oe,bU as Se,bv as be}from"./antd-vue-vendor-0d72f01e.js";import De from"./AppColorSelector-317f3131.js";import Ne from"./AppCoverSelector-235d9d43.js";import{d as Ee,f as y,w as ee,r as Be,h as oe,I as Me,a2 as Ue,l as te,a3 as Fe,a4 as Re,a5 as a,V as p,a6 as u,a7 as A,a8 as Ge,af as g,ai as d,k as r,z as Ve,W as E,ak as ne,F as ae,am as Pe,E as Te,ae as q}from"./vue-vendor-24c7dc61.js";import{R as ze,a7 as Le,e as se,a as $e,l as je}from"./index-831af9dd.js";import{f as M}from"./low.app.api-97fc250a.js";import{u as We}from"./useAppCurd-f2486678.js";import Qe from"./AppDeleteConfirm-a0947474.js";import"./index-1c3affea.js";import{g as qe}from"./index-b510c86d.js";import{g as He}from"./VipPay.api-469f07f9.js";import Je from"./CopyConfirmModal-db84aff0.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./lowAppAuth-3d637b7d.js";import"./lowAppUtils-56892d30.js";const Ke=Ee({name:"AppItem",props:{info:{type:Object,default:()=>{}},update:{type:Boolean,default:!1},appGroupList:{type:Array,default:()=>[]},relations:{type:Array,default:()=>[]}},emits:["success","groupChange"],components:{ScheduleOutlined:ye,WarningOutlined:ve,SearchOutlined:ke,AppIconSelector:Ne,AppColorSelector:De,Icon:ze,EditOutlined:we,CopyOutlined:_e,DeleteOutlined:Ae,StarFilled:Ie,StarOutlined:Oe,EllipsisOutlined:Se,LogoutOutlined:be,AppDeleteConfirm:Qe,CopyConfirmModal:Je},setup(e,{emit:o}){const{createInfoModal:i,createMessage:v}=$e(),O=Le(),[B,{openModal:k}]=se(),[h,{openModal:f}]=se(),c=y(!1),w=y(!1);ee(()=>e.update,t=>{t===!0&&(c.value=!0,w.value=!1)},{immediate:!0});const s=Be({id:"",appName:"",iconType:"",iconBackColor:"",starStatus:0,maintStatus:0,appCoverImg:""});function U(){return s.maintStatus===1}const S=y(!1),b=y(!1);oe(()=>{if(e.info&&e.info.id){Object.keys(s).map(n=>{s[n]=e.info[n]});let t=O.getUserInfo.id;e.info.ownerId==t?S.value=!0:S.value=!1,e.info.hasAdmin===!0?b.value=!0:b.value=!1}}),ee(c,t=>C(this,null,function*(){if(t===!1){let n=Me(s);yield L(n)}}));const D=y(!1);function F(t){return t==null?void 0:t.parentNode.parentNode.parentNode}function R(){return e.update||D.value||c.value?"shape-chunk active":"shape-chunk"}function G(){k(!0,{appId:s.id,appName:s.appName})}function V(){o("success",{})}function P(t){let n=t.key;if(n=="update")c.value=!0,w.value=!1;else if(n=="copy"){if(!He()){v.warning("您还不是会员，请升级会员后再次重试");return}f(!0,{name:s.appName})}else n=="delete"?G():n=="out"&&i({title:()=>te("span",{style:{color:"rgb(244, 67, 54)","font-size":"17px"}},"您确认退出此应用吗?"),content:"退出此应用后，您将无法访问此应用",width:480,okText:"确定",icon:" ",okButtonProps:{danger:!0},cancelText:"取消",okCancel:!0,onOk:function(){T()},onCancel:function(){}});D.value=!1}function T(){return C(this,null,function*(){const t=yield M.outOfApp(s.id);if(t.success)v.success("操作成功!"),o("success",{});else{let n=t.result,m="无法退出通过部门加入的应用",_="您所在的部门被加入了此应用，只能由应用管理员进行操作";n=="sys_role"?(m="无法退出通过组织角色加入的应用",_="您所在的组织角色被加入了此应用，只能由应用管理员进行操作"):n=="sys_position"&&(m="无法退出通过职位加入的应用",_="您所在的职位被加入了此应用，只能由应用管理员进行操作"),i({title:()=>te("span",{style:{color:"rgb(244, 67, 54)","font-size":"17px"}},m),content:_,width:480,okText:"关闭",icon:" ",onOk:function(){}})}})}function z(t){return C(this,null,function*(){let n=x(Z({},t),{id:s.id});(yield M.copy(n))&&v.success("复制成功!"),o("success",{})})}function L(t){return C(this,null,function*(){if(w.value===!0){let n=e.info;(s.appCoverImg!=n.appCoverImg||s.appName!=n.appName||s.iconType!=n.iconType||s.iconBackColor!=n.iconBackColor)&&(yield M.saveOrUpdate(t,!0))}o("groupChange")})}function $(){w.value=!0}const l=Ue();function N(t){t.preventDefault(),t.stopPropagation();let n=s.id;l.push({path:`/myapp/${n}`})}function le(t){return C(this,null,function*(){t.preventDefault(),t.stopPropagation();let n={id:s.id,starStatus:1};s.starStatus==1&&(n.starStatus=0),yield M.saveOrUpdate(n,!0),o("groupChange")})}const j=y([]),H=y("");oe(()=>{let t=e.appGroupList;if(!t||t.length==0)j.value=[];else{let n="";e.info&&e.info.id&&(n=e.info.id);let m=[];for(let _ of t){let W={id:_.id,groupName:_.groupName,checked:!1},Q=e.relations;if(Q&&Q.length>0){let J=Q.filter(K=>K.appId==n&&W.id==K.groupId);J&&J.length>0&&(W.checked=!0)}m.push(W)}j.value=m}});const{addAppGroupRelation:ie,removeAppGroupRelation:pe}=We();function re(t,n){return C(this,null,function*(){t.preventDefault(),t.stopPropagation();let m={groupId:n.id,appId:s.id};n.checked===!0?yield pe(m):yield ie(m),o("groupChange")})}function ue(t){let n=H.value;return!n||t.groupName.indexOf(n)>=0}function de(){return qe(s.appCoverImg)}function ce(){c.value=!1}return{showUpdateInfo:c,lowAppInfo:s,getPopupContainer:F,actionVisible:D,getShapeClass:R,handleActionClick:P,registerDeleteModal:B,deleteOk:V,onOpenApp:N,onDataChange:$,onChangeStar:le,selectGroupOptions:j,onChangeGroupSelect:re,filterValue:H,isFilterGroup:ue,isAdmin:b,isOwner:S,isMaintaining:U,getRandomSrc:de,registerCopyModal:h,doCopyApp:z,closeShowUpdateInfo:ce}}});const I=e=>(Fe("data-v-25e07fa1"),e=e(),Re(),e),Xe={class:"jee-app-item"},Ye={class:"event-chunk",style:{padding:"0",width:"230px","border-radius":"12px",overflow:"hidden","box-shadow":"0 1px 5px rgba(38, 38, 38, 0.1)"}},Ze=["src"],xe={style:{padding:"0 12px"}},eo=["src"],oo={key:0,class:"app-item-maintaining",style:{left:"0","margin-bottom":"10px"}},to={style:{display:"flex","align-items":"center","flex-direction":"row",padding:"8px"}},no=["title"],ao={style:{width:"24px"}},so={class:"min_star_list_item_more",style:{height:"16px"}},lo=I(()=>a("span",{class:"label"},"修改名称和主题",-1)),io=I(()=>a("span",{class:"label"},"复制应用",-1)),po=I(()=>a("span",{class:"label"},"设置分组",-1)),ro={class:"sub-menu-content"},uo={class:"search-div"},co={class:"groups"},fo=I(()=>a("div",{class:"title"},"个人",-1)),mo=["onClick"],go={class:"group-name"},ho=I(()=>a("span",{class:"label"},"删除应用",-1)),Co=I(()=>a("span",{class:"label"},"退出应用",-1)),yo={class:"app-item-star"};function vo(e,o,i,v,O,B){const k=p("a-input"),h=p("AppColorSelector"),f=p("AppIconSelector"),c=p("a-dropdown"),w=p("EditOutlined"),s=p("a-menu-item"),U=p("CopyOutlined"),S=p("Icon"),b=p("SearchOutlined"),D=p("a-checkbox"),F=p("a-sub-menu"),R=p("DeleteOutlined"),G=p("LogoutOutlined"),V=p("a-menu"),P=p("StarFilled"),T=p("StarOutlined"),z=p("a-tooltip"),L=p("AppDeleteConfirm"),$=p("CopyConfirmModal");return u(),A("div",Xe,[a("div",{class:Ge(e.getShapeClass()),style:{height:"auto"}},[a("div",Ye,[e.showUpdateInfo?(u(),g(c,{key:0,open:e.showUpdateInfo,"onUpdate:open":o[4]||(o[4]=l=>e.showUpdateInfo=l),placement:"bottom",trigger:["click"],overlayClassName:"app-update-dropdown",getPopupContainer:e.getPopupContainer},{overlay:d(()=>[a("div",null,[a("div",xe,[r(k,{value:e.lowAppInfo.appName,"onUpdate:value":o[1]||(o[1]=l=>e.lowAppInfo.appName=l),style:{width:"100%","text-align":"center"},onChange:e.onDataChange},null,8,["value","onChange"])]),a("div",null,[r(h,{value:e.lowAppInfo.iconBackColor,"onUpdate:value":o[2]||(o[2]=l=>e.lowAppInfo.iconBackColor=l),onChange:e.onDataChange},null,8,["value","onChange"])]),a("div",null,[r(f,{value:e.lowAppInfo.appCoverImg,"onUpdate:value":o[3]||(o[3]=l=>e.lowAppInfo.appCoverImg=l),onChange:e.onDataChange,color:e.lowAppInfo.iconBackColor},null,8,["value","onChange","color"])])])]),default:d(()=>[a("div",{class:"icon",style:{width:"230px",height:"100px"},onClick:o[0]||(o[0]=Ve(()=>{},["prevent"]))},[a("div",null,[a("img",{src:e.getRandomSrc(),style:{height:"100px",width:"230px"}},null,8,Ze)])])]),_:1},8,["open","getPopupContainer"])):(u(),A("div",{key:1,class:"icon",style:{width:"230px",height:"100px"},onClick:o[5]||(o[5]=(...l)=>e.onOpenApp&&e.onOpenApp(...l))},[a("div",null,[a("img",{src:e.getRandomSrc(),style:{height:"100px",width:"230px"}},null,8,eo)]),e.isMaintaining()?(u(),A("div",oo," 维护中 ")):E("",!0)])),a("div",to,[a("div",{onClick:o[6]||(o[6]=(...l)=>e.onOpenApp&&e.onOpenApp(...l)),style:{flex:"1",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},title:e.lowAppInfo.appName},ne(e.lowAppInfo.appName),9,no),a("div",ao,[r(c,{open:e.actionVisible,"onUpdate:open":o[8]||(o[8]=l=>e.actionVisible=l),trigger:["hover"],overlayClassName:"app-item-actions-dropdown"},{overlay:d(()=>[r(V,{onClick:e.handleActionClick},{default:d(()=>[e.isAdmin||e.isOwner?(u(),g(s,{key:"update"},{default:d(()=>[r(w,{style:{"margin-right":"10px"}}),lo]),_:1})):E("",!0),e.isAdmin||e.isOwner?(u(),g(s,{key:"copy"},{default:d(()=>[r(U,{style:{"margin-right":"10px"}}),io]),_:1})):E("",!0),e.selectGroupOptions&&e.selectGroupOptions.length>0&&(e.isAdmin||e.isOwner)?(u(),g(F,{key:"4",class:"has-sub-menu",popupClassName:"low-app-app-group-select-pop"},{title:d(()=>[r(S,{icon:"ant-design:setting-outlined",style:{"margin-right":"10px"}}),po]),default:d(()=>[a("div",ro,[a("div",uo,[r(k,{placeholder:"搜索分组",class:"my-input",value:e.filterValue,"onUpdate:value":o[7]||(o[7]=l=>e.filterValue=l)},{prefix:d(()=>[r(b,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),a("div",co,[fo,(u(!0),A(ae,null,Pe(e.selectGroupOptions,l=>(u(),A(ae,null,[e.isFilterGroup(l)?(u(),A("div",{key:0,class:"group-item",onClick:N=>e.onChangeGroupSelect(N,l)},[a("div",go,[r(D,{checked:l.checked,"onUpdate:checked":N=>l.checked=N},{default:d(()=>[Te(ne(l.groupName),1)]),_:2},1032,["checked","onUpdate:checked"])])],8,mo)):E("",!0)],64))),256))])])]),_:1})):E("",!0),e.isOwner?(u(),g(s,{key:"delete",class:"delete-item"},{default:d(()=>[r(R,{style:{"margin-right":"10px"}}),ho]),_:1})):(u(),g(s,{key:"out",class:"delete-item"},{default:d(()=>[r(G,{style:{"margin-right":"10px"}}),Co]),_:1}))]),_:1},8,["onClick"])]),default:d(()=>[a("span",so,[a("i",{style:q({"background-color":e.lowAppInfo.iconBackColor})},null,4),a("i",{style:q({"background-color":e.lowAppInfo.iconBackColor})},null,4),a("i",{style:q({"background-color":e.lowAppInfo.iconBackColor})},null,4)])]),_:1},8,["open"])])])]),a("div",yo,[r(z,{placement:"bottom",title:e.lowAppInfo.starStatus==1?"取消标星":"标星"},{default:d(()=>[e.lowAppInfo.starStatus==1?(u(),g(P,{key:0,onClick:e.onChangeStar,style:{color:"rgb(255, 196, 0)","font-size":"24px"}},null,8,["onClick"])):(u(),g(T,{key:1,onClick:e.onChangeStar,style:{"font-size":"24px"}},null,8,["onClick"]))]),_:1},8,["title"])])],2),r(L,{onRegister:e.registerDeleteModal,onSuccess:e.deleteOk},null,8,["onRegister","onSuccess"]),r($,{onRegister:e.registerCopyModal,onCopy:e.doCopyApp},null,8,["onRegister","onCopy"])])}const zo=je(Ke,[["render",vo],["__scopeId","data-v-25e07fa1"]]);export{zo as default};
