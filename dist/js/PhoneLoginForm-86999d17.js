var ne=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var O=(s,e,o)=>e in s?ne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,V=(s,e)=>{for(var o in e||(e={}))ae.call(e,o)&&O(s,o,e[o]);if(A)for(var o of A(e))le.call(e,o)&&O(s,o,e[o]);return s},K=(s,e)=>te(s,se(e));var C=(s,e,o)=>new Promise((x,t)=>{var c=m=>{try{f(o.next(m))}catch(a){t(a)}},p=m=>{try{f(o.throw(m))}catch(a){t(a)}},f=m=>m.done?x(m.value):Promise.resolve(m.value).then(c,p);f((o=o.apply(s,e)).next())});import{d as W,f as u,r as q,e as d,u as l,V as k,a6 as h,af as S,ai as I,a5 as g,k as b,a8 as R,ak as T,E as ie,a7 as re,W as ue,at as ce,I as me}from"./vue-vendor-24c7dc61.js";import{a7 as de,a as H,o as fe,bt as ve,bu as pe,l as ge}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";const be=W({name:"phone-login-form"}),ye=W(K(V({},be),{props:{bindThirdAccount:{type:Boolean,default:!1}},emits:["login","login-success","bind-third-phone"],setup(s,{emit:e}){const o=s,{createMessage:x}=H(),{t}=fe(),c=u(""),p=u(!1),f=u(),m=q({randCodeImage:"",requestCodeSuccess:!1,checkKey:-1}),a=q({mobile:"",sms:""}),$=de(),_e=u(!1),z=d(()=>a.mobile!=""||l(c)==="mobile"?"current-active":""),G=d(()=>a.sms!=""||l(c)==="sms"?"current-active":""),{notification:j,createErrorModal:Ce}=H(),w=u(!0),v=u(60),y=u(null),B=u(),E=u(),J=d(()=>P(t("sys.login.accountPlaceholder"))),Q=d(()=>P(t("sys.login.smsPlaceholder"))),X=d(()=>({mobile:l(J),sms:l(Q)})),L=d(()=>t("component.countdown.normalText")),M=d(()=>t("component.countdown.sendText",[l(v)]));function P(i){return[{required:!0,message:i,trigger:"change"}]}function U(i){c.value=i,i==="sms"?B.value.focus():E.value.focus()}function D(){c.value=""}function F(){return C(this,null,function*(){f.value.validateFields().then(i=>C(this,null,function*(){if(o.bindThirdAccount)e("bind-third-phone",i);else try{p.value=!0;const{userInfo:n}=yield $.phoneLogin(me({mobile:i.mobile,captcha:i.sms,mode:"none",goHome:!1}));n&&e("login-success",n.realname)}catch(n){j.error({message:t("sys.api.errorTip"),description:n.message||t("sys.api.networkExceptionMsg"),duration:3})}finally{p.value=!1}}))})}function Y(){return C(this,null,function*(){if(!a.mobile){x.warn(t("sys.login.mobilePlaceholder"));return}(yield ve({mobile:a.mobile,smsmode:pe.FORGET_PASSWORD}))&&(l(y)||(v.value=60,w.value=!1,y.value=setInterval(()=>{l(v)>0&&l(v)<=60?v.value=v.value-1:(w.value=!0,clearInterval(l(y)),y.value=null)},1e3)))})}function Z(){e("login","accountLogin")}return(i,n)=>{const _=k("a-input"),N=k("a-form-item"),ee=k("a-button"),oe=k("a-form");return h(),S(oe,{ref_key:"loginPhoneRef",ref:f,model:a,rules:X.value,onKeyup:ce(F,["enter","native"])},{default:I(()=>[g("div",{class:R(["content-item",z.value]),onClick:n[1]||(n[1]=r=>U("mobile"))},[b(N,{name:"mobile"},{default:I(()=>[b(_,{ref_key:"mobileRef",ref:E,value:a.mobile,"onUpdate:value":n[0]||(n[0]=r=>a.mobile=r),style:{height:"40px"},onBlur:D},null,8,["value"]),g("div",{class:R(["form-title",c.value==="mobile"?"active-title":""])},T(l(t)("sys.login.mobile")),3)]),_:1})],2),g("div",{class:R(["content-item",G.value])},[b(N,{name:"sms",onClick:n[3]||(n[3]=r=>U("sms"))},{default:I(()=>[b(_,{ref_key:"smsCodeRef",ref:B,maxLength:6,value:a.sms,"onUpdate:value":n[2]||(n[2]=r=>a.sms=r),style:{height:"40px"},onBlur:D},null,8,["value"]),g("div",{class:R(["form-title",c.value==="sms"?"active-title":""])},T(l(t)("sys.login.smsCode")),3)]),_:1}),w.value?(h(),S(_,{key:0,type:"button",class:"aui-code-line pointer",bordered:!1,onClick:Y,value:L.value,"onUpdate:value":n[4]||(n[4]=r=>L.value=r)},null,8,["value"])):(h(),S(_,{key:1,type:"button",class:"aui-code-line disabled-btn",bordered:!1,value:M.value,"onUpdate:value":n[5]||(n[5]=r=>M.value=r)},null,8,["value"]))],2),g("div",null,[b(ee,{type:"primary",onClick:F,loading:p.value,class:"login-btn"},{default:I(()=>[ie(T(l(t)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),o.bindThirdAccount?ue("",!0):(h(),re("div",{key:0,class:"phone-login-btn pointer",onClick:Z},T(l(t)("sys.login.backSignIn")),1))]),_:1},8,["model","rules","onKeyup"])}}}));const xe=ge(ye,[["__scopeId","data-v-67d56c78"]]);export{xe as default};
