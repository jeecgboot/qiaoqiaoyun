var O=Object.defineProperty,V=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var P=(s,o,e)=>o in s?O(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e,C=(s,o)=>{for(var e in o||(o={}))A.call(o,e)&&P(s,e,o[e]);if(M)for(var e of M(o))N.call(o,e)&&P(s,e,o[e]);return s},S=(s,o)=>V(s,j(o));var k=(s,o,e)=>new Promise((_,i)=>{var v=r=>{try{c(e.next(r))}catch(p){i(p)}},t=r=>{try{c(e.throw(r))}catch(p){i(p)}},c=r=>r.done?_(r.value):Promise.resolve(r.value).then(v,t);c((e=e.apply(s,o)).next())});import{d as I,f as U,r as T,V as w,a6 as $,af as E,ai as m,k as l,a5 as f,u as g,ag as F,a3 as H,a4 as Z}from"./vue-vendor-24c7dc61.js";import{B as D}from"./index-1c3affea.js";import{k as G}from"./UserSetting.api-d09d4ebb.js";import{j as J,a7 as K,a as Q,k as W,l as X}from"./index-831af9dd.js";import{C as Y}from"./index-f99b266a.js";import"./BasicModal-58413bab.js";import"./antd-vue-vendor-0d72f01e.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const y=s=>(H("data-v-4c7958d5"),s=s(),Z(),s),ee=y(()=>f("div",{class:"black font-size-13"},"验证手机号",-1)),se={class:"pass-padding"},oe=y(()=>f("span",{class:"black font-size-13"},"新密码",-1)),ae={class:"pass-padding"},te=y(()=>f("span",{class:"gray-9e font-size-13"},"8-20位，需包含字母和数字",-1)),re=I({name:"user-pass-word-modal"}),ne=I(S(C({},re),{emits:["success","register"],setup(s,{emit:o}){const{createMessage:e,createErrorModal:_}=Q(),i=U(""),v=U(),t=T({oldpassword:"",password:"",smscode:"",phone:""}),[c,{setModalProps:r,closeModal:p}]=J(n=>k(this,null,function*(){r({confirmLoading:!1}),i.value=n.record.username,Object.assign(t,{password:"",smscode:"",phone:""})})),R=K(),b={password:[{required:!0,validator:x},{pattern:/^(?=.*[0-9])(?=.*[a-zA-Z])(.{8,20})$/,message:"8-20位，需包含字母和数字"}],phone:[{required:!0,message:"请输入手机号"}],smscode:[{required:!0,message:"请输入6位验证码"}]};function B(){return k(this,null,function*(){try{let n=yield v.value.validateFields();r({confirmLoading:!0}),n.username=g(i),yield G(n).then(a=>{a.success?(e.info({content:"密码修改成功，请重新登录！3s后自动退出登录",duration:3}),setTimeout(()=>{R.logout(!0)},3e3),p()):e.warn(a.message)})}finally{r({confirmLoading:!1})}})}function x(n,a){return a===""?Promise.reject("请输入新密码"):Promise.resolve()}function z(){return new Promise((n,a)=>{let h={mobile:t.phone};W.post({url:"/sys/sendChangePwdSms",params:h},{isTransformResponse:!1}).then(d=>{d.success?n(!0):(_({title:"错误提示",content:d.message||"未知问题"}),a())}).catch(d=>{_({title:"错误提示",content:d.message||"未知问题"}),a()})})}return(n,a)=>{const h=w("a-input"),d=w("a-form-item"),q=w("a-input-password"),L=w("a-form");return $(),E(g(D),F(n.$attrs,{onRegister:g(c),title:"修改密码",onOk:B,destroyOnClose:"",width:400}),{default:m(()=>[l(L,{class:"antd-modal-form",ref_key:"formRef",ref:v,model:t,rules:b},{default:m(()=>[l(d,{name:"phone"},{default:m(()=>[ee,f("div",se,[l(h,{placeholder:"请输入手机号",value:t.phone,"onUpdate:value":a[0]||(a[0]=u=>t.phone=u)},null,8,["value"])])]),_:1}),l(d,{name:"smscode"},{default:m(()=>[l(g(Y),{value:t.smscode,"onUpdate:value":a[1]||(a[1]=u=>t.smscode=u),placeholder:"请输入6位验证码",sendCodeApi:z},null,8,["value"])]),_:1}),l(d,{name:"password"},{default:m(()=>[oe,f("div",ae,[l(q,{value:t.password,"onUpdate:value":a[2]||(a[2]=u=>t.password=u),placeholder:"新密码",autocomplete:"new-password"},null,8,["value"])]),te]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister"])}}}));const we=X(ne,[["__scopeId","data-v-4c7958d5"]]);export{we as default};
