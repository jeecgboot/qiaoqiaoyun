var ve=Object.defineProperty,ye=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var ee=(t,n,y)=>n in t?ve(t,n,{enumerable:!0,configurable:!0,writable:!0,value:y}):t[n]=y,w=(t,n)=>{for(var y in n||(n={}))_e.call(n,y)&&ee(t,y,n[y]);if(x)for(var y of x(n))ge.call(n,y)&&ee(t,y,n[y]);return t},O=(t,n)=>ye(t,he(n));import{d as Ce,f as V,h as ke,e as te,w as le,I as H,n as we,a5 as c,V as g,a6 as a,a7 as p,F as C,am as $,af as G,ai as d,k as r,E as h,ak as q,z as oe,W as F,a8 as Fe,O as be,ap as Be,aq as qe}from"./vue-vendor-24c7dc61.js";import{aC as Se,n as Le,av as Te,aZ as Pe,cm as Re,p as A}from"./antd-vue-vendor-0d72f01e.js";import{D as $e,a as Ge,l as Me}from"./index-831af9dd.js";import{s as ne,d as ie}from"./type.definition-4eb605ee.js";import{c as Oe,u as Ve}from"./LinkRecordSelect-385d0eae.js";import{C as Ie}from"./ComponentIcon-f1bbb90f.js";import De from"./SuperQueryValComponent-97f284a9.js";import"./vxe-table-vendor-8813019a.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./helper-22dafba0.js";const Ne=Ce({name:"FilterFieldListNew",components:{PlusOutlined:Se,SearchOutlined:Le,CloseOutlined:Te,TableOutlined:Pe,OnlineSuperQueryValComponent:De,SaveOutlined:Re,ComponentIcon:Ie},emits:["save","copy","search","update:clear"],props:{columnList:{type:Array,default:()=>[]},info:{type:Object,require:!1,default:{}},saveButton:{type:Boolean,default:!0},clear:{type:Boolean,default:!1},emitChange:{type:String,default:""},parentContainer:{type:String,default:""}},setup(t,{emit:n}){const{getConditionOptions:y,getDefaultRule:J,getDefaultVal:K}=Ve(),N=V([]);function S(e){if(!e||e.length==0){N.value=[];return}let l=e.filter(s=>ie.includes(s.type)||ie.includes(s.realType)?s.type=="link-field"||s.realType==="link-field"?s.saveType==="save":!1:!0);N.value=l}const L=V(!1),k=V("and"),i=V([]),{getSchema:T,getFieldConfig:W}=Oe(t,!0,t.parentContainer),{createMessage:U}=Ge();ke(()=>{const e=t.columnList;S(e);const l=t.info;k.value=l.conditionType||"and";const s=[],f=l.conditionsGroup;if(Array.isArray(f))for(let P of f){const Q=[];for(const b of P.queryItems){let R="",B;if(B=e==null?void 0:e.find(D=>D.model==b.field),B||(B=ne.find(D=>D.field==b.field)),B&&(R=B.name),R){let D=A(b,"field","rule","val","type","timestamp");Q.push(O(w({},D),{name:R,reloading:!1}))}}P.queryItems=Q,s.push(P)}i.value=s});function E(e,l=0){let s=e.field||e.model,f=i.value[l],P=J(e.type),Q=K(e.type),b=[],R={field:s,rule:P,val:Q,type:e.type,name:e.name};if(f&&f.queryItems&&f.queryItems.length>0){let B=f.queryItems;B.push(w({},R)),i.value[l].queryItems=B}else f?(b.push(w({},R)),i.value[l].queryItems=b):(b.push(w({},R)),i.value.push({matchType:"and",queryItems:b}));i.value[l]&&(i.value[l].showPop=!1),L.value=!1}const M=V("");function z(e){let l=M.value;return l?e?e.name.indexOf(l)>=0:!1:!0}function I(){let e=[];for(const l of i.value){const s=[];for(const f of l.queryItems)if(_(f)){const P=A(f,"field","rule","type","timestamp");s.push(O(w({},P),{val:H(f.val)}))}s.length>0&&e.push(O(w({},l),{queryItems:s}))}e.length>0?n("save",{conditionsGroup:e,conditionType:k.value}):U.warning("没有有效的条件值，不可保存！")}function u(){let e=[];for(let l of i.value)if(_(l)){let s=A(l,"field","rule","type","timestamp");e.push(O(w({},s),{val:H(l.val)}))}e.length>0&&n("copy",{conditionsGroup:e,conditionType:k.value})}function v(e,l){let s=i.value[e];s.queryItems.splice(l,1),i.value[e]=s,i.value.length==0&&(n("search",{conditionsGroup:[],conditionType:k.value}),n("update:clear",!1))}function o(e){let l=i.value;l.splice(e,1),i.value=l}function _(e){return e.val==="0"||e.val===0||e.val?!0:e.rule==="empty"||e.rule==="not_empty"}const m=te(()=>{if(t.saveButton===!1)return!1;let e=i.value;return!(!e||e.length==0)}),j=te(()=>{let e=i.value;if(!e||e.length==0)return!1;let l=!1;for(let s=0;s<e.length;s++)if(_(e[s]))l=!0;else{l=!1;break}return l});le(()=>t.clear,e=>{e===!0&&(i.value=[],L.value=!0)},{immediate:!0});function se(e,l,s){s.val=l}function ae(e){const l=W(e.field);let s=e.type,f=y(s,l.multiple);return!f||f.length==0?[]:f}function re(){let e=[];for(let l of i.value){let s=A(l,"field","rule","type","timestamp");e.push(O(w({},s),{val:H(l.val)}))}e.length>0&&n("search",{conditionsGroup:e,conditionType:k.value})}const X=$e(re,800);le(i.value,()=>{X()},{deep:!0});function ue(){X()}function pe(e,l){e.reloading=!0,we(()=>{e.reloading=!1,i.value[l]&&(i.value[l].showPop=!1)})}function de(){if(i.value.length==0)for(let e=0;e<2;e++)Y();else Y()}function Y(){i.value.push({matchType:"and",showPop:!1,queryItems:[]})}const Z=V("");function ce(e){Z.value=e}function fe(){Z.value=""}function me(e){i.value[e]&&(i.value[e].showPop=!0)}return{conditionsGroupList:i,getOptions:ae,conditionRelation:k,systemFields:ne,showPop:L,filterValue:M,onSelectField:E,isFilterItem:z,saveCondition:I,copyCondition:u,onRemove:v,showSave:m,getSchema:T,saveable:j,setFormModel:se,filterColumnList:N,onRelationChange:ue,onConditionRuleChange:pe,addFilterGroup:de,queryIndex:Z,mouseMoveQuery:ce,mouseLeaveQuery:fe,showPopField:me,onConRemove:o}}});const Ue={class:"config-detail",style:{"padding-top":"0"}},Ee={class:"condition-item",style:{"margin-top":"12px",padding:"0 16px"}},ze={key:0,style:{display:"flex"}},Qe={style:{"font-size":"13px"}},Ae={class:"icon-remove",style:{position:"relative",top:"4px"}},We={class:"children-query",style:{"margin-top":"20px"}},je=["onMousemove"],Ze={style:{width:"50px"}},He={key:0,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0 0 6px"}},Je={key:1,class:"condition-rela"},Ke={key:2,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0 0 7px"}},Xe={style:{display:"flex",flex:"1","flex-direction":"column"}},Ye={style:{"margin-bottom":"2px",display:"flex"}},xe={style:{flex:"1"}},et={style:{"margin-right":"10px","max-width":"100px","font-weight":"bold"}},tt={class:"condition-select",style:{width:"100px"}},lt={style:{width:"100%","margin-top":"0"},class:"condition-val"},ot={class:"field-list"},nt=["onClick"],it=c("div",{class:"split"},null,-1),st=["onClick"],at=["onClick"],rt={class:"field-list"},ut=["onClick"],pt=c("div",{class:"split"},null,-1),dt=["onClick"],ct={style:{width:"100%","text-align":"right",position:"relative"}};function ft(t,n,y,J,K,N){const S=g("a-select-option"),L=g("a-select"),k=g("a-divider"),i=g("close-outlined"),T=g("component-icon"),W=g("online-super-query-val-component"),U=g("search-outlined"),E=g("a-input"),M=g("PlusOutlined"),z=g("a-popover"),I=g("a-button");return a(),p("div",Ue,[(a(!0),p(C,null,$(t.conditionsGroupList,(u,v)=>(a(),p("div",Ee,[v>0?(a(),p("div",ze,[v===1?(a(),G(k,{key:0,style:{margin:"0"}},{default:d(()=>[r(L,{style:{width:"50px"},size:"small",value:t.conditionRelation,"onUpdate:value":n[0]||(n[0]=o=>t.conditionRelation=o)},{default:d(()=>[r(S,{value:"and"},{default:d(()=>[h("且")]),_:1}),r(S,{value:"or"},{default:d(()=>[h("或")]),_:1})]),_:1},8,["value"])]),_:1})):(a(),G(k,{key:1,style:{margin:"0"}},{default:d(()=>[c("span",Qe,q(t.conditionRelation==="and"?"且":"或"),1)]),_:1})),c("div",Ae,[r(i,{onClick:oe(o=>t.onConRemove(v),["prevent"])},null,8,["onClick"])])])):F("",!0),(a(!0),p(C,null,$(u.queryItems,(o,_)=>(a(),p("div",We,[c("div",{style:{display:"flex"},onMousemove:m=>t.mouseMoveQuery(v+"-"+_),onMouseleave:n[1]||(n[1]=(...m)=>t.mouseLeaveQuery&&t.mouseLeaveQuery(...m))},[c("div",Ze,[_===0?(a(),p("span",He,"当")):_===1?(a(),p("div",Je,[r(L,{style:{width:"50px"},size:"small",value:u.matchType,"onUpdate:value":m=>u.matchType=m,onChange:t.onRelationChange},{default:d(()=>[r(S,{value:"and"},{default:d(()=>[h("且")]),_:1}),r(S,{value:"or"},{default:d(()=>[h("或")]),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])])):(a(),p("span",Ke,q(u.matchType==="and"?"且":"或"),1))]),c("div",Xe,[c("div",Ye,[c("div",xe,[r(T,{type:o.type,style:{color:"rgb(158, 158, 158)"}},null,8,["type"]),c("span",et,q(o.name),1),c("span",tt,[r(L,{style:{"min-width":"70px"},size:"small",value:o.rule,"onUpdate:value":m=>o.rule=m,dropdownStyle:{minWidth:"120px"},onChange:m=>t.onConditionRuleChange(o,v)},{default:d(()=>[(a(!0),p(C,null,$(t.getOptions(o),m=>(a(),G(S,{value:m.value},{default:d(()=>[h(q(m.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value","onChange"])])]),c("div",{class:Fe(t.queryIndex==v+"-"+_?"icon-children-show":"icon-children-hide")},[r(i,{onClick:oe(m=>t.onRemove(v,_),["prevent"])},null,8,["onClick"])],2)]),c("div",lt,[o.reloading?F("",!0):(a(),G(W,{key:0,style:{width:"100%"},schema:t.getSchema(o,_),formModel:o,setFormModel:(m,j)=>{t.setFormModel(m,j,o)}},null,8,["schema","formModel","setFormModel"]))])])],40,je)]))),256)),t.conditionsGroupList.length>1?(a(),G(z,{key:1,overlayClassName:"view-pop-field-select",open:u.showPop,"onUpdate:open":o=>u.showPop=o,trigger:"click"},{content:d(()=>[c("div",ot,[(a(!0),p(C,null,$(t.filterColumnList,o=>(a(),p(C,null,[t.isFilterItem(o)?(a(),p("div",{key:0,class:"field-item",onClick:_=>t.onSelectField(o,v)},[c("div",null,[r(T,{type:o.type},null,8,["type"]),h(q(o.name),1)])],8,nt)):F("",!0)],64))),256)),it,(a(!0),p(C,null,$(t.systemFields,o=>(a(),p(C,null,[t.isFilterItem(o)?(a(),p("div",{key:0,class:"field-item",onClick:_=>t.onSelectField(o,v)},[c("div",null,[r(T,{type:o.type},null,8,["type"]),h(q(o.name),1)])],8,st)):F("",!0)],64))),256))])]),title:d(()=>[r(E,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":n[2]||(n[2]=o=>t.filterValue=o)},{prefix:d(()=>[r(U,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:d(()=>[c("span",{class:"add-button",style:{"margin-top":"20px",cursor:"pointer",width:"80px"},onClick:o=>t.showPopField(v)},[r(M),h(" 筛选 ")],8,at)]),_:2},1032,["open","onUpdate:open"])):F("",!0)]))),256)),t.conditionsGroupList.length<=1?(a(),G(z,{key:0,overlayClassName:"view-pop-field-select",open:t.showPop,"onUpdate:open":n[4]||(n[4]=u=>t.showPop=u),trigger:"click"},{content:d(()=>[c("div",rt,[(a(!0),p(C,null,$(t.filterColumnList,u=>(a(),p(C,null,[t.isFilterItem(u)?(a(),p("div",{key:0,class:"field-item",onClick:v=>t.onSelectField(u)},[c("div",null,[r(T,{type:u.type},null,8,["type"]),h(" "+q(u.name),1)])],8,ut)):F("",!0)],64))),256)),pt,(a(!0),p(C,null,$(t.systemFields,u=>(a(),p(C,null,[t.isFilterItem(u)?(a(),p("div",{key:0,class:"field-item",onClick:v=>t.onSelectField(u)},[c("div",null,[r(T,{type:u.type},null,8,["type"]),h(q(u.name),1)])],8,dt)):F("",!0)],64))),256))])]),title:d(()=>[r(E,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":n[3]||(n[3]=u=>t.filterValue=u)},{prefix:d(()=>[r(U,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:d(()=>[r(I,{class:"add-button add-filter",style:{"margin-top":"20px"},type:"text"},{default:d(()=>[r(M),h(" 添加筛选条件 ")]),_:1})]),_:1},8,["open"])):F("",!0),r(I,{class:"add-button add-filter",style:{"margin-top":"20px","margin-left":"20px"},type:"text",onClick:t.addFilterGroup},{default:d(()=>[r(M),h(" 筛选组 ")]),_:1},8,["onClick"]),c("div",ct,[t.showSave?(a(),G(I,{key:0,class:"save-button",onClick:t.saveCondition,style:{right:"14px"}},{default:d(()=>[h("保存")]),_:1},8,["onClick"])):F("",!0),be(t.$slots,"save-button",Be(qe({saveable:t.saveable})))])])}const cl=Me(Ne,[["render",ft]]);export{cl as default};
