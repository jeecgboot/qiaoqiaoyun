var h=(e,l,m)=>new Promise((c,p)=>{var i=t=>{try{u(m.next(t))}catch(r){p(r)}},f=t=>{try{u(m.throw(t))}catch(r){p(r)}},u=t=>t.done?c(t.value):Promise.resolve(t.value).then(i,f);u((m=m.apply(e,l)).next())});import{B as A}from"./index-1c3affea.js";import{d as q,f as d,u as v,o as R,b as j,a3 as z,a4 as G,a5 as n,V as x,a6 as _,af as H,ag as O,ai as J,ak as b,a7 as M,F as K,am as X,a8 as Y,E as w,k}from"./vue-vendor-24c7dc61.js";import{a7 as Z,j as ee,d as se,a as ae,b as te,bB as ne,l as oe}from"./index-831af9dd.js";import{d as le,e as ue}from"./VipPay.api-469f07f9.js";import{Q as ie}from"./Qrcode-8252d989.js";import{a as U,o as B,c as re}from"./useWebSocket-df578a5f.js";import{ae as de,an as ce}from"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppAuth-3d637b7d.js";import"./lowAppUtils-56892d30.js";import"./download-1ac6acce.js";const pe=q({name:"MyVipExpandModal",emits:["register","success"],components:{BasicModal:A,Qrcode:ie,Slider:de},setup(e,{emit:l}){const m=Z(),{createMessage:c}=ae(),p=d(""),i=d("file"),f=d(!1),u=d(""),t=d([]),r=d([]),a=d(10),g=d({}),E=d({}),[V,{setModalProps:D,closeModal:I}]=ee(s=>h(this,null,function*(){D({confirmLoading:!1,minHeight:400}),r.value="",i.value=s.type,s.type==="sms"?p.value="短信扩展包购买":s.type==="file"?p.value="上传资源扩展包购买":p.value="额外使用人数购买",a.value=10,U(C),B(C),yield P(s.type)})),$=se();function P(s){return h(this,null,function*(){i.value=s,s==="sms"?u.value="短信扩展包购买":s==="file"?u.value="上传资源扩展包购买":u.value="额外使用人数购买",f.value=!0,yield le({type:s,buyUserCount:v(a)}).then(o=>{if(o.success){if(i.value!="userCount")t.value=o.result;else{g.value.value=o.result[0].value,g.value.price=o.result[0].price,g.value.title=o.result[0].title,y(g.value);return}v(t)&&v(t).length>0&&y(t.value[0])}else c.warning(o.message)})})}function y(s){return h(this,null,function*(){r.value=s.value,yield ue({value:s.value,type:v(i)}).then(o=>{o.success?E.value=o.result:c.warning(o.message)})})}function T(){var S;let s=te(),o=ne(s),L=v(m.getUserInfo).id+"_"+o,N=((S=$.domainUrl)==null?void 0:S.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+L;re(N),B(C)}function C(s){s.cmd==="paySuccess"?(c.success("支付成功"),I(),l("success")):s.cmd==="payFail"?c.warning("支付失败!"):s.cmd==="hasBeenProcessed"&&c.warning("此订单已被处理过了，请勿重新发起支付!")}const Q=s=>`${s}人`,W=ce(s=>{(!v(a)||v(a)<10)&&(a.value=10),i.value="userCount",y({value:a.value})},100);return R(()=>{T()}),j(()=>{U(C)}),{registerModal:V,title:p,extendShow:f,extendTitle:u,extendList:t,extendValue:r,extendValueChange:y,msgData:E,extendType:i,userCountData:g,buyUserCountChange:W,buyUserCount:a,userCountFormatter:Q}}});const F=e=>(z("data-v-d012977c"),e=e(),G(),e),me={class:"expand-header-title"},ve={key:0,class:"expand-content"},fe=["onClick"],ge={class:"expand-title"},_e={class:"expand-price",style:{"margin-top":"10px"}},ye={class:"amount"},Ce={key:1,class:"expand-item",style:{"padding-left":"8px"}},he=F(()=>n("div",{class:"expand-count-title"},"人员数量",-1)),xe={class:"expand-pay"},be={class:"expand-code"},Me={class:"expand-payment"},we={class:"expand-price"},ke={class:"amount"},Ee=F(()=>n("span",{class:"wechat"},[n("span",{style:{"margin-left":"5px"}},"微信扫码支付")],-1));function Se(e,l,m,c,p,i){const f=x("a-input-number"),u=x("Slider"),t=x("Qrcode"),r=x("BasicModal");return _(),H(r,O({wrapClassName:"vip-pay-expand-modal"},e.$attrs,{onRegister:e.registerModal,width:"400px",title:"",footer:null,destroyOnClose:""}),{default:J(()=>[n("div",me,[n("ul",null,[n("li",null,b(e.title),1)])]),e.extendType==="sms"||e.extendType==="file"?(_(),M("div",ve,[(_(!0),M(K,null,X(e.extendList,a=>(_(),M("div",{class:Y(["expand-item",e.extendValue===a.value?"active":""]),onClick:g=>e.extendValueChange(a)},[n("div",ge,b(a.title),1),n("div",_e,[w(" ￥"),n("span",ye,b(a.price),1)])],10,fe))),256))])):(_(),M("div",Ce,[k(f,{class:"expand-count",bordered:!1,value:e.buyUserCount,"onUpdate:value":l[0]||(l[0]=a=>e.buyUserCount=a),step:5,min:10,max:750,onChange:e.buyUserCountChange},null,8,["value","onChange"]),he,k(u,{class:"expand-count-slider",value:e.buyUserCount,"onUpdate:value":l[1]||(l[1]=a=>e.buyUserCount=a),min:10,step:5,max:750,onChange:e.buyUserCountChange,"tip-formatter":e.userCountFormatter},null,8,["value","onChange","tip-formatter"])])),n("div",xe,[n("div",be,[k(t,{value:e.msgData.qrCode,"onUpdate:value":l[2]||(l[2]=a=>e.msgData.qrCode=a),width:150},null,8,["value"])]),n("div",Me,[n("span",null,[w("实付款: "),n("span",we,[w("￥"),n("span",ke,b(e.msgData.totalAmount),1)])]),Ee])])]),_:1},16,["onRegister"])}const qe=oe(pe,[["render",Se],["__scopeId","data-v-d012977c"]]);export{qe as default};
