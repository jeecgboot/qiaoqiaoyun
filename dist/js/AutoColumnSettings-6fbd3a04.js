var B=(e,s,l)=>new Promise((h,c)=>{var _=t=>{try{u(l.next(t))}catch(n){c(n)}},r=t=>{try{u(l.throw(t))}catch(n){c(n)}},u=t=>t.done?h(t.value):Promise.resolve(t.value).then(_,r);u((l=l.apply(e,s)).next())});import{d as j,e as D,f as y,h as H,w as K,u as g,V as C,a6 as w,af as N,ai as i,a5 as b,a8 as v,k as f,E as k,a7 as x,F as W,am as q,ak as G,W as J}from"./vue-vendor-24c7dc61.js";import{H as I,m as P,h as Q,a as X,l as Y}from"./index-831af9dd.js";import{h as Z}from"./LinkRecordSelect-385d0eae.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const ee=j({name:"AutoColumnSettings",props:{desformCode:I.string,columns:I.array,auth:I.bool.def(!0),dynamicConfig:Object},emits:["columns-change"],setup(e,{emit:s}){let l=!1;const h=P(),{createMessage:c}=X(),{prefixCls:_}=Q("desform-column-setting"),r=D(()=>"columnCache:"+`desform:auto:${e.desformCode}`),u=y(!1),t=y([]),n=y(!0),m=y(!0),{addOptions:A,addColumns:a}=Z(t),E=D(()=>{if(!e.columns)return[];let o=[];for(let S=0;S<e.columns.length;S++){let L=e.columns[S];o.push({label:L.title,value:L.key})}let{hasChange:d,newOptions:$}=A(e.dynamicConfig,o);return d===!0&&l&&p(),$});H(()=>{var o;(o=e.columns)!=null&&o.length&&O()}),K(()=>e.dynamicConfig,o=>{o&&p()});function O(){return B(this,null,function*(){if(l)return;l=!0;let o=h.get(r.value);o&&o.checkedList?(t.value=o.checkedList,n.value=o.showIndex,m.value=o.showAction):F(),p()})}function V(o){h.set(r.value,{checkedList:o,showIndex:g(n),showAction:g(m)})}function F(){t.value=E.value.filter((o,d)=>d<99).map(o=>o.value),n.value=!0,m.value=!0}function z(o){if(o.length===0){c.warning("请至少选择1列");return}t.value=o,p()}function T(){p()}function U(){p()}function M(){V(t.value),c.success("保存成功"),u.value=!1}function R(){F(),p(),h.remove(r.value),c.success("重置成功"),u.value=!1}function p(){let o=g(t),d=e.columns.filter($=>o.includes($.key));d=a(e.dynamicConfig,d),s("columns-change",{columns:d,showIndex:g(n),showAction:g(m)})}return{visible:u,prefixCls:_,checkedList:t,columnOptions:E,showIndex:n,showAction:m,onSave:M,onReset:R,onChange:z,onIndexChange:T,onActionChange:U}}});function oe(e,s,l,h,c,_){const r=C("a-checkbox"),u=C("a-checkbox-group"),t=C("a-button"),n=C("a-icon"),m=C("a-tooltip"),A=C("a-popover");return w(),N(A,{open:e.visible,"onUpdate:open":s[2]||(s[2]=a=>e.visible=a),placement:"bottomLeft",trigger:"click",overlayClassName:`${e.prefixCls}__column-list`},{title:i(()=>[b("div",{class:v(`${e.prefixCls}__popover-title`)},[f(r,{checked:e.showIndex,"onUpdate:checked":s[0]||(s[0]=a=>e.showIndex=a),onChange:e.onIndexChange},{default:i(()=>[k(" 序号列 ")]),_:1},8,["checked","onChange"]),f(r,{checked:e.showAction,"onUpdate:checked":s[1]||(s[1]=a=>e.showAction=a),onChange:e.onActionChange},{default:i(()=>[k(" 操作列 ")]),_:1},8,["checked","onChange"])],2)]),content:i(()=>[b("div",{class:v([`${e.prefixCls}__scroll`])},[f(u,{value:e.checkedList,onChange:e.onChange},{default:i(()=>[(w(!0),x(W,null,q(e.columnOptions,a=>(w(),x("div",{key:a.value,class:v(`${e.prefixCls}__check-item`)},[f(r,{value:a.value},{default:i(()=>[k(G(a.label),1)]),_:2},1032,["value"])],2))),128))]),_:1},8,["value","onChange"])],2),b("div",{class:v(`${e.prefixCls}__popover-footer`)},[f(t,{size:"small",onClick:e.onReset},{default:i(()=>[k("重置")]),_:1},8,["onClick"]),f(t,{size:"small",type:"primary",onClick:e.onSave},{default:i(()=>[k("保存")]),_:1},8,["onClick"])],2)]),default:i(()=>[e.auth?(w(),N(m,{key:0,title:"自定义列"},{default:i(()=>[b("div",{class:v(`${e.prefixCls}__icon`)},[f(n,{type:"setting"})],2)]),_:1})):J("",!0)]),_:1},8,["open","overlayClassName"])}const Xe=Y(ee,[["render",oe]]);export{Xe as default};
