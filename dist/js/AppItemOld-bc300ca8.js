var C=(e,n,f)=>new Promise((E,w)=>{var N=u=>{try{d(f.next(u))}catch(s){w(s)}},h=u=>{try{d(f.throw(u))}catch(s){w(s)}},d=u=>u.done?E(u.value):Promise.resolve(u.value).then(N,h);d((f=f.apply(e,n)).next())});import{bP as ae,bQ as se,n as le,a_ as ie,bR as pe,a$ as ue,bS as re,bT as ce,bU as de,bv as fe}from"./antd-vue-vendor-0d72f01e.js";import me from"./AppColorSelector-317f3131.js";import ge from"./AppIconSelector-c6c055a9.js";import{d as he,f as y,w as J,r as ve,h as K,I as Ce,a2 as ye,l as X,a3 as ke,a4 as _e,a5 as a,V as i,a6 as r,a7 as A,a8 as Ae,af as g,ai as c,k as p,ae as Y,z as Oe,W as D,ak as Z,F as x,am as we,E as Ie}from"./vue-vendor-24c7dc61.js";import{R as Se,a7 as be,e as De,a as Ee,l as Ne}from"./index-831af9dd.js";import{f as B}from"./low.app.api-97fc250a.js";import{u as Ue}from"./useAppCurd-f2486678.js";import Be from"./AppDeleteConfirm-a0947474.js";import"./index-1c3affea.js";import"./vxe-table-vendor-8813019a.js";import"./VipPay.api-469f07f9.js";import"./lowAppAuth-3d637b7d.js";import"./lowAppUtils-56892d30.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";const Te=he({name:"AppItem",props:{info:{type:Object,default:()=>{}},update:{type:Boolean,default:!1},appGroupList:{type:Array,default:()=>[]},relations:{type:Array,default:()=>[]}},emits:["success","groupChange"],components:{ScheduleOutlined:ae,WarningOutlined:se,SearchOutlined:le,AppIconSelector:ge,AppColorSelector:me,Icon:Se,EditOutlined:ie,CopyOutlined:pe,DeleteOutlined:ue,StarFilled:re,StarOutlined:ce,EllipsisOutlined:de,LogoutOutlined:fe,AppDeleteConfirm:Be},setup(e,{emit:n}){const{createInfoModal:f,createMessage:E}=Ee(),w=be(),[N,{openModal:h}]=De(),d=y(!1),u=y(!1);J(()=>e.update,t=>{t===!0&&(d.value=!0,u.value=!1)},{immediate:!0});const s=ve({id:"",appName:"",iconType:"",iconBackColor:"",starStatus:0,maintStatus:0});function U(){return s.maintStatus===1}const I=y(!1),S=y(!1);K(()=>{if(e.info&&e.info.id){Object.keys(s).map(o=>{s[o]=e.info[o]});let t=w.getUserInfo.id;e.info.ownerId==t?I.value=!0:I.value=!1,e.info.hasAdmin===!0?S.value=!0:S.value=!1}}),J(d,t=>C(this,null,function*(){if(t===!1){let o=Ce(s);yield R(o)}}));const b=y(!1);function T(t){return t.parentNode.parentNode.parentNode}function F(){return e.update||b.value||d.value?"shape-chunk active":"shape-chunk"}function k(){h(!0,{appId:s.id,appName:s.appName})}function G(){n("success",{})}function M(t){let o=t.key;o=="update"?(d.value=!0,u.value=!1):o=="copy"?f({title:"复制应用 ”未命名应用“",content:"将复制目标应用的应用结构、流程和角色。应用下的数据和成员不会被复制",width:480,okText:"复制",cancelText:"取消",okCancel:!0,onOk:function(){P()},onCancel:function(){}}):o=="delete"?k():o=="out"&&f({title:()=>X("span",{style:{color:"rgb(244, 67, 54)","font-size":"17px"}},"您确认退出此应用吗?"),content:"退出此应用后，您将无法访问此应用",width:480,okText:"确定",icon:" ",okButtonProps:{danger:!0},cancelText:"取消",okCancel:!0,onOk:function(){V()},onCancel:function(){}}),b.value=!1}function V(){return C(this,null,function*(){const t=yield B.outOfApp(s.id);if(t.success)E.success("操作成功!"),n("success",{});else{let o=t.result,m="无法退出通过部门加入的应用",_="您所在的部门被加入了此应用，只能由应用管理员进行操作";o=="sys_role"?(m="无法退出通过组织角色加入的应用",_="您所在的组织角色被加入了此应用，只能由应用管理员进行操作"):o=="sys_position"&&(m="无法退出通过职位加入的应用",_="您所在的职位被加入了此应用，只能由应用管理员进行操作"),f({title:()=>X("span",{style:{color:"rgb(244, 67, 54)","font-size":"17px"}},m),content:_,width:480,okText:"关闭",icon:" ",onOk:function(){}})}})}function P(){return C(this,null,function*(){const t=yield B.copy({id:s.id});n("success",{})})}function R(t){return C(this,null,function*(){if(u.value===!0){let o=e.info;(s.appName!=o.appName||s.iconType!=o.iconType||s.iconBackColor!=o.iconBackColor)&&(yield B.saveOrUpdate(t,!0))}n("groupChange")})}function z(){u.value=!0}const L=ye();function $(t){t.preventDefault(),t.stopPropagation();let o=s.id;L.push({path:`/myapp/${o}`})}function l(t){return C(this,null,function*(){t.preventDefault(),t.stopPropagation();let o={id:s.id,starStatus:1};s.starStatus==1&&(o.starStatus=0),yield B.saveOrUpdate(o,!0),n("groupChange")})}const v=y([]),Q=y("");K(()=>{let t=e.appGroupList;if(!t||t.length==0)v.value=[];else{let o="";e.info&&e.info.id&&(o=e.info.id);let m=[];for(let _ of t){let j={id:_.id,groupName:_.groupName,checked:!1},W=e.relations;if(W&&W.length>0){let q=W.filter(H=>H.appId==o&&j.id==H.groupId);q&&q.length>0&&(j.checked=!0)}m.push(j)}v.value=m}});const{addAppGroupRelation:ee,removeAppGroupRelation:te}=Ue();function oe(t,o){return C(this,null,function*(){t.preventDefault(),t.stopPropagation();let m={groupId:o.id,appId:s.id};o.checked===!0?yield te(m):yield ee(m),n("groupChange")})}function ne(t){let o=Q.value;return!o||t.groupName.indexOf(o)>=0}return{showUpdateInfo:d,lowAppInfo:s,getPopupContainer:T,actionVisible:b,getShapeClass:F,handleActionClick:M,registerDeleteModal:N,deleteOk:G,onOpenApp:$,onDataChange:z,onChangeStar:l,selectGroupOptions:v,onChangeGroupSelect:oe,filterValue:Q,isFilterGroup:ne,isAdmin:S,isOwner:I,isMaintaining:U}}});const O=e=>(ke("data-v-6102c7e2"),e=e(),_e(),e),Fe={class:"jee-app-item"},Ge={style:{padding:"0 12px"}},Me={key:0,class:"app-item-maintaining"},Ve={class:"label"},Pe={class:"app-item-star"},Re={class:"app-item-actions"},ze={class:"icon"},Le=O(()=>a("span",{class:"label"},"修改名称和图标",-1)),$e=O(()=>a("span",{class:"label"},"复制应用",-1)),je=O(()=>a("span",{class:"label"},"设置分组",-1)),We={class:"sub-menu-content"},Qe={class:"search-div"},qe={class:"groups"},He=O(()=>a("div",{class:"title"},"个人",-1)),Je=["onClick"],Ke={class:"group-name"},Xe=O(()=>a("span",{class:"label"},"删除应用",-1)),Ye=O(()=>a("span",{class:"label"},"退出应用",-1));function Ze(e,n,f,E,w,N){const h=i("Icon"),d=i("a-input"),u=i("AppColorSelector"),s=i("AppIconSelector"),U=i("a-dropdown"),I=i("StarFilled"),S=i("StarOutlined"),b=i("a-tooltip"),T=i("EllipsisOutlined"),F=i("EditOutlined"),k=i("a-menu-item"),G=i("CopyOutlined"),M=i("SearchOutlined"),V=i("a-checkbox"),P=i("a-sub-menu"),R=i("DeleteOutlined"),z=i("LogoutOutlined"),L=i("a-menu"),$=i("AppDeleteConfirm");return r(),A("div",Fe,[a("div",{class:Ae(e.getShapeClass())},[a("div",{class:"event-chunk",onClick:n[5]||(n[5]=(...l)=>e.onOpenApp&&e.onOpenApp(...l))},[e.showUpdateInfo?(r(),g(U,{key:0,open:e.showUpdateInfo,"onUpdate:open":n[4]||(n[4]=l=>e.showUpdateInfo=l),placement:"bottom",trigger:["click"],overlayClassName:"app-update-dropdown"},{overlay:c(()=>[a("div",null,[a("div",Ge,[p(d,{value:e.lowAppInfo.appName,"onUpdate:value":n[1]||(n[1]=l=>e.lowAppInfo.appName=l),style:{width:"100%","text-align":"center"},onChange:e.onDataChange},null,8,["value","onChange"])]),a("div",null,[p(u,{value:e.lowAppInfo.iconBackColor,"onUpdate:value":n[2]||(n[2]=l=>e.lowAppInfo.iconBackColor=l),onChange:e.onDataChange},null,8,["value","onChange"])]),a("div",null,[p(s,{value:e.lowAppInfo.iconType,"onUpdate:value":n[3]||(n[3]=l=>e.lowAppInfo.iconType=l),onChange:e.onDataChange},null,8,["value","onChange"])])])]),default:c(()=>[a("div",{class:"icon",style:Y({"background-color":e.lowAppInfo.iconBackColor}),onClick:n[0]||(n[0]=Oe(()=>{},["prevent"]))},[a("div",null,[p(h,{icon:e.lowAppInfo.iconType,style:{color:"#fff","font-size":"48px"}},null,8,["icon"])])],4)]),_:1},8,["open"])):(r(),A("div",{key:1,class:"icon",style:Y({"background-color":e.lowAppInfo.iconBackColor})},[a("div",null,[p(h,{icon:e.lowAppInfo.iconType,style:{color:"#fff","font-size":"48px"}},null,8,["icon"])]),e.isMaintaining()?(r(),A("div",Me," 维护中 ")):D("",!0)],4)),a("div",Ve,[a("div",null,Z(e.lowAppInfo.appName),1)])]),a("div",Pe,[p(b,{placement:"bottom",title:e.lowAppInfo.starStatus==1?"取消标星":"标星"},{default:c(()=>[e.lowAppInfo.starStatus==1?(r(),g(I,{key:0,onClick:e.onChangeStar,style:{color:"rgb(255, 196, 0)"}},null,8,["onClick"])):(r(),g(S,{key:1,onClick:e.onChangeStar},null,8,["onClick"]))]),_:1},8,["title"])]),a("div",Re,[p(U,{open:e.actionVisible,"onUpdate:open":n[7]||(n[7]=l=>e.actionVisible=l),getPopupContainer:e.getPopupContainer,trigger:["click"],overlayClassName:"app-item-actions-dropdown"},{overlay:c(()=>[p(L,{onClick:e.handleActionClick},{default:c(()=>[e.isAdmin||e.isOwner?(r(),g(k,{key:"update"},{default:c(()=>[p(F,{style:{"margin-right":"10px"}}),Le]),_:1})):D("",!0),e.isAdmin||e.isOwner?(r(),g(k,{key:"copy"},{default:c(()=>[p(G,{style:{"margin-right":"10px"}}),$e]),_:1})):D("",!0),e.selectGroupOptions&&e.selectGroupOptions.length>0&&(e.isAdmin||e.isOwner)?(r(),g(P,{key:"4",class:"has-sub-menu",popupClassName:"low-app-app-group-select-pop"},{title:c(()=>[p(h,{icon:"ant-design:setting-outlined",style:{"margin-right":"10px"}}),je]),default:c(()=>[a("div",We,[a("div",Qe,[p(d,{placeholder:"搜索分组",class:"my-input",value:e.filterValue,"onUpdate:value":n[6]||(n[6]=l=>e.filterValue=l)},{prefix:c(()=>[p(M,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),a("div",qe,[He,(r(!0),A(x,null,we(e.selectGroupOptions,l=>(r(),A(x,null,[e.isFilterGroup(l)?(r(),A("div",{key:0,class:"group-item",onClick:v=>e.onChangeGroupSelect(v,l)},[a("div",Ke,[p(V,{checked:l.checked,"onUpdate:checked":v=>l.checked=v},{default:c(()=>[Ie(Z(l.groupName),1)]),_:2},1032,["checked","onUpdate:checked"])])],8,Je)):D("",!0)],64))),256))])])]),_:1})):D("",!0),e.isOwner?(r(),g(k,{key:"delete",class:"delete-item"},{default:c(()=>[p(R,{style:{"margin-right":"10px"}}),Xe]),_:1})):(r(),g(k,{key:"out",class:"delete-item"},{default:c(()=>[p(z,{style:{"margin-right":"10px"}}),Ye]),_:1}))]),_:1},8,["onClick"])]),default:c(()=>[a("div",ze,[p(T)])]),_:1},8,["open","getPopupContainer"])])],2),p($,{onRegister:e.registerDeleteModal,onSuccess:e.deleteOk},null,8,["onRegister","onSuccess"])])}const gt=Ne(Te,[["render",Ze],["__scopeId","data-v-6102c7e2"]]);export{gt as default};
