var B=Object.defineProperty;var b=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var A=(o,t,r)=>t in o?B(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,F=(o,t)=>{for(var r in t||(t={}))_.call(t,r)&&A(o,r,t[r]);if(b)for(var r of b(t))L.call(t,r)&&A(o,r,t[r]);return o};var D=(o,t,r)=>new Promise((s,m)=>{var l=n=>{try{c(r.next(n))}catch(p){m(p)}},d=n=>{try{c(r.throw(n))}catch(p){m(p)}},c=n=>n.done?s(n.value):Promise.resolve(n.value).then(l,d);c((r=r.apply(o,t)).next())});import{f as h,d as O,K as P,e as x,u as i,a6 as j,af as C,ai as K,k as V,ag as $}from"./vue-vendor-24c7dc61.js";import"./index-52c8c841.js";import{c as E}from"./user.data-965c1456.js";import{a as G,B as N}from"./index-44229d9b.js";import{h as z,g as q,i as H,b as J,j as M}from"./user.api-ffaaa05b.js";import{ao as Q,D as X,G as Y,c as Z}from"./index-831af9dd.js";import{u as ee,B as re}from"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./antd-vue-vendor-0d72f01e.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./validator-bc7dc032.js";import"./renderUtils-7ad8f436.js";import"./helper-22dafba0.js";const R={"<=565":"100%","<=1366":"800px","<=1600":"600px","<=1920":"600px",">1920":"500px"};function te(o=R,t=!0,r=50){const s=t?Object.assign({},R,o):o,m=Object.keys(s),l=h();function d(n){let p;for(const g of m)try{if(new Function(`return ${n} ${g}`)()){p=s[g];break}}catch(I){}p&&(l.value=p)}d(window.innerWidth);const{removeEvent:c}=Q({el:window,name:"resize",listener:X(()=>d(window.innerWidth),r)});return Y(()=>c()),{adaptiveWidth:l}}function oe(){return te({"<=620":"100%","<=1600":600,"<=1920":650,">1920":700},!1)}const er=O({__name:"UserDrawer",emits:["success","register"],setup(o,{emit:t}){const r=P(),s=h(!0),m=h(""),l=h([]),[d,{setProps:c,resetFields:n,setFieldsValue:p,validate:g,updateSchema:I}]=ee({labelWidth:90,schemas:E,showActionButtonGroup:!1}),f=h(!0),[S,{setDrawerProps:v,closeDrawer:T}]=G(e=>D(this,null,function*(){var a;if(yield n(),f.value=(a=e==null?void 0:e.showFooter)!=null?a:!0,v({confirmLoading:!1,showFooter:f.value}),s.value=!!(e!=null&&e.isUpdate),i(s)){m.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const u=yield z({userid:e.record.id});u&&u.length>0&&(e.record.selectedroles=u)}catch(u){}const w=yield q({userId:e.record.id});if(w&&w.length>0){e.record.selecteddeparts=w;let u=Array.from(w,({key:y})=>y);e.record.selecteddeparts=u.join(","),l.value=w.map(y=>({label:y.title,value:y.key}))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=!e.record.departIds||e.record.departIds==""?[]:e.record.departIds}e.selectedroles&&(yield p({selectedroles:e.selectedroles})),I([{field:"password",ifShow:!i(s)},{field:"confirmPassword",ifShow:!i(s)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:l}},{field:"selecteddeparts",show:!(e!=null&&e.departDisabled)},{field:"selectedroles",show:!(e!=null&&e.departDisabled),componentProps:{api:e.tenantSaas?H:J}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!i(s)&&e.tenantSaas&&(yield p({relTenantIds:Z().toString()})),typeof e.record=="object"&&p(F({},e.record)),c({disabled:!f.value})})),U=x(()=>i(s)?i(f)?"编辑用户":"用户详情":"新增用户"),{adaptiveWidth:W}=oe();function k(){return D(this,null,function*(){try{let e=yield g();v({confirmLoading:!0}),e.userIdentity===1&&(e.departIds="");let a=i(s);yield M(e,a),T(),t("success",{isUpdateVal:a,values:e})}finally{v({confirmLoading:!1})}})}return(e,a)=>(j(),C(i(N),$(e.$attrs,{onRegister:i(S),title:U.value,width:i(W),onOk:k,showFooter:f.value,destroyOnClose:""}),{default:K(()=>[V(i(re),{onRegister:i(d)},null,8,["onRegister"])]),_:1},16,["onRegister","title","width","showFooter"]))}});export{er as default};
