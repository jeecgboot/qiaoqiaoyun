var S=(e,p,o)=>new Promise((d,l)=>{var u=t=>{try{c(o.next(t))}catch(f){l(f)}},i=t=>{try{c(o.throw(t))}catch(f){l(f)}},c=t=>t.done?d(t.value):Promise.resolve(t.value).then(u,i);c((o=o.apply(e,p)).next())});import{d as E,f as m,e as k,w as M,V as b,a6 as C,af as D,ai as N,a7 as w,k as j,E as H,ak as B}from"./vue-vendor-24c7dc61.js";import{H as r,k as $,bI as L,b2 as O,l as U}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";const Y=E({name:"AuthBatchTransfer",components:{},props:{authScopeCode:r.string,authScopeType:r.string,desformCode:r.string,permissionType:r.string,loading:r.bool,desformId:r.string,authScope:r.object},emits:["update:loading"],setup(e,{emit:p}){const o=m([]),d=m([]),l=m([]),u=m([]),i=k(()=>({list:`/desform/auth/${e.authScopeType}List/${e.authScopeCode}/${e.permissionType}/${e.desformCode}`,soub:"/desform/auth/saveOrUpdateBatch"})),c=k(()=>[...l.value,...u.value]);M(()=>i.value.list,()=>t(),{immediate:!0});function t(a=0){if(e.authScopeType&&e.permissionType&&e.authScopeCode&&e.desformCode)return f(a)}function f(a){return S(this,null,function*(){h(!0);try{let s=yield $.get({url:i.value.list},{successMessageMode:"none"});o.value=s.records,d.value=s.targetKeys}finally{yield L(a),h(!1)}})}function h(a){p("update:loading",a)}function I(a,s,n){return S(this,null,function*(){let T=n.map(y=>A(y));T.forEach(y=>{let _=y.scopeValue,g=_?_.split(","):[];if(s==="right"&&O(g,e.authScopeCode),s==="left"){let K=g.indexOf(e.authScopeCode);K!==-1&&g.splice(K,1)}y.scopeValue=g.join(",")});let v=e.authScope.getUpdateParams(T);e.permissionType==="button"&&V(v);try{h(!0),yield $.put({url:i.value.soub,params:v},{successMessageMode:"none"}),yield t(100)}finally{h(!1)}})}function V(a){const s="temp-";a.forEach(n=>{n.id.startsWith(s)&&(delete n.id,n.desformId=e.desformId,n.desformCode=e.desformCode,n.permissionType=e.permissionType,n.authScopeIsAll="Y",n.status=1)})}function x(a,s){l.value=a,u.value=s}function A(a){return o.value.filter(s=>s.key===a)[0]}return{dataSource:o,targetKeys:d,selectedKeys:c,sourceSelectedKeys:l,targetSelectedKeys:u,onChange:I,onSelectChange:x}}}),F={key:0},P={key:1};function R(e,p,o,d,l,u){const i=b("a-icon"),c=b("a-transfer");return C(),D(c,{titles:["未授权","已授权"],loading:e.loading,dataSource:e.dataSource,targetKeys:e.targetKeys,selectedKeys:e.selectedKeys,listStyle:{width:"calc(50% - 25px)"},style:{height:"100%"},onChange:e.onChange,onSelectChange:e.onSelectChange},{render:N(t=>[t.authScopeIsAll==="Y"?(C(),w("span",F,[j(i,{type:"eye-invisible"}),H(" "+B(t.title),1)])):(C(),w("span",P,B(t.title),1))]),_:1},8,["loading","dataSource","targetKeys","selectedKeys","listStyle","onChange","onSelectChange"])}const Q=U(Y,[["render",R]]);export{Q as default};
