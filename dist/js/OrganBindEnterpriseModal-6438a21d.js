var I=(a,b,m)=>new Promise((s,d)=>{var v=n=>{try{r(m.next(n))}catch(_){d(_)}},c=n=>{try{r(m.throw(n))}catch(_){d(_)}},r=n=>n.done?s(n.value):Promise.resolve(n.value).then(v,c);r((m=m.apply(a,b)).next())});import{d as H,f as U,l as S,a3 as W,a4 as J,a5 as y,V as h,a6 as f,af as D,ai as i,E as L,W as q,k as w,a7 as F,F as z,am as G,ak as A}from"./vue-vendor-24c7dc61.js";import{B as K}from"./index-1c3affea.js";import{b as P,c as Q,w as X,d as Y}from"./OrganAppThird.api-f164f206.js";import{a7 as Z,j as ee,ap as ae,a as te,l as se}from"./index-831af9dd.js";import{M as O}from"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const ne=H({name:"ThirdAppBindWeEnterpriseModal",components:{BasicModal:K},setup(a,{emit:b}){const m=U("企业微信绑定"),s=U({}),d=U(!1),v=U(!1),{createMessage:c}=te(),r=U([]),n=U(!1),_=Z(),[R,{closeModal:j}]=ee(e=>I(this,null,function*(){d.value=!0,e.izBind?yield B():yield C(),n.value=e.izBind}));function C(){return I(this,null,function*(){yield P().then(e=>{if(e.success){let t=e.result.userList;s.value=e.result,r.value=e.result.userList,d.value=!1}else c.warning(e.message),d.value=!1})})}function B(){return I(this,null,function*(){yield Q().then(e=>{e.success?(s.value.jwUserDepartVos=e.result,d.value=!1):(c.warn(e.message),d.value=!1)})})}function l(){return I(this,null,function*(){v.value=!0;let e=s.value.userList,t=[];for(const o of s.value.jwUserDepartVos)o.wechatUserId&&(e=e.filter(p=>p.wechatUserId!=o.wechatUserId),t.push({wechatUserId:o.wechatUserId,wechatDepartId:o.wechatDepartId,wechatRealName:o.wechatRealName,userId:o.userId}));let u="";if(e&&e.length>0){for(const o of e)t.push({wechatUserId:o.wechatUserId,wechatDepartId:o.wechatDepartId,wechatRealName:o.wechatRealName});u="检测到未绑定的企业微信用户 "+e.length+" 位，平台将会为这 "+e.length+" 位用户创建新的账号"}O.confirm({title:"确认同步",content:u,okText:"确认",onOk:()=>{let o=JSON.stringify(t);X({jwUserDepartJson:o}).then(p=>{let T={};p.success&&(p.result&&(T={width:600,title:p.message,content:()=>{let M,$=["成功信息如下：",N(S,p.result.successInfo.map((V,E)=>`${E+1}. ${V}`).join(`
`))];return p.success?M=[...$,S("br"),"无失败信息！"]:M=["失败信息如下：",N(S,p.result.failInfo.map((V,E)=>`${E+1}. ${V}`).join(`
`)),S("br"),...$],M}}),j(),b("success",T,p))}).finally(()=>{v.value=!1})}})})}function k(e,t,u){s.value.jwUserDepartVos[u].wechatUserId=t.wechatUserId,s.value.jwUserDepartVos[u].wechatRealName=t.wechatRealName,s.value.jwUserDepartVos[u].wechatDepartId=t.wechatDepartId,r.value=r.value.filter(o=>o.wechatUserId!=t.wechatUserId)}function g(e,t){n.value?O.confirm({title:"确认取消绑定吗",okText:"确认",onOk:()=>I(this,null,function*(){yield Y({id:t.thirdId,sysUserId:_.getUserInfo.id}).then(u=>{u.success?(c.success("取消绑定成功！"),B()):c.warning(u.message)})})}):(r.value.push({wechatUserId:t.wechatUserId,wechatRealName:t.wechatRealName,wechatDepartId:t.wechatDepartId}),s.value.jwUserDepartVos[e].wechatUserId="",s.value.jwUserDepartVos[e].wechatRealName="",s.value.jwUserDepartVos[e].wechatDepartId="")}function N(e,t){return e("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},t)}return{title:m,registerModal:R,handleSubmit:l,bindData:s,getFileAccessHttpUrl:ae,loading:d,userList:r,handleSelect:k,handleRemoveClick:g,btnLoading:v,izBind:n}}});const x=a=>(W("data-v-54484f87"),a=a(),J(),a),oe={class:"we-bind"},le=x(()=>y("span",null,"组织用户",-1)),re=x(()=>y("span",null,"企业微信用户",-1)),ce={class:"we-account"},ie={class:"we-account"},de={key:0,class:"we-remove"},ue=["onClick"];function pe(a,b,m,s,d,v){const c=h("a-col"),r=h("a-row"),n=h("a-avatar"),_=h("a-input"),R=h("a-select"),j=h("a-spin"),C=h("a-button"),B=h("BasicModal");return f(),D(B,{onRegister:a.registerModal,width:800,title:a.title,destroyOnClose:""},{footer:i(()=>[a.izBind?q("",!0):(f(),D(C,{key:0,type:"primary",onClick:a.handleSubmit},{default:i(()=>[L("同步")]),_:1},8,["onClick"]))]),default:i(()=>[w(j,{spinning:a.loading},{default:i(()=>[y("div",oe,[w(r,{span:24,class:"we-title-background"},{default:i(()=>[w(c,{span:12,class:"border-right"},{default:i(()=>[le]),_:1}),w(c,{span:12,class:"padding-left"},{default:i(()=>[re]),_:1})]),_:1}),w(r,{span:24},{default:i(()=>[(f(!0),F(z,null,G(a.bindData.jwUserDepartVos,(l,k)=>(f(),F(z,null,[w(c,{span:12,class:"border-right padding-left border-bottom"},{default:i(()=>[y("div",ce,[l.avatar?(f(),D(n,{key:0,src:a.getFileAccessHttpUrl(l.avatar),size:28},null,8,["src"])):(f(),D(n,{key:1,size:28},{default:i(()=>[L(A(l.realName.length>2?l.realName.substr(0,2):l.realName),1)]),_:2},1024)),w(_,{style:{"margin-left":"20px"},value:l.realName,readonly:""},null,8,["value"])])]),_:2},1024),w(c,{span:12,class:"padding-left border-bottom"},{default:i(()=>[y("div",ie,[l.wechatUserId||a.izBind?(f(),F("span",de,[L(A(l.wechatRealName)+" ",1),y("span",{style:{"margin-right":"20px"},onClick:g=>a.handleRemoveClick(k,l)},"移出",8,ue)])):(f(),D(R,{key:1,value:l.wechatUserId,"onUpdate:value":g=>l.wechatUserId=g,options:a.userList,fieldNames:{label:"wechatRealName",value:"wechatUserId"},style:{width:"200px"},showSearch:"",onSelect:(g,N)=>a.handleSelect(g,N,k)},null,8,["value","onUpdate:value","options","onSelect"]))])]),_:2},1024)],64))),256))]),_:1})])]),_:1},8,["spinning"])]),_:1},8,["onRegister","title"])}const ye=se(ne,[["render",pe],["__scopeId","data-v-54484f87"]]);export{ye as default};
