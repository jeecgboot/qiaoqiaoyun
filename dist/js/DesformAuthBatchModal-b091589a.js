var z=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var F=(e,o,t)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,h=(e,o)=>{for(var t in o||(o={}))j.call(o,t)&&F(e,t,o[t]);if(k)for(var t of k(o))K.call(o,t)&&F(e,t,o[t]);return e},M=(e,o)=>H(e,O(o));var D=(e,o,t)=>new Promise((u,r)=>{var c=n=>{try{m(t.next(n))}catch(i){r(i)}},f=n=>{try{m(t.throw(n))}catch(i){r(i)}},m=n=>n.done?u(n.value):Promise.resolve(n.value).then(c,f);m((t=t.apply(e,o)).next())});import{d as G,f as E,e as g,u as w,a3 as J,a4 as Q,a5 as I,V as l,a6 as W,af as X,ap as Y,aq as Z,ai as p,k as s,ag as P}from"./vue-vendor-24c7dc61.js";import"./index-621e597c.js";import{B as ee}from"./index-1c3affea.js";import{h as te}from"./antd-vue-vendor-0d72f01e.js";import{k as oe,H as ae,q as re,j as ne,l as se}from"./index-831af9dd.js";import{u as ie}from"./useListPage-62a041ef.js";import le from"./AuthBatchTransfer-ba68ad38.js";import pe from"./BasicTable-d435f501.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";function ue(e){const o={role:{name:"角色",codeName:"roleCode",columns:[{title:"角色编码",align:"center",dataIndex:"roleCode"},{title:"角色名称",align:"center",dataIndex:"roleName"}],url:{list:"/sys/role/list"},getUpdateParams(r){return r.map(c=>({id:c.key,authField:c.authField,authScopeRolesVal:c.scopeValue}))}},depart:{name:"部门",codeName:"id",columns:[],url:{list:""},getUpdateParams(r){}}},t=o[e];if(!t)throw new Error("未知的 authScopeType 值："+e);function u(r){return oe.get({url:t.url.list,params:r})}return{scopeTypes:o,authScope:t,loadTableData:u}}const ce=G({name:"DesformAuthBatchModal",components:{BasicModal:ee,BasicTable:pe,AuthBatchTransfer:le},props:{authScopeType:ae.oneOf(["role","depart"]).isRequired},emits:["register"],setup(e){const o=re(),t=E(!1),u=E(),{authScope:r,loadTableData:c}=ue(e.authScopeType),f=g(()=>r.name+"批量授权"),[m,{closeModal:n,setModalProps:i}]=ne($),y=ie({tableProps:{immediate:!1,api:a=>{v(!0);try{return c(a)}finally{v(!1)}},columns:r.columns,canResize:!1,clickToRowSelect:!0,showTableSetting:!1,useSearchForm:!1,showActionColumn:!1,rowSelection:{type:"radio"},afterFetch:V}}),{tableContext:B}=y,[T,{reload:b,setLoading:S},{rowSelection:x,selectedRows:_,selectedRowKeys:R}]=B,N=g(()=>{let a={width:1e3,title:w(f),confirmLoading:w(t),defaultFullscreen:!0};return M(h(h(h({},w(o)),a),e),{onOk:q,onCancel:C,onRegister:m})}),A=g(()=>_.value.length>0?_.value[0][r.codeName]:""),L=g(()=>{var a,d;return{authScope:r,authScopeCode:A.value,authScopeType:e.authScopeType,desformId:(a=u.value)==null?void 0:a.id,desformCode:(d=u.value)==null?void 0:d.desformCode,loading:t.value,"onUpdate:loading":U=>v(U)}});function V(a){if(a.length>0){let d=a[0];setTimeout(()=>{_.value=[d],R.value=[d.id]},300)}}function $(a){u.value=te(a==null?void 0:a.record),b()}function C(){n()}function q(){return D(this,null,function*(){C()})}function v(a){t.value=a,S(a),i({confirmLoading:a})}return{getProps:N,loading:t,transferProps:L,registerTable:T,rowSelection:x,authScopeCode:A,selectedRows:_,selectedRowKeys:R}}});const me=e=>(J("data-v-f4dd471d"),e=e(),Q(),e),de={style:{margin:"8px 0 0 0"}},fe=me(()=>I("span",null,"符号开头的字段代表已勾选“授权给所有人”",-1));function _e(e,o,t,u,r,c){const f=l("BasicTable"),m=l("a-col"),n=l("AuthBatchTransfer"),i=l("a-tab-pane"),y=l("a-tabs"),B=l("a-spin"),T=l("a-icon"),b=l("a-row"),S=l("BasicModal");return W(),X(S,Y(Z(e.getProps)),{default:p(()=>[s(b,{type:"flex",gutter:10,style:{height:"100%"}},{default:p(()=>[s(m,{md:12,sm:24,style:{flex:"1"}},{default:p(()=>[s(f,{onRegister:e.registerTable,rowSelection:e.rowSelection},null,8,["onRegister","rowSelection"])]),_:1}),s(m,{md:12,sm:24,class:"col-right",style:{flex:"1"}},{default:p(()=>[s(B,{spinning:e.loading},{default:p(()=>[s(y,null,{default:p(()=>[s(i,{tab:"数据权限",key:"data",forceRender:""},{default:p(()=>[s(n,P({permissionType:"data"},e.transferProps),null,16)]),_:1}),s(i,{tab:"按钮权限",key:"button",forceRender:""},{default:p(()=>[s(n,P({permissionType:"button"},e.transferProps),null,16)]),_:1}),s(i,{tab:"字段权限",key:"field",forceRender:""},{default:p(()=>[s(n,P({permissionType:"field"},e.transferProps),null,16)]),_:1})]),_:1})]),_:1},8,["spinning"]),I("p",de,[s(T,{type:"eye-invisible",style:{"margin-right":"8px"}}),fe])]),_:1})]),_:1})]),_:1},16)}const ct=se(ce,[["render",_e],["__scopeId","data-v-f4dd471d"]]);export{ct as default};
