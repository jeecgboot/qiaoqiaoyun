var q=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(t,o,s)=>o in t?q(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,c=(t,o)=>{for(var s in o||(o={}))W.call(o,s)&&U(t,s,o[s]);if(R)for(var s of R(o))z.call(o,s)&&U(t,s,o[s]);return t},A=(t,o)=>G(t,H(o));var m=(t,o,s)=>new Promise((g,p)=>{var i=n=>{try{r(s.next(n))}catch(h){p(h)}},y=n=>{try{r(s.throw(n))}catch(h){p(h)}},r=n=>n.done?g(n.value):Promise.resolve(n.value).then(i,y);r((s=s.apply(t,o)).next())});import{d as K,f as b,e as Q,u as X,a3 as Y,a4 as Z,a5 as E,V as C,a6 as u,af as B,ai as f,E as _,ak as x,k as I,a7 as D,W as S}from"./vue-vendor-24c7dc61.js";import{B as ee,a as te}from"./index-44229d9b.js";import"./index-52c8c841.js";import{r as v}from"./validator-bc7dc032.js";import{g as ae}from"./user.api-ffaaa05b.js";import{a7 as oe,a as se,l as re}from"./index-831af9dd.js";import{y as F,k as T}from"./organization.api-98a6e46c.js";import{M as ie}from"./antd-vue-vendor-0d72f01e.js";import{B as ne,u as le}from"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./helper-22dafba0.js";const ue=[{label:"手机",value:"phone"},{label:"邮箱",value:"email"}],pe=K({name:"OrganUserDrawer",components:{BasicDrawer:ee,BasicForm:ne},emits:["reload","register","reload-count"],setup(t,{emit:o}){const s=oe(),g=b(""),{createMessage:p}=se(),i=b(!1),y=Q(()=>i.value?"人员信息":"添加人员"),r=[{field:"id",label:"id",component:"Input",show:!1},{field:"username",label:"username",component:"Input",show:!1},{field:"realname",label:"姓名",component:"Input",required:!0,dynamicDisabled:({values:e})=>!!e.id},{field:"loginType",label:"登录方式",component:"RadioGroup",defaultValue:"phone",ifShow:({values:e})=>!e.id,componentProps:{options:ue}},{field:"phone",label:"手机",component:"Input",ifShow:({values:e})=>e.id?!0:e.loginType==="phone",dynamicRules:({model:e,schema:a})=>e.id?[]:[c({},v.phone(!0)[0]),c({},v.duplicateCheckRule("sys_user","phone",e,a,!1)[0])],dynamicDisabled:({values:e})=>!!e.id},{field:"email",label:"邮箱",component:"Input",ifShow:({values:e})=>e.id?!0:e.loginType==="email",dynamicRules:({model:e,schema:a})=>e.id?[]:[c({},v.email(!0)[0]),c({},v.duplicateCheckRule("sys_user","phone",e,a,!1)[0])],dynamicDisabled:({values:e})=>!!e.id},{field:"selecteddeparts",label:"部门",component:"JSelectDept",componentProps:{checkStrictly:!0}},{field:"post",label:"职位",component:"JSelectPosition"},{field:"workAddress",label:"工作地点",component:"JDictSelectTag"},{field:"workNo",label:"工号",component:"Input",dynamicRules:({model:e,schema:a})=>[{required:!0,message:"请输入工号"},c({},v.duplicateCheckRule("sys_user","work_no",e,a,!1)[0])]},{field:"relTenantIds",label:"租户",component:"Input",show:!1},{field:"selectedroles",label:"角色",component:"Input",show:!1}],[n,{setFieldsValue:h,resetFields:O,validate:k}]=le({schemas:r,showActionButtonGroup:!1,labelCol:{span:24},wrapperCol:{span:24}}),[J,{closeDrawer:V}]=te(e=>m(this,null,function*(){if(i.value=e.isUpdate,yield O(),X(i)){const a=yield ae({userId:e.record.id});let d="";a&&a.length>0&&(d=a.map(j=>j.value));let $=A(c({},e.record),{selecteddeparts:d,selectedroles:e.record.selectedroles});g.value=e.status,yield h($)}else e.leftSelectedDepartId&&(yield h({selecteddeparts:e.leftSelectedDepartId}))})),l=b(!1);function L(){return m(this,null,function*(){const e=yield k();e.username||(e.loginType=="phone"?e.username=e.phone:e.username=e.email),e.password="123456",l.value=!0,yield F(e,i.value).catch(()=>{l.value=!1}),l.value=!1,o("reload"),w()})}function N(){w()}function w(){V()}function _e(){let e=["realname","phone","email"],a=r.filter(d=>e.indexOf(d.field)>=0);for(let d of a)i.value===!0?d.componentProps={disabled:!0}:d.componentProps={disabled:!1};return r}function P(){return m(this,null,function*(){const e=yield k();l.value=!0,T({status:"1",userId:e.id}).then(a=>m(this,null,function*(){a.success?(yield F(e,i.value),o("reload-count"),w(),l.value=!1):(l.value=!1,p.warning(a.message))})).catch(a=>{p.warning(a.message)})})}function M(){return m(this,null,function*(){const e=yield k();ie.confirm({title:"拒绝此用户加入",okText:"确认",cancelText:"取消",onOk:()=>{l.value=!0,T({status:"4",userId:e.id}).then(a=>m(this,null,function*(){a.success&&(yield F(e,i.value),o("reload"),w(),l.value=!1)})).catch(a=>{p.warning(a.message),l.value=!1})}})})}return{isUpdate:i,title:y,registerForm:n,registerDrawer:J,handleSubmit:L,handleLeave:N,handleClose:w,status:g,handleApprovedJoin:P,handleRefuseJoin:M,confirmLoading:l}}});const de=t=>(Y("data-v-ca01656d"),t=t(),Z(),t),ce={key:0,class:"not-update"},me={key:1,class:"tenant-status"},fe=de(()=>E("div",{class:"status-label"},"状态",-1)),he={key:0,class:"approval status"},ge={key:1,class:"refuse status"},ye={style:{display:"flex","justify-content":"space-between"}},we={style:{display:"flex","flex-direction":"row","justify-content":"flex-start","padding-top":"15px"}},De={key:0,style:{float:"right"}};function ve(t,o,s,g,p,i){const y=C("BasicForm"),r=C("a-button"),n=C("BasicDrawer");return u(),B(n,{onRegister:t.registerDrawer,title:t.title,width:580,destroyOnClose:"",showFooter:""},{footer:f(()=>[E("div",ye,[E("div",we,[t.status==="3"||t.status==="4"?(u(),B(r,{key:0,type:"primary",onClick:t.handleApprovedJoin,loading:t.confirmLoading},{default:f(()=>[_("批准加入")]),_:1},8,["onClick","loading"])):(u(),B(r,{key:1,type:"primary",onClick:t.handleSubmit,loading:t.confirmLoading},{default:f(()=>[_(x(t.isUpdate?"保存":"添加"),1)]),_:1},8,["onClick","loading"])),I(r,{style:{"margin-left":"15px"},onClick:t.handleClose,loading:t.confirmLoading},{default:f(()=>[_("取消")]),_:1},8,["onClick","loading"])]),t.status==="3"?(u(),D("div",De,[I(r,{onClick:t.handleRefuseJoin},{default:f(()=>[_("拒绝")]),_:1},8,["onClick"])])):S("",!0)])]),default:f(()=>[I(y,{onRegister:t.registerForm},{formHeader:f(()=>[t.isUpdate?(u(),D("div",ce," 姓名、手机和邮箱为个人账户信息，组织中无法修改 ")):S("",!0),t.isUpdate&&(t.status==="3"||t.status==="4")?(u(),D("div",me,[fe,t.status==="3"?(u(),D("div",he,"审批中")):(u(),D("div",ge,"已拒绝"))])):S("",!0)]),_:1},8,["onRegister"])]),_:1},8,["onRegister","title"])}const yt=re(pe,[["render",ve],["__scopeId","data-v-ca01656d"]]);export{yt as default};
