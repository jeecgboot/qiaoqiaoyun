var q=Object.defineProperty;var x=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var I=(e,s,l)=>s in e?q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l,B=(e,s)=>{for(var l in s||(s={}))D.call(s,l)&&I(e,l,s[l]);if(x)for(var l of x(s))O.call(s,l)&&I(e,l,s[l]);return e};var k=(e,s,l)=>new Promise((y,n)=>{var S=r=>{try{c(l.next(r))}catch(f){n(f)}},h=r=>{try{c(l.throw(r))}catch(f){n(f)}},c=r=>r.done?y(r.value):Promise.resolve(r.value).then(S,h);c((l=l.apply(e,s)).next())});import{d as H,f as M,e as v,w as T,I as W,a3 as me,a4 as ye,V as U,a6 as u,a7 as m,a8 as G,F,am as L,af as C,a5 as E,ak as J,W as _,ai as K,k as z}from"./vue-vendor-24c7dc61.js";import{aC as X,a8 as Y}from"./antd-vue-vendor-0d72f01e.js";import"./index-1c3affea.js";import{U as Z,S as ee,m as A,a as te}from"./UserSelectModal-d78c1490.js";import{e as se,k as le,l as ne}from"./index-831af9dd.js";const ae=H({name:"UserSelect",components:{PlusOutlined:X,UserSelectModal:Z,SelectedUserItem:ee},props:{store:{type:String,default:"id"},value:{type:String,default:""},multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},query:{type:Boolean,default:!1},maxCount:{type:Number,default:2},disabled:{type:Boolean,default:!1},izExcludeMy:{type:Boolean,default:!1},inSuperQuery:{type:Boolean,default:!1}},emits:["update:value","change"],setup(e,{emit:s}){const l=Y.useInjectFormItemContext(),y=M(!0),n=M([]),S=v(()=>{let t=n.value,a=e.maxCount;return t.length<=a?t:t.filter((i,o)=>o<a)}),h=v(()=>{let t=e.maxCount,a=n.value.length;return a>t?{status:!0,count:a-t}:{status:!1}}),[c,{openModal:r,closeModal:f}]=se();function d(){if(e.disabled===!0)return;let t=W(n.value);r(!0,{list:t})}function N(t){n.value=t,b(),f()}function b(){y.value=!1;let t=[],a=n.value;a&&a.length>0&&(t=a.map(o=>o[e.store]));let i=t.join(",");s("update:value",i),s("change",i),l.onFieldChange()}T(()=>e.value,t=>k(this,null,function*(){t?y.value===!0&&(yield P(t)):n.value=[],y.value=!0}),{immediate:!0});function P(t){return k(this,null,function*(){let a=!1,i=t,o=[];if(n.value=[],t){let g=t.split(",").map(p=>p.trim()).filter(p=>p!="");g.includes(A)?(a=!0,o=g.filter(p=>p!=A)):o=g}if(o.length>0){i=o.join(",");const g="/sys/user/list";let p={[e.store]:i};const w=yield le.get({url:g,params:p},{isTransformResponse:!1});if(w.success){const{records:j}=w.result;n.value=j}}a&&n.value.push(B({},te))})}const Q=v(()=>e.disabled===!0?!1:e.multi===!0?!0:!(n.value.length>0));function R(t){let a=n.value,i=-1;for(let o=0;o<a.length;o++)if(a[o].id==t){i=o;break}i>=0&&(a.splice(i,1),n.value=a,b())}function V(t){t.preventDefault(),t.stopPropagation(),d()}const $=v(()=>e.query===!0);return{registerModal:c,onShowModal:d,isSearchFormComp:$,onSelected:N,showAddButton:Q,unSelectUser:R,selectedUserList:n,showUserList:S,ellipsisInfo:h,click2Add:V}}});const oe={key:1,style:{height:"30px","line-height":"30px",display:"inline-block","margin-left":"7px",color:"#bfbfbf"}},re={key:2,class:"user-selected-item"},ie={class:"user-select-ellipsis"},ue={style:{color:"red"}},de={key:1,style:{display:"flex","flex-wrap":"wrap","flex-direction":"row"}};function ce(e,s,l,y,n,S){const h=U("SelectedUserItem"),c=U("PlusOutlined"),r=U("a-button"),f=U("user-select-modal");return u(),m("div",null,[e.isSearchFormComp?(u(),m("div",{key:0,onClick:s[0]||(s[0]=(...d)=>e.click2Add&&e.click2Add(...d)),class:G(e.disabled?"disabled-user-select":""),style:{padding:"0 5px","background-color":"#fff",border:"1px solid #ccc","border-radius":"3px","box-sizing":"border-box",display:"flex",color:"#9e9e9e","font-size":"14px","flex-wrap":"wrap","min-height":"32px"}},[e.selectedUserList.length>0?(u(!0),m(F,{key:0},L(e.showUserList,d=>(u(),C(h,{info:d,onUnSelect:e.unSelectUser,query:""},null,8,["info","onUnSelect"]))),256)):(u(),m("span",oe,"请选择用户")),e.ellipsisInfo.status?(u(),m("div",re,[E("div",ie,[E("span",ue,"+"+J(e.ellipsisInfo.count)+"...",1)])])):_("",!0)],2)):(u(),m("div",de,[e.selectedUserList.length>0?(u(!0),m(F,{key:0},L(e.selectedUserList,d=>(u(),C(h,{info:d,onUnSelect:e.unSelectUser},null,8,["info","onUnSelect"]))),256)):_("",!0),e.showAddButton?(u(),C(r,{key:1,shape:"circle",onClick:e.onShowModal},{default:K(()=>[z(c)]),_:1},8,["onClick"])):_("",!0)])),z(f,{inSuperQuery:e.inSuperQuery,multi:e.multi,getContainer:e.getContainer,onRegister:e.registerModal,onSelected:e.onSelected,izExcludeMy:e.izExcludeMy},null,8,["inSuperQuery","multi","getContainer","onRegister","onSelected","izExcludeMy"])])}const Ue=ne(ae,[["render",ce],["__scopeId","data-v-f5165e21"]]);export{Ue as U};
