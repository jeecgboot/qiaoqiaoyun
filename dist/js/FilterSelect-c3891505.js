var Be=Object.defineProperty,ke=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var re=(i,n,s)=>n in i?Be(i,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[n]=s,D=(i,n)=>{for(var s in n||(n={}))se.call(n,s)&&re(i,s,n[s]);if(R)for(var s of R(n))ue.call(n,s)&&re(i,s,n[s]);return i},Z=(i,n)=>ke(i,Oe(n));var de=(i,n)=>{var s={};for(var a in i)se.call(i,a)&&n.indexOf(a)<0&&(s[a]=i[a]);if(i!=null&&R)for(var a of R(i))n.indexOf(a)<0&&ue.call(i,a)&&(s[a]=i[a]);return s};var C=(i,n,s)=>new Promise((a,b)=>{var N=m=>{try{v(s.next(m))}catch(T){b(T)}},F=m=>{try{v(s.throw(m))}catch(T){b(T)}},v=m=>m.done?a(m.value):Promise.resolve(m.value).then(N,F);v((s=s.apply(i,n)).next())});import{d as we,f as _,r as ce,e as pe,w as Ie,I as Ne,a5 as h,V as c,a6 as g,a7 as I,k as f,ai as y,af as Q,ag as Le,E as Ee,F as me,am as Pe,a8 as De,ak as fe}from"./vue-vendor-24c7dc61.js";import{cn as Qe,ct as qe,aC as Ge,aH as Me,av as Ve,bU as je,i as Re}from"./antd-vue-vendor-0d72f01e.js";import Ue from"./AdvancedFilter-972e0983.js";import{a7 as $e,l as Ke}from"./index-831af9dd.js";import ze from"./FilterOperation-229e1139.js";import He from"./FilterTabBar-45960b35.js";import Je from"./FilterEdit-4f2e84e7.js";import{u as We}from"./useSuperQueryCurd-0a66a14b.js";import"./type.definition-4eb605ee.js";import"./LinkRecordSelect-385d0eae.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";const Xe="/assets/filter-3a3ada44.png",Ye=we({name:"FilterSelect",components:{FilterOutlined:Qe,FilterFilled:qe,PlusOutlined:Ge,CheckOutlined:Me,CloseOutlined:Ve,EllipsisOutlined:je,AdvancedFilter:Ue,FilterOperation:ze,FilterEdit:Je,FilterTabBar:He},props:{columnList:{type:Array,default:()=>[]},routeCode:{type:String,default:""}},emits:["selected","filter"],setup(i,{emit:n}){const s=_(!1),a=_([]),b=_("1"),N=_("-1"),{userInfo:F}=$e(),v=ce({selected:!1}),m=_(""),T=pe(()=>{if(v.selected===!0)return"我创建的";{if(m.value)return m.value;let t=a.value.filter(e=>e.selected===!0);if(t.length>0)return t[0].title}return""}),{saveSuperQuery:q,updateSelected:L,removeSuperQuery:U,udapteSuperQueryTitle:$,copySuperQuery:K,querySuperQueryList:z}=We(i);Ie(()=>i.routeCode,t=>C(this,null,function*(){t&&(yield H(),setTimeout(()=>{T.value&&B()},300))}),{immediate:!0});function H(){return C(this,null,function*(){const t=yield z();if(t&&t instanceof Array){let e=[];for(let l of t)l.myself===!0?v.selected=l.selected:e.push(D({},l));a.value=e,e.findIndex(l=>l.selected===!0)!==-1&&(b.value="2")}})}function J(t,e){return C(this,null,function*(){t&&Y(t),v.selected=!1;let o=a.value;for(let u of o)u.selected=!1,u.title==e.title&&(u.selected=!0);let l={id:e.id,selected:!0};m.value="",yield L(l),a.value=o,s.value=!1,B()})}function W(t){E(t),v.selected=!0,s.value=!1,B()}function G(t){return C(this,null,function*(){let e=a.value;for(let o of e)if(o.selected===!0){let l={id:o.id,selected:!1};yield L(l)}E(t),B(),A.value=!1,m.value=""})}function E(t){t&&Y(t),v.selected=!1;let e=a.value;for(let o of e)o.selected=!1;a.value=e}const r=ce({visible:!1,type:"save",filterName:"",validateStatue:!1}),X=pe(()=>r.type=="save"?"保存":r.type=="copy"?"另存为":r.type=="rename"?"重命名":""),A=_(!1);let d={};function p(t){t&&Y(t),A.value=!0,d={}}const O=_();function S(){return C(this,null,function*(){O.value.validate().then(()=>C(this,null,function*(){if(r.type=="save"){let e=a.value,o={selected:!0,title:r.filterName,conditionType:d.conditionType,conditions:d.conditions?d.conditions:[],conditionsGroup:d.conditionsGroup?d.conditionsGroup:[],myself:!1};const{id:l,code:u}=yield q(o);o.id=l,o.code=u,E(),e.push(o),a.value=e,B(),A.value=!1,b.value="2",m.value=""}else if(r.type=="copy"){let e=a.value,o={selected:!1,title:r.filterName,conditionType:d.conditionType,conditions:d.conditions?d.conditions:[],conditionsGroup:d.conditionsGroup?d.conditionsGroup:[],myself:!1,id:d.id};const{id:l,code:u}=yield K(o);o.id=l,o.code=u,e.push(o),a.value=e,P.value=!1}else if(r.type=="rename"){let e=a.value;for(let o of e)if(o.title==d.title){const l={id:o.id,title:r.filterName};yield $(l),o.title=r.filterName}a.value=e}r.visible=!1,d={}}))})}function M(t){r.visible=!0,r.filterName="自定义筛选",r.type="save",d=t}function ye(t){let e=a.value;if(e&&e.length>0){let o=e.filter(l=>l.title==t);if(o&&o.length>0)return!1}return!0}const ve=[{required:!0,validator:()=>C(this,null,function*(){let t=r.filterName;return t===""?Promise.reject("请输入名称！"):ye(t)===!0?Promise.resolve():Promise.reject("该名称已存在！")}),trigger:"change"}];function mt(){}function B(){if(v.selected===!0){let e={matchType:"and",superQueryParams:[{field:"create_by",rule:"eq",val:F==null?void 0:F.username,type:"input"}]};n("filter",e)}else{let t=a.value;if(t&&t.length>0){let e=t.filter(o=>o.selected===!0);if(!e||e.length==0){n("filter",{matchType:"and",superQueryParams:""});return}if(e[0].myself===!0){let l={matchType:"and",superQueryParams:[{field:"create_by",rule:"eq",val:F==null?void 0:F.username,type:"input"}]};n("filter",l)}else ie(oe(e[0]),e[0].conditionType)}else n("filter",{matchType:"and",superQueryParams:""})}}function he(t,e,o){return C(this,null,function*(){if(t=="copy"){let l={conditionType:e.conditionType,id:e.id},u=e.conditions;Array.isArray(u)&&u.length>0?l.conditions=u:l.conditionsGroup=e.conditionsGroup,x(o,l)}else if(t=="remove"){let l=a.value,u=l[o].selected;yield U(e.id),l.splice(o,1),a.value=l,u===!0&&B()}else if(t=="rename")d={index:o,title:e.title},r.visible=!0,r.filterName=e.title,r.type="rename";else if(t=="edit"){let l=D({index:o},Ne(e));P.value=!0,te.value=l}e.iconVisible=!1})}function ge(t,e){let o=a.value,l=o[t];l.emitChange="",l.conditions=e.conditions,l.conditionType=e.conditionType,l.title=e.title,l.conditionsGroup=e.conditionsGroup,a.value=o,l.selected===!0&&B(),P.value=!1}function x(t,e){let l=a.value[t];l.emitChange="",d=e,r.visible=!0,e.title?r.filterName=e.title:r.filterName=l.title+"-复制",r.type="copy"}function Fe(t){return N.value==t}function _e(){return document.getElementsByClassName("jee-filter-select-pop")[0]}function Y(t){t.preventDefault(),t.stopPropagation()}function be(t){b.value=t}const ee=_(!0);function Ce(){ee.value=!1}function Te(t){let e="ant-collapse-header";return t.selected===!0&&(e+=" selected"),t.iconVisible===!0&&(e+=" icon-visible"),e}const te=_({}),P=_(!1);function Se(){A.value=!1,P.value=!1}function ie(t,e){if(!t||t.length==0){n("filter",{matchType:"and",superQueryParams:""});return}let o=t,l=[],u=!0,V=[];for(let k of o){let ne=[];if(k.queryItems){for(const w of k.queryItems){let j=w.field,ae=w.val;le(ae,w),ne.push(Z(D({},w),{field:j,val:ae}))}l.push({queryItems:ne,matchType:k.matchType}),u=!1}else{let w=k.field,j=k.val;le(j,k),u=!0,V.push(Z(D({},k),{field:w,val:j}))}}u&&l.push({queryItems:V,matchType:e}),n("filter",{matchType:e,superQueryParams:l})}function Ae(t){const{conditionType:e}=t;let o=oe(t);if(ie(o,e),b.value==="1")if(o.length===0)G();else{let l=0;for(const u of o)u.queryItems&&u.queryItems.length>0&&(l+=u.queryItems.length);l==0&&(l=o.length),m.value=`${l} 项`}else m.value=""}function le(t,e){if(t instanceof Array&&(t=t.join(",")),t&&(e.type=="date"||e.type=="datetime"||e.type==="year"||e.type==="month")){const o=l=>e.timestamp?Re(l).toDate().getTime():l;if(e.rule==="range"){let l=t.split(","),u=o(l[0]),V=o(l[1]);t=u+","+V}else t=o(t)}return t}function oe(t){let e=t.conditions;return Array.isArray(e)&&e.length>0&&e[0].field?e:t.conditionsGroup}return{tabActive:b,onTabActiveChange:be,isFirstAdd:ee,filterImage:Xe,onAddFilter:Ce,getFilterItemClass:Te,editFilterInfo:te,isEditPage:P,visible:s,handleSelect:J,filterList:a,selectMyCreate:W,mySelfFilter:v,filterTitle:T,myClearFilter:G,showAdding:A,nameModal:r,nameModalTitle:X,handleAdd:p,beforeSaveFiledList:M,handleModalSave:S,nameRules:ve,activeFilterKey:N,showOperation:Fe,handleFilterOperation:he,saveInfo:ge,copyInfo:x,nameFormRef:O,getContainer:_e,editFilterOk:Se,onlySearch:Ae}}});const Ze={class:"jee-filter-select-container"},xe=h("div",{class:"ant-modal-content"},null,-1),et={key:0,class:"inner-content filter-select-adding",style:{padding:"1px"}},tt=h("span",null,[h("div",{style:{color:"#9e9e9e"}},"添加筛选条件，查询工作表数据")],-1),it={style:{width:"100%","text-align":"center","margin-bottom":"10px"}},lt=h("div",{style:{color:"#9e9e9e","font-size":"12px",padding:"6px 20px"}}," 我的筛选 ",-1),ot=["onClick"],nt={class:"right-operation"},at=h("span",null,[h("div",{style:{color:"#9e9e9e"}},"没有保存的筛选条件")],-1),rt={key:0,class:"has-filter"},st={class:"text"},ut={class:"icon"},dt={style:{display:"flex","margin-top":"20px"}};function ct(i,n,s,a,b,N){const F=c("FilterEdit"),v=c("AdvancedFilter"),m=c("PlusOutlined"),T=c("a-button"),q=c("a-empty"),L=c("a-tab-pane"),U=c("FilterFilled"),$=c("FilterOperation"),K=c("FilterTabBar"),z=c("a-tabs"),H=c("filter-outlined"),J=c("CloseOutlined"),W=c("FilterOutlined"),G=c("a-tooltip"),E=c("a-popover"),r=c("a-input"),X=c("a-form-item"),A=c("a-form"),d=c("a-modal");return g(),I("div",Ze,[f(E,{open:i.visible,"onUpdate:open":n[2]||(n[2]=p=>i.visible=p),placement:"bottomLeft",trigger:"click",overlayClassName:"jee-filter-select-pop"},{title:y(()=>[]),content:y(()=>[xe,i.isEditPage?(g(),Q(F,{key:0,columnList:i.columnList,info:i.editFilterInfo,onSave:i.saveInfo,onCopy:i.copyInfo,onSearch:i.onlySearch,onBack:i.editFilterOk},null,8,["columnList","info","onSave","onCopy","onSearch","onBack"])):(g(),Q(z,{key:1,activeKey:i.tabActive,"onUpdate:activeKey":n[1]||(n[1]=p=>i.tabActive=p),centered:"",class:"filter-tab"},{renderTabBar:y(S=>{var M=S,{DefaultTabBar:p}=M,O=de(M,["DefaultTabBar"]);return[f(K,Le(O,{onActive:i.onTabActiveChange}),null,16,["onActive"])]}),default:y(()=>[f(L,{key:"1",tab:"新的筛选","force-render":""},{default:y(()=>[i.showAdding?(g(),I("div",et,[f(v,{columnList:i.columnList,onSave:i.beforeSaveFiledList,onSearch:i.onlySearch,clear:i.showAdding,"onUpdate:clear":n[0]||(n[0]=p=>i.showAdding=p)},null,8,["columnList","onSave","onSearch","clear"])])):(g(),Q(q,{key:1,image:i.filterImage,"image-style":{margin:"0 auto",height:"160px",verticalAlign:"middle",borderStyle:"none"}},{description:y(()=>[tt]),default:y(()=>[h("div",it,[f(T,{onClick:i.handleAdd,type:"primary",style:{"border-radius":"15px"}},{default:y(()=>[f(m),Ee("添加筛选条件 ")]),_:1},8,["onClick"])])]),_:1},8,["image"]))]),_:1}),f(L,{key:"2",tab:"已保存","force-render":"",class:"filter-list"},{default:y(()=>[i.filterList&&i.filterList.length>0?(g(),I(me,{key:0},[lt,(g(!0),I(me,null,Pe(i.filterList,(p,O)=>(g(),I("div",{class:De(i.getFilterItemClass(p))},[h("div",{class:"header-content",onClick:S=>i.handleSelect(S,p)},[f(U,{style:{"margin-right":"10px",color:"rgb(153, 153, 153)"}}),h("span",null,fe(p.title),1)],8,ot),h("div",nt,[f($,{onOpt:S=>i.handleFilterOperation(S,p,O),onIconVisible:S=>p.iconVisible=S},null,8,["onOpt","onIconVisible"])])],2))),256))],64)):(g(),Q(q,{key:1,image:i.filterImage,"image-style":{margin:"0 auto",height:"160px",verticalAlign:"middle",borderStyle:"none"}},{description:y(()=>[at]),_:1},8,["image"]))]),_:1})]),_:1},8,["activeKey"]))]),default:y(()=>[f(G,{placement:"bottom",title:"筛选"},{default:y(()=>[i.filterTitle?(g(),I("span",rt,[f(H),h("span",st,fe(i.filterTitle),1),h("span",ut,[f(J,{onClick:i.myClearFilter},null,8,["onClick"])])])):(g(),Q(W,{key:1}))]),_:1})]),_:1},8,["open"]),f(d,{open:i.nameModal.visible,"onUpdate:open":n[4]||(n[4]=p=>i.nameModal.visible=p),wrapClassName:"filter-name-modal",title:i.nameModalTitle,onOk:i.handleModalSave,getContainer:i.getContainer},{default:y(()=>[h("div",dt,[f(A,{labelCol:{span:8},wrapperCol:{span:16},ref:"nameFormRef",model:i.nameModal},{default:y(()=>[f(X,{label:"名称",name:"filterName",rules:i.nameRules},{default:y(()=>[f(r,{value:i.nameModal.filterName,"onUpdate:value":n[3]||(n[3]=p=>i.nameModal.filterName=p),style:{width:"300px"}},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])])]),_:1},8,["open","title","onOk","getContainer"])])}const gi=Ke(Ye,[["render",ct]]);export{gi as default};
