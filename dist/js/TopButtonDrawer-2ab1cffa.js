var Be=Object.defineProperty,Ae=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var G=(e,i,r)=>i in e?Be(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,L=(e,i)=>{for(var r in i||(i={}))ke.call(i,r)&&G(e,r,i[r]);if(z)for(var r of z(i))Te.call(i,r)&&G(e,r,i[r]);return e},W=(e,i)=>Ae(e,ve(i));var B=(e,i,r)=>new Promise((S,T)=>{var I=h=>{try{m(r.next(h))}catch(C){T(C)}},l=h=>{try{m(r.throw(h))}catch(C){T(C)}},m=h=>h.done?S(h.value):Promise.resolve(h.value).then(I,l);m((r=r.apply(e,i)).next())});import{d as be,as as xe,f as D,r as Fe,e as X,w as Y,l as Re,a3 as Se,a4 as Ie,a5 as f,V as R,a6 as w,a7 as _,F as V,k as d,ai as y,a8 as Le,ak as J,W as v,am as De}from"./vue-vendor-24c7dc61.js";import{u as Ee}from"./lowAppAuth-3d637b7d.js";import{a as Ue}from"./useAuth-d62eecf0.js";import{a7 as Oe,e as Me,a as Ve,k as E,l as He}from"./index-831af9dd.js";import Pe from"./BatchUpdateModal-e973d8c0.js";import"./index-1c3affea.js";import{u as $e}from"./useFuncSwitch-b7681246.js";import{u as je}from"./LinkRecordSelect-385d0eae.js";import"./lowAppUtils-56892d30.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./SelectItem-04dd2229.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const Ke=be({name:"TopButtonDrawer",props:{selectedRowKeys:{type:Array,default:()=>[]},selectedRows:{type:Array,default:()=>[]},designButtonList:{type:Array,default:()=>[]},designFormCode:{type:String,default:""},viewId:{type:String,default:""},tableColumns:{type:Array,default:()=>[]},dynamicConfig:{type:Object,default:()=>{}}},components:{BatchUpdateModal:Pe},emits:["delete","success","export","clear","reload"],setup(e,{emit:i}){const r=xe(),S=Oe(),T="/act/designer/miniDesFlow/api/buttonStartProcess",{createInfoModal:I,createMessage:l,createConfirm:m,createConfirmSync:h}=Ve(),C=D([]),b=D([]),{ifTrue:g,ifGroupTrue:U}=je(),A=Ee(),Q=D(!1);Q.value=A.getLowAppAdminAuth();const c=Fe({update:!0,copy:!0,print:!0,export:!0,delete:!0}),{hasUpdateAuth:Z,hasDeleteAuth:ee}=Ue(),{getHasFunc:x}=$e(),O=x("BATCH_EDIT"),te=x("BATCH_SYS_PRINT"),H=x("BATCH_EXPORT"),P=x("BATCH_REMOVE"),$=x("BATCH_CUSTOM_BUTTON"),j=X(()=>!!(O.value&&c.update||O.value&&c.copy||H.value&&c.export||P.value&&c.delete||$.value&&b.value.length>0)),oe=X(()=>j.value?91:54),M=D(!1);Y(()=>e.selectedRowKeys,t=>{if(t&&t.length>0){if(M.value=!0,A.getLowAppAdminAuth()==!0)Object.keys(c).map(n=>{c[n]=!0});else{let n=e.designFormCode,s=A.getOperationAuth(n);c.print=s.print_record,c.export=s.export_table,c.update=Z(n,e.viewId,e.selectedRows),c.delete=ee(n,e.viewId,e.selectedRows),c.copy=c.update}ne()}else M.value=!1},{deep:!0,immediate:!0});function ne(){let t=ge();if(t&&t.length)for(let o of t)c[o.id]=se(o,e.selectedRows);b.value=t}function se(t,o){if(t.showStatus==="condition"){let n=!1;for(let s of o){const{conditionList:a,conditionsGroup:p,conditionType:u}=t;if(Array.isArray(a)&&a.length>0?n=g(a,u,s):n=U(p,u,s),n===!0)break}return n}return!0}function ie(){return r.meta.lowApp===!0?document.getElementById("low_app_page_content"):document.querySelector(".jeecg-default-layout-main")}function re(t){return A.getLowAppAdminAuth()===!0?!0:c[t]}function ae(){I({title:()=>Re("span",{style:{color:"rgb(244, 67, 54)","font-size":"17px"}},"批量删除记录"),content:"60天内可在 回收站 内找回已删除记录, 无删除权限的数据无法删除",width:480,okText:"确定",icon:" ",okButtonProps:{danger:!0},cancelText:"取消",okCancel:!0,onOk:function(){pe()},onCancel:function(){}})}const[le,{openModal:ue,closeModal:K}]=Me();function de(){ue(!0,{})}function ce(t){return B(this,null,function*(){let o=e.selectedRowKeys;const n="/desform/data/batchUpdate";let s=r.params.appId||"-1",a=W(L({},t),{idList:o,appId:s,designFormCode:e.designFormCode,authType:"update"});const p=yield E.put({url:n,params:a},{isTransformResponse:!1});p.success?(l.success(p.message),i("success")):l.error(p.message),K()})}function pe(){return B(this,null,function*(){const t="/desform/data/batchDelete";let o=e.selectedRowKeys,n=r.params.appId||"-1",s={idList:o,appId:n,designFormCode:e.designFormCode,authType:"delete"};const a=yield E.put({url:t,params:s},{isTransformResponse:!1});a.success?(l.success(a.message),i("success")):l.error(a.message),K()})}function fe(){i("export")}function me(){i("clear")}function he(){return B(this,null,function*(){const{designFormCode:t,selectedRowKeys:o}=e;if(!o||o.length===0){l.warning("请先选择要复制的数据");return}const n=`/desform/data/${t}/copyRecords`;try{if(!(yield h({title:"复制",content:`确定要复制这${o.length}条数据吗？`})))return;yield E.put({url:n,params:{ids:o}},{joinParamsToUrl:!0}),i("success")}catch(s){}})}Y(()=>e.dynamicConfig,()=>{let o=e.dynamicConfig.buttonList||[];C.value=o},{immediate:!0,deep:!0});function N(t,o,n){return t===!0||Object.keys(o).indexOf(n)<0?!0:o[n]}function ge(){let t=e.designButtonList,o=[],n=A.getLowAppAdminAuth(),s=A.getCustomButtonAuth(e.designFormCode),a=C.value,p=t.filter(u=>u.allView===!0);if(a.length===0&&p.length===0)return[];if(p&&p.length>0)for(let u of p)u.clickThen!=="form"&&N(n,s,u.id)!==!1&&o.push(L({},u));for(let u of t)if(a.indexOf(u.id)>=0){if(u.clickThen==="form"||N(n,s,u.id)===!1)continue;o.push(L({},u))}return o.sort(function(u,F){return F.seq-u.seq}),o}function ye(t){if(t.clickThen==="confirm"){const{tip:o,ok:n,cancel:s}=t.confirmText;m({iconType:"warning",title:o,okText:n,cancelText:s,onOk:()=>B(this,null,function*(){q(t)})})}else t.clickThen==="form"||q(t)}function q(t){return B(this,null,function*(){let o=t.processId;if(o){let n=Ce(t),s=[];if(n&&n.length>0)for(let a=0;a<n.length;a++){const p=yield we(o,n[a]);p&&s.push(p)}s.length>0?l.error(s.join(";")):(l.success("操作成功！"),i("success"))}else l.warn("未配置流程！");i("reload")})}function Ce(t){let o=e.selectedRows,n=[];if(t.showStatus==="condition")for(let s of o){const{conditionList:a,conditionsGroup:p,conditionType:u}=t;let F=!1;Array.isArray(a)&&a.length>0?F=g(a,u,s):F=U(p,u,s),F===!0&&n.push(s.id)}else n=o.map(s=>s.id);return n}function we(t,o){return B(this,null,function*(){let n={processId:t,dataId:o,formKey:e.designFormCode,applyUserId:S.getUserInfo.username};const s=yield E.post({url:T,params:n},{joinParamsToUrl:!0,isTransformResponse:!1});return s.success?"":s.message})}function _e(t){t.preventDefault(),t.stopPropagation(),i("reload")}return{topTipVisible:M,getContainer:ie,drawerHeight:oe,hasBatchEdit:O,hasBatchPrint:te,hasBatchExport:H,hasBatchRemove:P,hasBatchCustomButton:$,showFooterButton:j,hasAuth:re,operationAuth:c,onDelete:ae,registerModal:le,onUpdate:de,doUpdate:ce,onExport:fe,onBatchCopy:he,onClearSelect:me,customButtonList:b,onCustomButtonBatch:ye,onReload:_e}}});const k=e=>(Se("data-v-202d5bb4"),e=e(),Ie(),e),Ne=k(()=>f("div",{style:{height:"0"}},null,-1)),qe={style:{display:"flex"}},ze={style:{height:"42px","line-height":"40px",color:"#333","font-size":"17px","font-weight":"700","margin-left":"12px"}},Ge={style:{"margin-left":"10px",height:"42px","line-height":"40px"}},We=k(()=>f("span",{style:{"margin-left":"4px"}},"取消选中",-1)),Xe={class:"top-drawer-footer-buttons"},Ye={key:0},Je=k(()=>f("span",{style:{"margin-left":"4px"}},"编辑",-1)),Qe={key:1,style:{"margin-left":"5px"}},Ze=k(()=>f("span",{style:{"margin-left":"4px"}},"复制",-1)),et={key:2,style:{"margin-left":"5px"}},tt=k(()=>f("span",{style:{"margin-left":"4px"}},"导出",-1)),ot={key:3,style:{"margin-left":"5px"}},nt=k(()=>f("span",{style:{"margin-left":"4px",color:"#ff6d6c"}},"删除",-1)),st={key:0,style:{"margin-left":"5px"}},it={style:{"margin-left":"4px"}},rt={class:"top-drawer-footer-icons"};function at(e,i,r,S,T,I){const l=R("Icon"),m=R("a-button"),h=R("a-tooltip"),C=R("a-drawer"),b=R("BatchUpdateModal");return w(),_(V,null,[d(C,{width:500,placement:"top",getContainer:e.getContainer,open:e.topTipVisible,"root-style":{position:"absolute"},contentWrapperStyle:{overflow:"hidden"},bodyStyle:{padding:0},headerStyle:{padding:0,overflow:"hidden"},height:e.drawerHeight,closable:!1,mask:!1,destroyOnClose:"",onClose:i[0]||(i[0]=g=>e.topTipVisible=!1),keyboard:!1},{title:y(()=>[Ne]),default:y(()=>[f("div",{class:Le(["top-drawer-body",{"hide-button":!e.showFooterButton}])},[f("div",qe,[f("div",ze," 已选择 "+J(e.selectedRowKeys.length)+" 条记录 ",1),f("div",Ge,[d(m,{type:"text",ghost:"",style:{padding:"0 10px"},onClick:e.onClearSelect},{default:y(()=>[d(l,{icon:"ant-design:close-square-outlined"}),We]),_:1},8,["onClick"])])]),f("div",Xe,[e.hasBatchEdit&&e.operationAuth.update?(w(),_("div",Ye,[d(m,{type:"text",style:{padding:"0 10px"},onClick:e.onUpdate},{default:y(()=>[d(l,{icon:"ant-design:edit-outlined"}),Je]),_:1},8,["onClick"])])):v("",!0),e.hasBatchEdit&&e.operationAuth.copy?(w(),_("div",Qe,[d(m,{type:"text",style:{padding:"0 10px"},onClick:e.onBatchCopy},{default:y(()=>[d(l,{icon:"ant-design:copy-outlined"}),Ze]),_:1},8,["onClick"])])):v("",!0),e.hasBatchExport&&e.operationAuth.export?(w(),_("div",et,[d(m,{type:"text",style:{padding:"0 10px"},onClick:e.onExport},{default:y(()=>[d(l,{icon:"ant-design:download-outlined"}),tt]),_:1},8,["onClick"])])):v("",!0),e.hasBatchRemove&&e.operationAuth.delete?(w(),_("div",ot,[d(m,{type:"text",style:{padding:"0 10px"},onClick:e.onDelete},{default:y(()=>[d(l,{icon:"ant-design:delete-outlined",color:"#ff6d6c"}),nt]),_:1},8,["onClick"])])):v("",!0),e.hasBatchCustomButton?(w(!0),_(V,{key:4},De(e.customButtonList,g=>(w(),_(V,null,[e.operationAuth[g.id]?(w(),_("div",st,[d(m,{type:"text",style:{padding:"0 10px"},onClick:U=>e.onCustomButtonBatch(g)},{default:y(()=>[d(l,{icon:g.icon,color:g.color},null,8,["icon","color"]),f("span",it,J(g.label),1)]),_:2},1032,["onClick"])])):v("",!0)],64))),256)):v("",!0)]),f("div",rt,[d(h,{title:"刷新视图"},{default:y(()=>[d(l,{icon:"ant-design:reload-outlined",class:"top-drawer-reload-icon",size:18,onClick:e.onReload},null,8,["onClick"])]),_:1})])],2)]),_:1},8,["getContainer","open","height"]),d(b,{onOk:e.doUpdate,tableColumns:e.tableColumns,designFormCode:e.designFormCode,onRegister:e.registerModal},null,8,["onOk","tableColumns","designFormCode","onRegister"])],64)}const lo=He(Ke,[["render",at],["__scopeId","data-v-202d5bb4"]]);export{lo as default};
