var J=Object.defineProperty,z=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var A=(t,a,o)=>a in t?J(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,d=(t,a)=>{for(var o in a||(a={}))H.call(a,o)&&A(t,o,a[o]);if(R)for(var o of R(a))E.call(a,o)&&A(t,o,a[o]);return t},M=(t,a)=>z(t,G(a));var g=(t,a,o)=>new Promise((p,i)=>{var s=r=>{try{n(o.next(r))}catch(c){i(c)}},u=r=>{try{n(o.throw(r))}catch(c){i(c)}},n=r=>r.done?p(r.value):Promise.resolve(r.value).then(s,u);n((o=o.apply(t,a)).next())});import{B as K}from"./index-1c3affea.js";import{d as Q,f as _,e as P,w as W,u as f,V as h,a6 as X,af as Y,ap as Z,aq as ee,ai as T,k as O}from"./vue-vendor-24c7dc61.js";import{h as te}from"./antd-vue-vendor-0d72f01e.js";import{H as oe,q as ae,j as re,l as ie}from"./index-831af9dd.js";import"./index-52c8c841.js";import{dataAuth as se}from"./auth.data-0f6cd267.js";import{d as ne}from"./auth.api-15f2ddd8.js";import{g as me}from"./desformUtils-c7daaa89.js";import{B as pe,u as le}from"./useForm-14b2bc77.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./helper-22dafba0.js";const ue=Q({name:"DataAuthModal",components:{BasicForm:pe,BasicModal:K},props:{desformRecord:oe.any.isRequired},emits:["register","success"],setup(t,{emit:a}){const o=ae(),p=_(!1),i=_(),s=_(!1),u=P(()=>s.value?"编辑":"新增"),[n,{closeModal:r,setModalProps:c,getVisible:v}]=re(q),[$,{resetFields:D,setFieldsValue:y,validate:k,updateSchema:L}]=le({schemas:se.formSchemas,showActionButtonGroup:!1}),S=P(()=>{let e={width:800,title:f(u),confirmLoading:f(p)};return M(d(d(d({},f(o)),e),t),{onOk:U,onCancel:b,onRegister:n})});W(()=>v==null?void 0:v.value,e=>{e&&t.desformRecord&&j()},{immediate:!0});let F=[];function j(){let e=[];try{let m=JSON.parse(t.desformRecord.desformDesignJson);e=me({dataList:m.list})}catch(m){}let l=e.map(m=>{let{title:V,dataIndex:C}=m,x=m.valueType;return{label:`${V}（${C}）`,value:C,valueType:x}});F=[{label:"请选择",value:void 0},...l,{label:"创建人（create_by）",value:"create_by"},{label:"创建时间（create_time）",value:"create_time",valueType:"datetime"},{label:"更新人（update_by）",value:"update_by"},{label:"更新时间（update_time）",value:"update_time",valueType:"datetime"}]}function q(e){s.value=!!f(e==null?void 0:e.isUpdate),s.value?B(e==null?void 0:e.record):N(),L({field:"authField",componentProps:{options:F,onChange:I}})}function I(e,l){if(e){let m=l.valueType||"string";y({authValueType:m})}}function b(){r()}function N(){B({})}function B(e){return g(this,null,function*(){yield D(),i.value=te(e),yield y(d({},i.value))})}function U(){return g(this,null,function*(){try{let e=yield k(),l=Object.assign({desformId:t.desformRecord.id,desformCode:t.desformRecord.desformCode},i.value,e);w(!0),yield ne.saveOrUpdate(l,s.value),b(),a("success")}finally{w(!1)}})}function w(e){p.value=e,c({confirmLoading:e})}return{registerForm:$,getProps:S,loading:p}}});function ce(t,a,o,p,i,s){const u=h("BasicForm"),n=h("a-spin"),r=h("BasicModal");return X(),Y(r,Z(ee(t.getProps)),{default:T(()=>[O(n,{wrapperClassName:"p-2",spinning:t.loading},{default:T(()=>[O(u,{onRegister:t.registerForm},null,8,["onRegister"])]),_:1},8,["spinning"])]),_:1},16)}const nt=ie(ue,[["render",ce]]);export{nt as default};
