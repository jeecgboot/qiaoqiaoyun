var z=Object.defineProperty,I=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var M=(s,e,o)=>e in s?z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,b=(s,e)=>{for(var o in e||(e={}))N.call(e,o)&&M(s,o,e[o]);if(k)for(var o of k(e))O.call(e,o)&&M(s,o,e[o]);return s},R=(s,e)=>I(s,U(e));var C=(s,e,o)=>new Promise((i,a)=>{var u=r=>{try{c(o.next(r))}catch(n){a(n)}},_=r=>{try{c(o.throw(r))}catch(n){a(n)}},c=r=>r.done?i(r.value):Promise.resolve(r.value).then(u,_);c((o=o.apply(s,e)).next())});import{d as y,r as T,f as d,V as f,a6 as $,af as q,ai as m,k as l,u as w,E as A,ag as D}from"./vue-vendor-24c7dc61.js";import{B as G}from"./BasicModal-58413bab.js";import{C as L}from"./index-f99b266a.js";import{a7 as H,j as J,a as K,bt as Q,bu as W}from"./index-831af9dd.js";import"./index-1c3affea.js";import{r as X}from"./validator-bc7dc032.js";import{a8 as Y}from"./antd-vue-vendor-0d72f01e.js";import{j as Z}from"./UserSetting.api-d09d4ebb.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./user.api-ffaaa05b.js";const ee=y({name:"user-replace-phone-modal"}),de=y(R(b({},ee),{emits:["register","success"],setup(s,{emit:e}){const o=H(),{createMessage:i}=K(),a=T({phone:"",smscode:""}),u=d(),_=d({}),c={phone:[b({},X.duplicateCheckRule("sys_user","phone",a,{label:"手机号"})[0]),{pattern:/^1[3456789]\d{9}$/,message:"手机号码格式有误"}],smscode:[{required:!0,message:"请输入验证码"}]},r=Y.useForm,n=d(""),h=d("updatePhone"),[P,{setModalProps:B,closeModal:F}]=J(t=>C(this,null,function*(){u.value.resetFields(),u.value.clearValidate(),B({confirmLoading:!1}),t.record.phone?(n.value="修改手机号",h.value="updatePhone"):(n.value="绑定手机号",h.value="bindPhone"),t.record.smscode="",Object.assign(a,t.record),_.value=t.record}));function S(){return Q({mobile:a.phone,smsmode:W.REGISTER})}function x(){return C(this,null,function*(){yield u.value.validateFields(),Z(a).then(t=>{t.success?(i.success(h.value==="updatePhone"?"修改手机号成功":"绑定手机号成功"),e("success"),F()):i.warning(t.message)})})}return(t,p)=>{const E=f("a-input"),v=f("a-form-item"),V=f("a-button"),j=f("a-form");return $(),q(G,D(t.$attrs,{onRegister:w(P),width:"500px",title:n.value,showCancelBtn:!1,showOkBtn:!1}),{default:m(()=>[l(j,{class:"antd-modal-form",ref_key:"formRef",ref:u,model:a,rules:c},{default:m(()=>[l(v,{name:"phone"},{default:m(()=>[l(E,{size:"large",value:a.phone,"onUpdate:value":p[0]||(p[0]=g=>a.phone=g),placeholder:"请输入手机号"},null,8,["value"])]),_:1}),l(v,{name:"smscode"},{default:m(()=>[l(w(L),{size:"large",value:a.smscode,"onUpdate:value":p[1]||(p[1]=g=>a.smscode=g),placeholder:"输入6位验证码",sendCodeApi:S},null,8,["value"])]),_:1}),l(v,null,{default:m(()=>[l(V,{size:"large",type:"primary",block:"",onClick:x},{default:m(()=>[A(" 确认 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},16,["onRegister","title"])}}}));export{de as default};
