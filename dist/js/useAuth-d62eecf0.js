var M=(u,l,i)=>new Promise((f,c)=>{var p=r=>{try{o(i.next(r))}catch(t){c(t)}},d=r=>{try{o(i.throw(r))}catch(t){c(t)}},o=r=>r.done?f(r.value):Promise.resolve(r.value).then(p,d);o((i=i.apply(u,l)).next())});import{f as x,r as F,c as R}from"./vue-vendor-24c7dc61.js";import{k as _,a7 as j}from"./index-831af9dd.js";import{u as U}from"./lowAppAuth-3d637b7d.js";import{g as N}from"./lowAppUtils-56892d30.js";function G(){const u=U(),l=x(!1),i=F({}),f=x([]);function c(r,t){return M(this,null,function*(){if(!r||!t)return;let w=JSON.stringify({appId:r,formCode:t});if(!u.hasAuthByOnce(w))return yield p(r,t)})}function p(r,t){return M(this,null,function*(){if(!r||!t){N()||(l.value=!0);return}const w="/online/lowAppAuth/getMyAuth";let a={appId:r,formCode:t},e=yield _.get({url:w,params:a});e.hasAdmin===!0?f.value=[]:(Object.keys(e.formOperations).map(n=>{i[n]=e.formOperations[n]}),u.setOperationAuth(t,e.formOperations),u.setRecordAuth(t,e.recordAuth),u.setViewAuth(t,e.viewAuthMap),u.setEasyViewAuth(t,e.easyViewAuthMap),u.setCustomButtonAuth(t,e.customButtonAuth),u.setExcludeFields(t,e.excludeFields),u.setExcludeUpdateFields(t,e.excludeUpdateFields),u.setSubordinates(e.subordinateList||[]),d(e)),l.value=e.hasAdmin;let s=JSON.stringify({appId:r,formCode:t});u.setAuthByOnce(s,!0)})}function d(r){let t=r.viewAuthMap;if(r.easyViewAuthMap.read===!0)f.value=[];else{let a=[];Object.keys(t).map(e=>{t[e].read===!1&&a.push(e)}),f.value=a}}function o(r){return l.value===!0?!0:i[r]||!1}return{hasAdminAuth:l,getFormAuth:p,getFormAuthOnce:c,operationAuth:i,hasAuth:o,excludeViewIds:f}}function I(){const u=U(),l=j(),i="create_by";let f=R("globalColumnList",void 0);function c(a,e,s){return t(a,e,"update",s)}function p(a,e,s){return t(a,e,"delete",s)}function d(a,e){return u.getLowAppAdminAuth()===!0?!0:(u.getOperationAuth(a)||{})[e]||!1}function o(a){return d(a,"batch_table")}function r(a){return d(a,"add")}function t(a,e,s,n){if(u.getLowAppAdminAuth()===!0)return!0;let h=u.getViewAuth(a)[e]||{},L=u.getEasyViewAuth(a),m=u.getSubordinates,A=l.getUserInfo.username,k=h[s]||!1,B=L[s]||!1,b=k||B;if(b===!0){let S=u.getRecordAuth(a)[s];if(!S)return!1;let{scope:V,subStatus:E}=S;if(V=="readonly")b=!1;else if(V=="own"){let g=!1;for(let O of n){if(A==O[i]){g=!0;break}if(w(O)===!0){g=!0;break}}if(g===!1&&E===!0)for(let O of n){let D=O[i];if(m.indexOf(D)>=0){g=!0;break}}g===!1&&(b=!1)}}return b}function w(a){let e=!1;if(f){let s=f.value,n=u.getRoles,y=u.getDeparts,v=l.getUserInfo.username;for(let h of s){if(e===!0)break;if(h.dataAuthType==="owner"){let L=h.model,m=a[L];if(m){if(h.type==="org-role"){for(let A of m)if(n&&n.length>0&&n.indexOf(A)>=0){e=!0;break}}else if(h.type==="select-depart"){for(let A of m)if(y&&y.length>0&&y.indexOf(A)>=0){e=!0;break}}else if(h.type==="select-user"){for(let A of m)if(v&&v===A){e=!0;break}}}}}}return e}return{hasUpdateAuth:c,hasDeleteAuth:p,hasCreateAuth:r,hasBatchAuth:o}}export{I as a,G as u};
