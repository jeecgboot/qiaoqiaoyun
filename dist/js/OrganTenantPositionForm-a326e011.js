var f=(e,o,l)=>new Promise((U,h)=>{var w=r=>{try{v(l.next(r))}catch(p){h(p)}},d=r=>{try{v(l.throw(r))}catch(p){h(p)}},v=r=>r.done?U(r.value):Promise.resolve(r.value).then(w,d);v((l=l.apply(e,o)).next())});import{d as se,f as u,u as C,a3 as ie,a4 as ne,a5 as s,V as c,a6 as V,a7 as N,F as A,k as n,ai as a,E as _,z as ae,am as le,a8 as re,ak as $,q as ce,A as de}from"./vue-vendor-24c7dc61.js";import{B as pe,u as ue}from"./useForm-14b2bc77.js";import"./index-52c8c841.js";import{u as me}from"./useListPage-62a041ef.js";import"./index-621e597c.js";import"./index-1c3affea.js";import{U as fe}from"./UserSelectModal-d78c1490.js";import{k,R as ve,e as ge,l as Ce}from"./index-831af9dd.js";import{M as K}from"./antd-vue-vendor-0d72f01e.js";import _e from"./BasicTable-d435f501.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";const ke=e=>k.get({url:"/sys/position/list",params:e},{isTransformResponse:!1}),j=e=>k.get({url:"/sys/position/getPositionUserList",params:e}),he=(e,o)=>k.post({url:"/sys/position/savePositionUser",params:e},{joinParamsToUrl:!0}).then(()=>{o()}),ye=(e,o)=>{let l=o?"/sys/position/edit":"/sys/position/add";return k.post({url:l,params:e},{joinParamsToUrl:!0})},Ue=e=>k.delete({url:"/sys/position/delete",params:e},{joinParamsToUrl:!0}),we=e=>k.delete({url:"/sys/position/removePositionUser",params:e},{joinParamsToUrl:!0}),Fe=se({name:"OrganTenantPositionForm",components:{Icon:ve,BasicForm:pe,BasicTable:_e,UserSelectModal:fe},setup(){const e=u(""),o=u(!1),l=u({}),U=u(),h=[{field:"id",label:"id",component:"Input",show:!1},{field:"name",label:"职位名称",component:"Input",required:!0}],[w,{setFieldsValue:d,resetFields:v,validate:r}]=ue({schemas:h,showActionButtonGroup:!1,labelCol:{span:24},wrapperCol:{span:24}}),p=u("设置职业"),F=u([]),g=u(""),P=[{title:"姓名",dataIndex:"realname"},{title:"部门",dataIndex:"orgCodeTxt"},{title:"手机",dataIndex:"phone"},{title:"邮箱",dataIndex:"email"},{title:"工号",dataIndex:"workNo"}],S=u(0),{prefixCls:O,tableContext:B}=me({tableProps:{api:j,columns:P,canResize:!1,showTableSetting:!1,showActionColumn:!1,useSearchForm:!1,immediate:!1,formConfig:{showActionButtonGroup:!1},beforeFetch:t=>(t.positionId=C(g),t)}}),[M,{reload:i},{rowSelection:I,selectedRowKeys:D}]=B,[q,{openModal:E,closeModal:G}]=ge(),T=u(!1);function H(){y()}function J(){o.value=!0,T.value=!1,p.value="设置职业"}function Q(){}function W(t){g.value=t.id,l.value=t,i()}function X(t){p.value="编辑职业",o.value=!0,T.value=!0,setTimeout(()=>{v(),d(t)},300)}function Y(){return f(this,null,function*(){let t={positionId:C(l).id,pageNo:1,pageSize:999},m=yield j(t),b=[];if(m&&m.records){let z=m.records;for(let R=0;R<z.length;R++)b.push(z[R].id)}E(!0,{list:[],excludeUserIdList:b})})}function Z(){return f(this,null,function*(){let t=D.value;t&&t.length>0&&K.confirm({title:"确认移除该成员?",type:"warning",okText:"确认",cancelText:"取消",onOk:()=>f(this,null,function*(){yield we({userIds:t,positionId:C(l).id}),L()})})})}function x(t){return f(this,null,function*(){if(t&&t.length>0){let m=t.map(b=>b.id);yield he({userIds:m,positionId:C(g)},L)}G()})}function L(){(D.value=[])&&i()}function ee(){o.value=!1}function oe(){return f(this,null,function*(){const t=yield r();yield ye(t,C(T)),o.value=!1,y()})}function te(t){return f(this,null,function*(){K.confirm({title:"确认删除职位",type:"warning",content:"删除该职位，对应职位下的成员也会被删除",okText:"确认",cancelText:"取消",onOk:()=>f(this,null,function*(){yield Ue({id:t}),o.value=!1,g.value="",y()})})})}y();function y(){let t="";C(e)&&(t="*"+C(e)+"*"),ke({name:t,pageNo:1,pageSize:100}).then(m=>{m.success&&(F.value=m.result.records)})}return{searchValue:e,onSearchValueChange:H,positionAddClick:J,excelClick:Q,positionModal:o,positionRef:U,registerForm:w,title:p,positionList:F,activeKey:g,listItemClick:W,editPositionClick:X,roleUserNum:S,positionData:l,rowSelection:I,registerTable:M,registerUserModal:q,onSelected:x,addUserClick:Y,removeUser:Z,handleSuccess:L,selectedRowKeys:D,cancelClick:ee,saveClick:oe,deleteClick:te,isUpdate:T,getPositionList:y}}});const Pe=e=>(ie("data-v-9c15a8cf"),e=e(),ne(),e),Ie={class:"tenant-position"},Te={class:"position-left"},be={class:"search-container"},Se={class:"create-position flex-flow"},Be={class:"position-list"},Me={class:"position-list-desc"},De={class:"position-scroll"},Le=["onClick"],Re={class:"item-name"},Ve={class:"item-icon"},Ne={class:"position-right"},$e={class:"position-header"},Oe={class:"position-name"},ze={class:"position-count"},Ae=Pe(()=>s("div",{style:{height:"0"}},null,-1)),Ke={class:"position-btn"};function je(e,o,l,U,h,w){const d=c("Icon"),v=c("a-input"),r=c("a-menu-item"),p=c("a-menu"),F=c("a-dropdown"),g=c("a-tooltip"),P=c("a-button"),S=c("BasicTable"),O=c("BasicForm"),B=c("a-modal"),M=c("user-select-modal");return V(),N(A,null,[s("div",Ie,[s("div",Te,[s("div",be,[n(v,{placeholder:"搜索",bordered:!1,value:e.searchValue,"onUpdate:value":o[0]||(o[0]=i=>e.searchValue=i),onChange:e.onSearchValueChange,"allow-clear":""},{prefix:a(()=>[n(d,{icon:"ant-design:search-outlined"})]),_:1},8,["value","onChange"])]),s("div",Se,[s("span",{class:"create-position-txt pointer",onClick:o[1]||(o[1]=(...i)=>e.positionAddClick&&e.positionAddClick(...i))},[n(d,{icon:"ant-design:plus-outlined",style:{"margin-right":"3px"}}),_(" 创建职位 ")]),n(F,{trigger:["click"]},{overlay:a(()=>[n(p,{onClick:e.excelClick},{default:a(()=>[n(r,{key:"import"},{default:a(()=>[_("导入职位？")]),_:1}),n(r,{key:"export"},{default:a(()=>[_("导出职位？")]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[s("a",{class:"ant-dropdown-link",onClick:o[2]||(o[2]=ae(()=>{},["prevent"]))},[n(d,{icon:"ant-design:more-outlined",class:"position-more"})])]),_:1})]),s("div",Be,[s("div",Me,[s("div",De,[(V(!0),N(A,null,le(e.positionList,i=>(V(),N("div",null,[s("div",{class:re(["list-item",e.activeKey===i.id?"active":""]),onClick:I=>e.listItemClick(i)},[s("span",Re,[n(g,{title:i.name},{default:a(()=>[_($(i.name),1)]),_:2},1032,["title"])]),s("div",Ve,[n(d,{icon:"ant-design:edit-outlined",onClick:I=>e.editPositionClick(i),style:{"margin-right":"10px"}},null,8,["onClick"]),n(d,{icon:"ant-design:delete-outlined",onClick:I=>e.deleteClick(i.id)},null,8,["onClick"])])],10,Le)]))),256))])])])]),ce(s("div",Ne,[s("div",$e,[s("span",Oe,$(e.positionData.name),1),s("span",ze,$(e.roleUserNum!==0?e.roleUserNum:void 0),1)]),n(S,{onRegister:e.registerTable,rowSelection:e.rowSelection},{tableTitle:a(()=>[n(P,{type:"primary",onClick:e.addUserClick},{default:a(()=>[_("添加成员")]),_:1},8,["onClick"]),n(P,{onClick:e.removeUser,disabled:e.selectedRowKeys.length===0},{default:a(()=>[_(" 移出")]),_:1},8,["onClick","disabled"])]),tableTop:a(()=>[Ae]),_:1},8,["onRegister","rowSelection"])],512),[[de,e.activeKey!==""]])]),n(B,{open:e.positionModal,"onUpdate:open":o[5]||(o[5]=i=>e.positionModal=i),title:e.title,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",Ke,[s("span",{class:"cancel-btn pointer",onClick:o[3]||(o[3]=(...i)=>e.cancelClick&&e.cancelClick(...i))},"取消"),s("span",{class:"save-btn pointer",onClick:o[4]||(o[4]=(...i)=>e.saveClick&&e.saveClick(...i))},"保存")])]),default:a(()=>[n(O,{onRegister:e.registerForm,style:{padding:"0 20px"}},null,8,["onRegister"])]),_:1},8,["open","title"]),n(M,{multi:!0,onRegister:e.registerUserModal,onSelected:e.onSelected},null,8,["onRegister","onSelected"])],64)}const Oo=Ce(Fe,[["render",je],["__scopeId","data-v-9c15a8cf"]]);export{Oo as default};
