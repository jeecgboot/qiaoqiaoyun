var g=(t,u,p)=>new Promise((a,i)=>{var c=e=>{try{r(p.next(e))}catch(s){i(s)}},l=e=>{try{r(p.throw(e))}catch(s){i(s)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(c,l);r((p=p.apply(t,u)).next())});import{e as L,d as J,f as O,p as z,n as W,u as j,V as M,v as x,q as Q,a6 as h,af as G,a8 as X,ai as Y,W as Z,k as D,ap as oo,aq as eo,ag as to}from"./vue-vendor-24c7dc61.js";import{a as T,k as ro,r as w,h as po,bG as ao,bH as so,e as no,bI as io,l as mo}from"./index-831af9dd.js";import"./index-1c3affea.js";import{u as lo}from"./index-3c281896.js";import uo from"./LowAppLayout-b1b4d542.js";import co from"./HomeButtons-34035d8b.js";import fo from"./MenuMoveGroupModal-b253e3d4.js";import wo from"./ProcessManageDrawer-60f4c76c.js";import go from"./LowAppLayoutContent-f7018b25.js";import{u as Ao}from"./index-5f7e4a11.js";import{p as Mo,m as yo}from"./low.app.api-97fc250a.js";import{L as m}from"./index-a964241b.js";import{u as Lo}from"./index-44229d9b.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./index-306fe414.js";import"./index-e041eae3.js";import"./index-158ad271.js";import"./SimpleMenu-fbc2f100.js";import"./useOpenKeys-0758de45.js";import"./SubMenuItem-cfcb4516.js";import"./SimpleSubMenu-ff390f8a.js";import"./AppLogo-063b26cf.js";import"./LowAppIcon-e49e90b9.js";import"./index-7a1d97e6.js";import"./useHeaderSetting-7889be2c.js";import"./index-07670f1d.js";import"./LoginSelect-d08d3d93.js";import"./LayoutSider-a82baef0.js";import"./DragBar-74fbe5b4.js";import"./index-70f3c7fe.js";import"./SimpleMenuTag-e41510fe.js";import"./HomeButton-60767a77.js";import"./index-39efa5fe.js";import"./lowAppStore-499fb8f9.js";const{createMessage:S,createConfirm:Po}=T();function Ro(t,u){const[p,a]=Lo();let i=!1;const c=L(()=>({onRegister:p}));u.push(r=>{let{type:e,record:s}=r;return e==="process-manage"?(a.openDrawer(!0,{record:s}),!0):(e==="start-process"&&l(r),!1)});function l({record:r,onSuccess:e}){Po({title:"提交流程",iconType:"info",content:"确认提交流程吗？",onOk(){return g(this,null,function*(){i=(yield Mo.queryFormLinkByTableName(r._record.desformCode))!=null,i?(yield E.desform.startProcess(r),typeof e=="function"&&(yield e())):S.warning("没有设计流程，无法提交")})}})}return{processManageDrawerProps:c,processManageDrawerAction:a}}const E={desform:{flowCodePre:"desform_",startProcess:t=>g(void 0,null,function*(){let{id:u,desformCode:p,bpmStatus:a}=t._record;if(a&&a!="1"){S.warning("流程已发起，不能重复发起");return}let{flowCodePre:i}=E.desform,c="{{DOMAIN_URL}}/desform/detail/"+p+"/${BPM_DES_DATA_ID}?token={{TOKEN}}&taskId={{TASKID}}",l="{{DOMAIN_URL}}/desform/detail/"+p+"/${BPM_DES_DATA_ID}?token={{TOKEN}}&taskId={{TASKID}}",r={id:u,flowCode:i+p,formUrl:c,formUrlMobile:l},e="/act/process/extActProcess/startMutilProcess";yield ro.post({url:e,params:r}),w.push({name:"low-app-@appId-task-my-apply"})})}},_o=J({name:"LowAppAuto",components:{LowAppLayout:uo,LowAppLayoutContent:go,HomeButtons:co,MenuMoveGroupModal:fo,ProcessManageDrawer:wo},setup(){const{prefixCls:t}=po("low-app-auto"),{createJPrompt:u}=lo(),{createMessage:p}=T(),{appId:a,watchRouteId:i,reloadApp:c}=Ao(),l=O(a),{getPageLoading:r}=ao(),{getOpenPageLoading:e}=so(),s=O(!1),y=L(()=>s.value||e.value&&r.value),P=L(()=>w.currentRoute.value.name==="low-app-@appId"),[N,b]=no(),v=new Map,k={pagesMap:v,setLoading:H,addOrEditGroup:U,findSourceData:V,openMoveGroupModal:F};z("lowAppActions",k);const C=[],{processManageDrawerProps:$}=Ro(k,C),B=L(()=>({onActionClick:K}));i(o=>{o&&R(o)});function R(o){return g(this,null,function*(){try{s.value=!0,yield c(o)}finally{s.value=!1}})}function H(o){s.value=o}function U(o){let n=!!o,d=n?"新名称":"分组名称";u({title:n?"重命名":"创建分组",defaultValue:n?o.menuName:"",placeholder:`请输入${d}`,rules:[{required:!0,message:`${d}不能为空！`}],onOk:f=>g(this,null,function*(){yield yo.createOrUpdateGroup({id:o?o.id:null,appId:a.value,menuName:f},n),R(a.value)})})}function F(o){b.openModal(!0,{menu:o})}function V(o){const{type:n,menuUrl:d}=o;let f={};switch(n){case m.DESFORM.type:f.desformCode=d;break;case m.CGFORM.type:case m.DRAG.type:case m.CGREPORT.type:case m.GRAPHREPORT.type:f.id=d;break;default:p.warn("不支持的菜单类型");return}w.push({name:"low-app-@appId-redirect",params:{redirectName:"low-app-@appId-list-"+n,lowAppFilter:JSON.stringify(f)}})}function q(o){o===m.CGFORM.type?(w.push({name:"low-app-@appId-list-cgform"}),A()):o===m.DESFORM.type?(w.push({name:"low-app-@appId-list-desform"}),A("onAddRecord")):o===m.DRAG.type?(w.push({name:"low-app-@appId-list-drag"}),A("onAddRecord")):o===m.CGREPORT.type?(w.push({name:"low-app-@appId-list-cgreport"}),A("handleAdd")):o===m.GRAPHREPORT.type&&(w.push({name:"low-app-@appId-list-graphreport"}),A())}function A(o="onAdd"){return g(this,null,function*(){let n=0;const d=()=>g(this,null,function*(){yield W();let _=null,I=j(v.get("route-view"));return I&&(_=I[o]),typeof _=="function"?_:++n===10?null:(yield io(100),d())});let f=yield d();f&&f()})}function K(o){for(const n of C)if(n(o))break}return{prefixCls:t,getLoading:y,getContentProps:B,isRootRoute:P,refreshApp:R,onOpenLink:q,lowAppId:l,processManageDrawerProps:$,registerMenuMoveGroupModal:N}}});function Do(t,u,p,a,i,c){const l=M("HomeButtons"),r=M("LowAppLayoutContent"),e=M("MenuMoveGroupModal"),s=M("ProcessManageDrawer"),y=M("LowAppLayout"),P=x("loading");return Q((h(),G(y,{class:X([t.prefixCls])},{default:Y(()=>[t.isRootRoute?(h(),G(l,{key:0,onOpenLink:t.onOpenLink},null,8,["onOpenLink"])):Z("",!0),D(r,oo(eo(t.getContentProps)),null,16),D(e,{onRegister:t.registerMenuMoveGroupModal,onSuccess:t.refreshApp},null,8,["onRegister","onSuccess"]),D(s,to(t.processManageDrawerProps,{lowAppId:t.lowAppId}),null,16,["lowAppId"])]),_:1},8,["class"])),[[P,t.getLoading]])}const ze=mo(_o,[["render",Do]]);export{ze as default};
