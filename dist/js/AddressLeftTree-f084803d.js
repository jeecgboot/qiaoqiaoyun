var v=(T,g,i)=>new Promise((d,n)=>{var t=l=>{try{u(i.next(l))}catch(c){n(c)}},r=l=>{try{u(i.throw(l))}catch(c){n(c)}},u=l=>l.done?d(l.value):Promise.resolve(l.value).then(t,r);u((i=i.apply(T,g)).next())});import{d as b,f as o,V as m,a6 as _,af as D,ai as N,k as F,a7 as P,W as H,F as U,u as k,n as x}from"./vue-vendor-24c7dc61.js";import{k as S}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";const M=b({__name:"AddressLeftTree",emits:["select","rootTreeData"],setup(T,{expose:g,emit:i}){const d=o(!1),n=o([]),t=o([]),r=o([]),u=o(!1),l=o(null),c=o(0),K={queryBookDepTreeSync:"/sys/sysDepart/queryBookDepTreeSync"},p=o("");function w(e){return v(this,null,function*(){try{t.value=[],d.value=!0,c.value=e.id;let a={tenantId:k(c),departName:k(p)};const s=yield S.get({url:K.queryBookDepTreeSync,params:a});Array.isArray(s)?n.value=s:n.value=[],t.value.length===0&&C()}finally{d.value=!1}})}function R(e){return v(this,null,function*(){try{let a={pid:e.dataRef.id,tenantId:k(c),departName:k(p)};const s=yield S.get({url:K.queryBookDepTreeSync,params:a});if(s.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=s,t.value.length>0){let f=[];for(let y of t.value)s.findIndex(h=>h.id===y)!==-1&&f.push(y);f.length>0&&(t.value=[...t.value])}n.value=[...n.value]}catch(a){}return Promise.resolve()})}function C(){let e=n.value[0];e&&(e.isLeaf||(t.value=[e.key]),q())}function q(){return v(this,null,function*(){yield x(),u.value=!0,yield x(),u.value=!1})}function B(e,a){r.value=[e],a&&(l.value=a,i("select",a))}function A(e,a){e.length>0&&r.value[0]!==e[0]?B(e[0],a.selectedNodes[0]):B(r.value[0])}function I(){r.value=[]}function L(e){x(()=>{p.value=e.departName,w(e)})}function E(){p.value=""}return g({loadRootTreeData:w,clearSelectedKeys:I,searchDepart:L,clearDepartName:E}),(e,a)=>{const s=m("a-tree"),f=m("a-empty"),y=m("a-spin"),h=m("a-card");return _(),D(h,{bordered:!1,style:{height:"100%"}},{default:N(()=>[F(y,{spinning:d.value},{default:N(()=>[n.value.length>0?(_(),P(U,{key:0},[u.value?H("",!0):(_(),D(s,{key:0,showLine:"",clickRowToExpand:!1,treeData:n.value,selectedKeys:r.value,"load-data":R,expandedKeys:t.value,"onUpdate:expandedKeys":a[0]||(a[0]=V=>t.value=V),onSelect:A},null,8,["treeData","selectedKeys","expandedKeys"]))],64)):(_(),D(f,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"])]),_:1})}}});export{M as default};
