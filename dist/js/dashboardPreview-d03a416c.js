var z=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var V=(a,n,t)=>n in a?z(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,x=(a,n)=>{for(var t in n||(n={}))Z.call(n,t)&&V(a,t,n[t]);if(T)for(var t of T(n))K.call(n,t)&&V(a,t,n[t]);return a},A=(a,n)=>G(a,H(n));var _=(a,n,t)=>new Promise((h,c)=>{var u=l=>{try{d(t.next(l))}catch(o){c(o)}},f=l=>{try{d(t.throw(l))}catch(o){c(o)}},d=l=>l.done?h(l.value):Promise.resolve(l.value).then(u,f);d((t=t.apply(a,n)).next())});import{f as b,d as L,g as Q,a2 as X,as as Y,e as m,u as y,w as ee,V as E,a6 as te,a7 as oe,a5 as ne,k as F}from"./vue-vendor-24c7dc61.js";import{q as le,b as ae}from"./page.api-9d0cf9bc.js";import{N as ue,a7 as de,e as re,b as se,c as ie,aZ as ce,P as fe,l as pe}from"./index-831af9dd.js";import"./index-1c3affea.js";import ge from"./html2canvas-vendor-47cc7ff0.js";import{f as ve}from"./antd-vue-vendor-0d72f01e.js";import{J as we}from"./index.umd.min-e2b28327.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./searchcursor-9651c8d5.js";import"./codemirror-26b29690.js";import"./china-area-data-vendor-556d14ee.js";import"./renderers-81963a7f.js";import"./vuedraggable-vendor-6ef4bc68.js";import"./grid-layout-vendor-83979c40.js";import"./active-line-512fef49.js";function he(){const a=b();function n(c){let u=a.value;if(!u)return;const f={width:u.offsetWidth,height:u.offsetHeight};ge(u,{useCORS:!0,logging:!0}).then(d=>_(this,null,function*(){const l=d.toDataURL("image/png");yield t(l,f,c)}))}function t(c,u,f){return _(this,null,function*(){const d=yield h(c,u),l=document.createElement("a");l.href=d,l.download=`${f}.png`,l.click()})}function h(c,u){return new Promise(f=>{let d=document.createElement("canvas");const l=d.getContext("2d"),o=new Image;o.crossOrigin="Anonymous",o.src=c,o.onload=()=>{d.height=u.height,d.width=u.width,l.drawImage(o,0,0,u.width,u.height);const D=d.toDataURL("image/png");d=null,f(D)}})}return{exportRef:a,onExportImage:n}}const Ie=L({name:"drag-page-view"}),ye=L(A(x({},Ie),{props:{routeInfo:{type:Object,default:()=>{}}},emits:["loadOk"],setup(a,{emit:n}){var O;const t=a;(O=Q())==null||O.appContext.app.use(we);const{setTitle:h}=ue(),c=de(),u=b(""),{currentRoute:f,push:d,resolve:l}=X(),o=b({name:"",coverUrl:"",backgroundColor:"",theme:"default",style:"default",designType:100,backgroundImage:"",componentData:[]});function D(){return _(this,null,function*(){const{params:e,path:i}=y(f);let p=e.id?e.id:i.substr(i.lastIndexOf("/")+1);u.value=p;const r=yield le({id:p});if(r.success){yield h(r.result.name);let k=r.result.template?JSON.parse(r.result.template):[];o.value.componentData=k,o.value.name=r.result.name,o.value.coverUrl=r.result.coverUrl,o.value.backgroundColor=r.result.backgroundColor,o.value.backgroundImage=r.result.backgroundImage,o.value.designType=r.result.designType,o.value.theme=r.result.theme||"default",o.value.style=r.result.style||"default"}})}function M(e,i){e&&e.indexOf("http")>-1?ce(e):d({path:e,query:i})}const[B,{openModal:S}]=re(),I=Y(),C=b({}),$=m(()=>{var e;return(e=I.params)==null?void 0:e.appId}),q=m(()=>{var e;return!!((e=I.params)!=null&&e.appId)}),N=m(()=>y(C));function U(e,i){if(i.openMode==="2"){let p=l(e);window.open(p.href,"_blank")}else d(e)}function J(e){var p,r,k,P;let i=e.operationType;if(i=="1"&&(e!=null&&e.worksheet.value)){let v={mode:"add",desformCode:e.worksheet.value,dataId:null,isOnline:!1,viewId:"",lowAppId:e!=null&&e.appInfo?e.appInfo.value:I.params.appId};if(e!=null&&e.defVal&&(e==null?void 0:e.defVal.length)>0){let g={};e.defVal.forEach(s=>{let w=s.model,R=s.value;g[w]=R,s!=null&&s.type&&s.type==="area-linkage"&&s!=null&&s.value&&fe(s.value)&&s.value.length>0&&(g[w]=R[R.length-1])}),C.value=x({},g)}S(!0,v)}else if(i=="2"&&(e!=null&&e.worksheet.value)){let v=(p=e==null?void 0:e.appInfo)!=null&&p.value?e.appInfo.value:I.params.appId,g=e.worksheet.value,s="desform";((r=e==null?void 0:e.worksheet)==null?void 0:r.type)=="form"&&(g=((k=e==null?void 0:e.worksheet)==null?void 0:k.desformId)||e.worksheet.value,s="form");let w={path:`/myapp/${v}/${s}/${g}`};e.view?w.query={view:e.view,type:"drag"}:w.query={type:"drag"},U(w,e)}else if(i=="3"&&(e!=null&&e.customPage.value)){let v=e!=null&&e.appInfo&&((P=e==null?void 0:e.appInfo)!=null&&P.value)?e.appInfo.value:I.params.appId,g=e.customPage.value,s={path:`/myapp/${v}/drag/${g}`};U(s,e)}else i=="4"||(i=="6"&&e.bizFlow.key?ae({processId:e.bizFlow.key,inputParams:JSON.stringify(e.bizParams),applyUserId:c.getUserInfo.username}).then(v=>{}):ve.error("未绑定业务或表单，请检查配置项！"))}const{exportRef:j,onExportImage:W}=he();return ee(()=>t.routeInfo,e=>{if(e&&e.exportImage){let i=o.value.name;W(i)}},{deep:!0,immediate:!0}),D(),(e,i)=>{const p=E("ViewEngine"),r=E("DesformViewModal");return te(),oe("div",null,[ne("div",{ref_key:"exportRef",ref:j},[F(p,{dragData:o.value,token:y(se)(),tenantId:y(ie)(),lowAppId:$.value,isLowApp:q.value,pageId:u.value,onGo:M,onBtnClick:J},null,8,["dragData","token","tenantId","lowAppId","isLowApp","pageId"])],512),F(r,{onRegister:y(B),showComment:!1,showFiles:!1,showDataLog:!1,defaultFormData:N.value},null,8,["onRegister","defaultFormData"])])}}}));const Be=pe(ye,[["__scopeId","data-v-2ae004ba"]]);export{Be as default};
