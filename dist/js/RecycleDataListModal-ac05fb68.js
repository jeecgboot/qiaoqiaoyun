var ke=Object.defineProperty,Ae=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var V=(e,a,n)=>a in e?ke(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,T=(e,a)=>{for(var n in a||(a={}))De.call(a,n)&&V(e,n,a[n]);if(q)for(var n of q(a))xe.call(a,n)&&V(e,n,a[n]);return e},N=(e,a)=>Ae(e,Se(a));var w=(e,a,n)=>new Promise((C,k)=>{var A=d=>{try{r(n.next(d))}catch(_){k(_)}},f=d=>{try{r(n.throw(d))}catch(_){k(_)}},r=d=>d.done?C(d.value):Promise.resolve(d.value).then(A,f);r((n=n.apply(e,a)).next())});import{d as Be,f as m,as as Fe,r as Te,w as Re,e as Ie,I as Me,a3 as Ee,a4 as Le,a5 as l,V as h,a6 as b,af as W,ai as c,ak as U,E as Y,W as R,a8 as Oe,ae as J,k as u,a7 as I}from"./vue-vendor-24c7dc61.js";import{B as Pe}from"./index-1c3affea.js";import"./index-621e597c.js";import{u as $e}from"./useListPage-62a041ef.js";import{p as Ne}from"./auto.desform.api-839115ed.js";import{a as We}from"./LinkRecordSelect-385d0eae.js";import He from"./TableImage-14ca1f5d.js";import je from"./SubTableTag-81763fd6.js";import{a7 as ze,j as Ke,D as qe,a as Ve,ap as Ue,k as M,l as Ye}from"./index-831af9dd.js";import{d as Je}from"./renderUtils-7ad8f436.js";import{n as Qe,i as Ge}from"./antd-vue-vendor-0d72f01e.js";import{u as Xe}from"./lowAppAuth-3d637b7d.js";import Ze from"./BasicTable-d435f501.js";import{T as et}from"./componentMap-c857637c.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./useMethods-f689b480.js";import"./SelectItem-04dd2229.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./CardCellFile-92b3c8c8.js";import"./index-b845562c.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./useFormItem-86503382.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./JPopup-2a779923.js";import"./EasyCronInput-b2123242.js";import"./JCheckbox-0b89d32a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JEditor-249b2194.js";import"./JImageUpload-d644253a.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";const tt=[{name:"创建时间",field:"create_time",type:"datetime",seq:100},{name:"创建人",field:"create_by",type:"select-user",seq:101},{name:"删除时间",field:"delete_time",type:"datetime",seq:102},{name:"删除人",field:"delete_by",type:"select-user",seq:103}],ot=Be({name:"RecycleDataListModal",components:{BasicModal:Pe,BasicTable:Ze,TableAction:et,TableImage:He,SubTableTag:je,SearchOutlined:Qe},emits:["success","register"],setup(e,{emit:a}){const n=m(0);n.value=window.innerHeight-300;const C=Xe(),k=ze(),{createWarningModal:A}=Ve(),f=m(!1),r=m(""),d=m({}),_=m(""),E=Fe(),x=m({}),L=m({}),O=m({}),P=m(""),B=m("");let s={buttonsAuth:O,desformCode:P,desformName:B,translData:x,remoteOptionsMap:L};const v=Te({notDesignForm:!1}),Q=m(!1),G=$e({designScope:"recycle-data-list-modal",tableProps:{immediate:!1,api:ie,useSearchForm:!1,showActionColumn:!0,actionColumn:{title:"操作",fixed:"right"},showIndexColumn:!0,indexColumnProps:{title:"#",fixed:"left",width:50},rowSelection:{columnWidth:50},showTableSetting:!1,tableSetting:{setting:!1},beforeFetch(t){t.del_flag=1}}}),{prefixCls:X,tableContext:Z,createMessage:$}=G,[ee,p,{rowSelection:te,selectedRowKeys:H}]=Z,{allColumns:j,loadColumnsInfo:oe,linkRecordDataMap:ae}=We(s,{loadData:ce,openLinkRecord:ue,tableAction:p},v);Re(j,()=>{se()},{deep:!0,immediate:!0});function ne(t){let o=t,g={key:o.field,title:o.name,align:"center",sorter:!0,width:150,dataIndex:o.field};return g.key.indexOf("time")>=0?g.customRender=({text:i})=>i?Ge(i).format("YYYY-MM-DD HH:mm:ss"):"":g.customRender=({text:i,record:y})=>i?y[g.dataIndex+"_dictText"]:"",g}function se(){let t=j.value;if(t&&t.length>0){let o=[];for(let y of t)o.push(T({},y));for(let y of tt){let S=ne(y);o.push(S)}let g=window.innerWidth*.8-100,i=0;for(let y of o)i+=y.width;i>g&&p.setProps({scroll:{x:1e3}}),p.setColumns(o)}}function ie(t){return w(this,null,function*(){ae.value={};const o=N(T({},t),{desformCode:r.value,superQuery:JSON.stringify(d.value),listViewId:"",global_keyword:_.value,appId:E.params.appId});C.getLowAppAdminAuth()===!0||(o.delete_by=k.getUserInfo.username);let i=yield Ne.list(o),y=[];return i.result.records.forEach(S=>{let Ce=N(T({},JSON.parse(S.desformDataJson)),{id:S.id,_record:S});y.push(Ce)}),i.result.translData&&(x.value=i.result.translData),i.message!=="查询成功"&&$.warn(i.message),i.result.records=y,i.result})}const[le,{closeModal:re}]=Ke(t=>w(this,null,function*(){let o=C.getLowAppAdminAuth();f.value=o,r.value=t.code,yield oe(t.code)}));function ce(){p.reload()}function ue(){}function z(t){Q.value=!0,p.setLoading(t)}function de(t){z(!0);let o=0;for(let g of t){let i=Ue(g.url);o++;try{Je(i)}finally{--o===0&&z(!1)}}}const pe={},me=Ie(()=>window.innerWidth*.8);function K(){let t=H.value;return t&&t.length>0?Me(t).join(","):""}function fe(){return w(this,null,function*(){const t=`/desform/data/${r.value}/restoreData`;let o=K();if(!o){$.warning("未选中数据");return}yield M.get({url:t,params:{ids:o}}),yield p.reload(),F(),a("success")})}function ge(){A({title:"彻底删除记录",content:"记录删除后无法恢复，请确认您和工作表成员都不再需要这些记录再行删除。",okCancel:!0,okText:"删除",cancelText:"取消",onOk:()=>{ye()}})}function ye(){return w(this,null,function*(){const t=`/desform/data/${r.value}/deleteBatchFromDb`;let o=K();if(!o){$.warning("未选中数据");return}yield M.delete({url:t,params:{ids:o}},{joinParamsToUrl:!0}),yield p.reload(),F()})}function he(){A({title:"是否清空回收站",content:"记录删除后无法恢复，请确认您和工作表成员都不再需要这些记录再行删除",okCancel:!0,okText:"确认",cancelText:"取消",onOk:()=>{_e()}})}function _e(){return w(this,null,function*(){const t=`/desform/data/${r.value}/clearRecycle`;yield M.delete({url:t}),yield p.reload(),F()})}function F(){p.clearSelectedRowKeys()}function we(){p.reload()}function be(t){return[{label:"恢复",onClick:()=>ve(t.id)}]}function ve(t){return w(this,null,function*(){const o=`/desform/data/${r.value}/restoreData`;yield M.get({url:o,params:{ids:t}}),yield p.reload(),a("success")})}return{downloadRowFile:de,deleteData:ge,getTableAction:be,restoreData:fe,clearRecycle:he,prefixCls:X,bodyHeight:n,registerModal:le,closeModal:re,registerTable:ee,rowSelection:te,tableStyle:pe,desformName:B,modalWidth:me,selectedRowKeys:H,keyword:_,clearSelect:F,hasAdminAuth:f,onSearchByKeyword:qe(we,500)}}});const D=e=>(Ee("data-v-5a72437c"),e=e(),Le(),e),at={style:{"font-size":"17px","font-weight":"500","margin-left":"5px"}},nt=D(()=>l("span",{style:{"margin-left":"6px",color:"rgb(158, 158, 158)","font-size":"13px"}}," 记录60天后将被自动删除 ",-1)),st={style:{"margin-left":"6px","font-size":"14px"}},it={class:"ant-alert-info",style:{display:"flex","align-items":"center",padding:"3px 20px",height:"40px"}},lt={style:{"margin-right":"5px"}},rt={key:0,style:{display:"flex","align-items":"center"}},ct={style:{"margin-left":"10px"}},ut=D(()=>l("span",{style:{"margin-left":"4px"}},"恢复",-1)),dt={style:{"margin-left":"10px"}},pt=D(()=>l("span",{style:{"margin-left":"4px"}},"彻底删除",-1)),mt={style:{"margin-left":"10px"}},ft=D(()=>l("span",{style:{"margin-left":"4px"}},"取消选中",-1)),gt={key:1},yt=D(()=>l("div",{style:{flex:"1"}},null,-1)),ht={key:0,class:"j-table-slot-view"},_t={key:0,class:"j-table-slot-view"};function wt(e,a,n,C,k,A){const f=h("a-button"),r=h("Icon"),d=h("SearchOutlined"),_=h("a-input"),E=h("sub-table-tag"),x=h("TableImage"),L=h("a-tooltip"),O=h("TableAction"),P=h("BasicTable"),B=h("BasicModal");return b(),W(B,{minHeight:100,bodyStyle:{height:e.bodyHeight+"px"},onRegister:e.registerModal,width:e.modalWidth,destroyOnClose:"",canFullscreen:""},{title:c(()=>[l("div",null,[l("span",at," 回收站（"+U(e.desformName)+"） ",1),nt,l("span",st,[e.hasAdminAuth?(b(),W(f,{key:0,type:"text",onClick:e.clearRecycle},{default:c(()=>[Y("立即清空")]),_:1},8,["onClick"])):R("",!0)])])]),default:c(()=>[l("div",{class:Oe([e.prefixCls,"p-2"]),style:J(e.tableStyle)},[l("div",it,[l("div",lt,[u(r,{icon:"ant-design:info-circle-outlined",class:"ant-alert-icon",size:16})]),e.selectedRowKeys.length>0?(b(),I("div",rt,[l("div",null," 已选择 "+U(e.selectedRowKeys.length)+" 条记录 ",1),l("div",ct,[u(f,{type:"text",style:{padding:"0 10px"},onClick:e.restoreData},{default:c(()=>[u(r,{icon:"ant-design:rollback-outlined"}),ut]),_:1},8,["onClick"])]),l("div",dt,[u(f,{type:"text",style:{padding:"0 10px"},onClick:e.deleteData},{default:c(()=>[u(r,{icon:"ant-design:delete-outlined"}),pt]),_:1},8,["onClick"])]),l("div",mt,[u(f,{type:"text",style:{padding:"0 10px"},onClick:e.clearSelect},{default:c(()=>[u(r,{icon:"ant-design:close-square-outlined"}),ft]),_:1},8,["onClick"])])])):(b(),I("div",gt," 未选中任何数据 ")),yt,l("div",null,[u(_,{placeholder:"请输入关键字搜索",class:"my-input",value:e.keyword,"onUpdate:value":a[0]||(a[0]=s=>e.keyword=s),onChange:e.onSearchByKeyword},{prefix:c(()=>[u(d,{style:{color:"#c0c0c0"}})]),_:1},8,["value","onChange"])])]),u(P,{onRegister:e.registerTable,rowSelection:e.rowSelection},{"view-sub-table":c(({text:s})=>[u(E,{text:s},null,8,["text"])]),"view-picture":c(({text:s})=>[Array.isArray(s)&&s.length>0?(b(),I("div",ht,[u(x,{text:s},null,8,["text"])])):R("",!0)]),"view-file":c(({text:s})=>[Array.isArray(s)&&s.length>0?(b(),I("div",_t,[u(f,{type:"primary",preIcon:"ant-design:download",size:"small",ghost:"",onClick:v=>e.downloadRowFile(s)},{default:c(()=>[Y("下载")]),_:2},1032,["onClick"])])):R("",!0)]),"view-color":c(({text:s})=>[s?(b(),W(L,{key:0,placement:"top",title:s,getPopupContainer:v=>v==null?void 0:v.parentNode},{default:c(()=>[l("div",{class:"j-table-slot-view-color",style:J({backgroundColor:s})},null,4)]),_:2},1032,["title","getPopupContainer"])):R("",!0)]),action:c(({record:s})=>[u(O,{actions:e.getTableAction(s)},null,8,["actions"])]),_:1},8,["onRegister","rowSelection"])],6)]),_:1},8,["bodyStyle","onRegister","width"])}const Ro=Ye(ot,[["render",wt],["__scopeId","data-v-5a72437c"]]);export{Ro as default,tt as systemFields};
