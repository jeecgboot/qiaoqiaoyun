var E=Object.defineProperty;var B=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var D=(t,l,n)=>l in t?E(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,T=(t,l)=>{for(var n in l||(l={}))K.call(l,n)&&D(t,n,l[n]);if(B)for(var n of B(l))z.call(l,n)&&D(t,n,l[n]);return t};var R=(t,l,n)=>new Promise((g,a)=>{var c=r=>{try{u(n.next(r))}catch(d){a(d)}},h=r=>{try{u(n.throw(r))}catch(d){a(d)}},u=r=>r.done?g(r.value):Promise.resolve(r.value).then(c,h);u((n=n.apply(t,l)).next())});import{d as W,f as C,e as j,w as q,l as G,a3 as H,a4 as J,a5 as p,V as f,a6 as I,a7 as A,F as M,k as m,ai as v,am as Q,a8 as X,ak as Y,af as Z,W as ee}from"./vue-vendor-24c7dc61.js";import{e as oe,a as te,l as ne}from"./index-831af9dd.js";import le from"./RoleInfo-988ef559.js";import{g as ae,d as ie}from"./application.api-4e2bde90.js";import re from"./RoleCopyConfirm-c60c69d7.js";import"./index-1c3affea.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicTable-d435f501.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./application.data-33c48cb5.js";import"./useRoleAuth-039fb12a.js";import"./ViewCurdAuthTable-7d5707fb.js";import"./useListPage-62a041ef.js";import"./index-621e597c.js";import"./RoleAuthDrawer-e478a562.js";import"./index-44229d9b.js";import"./RoleCheckBox-ff98d496.js";import"./FormAuthDrawer-ec07a39e.js";import"./AuthRecord-c2685ecc.js";import"./AuthOperation-f0820b93.js";import"./AuthField-ed45cd67.js";import"./ComponentIcon-f1bbb90f.js";const se=W({name:"RoleAuthPage",components:{RoleInfo:le,RoleCopyConfirm:re},props:{appId:{type:String,default:""}},emits:["tab-change"],setup(t,{emit:l}){const{createMessage:n,createInfoModal:g}=te(),a=C([]),c=C(""),h=C(""),u=C(),r=C(""),d=j(()=>{let e=a.value,o=h.value;return o?!e||e.length==0?[]:e.filter(s=>s.name.indexOf(o)>=0):e});function S(){if(c.value==="-1"){n.warning("请保存当前新增角色");return}let o={id:"-1",name:"新角色",orderNum:b()};a.value.push(o),c.value=o.id,u.value.show(o)}function b(){let e=0;for(let o of a.value)o.orderNum>e&&(e=o.orderNum);return e+1}function y(e){let s=a.value.filter(_=>_.id!="-1");a.value=s||[],s&&s.length>0&&(e&&e.id!="-1"?(c.value=e.id,i(e)):(c.value=s[0].id,i(s[0])))}function N(){u.value.createRole()}function i(e){if(c.value=="-1"){g({title:"创建当前新增角色?",okCancel:!0,okText:"创建",cancelText:"不创建",onCancel:()=>y(e),onOk:N});return}c.value=e.id,u.value&&u.value.show(T({},e))}const[k,{openModal:V}]=oe();function O(e,o){e.key=="copy"?V(!0,{id:o.id,roleName:o.name}):g({title:x,width:480,okText:"确认",cancelText:"取消",okCancel:!0,icon:" ",okButtonProps:{danger:!0},onOk:function(){$(o.id)},onCancel:function(){}})}function x(){return G("span",{style:{color:"#f44336"}},"你确认删除此角色吗?")}function $(e){return R(this,null,function*(){yield ie(e),yield w();let o=a.value;o&&o.length>0&&i(o[0])})}q(()=>t.appId,e=>R(this,null,function*(){if(e){yield w();let o=a.value;if(o&&o.length>0){if(r.value){let s=o.filter(_=>_.id==r.value);i(s[0])}else i(o[0]);r.value=""}}}),{immediate:!0});function w(){return R(this,null,function*(){const e={appId:t.appId,column:"orderNum",order:"asc"},o=yield ae(e);a.value=o||[]})}function P(e){return R(this,null,function*(){yield w(),c.value="";let o=a.value;if(o&&o.length>0){let s=o.filter(_=>_.id==e);i(s[0])}})}function F(e){r.value=e;let o=a.value;if(o&&o.length>0){let s=o.filter(_=>_.id==e);c.value=s[0].id,u.value.show(T({},s[0]))}}function U(){let e=c.value;e!="-1"&&l("tab-change",e)}return{onCreateRole:S,roleList:a,showRoleList:d,activeLiKey:c,searchRoleValue:h,onSelectRole:i,roleInfoRef:u,onRoleAction:O,initRoleList:w,onSaveSuccess:P,cancelCreateRole:y,onSelectRoleById:F,registerModal:k,goRoleUserTab:U}}});const L=t=>(H("data-v-c4fba79a"),t=t(),J(),t),ce={class:"flex-flow",style:{height:"100%"}},ue={class:"role-left flex-column"},pe={class:"create-role"},me=L(()=>p("span",{style:{"margin-left":"0 !important"}},"创建角色",-1)),de={class:"search-role"},fe={class:"role-list flex-flow"},_e=["onClick"],ve={class:"flex-flow flex ellipsis break-all vertical-middle"},he=L(()=>p("span",{class:"edit-role"},"复制角色",-1)),ge=L(()=>p("span",{class:"delete-role"},"删除",-1));function Re(t,l,n,g,a,c){const h=f("a-button"),u=f("Icon"),r=f("a-input"),d=f("a-menu-item"),S=f("a-menu"),b=f("a-dropdown"),y=f("role-info"),N=f("RoleCopyConfirm");return I(),A(M,null,[p("div",ce,[p("div",ue,[p("div",pe,[m(h,{preIcon:"ant-design:plus-outlined",class:"add-role-btn",onClick:t.onCreateRole},{default:v(()=>[me]),_:1},8,["onClick"])]),p("div",de,[m(r,{value:t.searchRoleValue,"onUpdate:value":l[0]||(l[0]=i=>t.searchRoleValue=i),placeholder:"搜索角色",allowClear:"",style:{border:"none"}},{prefix:v(()=>[m(u,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value"])]),p("div",fe,[p("ul",null,[(I(!0),A(M,null,Q(t.showRoleList,i=>(I(),A("li",{class:X(["flex-flow content-li",t.activeLiKey===i.id?"li-active":""]),style:{position:"relative"},onClick:k=>t.onSelectRole(i)},[p("span",ve,Y(i.name),1),m(b,{trigger:["click"]},{overlay:v(()=>[m(S,{onClick:k=>t.onRoleAction(k,i)},{default:v(()=>[m(d,{key:"copy",class:"menu-item-content"},{default:v(()=>[he]),_:1}),m(d,{key:"delete",class:"menu-item-content"},{default:v(()=>[ge]),_:1})]),_:2},1032,["onClick"])]),default:v(()=>[i.code!="admin"?(I(),Z(u,{key:0,class:"content-icon",icon:"ant-design:more-outlined",style:{display:"none"}})):ee("",!0)]),_:2},1024)],10,_e))),256))])])]),m(y,{ref:"roleInfoRef",appId:t.appId,onOk:t.onSaveSuccess,onCancel:t.cancelCreateRole,onTabChange:t.goRoleUserTab},null,8,["appId","onOk","onCancel","onTabChange"])]),m(N,{onRegister:t.registerModal,onSuccess:t.onSaveSuccess},null,8,["onRegister","onSuccess"])],64)}const Ao=ne(se,[["render",Re],["__scopeId","data-v-c4fba79a"]]);export{Ao as default};
