var Te=Object.defineProperty,Le=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var Z=(e,a,p)=>a in e?Te(e,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):e[a]=p,W=(e,a)=>{for(var p in a||(a={}))ze.call(a,p)&&Z(e,p,a[p]);if(X)for(var p of X(a))Ae.call(a,p)&&Z(e,p,a[p]);return e},ee=(e,a)=>Le(e,Ie(a));var T=(e,a,p)=>new Promise((E,L)=>{var j=v=>{try{C(p.next(v))}catch(k){L(k)}},y=v=>{try{C(p.throw(v))}catch(k){L(k)}},C=v=>v.done?E(v.value):Promise.resolve(v.value).then(j,y);C((p=p.apply(e,a)).next())});import{a2 as le,f as g,d as Ee,r as Me,e as te,u as c,o as Oe,H as je,a3 as Be,a4 as De,a5 as t,V as h,a6 as r,af as U,a8 as se,ai as i,k as n,ae as oe,ak as _,a7 as d,E as q,F as z,am as A,W as G}from"./vue-vendor-24c7dc61.js";import{R as Fe,h as Ve,e as Ne,a7 as Se,cs as Ue,a as qe,c as ae,L as Pe,a5 as Re,l as He}from"./index-831af9dd.js";import{bi as $e,c9 as Ye,ca as xe,i as Qe}from"./antd-vue-vendor-0d72f01e.js";import{s as We,c as ne,e as Ge,f as Je,b as Ke,h as Xe,i as Ze}from"./market.api-af34a608.js";import et from"./InstallConfirmModal-79258a44.js";import"./index-1c3affea.js";import{f as tt}from"./low.app.api-97fc250a.js";import{a as st}from"./VipPay.api-469f07f9.js";import ot from"./TemplateComment-728614ef.js";import{s as at}from"./depart.api-339f4da6.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./lowAppAuth-3d637b7d.js";import"./lowAppUtils-56892d30.js";function nt(){const e=le(),a=g(!1);function p(){st().then(L=>{L.success?a.value=L.result.izVip:a.value=!1})}function E(){e.push("/myapps/pay")}return{izVip:a,verifyVip:p,goUpgrade:E}}const lt=Ee({name:"TemplateDetail",components:{AComment:$e,TemplateComment:ot,InstallConfirmModal:et,Icon:Fe,LeftCircleOutlined:Ye,RightCircleOutlined:xe},setup(){const{prefixCls:e}=Ve("low-myapps-layout"),a=le(),{izVip:p,verifyVip:E,goUpgrade:L}=nt(),j=g(!1),y=g(!1),C=g(!0),v=g([]),k=g([]),B=g([]),{createMessage:I}=qe(),[P,{openModal:V}]=Ne(),{userInfo:w,setUserInfo:R,setTenant:N}=Se(),D=g(!1),F=g([]),m=g({}),M=g({}),o=g([]),f=Me({iconType:"ant-design:appstore-filled",iconColor:"#2196f3",originalTenantId:null}),J=g(!0),O=g({current:1,pageSize:20,total:0}),S=g(!1),ie=te(()=>c(m).rotationPics?c(m).rotationPics.split(","):[]),re=te(()=>c(m).tag?c(m).tag.split(","):[]);function ue(){c(p)||c(C)?V(!0,{name:c(m).title}):j.value=!0}function ce(s){return T(this,null,function*(){let u={originalTenantId:f.originalTenantId,tenantId:s!=null&&s.tenantId?s.tenantId:ae(),id:c(m).bindLowAppId};D.value=!0;const l=yield tt.copy(u);D.value=!1,l?(I.success("安装成功！"),yield pe(),yield de(u.tenantId,l)):I.error("安装失败！")})}function de(s,u){return T(this,null,function*(){let l=ae();if(s!=l){const Q=yield at({loginTenantId:s});if(Q.userInfo){const we=Q.userInfo;R(we),N(s),a.push(`/myapp/${u}`)}}else setTimeout(()=>{a.push(`/myapp/${u}`)},500)})}function pe(){return T(this,null,function*(){c(m).downloadNum+=1;const s=yield We(W({},c(m)),!0)})}function H(){return w.realname?w.realname.length>3?w.realname.substr(0,3):w.realname:""}function $(){return w.avatar}function me(){return T(this,null,function*(){let s={id:c(M).id,templateId:c(m).id,izLike:c(S)?0:1,avatar:$(),realname:H()};(yield ne(s)).success&&I.success(c(S)?"取消点赞":"已点赞!"),Y(c(m).id)})}function fe(){a.push("/myapps/market")}function ye(){Ge({id:c(m).bindLowAppId}).then(s=>{if(s.success){let u=s.result.filter(l=>l==null?void 0:l.appName);v.value=s.result.filter(l=>((l==null?void 0:l.type)||(l==null?void 0:l.TYPE))&&(["desform","form"].includes(l.type)||["desform","form"].includes(l.TYPE))),k.value=s.result.filter(l=>(l==null?void 0:l.type)&&l.type==="drag"),u.length>0&&(f.iconType=u[0].iconType,f.iconColor=u[0].iconBackColor,f.originalTenantId=u[0].tenantId)}})}function _e(){Je({pageNo:1,pageSize:20,lowAppId:c(m).bindLowAppId}).then(s=>{var u;s.success&&(B.value=((u=s==null?void 0:s.result)==null?void 0:u.records)||[])})}function Y(s,u=!0){Ke({id:s}).then(l=>{l.id&&(m.value=l,be(),K(1),u&&(ye(),_e()))})}function K(s){return T(this,null,function*(){s===1&&(O.value.current=1);let u=he(),l=yield Xe(u);l.records&&(o.value=s===1?l.records:o.value.concat(l.records),O.value.total=l.total,(o.value.length==l.total||l.records.length<O.value.pageSize)&&(J.value=!1))})}function ge(){O.value.current+=1,K()}function he(){let s={delFlag:0,templateId:c(m).id,pageNo:O.value.current,pageSize:O.value.pageSize,column:"createTime",order:"desc"};return Pe(s)}const x=g(!1);function ve(s,u){return T(this,null,function*(){let l={id:c(M).id,templateId:c(m).id,commentContent:s,rate:u,avatar:$(),realname:H()};(yield ne(l)).success&&(I.success("评论成功"),Y(c(m).id,!1),x.value=!1,setTimeout(()=>{x.value=!0},100))})}function be(){return T(this,null,function*(){var u;let s=yield Ze({templateId:c(m).id,createBy:w.username,delFlag:0});s.success&&(M.value=s==null?void 0:s.result,S.value=!!((u=s==null?void 0:s.result)!=null&&u.izLike))})}function Ce(){return T(this,null,function*(){F.value=yield Re("template_tag")})}function ke(s){return c(F).filter(u=>u.value===s)[0].text}return Oe(()=>{const{query:s}=c(a.currentRoute);E(),Ce(),Y(s.id)}),ee(W({lowAppLayout:e,goHomeClick:fe,templateObj:m,carouselList:ie},je(f)),{doCopyApp:ce,registerModal:P,showModal:ue,likeClick:me,izLike:S,selectTagsList:re,getTagLabel:ke,spinning:D,visible:j,goUpgrade:L,tableList:v,pageList:k,processList:B,getMyname:H,getMyAvatar:$,sendComment:ve,focusStatus:x,videoVisible:y,commentObj:M,commentList:o,nextPage:ge,dayjs:Qe,showMoreBtn:J})},methods:{getRandomColor:Ue}});const b=e=>(Be("data-v-332e33ee"),e=e(),De(),e),it={style:{width:"100%",display:"flex","align-items":"center"}},rt=b(()=>t("div",{class:"home_title"},[t("span",{style:{"font-size":"16px","font-weight":"normal"}}," 模版详情 ")],-1)),ut={class:"tempalate-container"},ct={class:"left_div"},dt={class:"title"},pt={class:"logo"},mt={style:{"margin-left":"10px"}},ft={class:"text"},yt={class:"text"},_t={key:0,class:"flexCenter",style:{"justify-content":"flex-start","padding-top":"5px"}},gt={key:1,style:{"font-size":"14px"}},ht={class:"btn_area"},vt={class:"title_desc"},bt={class:"template_desc"},Ct=b(()=>t("div",{class:"title"},"模版介绍",-1)),kt={class:"intro"},wt=["innerHTML"],Tt={class:"app-info"},Lt=b(()=>t("div",{class:"title",style:{"margin-bottom":"20px"}},"应用详情",-1)),It={class:"flexAlignCenter"},zt=b(()=>t("span",{style:{"margin-left":"10px"}},"工作表",-1)),At={style:{"margin-left":"5%","min-height":"20px",overflow:"auto"}},Et={style:{color:"#9d9c9c"}},Mt={style:{"margin-left":"5px","font-size":"14px"}},Ot={class:"flexAlignCenter"},jt=b(()=>t("span",{style:{"margin-left":"10px"}},"自定义页面",-1)),Bt={style:{"margin-left":"5%","min-height":"150px",overflow:"auto"}},Dt={style:{color:"#9d9c9c"}},Ft={style:{"margin-left":"5px","font-size":"14px"}},Vt={class:"flexAlignCenter"},Nt=b(()=>t("span",{style:{"margin-left":"10px"}},"工作流",-1)),St={style:{"margin-left":"5%","min-height":"150px",overflow:"auto"}},Ut={style:{color:"#9d9c9c"}},qt={style:{"margin-left":"5px","font-size":"14px"}},Pt={key:0,class:"carousel"},Rt={class:"title"},Ht={class:"subTitle"},$t={class:"imgs"},Yt=["src"],xt={class:"title",style:{"padding-top":"50px","margin-bottom":"20px"}},Qt={class:"comment-container"},Wt={key:0,class:"more-btn"},Gt={class:"right_div"},Jt={class:"header"},Kt={style:{"border-radius":"100%"}},Xt=["src"],Zt={class:"title",style:{"margin-left":"10px"}},es={style:{"margin-top":"10px"}},ts=b(()=>t("span",{class:"label"},"更新时间:",-1)),ss={class:"value"},os={style:{"margin-top":"5px"}},as=b(()=>t("span",{class:"label"},"安装量:",-1)),ns={class:"value"},ls={style:{"margin-top":"5px"}},is=b(()=>t("span",{class:"label"},"点赞量:",-1)),rs={class:"value"},us={class:"tag"},cs=b(()=>t("div",{class:"label"},"标签:",-1)),ds={key:0,class:"classification"},ps={class:"title"},ms={style:{width:"100%",padding:"24px",display:"flex","align-items":"center"}},fs=b(()=>t("span",{style:{"margin-left":"10px"}},"当前仅限会员安装应用，是否升级成会员?",-1)),ys={key:0,autoplay:"",loop:"",muted:"",playsinline:"",class:"product-video"},_s=["src"],gs={key:1,style:{width:"100%",padding:"24px"}},hs=["src"],vs={key:2,style:{width:"100%",padding:"24px",display:"flex","align-items":"center"}},bs=b(()=>t("span",{style:{"margin-left":"10px"}},"未配置应用介绍",-1));function Cs(e,a,p,E,L,j){const y=h("Icon"),C=h("a-tooltip"),v=h("a-layout-header"),k=h("a-rate"),B=h("a-button"),I=h("a-collapse-panel"),P=h("a-collapse"),V=h("a-carousel"),w=h("a-avatar"),R=h("template-comment"),N=h("a-comment"),D=h("a-spin"),F=h("a-modal"),m=h("InstallConfirmModal"),M=h("a-layout");return r(),U(M,{class:se(e.lowAppLayout),style:{height:"100%","background-color":"#ffffff"},theme:"light"},{default:i(()=>[n(v,{class:"app-index-header",theme:"light",style:{padding:"0 0 0 16px",background:"#ffffff"}},{default:i(()=>[t("div",it,[n(C,{title:"模版市场"},{default:i(()=>[t("div",{class:"home_icon",onClick:a[0]||(a[0]=(...o)=>e.goHomeClick&&e.goHomeClick(...o))},[n(y,{icon:"ant-design:left-outlined"})])]),_:1}),rt])]),_:1}),n(D,{tip:"安装中...",spinning:e.spinning},{default:i(()=>[t("div",ut,[t("div",ct,[t("div",dt,[t("div",pt,[n(y,{icon:e.iconType,style:oe([{color:"rgb(255, 255, 255)","border-radius":"5px",padding:"5px"},{backgroundColor:e.iconColor}]),size:"48"},null,8,["icon","style"]),t("div",mt,[t("div",ft,_(e.templateObj.title),1),t("div",yt,[e.templateObj.rate?(r(),d("p",_t,[n(k,{value:e.templateObj.rate,"onUpdate:value":a[1]||(a[1]=o=>e.templateObj.rate=o),disabled:""},null,8,["value"])])):(r(),d("p",gt,"暂无评分"))])])]),t("div",ht,[n(B,{style:{"margin-left":"5px"},type:"primary",onClick:e.showModal},{default:i(()=>[q("安装")]),_:1},8,["onClick"]),n(C,{title:"预览"},{default:i(()=>[t("div",{class:"small_icon",onClick:a[2]||(a[2]=o=>e.videoVisible=!0)},[n(y,{icon:"ant-design:eye-outlined"})])]),_:1}),n(C,{title:"点赞"},{default:i(()=>[t("div",{class:se(["small_icon",{active:e.izLike}]),onClick:a[3]||(a[3]=(...o)=>e.likeClick&&e.likeClick(...o))},[n(y,{icon:"ant-design:like-outlined",color:e.izLike?"#56befa":"black"},null,8,["color"])],2)]),_:1})])]),t("div",vt,[t("span",null,_(e.templateObj.subTitle),1)]),t("div",bt,[Ct,t("div",kt,[t("div",{innerHTML:e.templateObj.introduce},null,8,wt)]),t("div",Tt,[Lt,n(P,{accordion:"",expandIconPosition:"right",ghost:""},{default:i(()=>[n(I,{key:"1",style:{"border-bottom":"1px solid rgba(196, 192, 192, 0.5)"}},{header:i(()=>[t("p",It,[n(y,{icon:"ant-design:table-outlined",color:e.iconColor,size:"24"},null,8,["color"]),zt])]),default:i(()=>[t("ul",At,[(r(!0),d(z,null,A(e.tableList,(o,f)=>(r(),d("li",{style:{width:"30%"},class:"simplify-text",key:f},[t("span",Et,[n(y,{icon:o.iconType?o.iconType:"ant-design:table-outlined",size:"16"},null,8,["icon"]),t("span",Mt,_(o.menuName),1)])]))),128))])]),_:1}),n(I,{key:"2",style:{"border-bottom":"1px solid rgba(196, 192, 192, 0.5)"}},{header:i(()=>[t("p",Ot,[n(y,{icon:"ant-design:gateway-outlined",color:e.iconColor,size:"24"},null,8,["color"]),jt])]),default:i(()=>[t("ul",Bt,[(r(!0),d(z,null,A(e.pageList,(o,f)=>(r(),d("li",{style:{width:"30%"},class:"simplify-text",key:f},[t("span",Dt,[n(y,{icon:o.iconType?o.iconType:"ant-design:gateway-outlined",size:"16"},null,8,["icon"]),t("span",Ft,_(o.menuName),1)])]))),128))])]),_:1}),n(I,{key:"3",style:{"border-bottom":"1px solid rgba(196, 192, 192, 0.5)"}},{header:i(()=>[t("p",Vt,[n(y,{icon:"ant-design:partition-outlined",color:e.iconColor,size:"24"},null,8,["color"]),Nt])]),default:i(()=>[t("ul",St,[(r(!0),d(z,null,A(e.processList,(o,f)=>(r(),d("li",{style:{width:"30%"},class:"simplify-text",key:f},[t("span",Ut,[o.startType=="timerEvent"?(r(),U(y,{key:0,icon:"ant-design:history-outlined",size:"16"})):o.startType=="buttonEvent"?(r(),U(y,{key:1,icon:"ant-design:select-outlined",size:"16"})):(r(),U(y,{key:2,icon:"ant-design:cluster-outlined",size:"16"})),t("span",qt,_(o.processName),1)])]))),128))])]),_:1})]),_:1})]),e.carouselList&&e.carouselList.length>0?(r(),d("div",Pt,[t("div",Rt,_(e.templateObj.title),1),t("div",Ht,_(e.templateObj.subTitle),1),t("div",$t,[n(V,{arrows:"",autoplay:""},{default:i(()=>[(r(!0),d(z,null,A(e.carouselList,(o,f)=>(r(),d("div",{key:f},[t("img",{src:o,style:{width:"inherit",height:"350px"}},null,8,Yt)]))),128))]),_:1})])])):G("",!0),t("div",xt,_(e.commentList.length)+" 条评价",1),n(N,null,{avatar:i(()=>[n(w,{class:"tx",src:e.getMyAvatar(),alt:e.getMyname()},{default:i(()=>[q(_(e.getMyname()),1)]),_:1},8,["src","alt"])]),content:i(()=>[n(R,{ref:"bottomCommentRef",onComment:e.sendComment,inputFocus:e.focusStatus},null,8,["onComment","inputFocus"])]),_:1}),t("div",Qt,[t("ul",null,[(r(!0),d(z,null,A(e.commentList,(o,f)=>(r(),d("li",{key:f},[n(N,null,{actions:i(()=>[t("span",null,[n(k,{value:o.rate,disabled:""},null,8,["value"])])]),author:i(()=>[t("a",null,_(o.realname),1)]),avatar:i(()=>[n(w,{src:o.avatar,alt:e.getMyname()},{default:i(()=>[q(_(o.realname),1)]),_:2},1032,["src","alt"])]),content:i(()=>[t("p",null,_(o.commentContent),1)]),datetime:i(()=>[n(C,{title:e.dayjs(o.createTime).format("YYYY-MM-DD HH:mm:ss")},{default:i(()=>[t("span",null,_(e.dayjs(o.createTime).fromNow()),1)]),_:2},1032,["title"])]),_:2},1024)]))),128))]),e.showMoreBtn?(r(),d("div",Wt,[n(B,{type:"default",onClick:e.nextPage},{default:i(()=>[q(" 加载更多 ")]),_:1},8,["onClick"])])):G("",!0)])])]),t("div",Gt,[t("div",Jt,[t("div",Kt,[t("img",{style:{width:"50px",height:"50px","border-radius":"inherit"},src:e.templateObj.coverUrl},null,8,Xt)]),t("div",Zt,_(e.templateObj.title),1)]),t("div",es,[ts,t("span",ss,_(e.templateObj.updateTime),1)]),t("div",os,[as,t("span",ns,_(e.templateObj.downloadNum),1)]),t("div",ls,[is,t("span",rs,_(e.templateObj.likeNum),1)]),t("div",us,[cs,e.selectTagsList&&e.selectTagsList.length>0?(r(),d("ul",ds,[(r(!0),d(z,null,A(e.selectTagsList,(o,f)=>(r(),d("li",{class:"classification-item flexCenter",style:oe({background:e.getRandomColor(f)}),key:f},[t("span",ps,_(e.getTagLabel(o)),1)],4))),128))])):G("",!0)])])])]),_:1},8,["spinning"]),n(F,{style:{top:"100px"},title:"提示",open:e.visible,"onUpdate:open":a[4]||(a[4]=o=>e.visible=o),onOk:e.goUpgrade,cancelText:"再看看",okText:"升级"},{default:i(()=>[t("div",ms,[n(y,{icon:"ant-design:question-circle-outlined",style:{color:"orange"},size:"30"}),fs])]),_:1},8,["open","onOk"]),n(F,{width:"80%",title:e.templateObj.title,open:e.videoVisible,"onUpdate:open":a[5]||(a[5]=o=>e.videoVisible=o),footer:null},{default:i(()=>[e.templateObj.videoUrl?(r(),d("video",ys,[t("source",{src:e.templateObj.videoUrl,type:"video/mp4"},null,8,_s)])):e.carouselList&&e.carouselList.length>0?(r(),d("div",gs,[n(V,{autoplay:""},{default:i(()=>[(r(!0),d(z,null,A(e.carouselList,(o,f)=>(r(),d("div",{key:f},[t("img",{src:o,style:{width:"100%",height:"400px"}},null,8,hs)]))),128))]),_:1})])):(r(),d("div",vs,[n(y,{icon:"ant-design:info-circle-outlined",style:{color:"orange"},size:"30"}),bs]))]),_:1},8,["title","open"]),n(m,{onRegister:e.registerModal,onCopy:e.doCopyApp},null,8,["onRegister","onCopy"])]),_:1},8,["class"])}const Ss=He(lt,[["render",Cs],["__scopeId","data-v-332e33ee"]]);export{Ss as default};
