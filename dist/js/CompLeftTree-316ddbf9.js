var f=(E,x,n)=>new Promise((I,_)=>{var w=o=>{try{l(n.next(o))}catch(u){_(u)}},T=o=>{try{l(n.throw(o))}catch(u){_(u)}},l=o=>o.done?I(o.value):Promise.resolve(o.value).then(w,T);l((n=n.apply(E,x)).next())});import{d as le,c as ie,f as r,V as i,a6 as y,af as C,ai as a,a5 as N,k as s,E as b,W as X,a7 as se,u as S,ak as ce,F as pe,n as L}from"./vue-vendor-24c7dc61.js";import"./index-1c3affea.js";import{e as ue,a as de}from"./index-831af9dd.js";import{q as P,a as U,b as me,d as fe,A as j}from"./comp.data-1c830b5e.js";import{u as ve}from"./useMethods-f689b480.js";import ye from"./CompModal-d02c3396.js";import{r as _e}from"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";const he={class:"j-table-operator",style:{width:"100%"}},ke=N("span",{style:{color:"red"}},"删除",-1),yt=le({__name:"CompLeftTree",emits:["select","rootTreeData"],setup(E,{expose:x,emit:n}){const I=ie("prefixCls"),{createMessage:_}=de(),{handleImportXls:w,handleExportXls:T}=ve(),l=r(!1),o=r([]),u=r([]),c=r([]),d=r([]),D=r(!1),q=r(!0),K=r(null),A=r(null),F=r(""),[O,{openModal:ge}]=ue();function p(){return f(this,null,function*(){try{l.value=!0,o.value=[];const e=yield P();if(Array.isArray(e)&&(o.value=e),c.value.length===0)R();else if(d.value.length===0){let t=o.value[0];t&&h(t.id,t)}else n("select",K.value);n("rootTreeData",o.value)}finally{l.value=!1}})}p();function W(e){return f(this,null,function*(){try{const t=yield P({pid:e.dataRef.id});if(t.length==0)e.dataRef.isLeaf=!0;else if(e.dataRef.children=t,c.value.length>0){let v=[];for(let k of c.value)t.findIndex(g=>g.id===k)!==-1&&v.push(k);v.length>0&&(c.value=[...c.value])}o.value=[...o.value],n("rootTreeData",o.value)}catch(t){}return Promise.resolve()})}function R(){let e=o.value[0];e?(e.isLeaf||(c.value=[e.key]),h(e.id,e),z()):n("select",null)}function z(){return f(this,null,function*(){yield L(),D.value=!0,yield L(),D.value=!1})}function h(e,t){d.value=[e],t&&(K.value=t,n("select",t))}function G(){U({parentId:0,status:0,orderNum:100,compName:"新增分类"}).then(e=>{p()})}function M(e=S(K)){if(e==null){_.warning("请先选择一个组件");return}U({parentId:e.id,status:0,orderNum:100,compName:"新增节点"}).then(t=>{p()})}function H(e){return f(this,null,function*(){if(e)try{l.value=!0,o.value=[];let t=yield me({keyWord:e});Array.isArray(t)&&(o.value=t),R()}finally{l.value=!1}else yield p();F.value=e})}function J(e){Array.isArray(e)?u.value=e:u.value=e.checked}function Q(e,t){e.length>0&&d.value[0]!==e[0]?h(e[0],t.selectedNodes[0]):h(d.value[0])}function Y(e){return f(this,null,function*(){e&&(V(!1),yield fe({id:e.id},()=>{d.value=[],p()}))})}function V(e){e||(A.value=null)}function Ce(e){w(e,j.importExcelUrl,()=>{p()})}function xe(){T("组件配置信息",j.exportXlsUrl)}return x({loadRootTreeData:p}),(e,t)=>{const v=i("a-button"),k=i("a-input-search"),g=i("a-menu-item"),Z=i("a-menu"),ee=i("a-dropdown"),te=i("a-tree"),oe=i("a-empty"),ae=i("a-spin"),ne=i("a-card");return y(),C(ne,{bordered:!1,style:{height:"100%"},title:"组件列表"},{default:a(()=>[N("div",he,[s(v,{type:"primary",preIcon:"ant-design:folder-outlined",onClick:t[0]||(t[0]=m=>G())},{default:a(()=>[b("新增组件分类")]),_:1}),d.value.length>0?(y(),C(v,{key:0,preIcon:"ant-design:appstore-add-outlined",onClick:t[1]||(t[1]=m=>M())},{default:a(()=>[b("新增组件")]),_:1})):X("",!0)]),s(ae,{spinning:l.value},{default:a(()=>[s(k,{placeholder:"按组件名称搜索…",style:{"margin-bottom":"10px"},onSearch:H}),o.value.length>0?(y(),se(pe,{key:0},[D.value?X("",!0):(y(),C(te,{key:0,clickRowToExpand:!1,treeData:o.value,selectedKeys:d.value,checkStrictly:q.value,"load-data":W,checkedKeys:u.value,expandedKeys:c.value,"onUpdate:expandedKeys":t[3]||(t[3]=m=>c.value=m),onCheck:J,onSelect:Q},{title:a(({key:m,title:re,dataRef:$})=>[s(ee,{trigger:["contextmenu"]},{overlay:a(()=>[s(Z,{onClick:t[2]||(t[2]=()=>{})},{default:a(()=>[s(g,{key:"1",onClick:B=>M($)},{default:a(()=>[b("添加子级")]),_:2},1032,["onClick"]),s(g,{key:"2",onClick:B=>A.value=m},{default:a(()=>[ke]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[s(S(_e),{open:A.value===m,title:"确定要删除吗？","ok-text":"确定","cancel-text":"取消",placement:"rightTop",onConfirm:B=>Y($),onOpenChange:V},{default:a(()=>[N("span",null,ce(re),1)]),_:2},1032,["open","onConfirm"])]),_:2},1024)]),_:1},8,["treeData","selectedKeys","checkStrictly","checkedKeys","expandedKeys"]))],64)):(y(),C(oe,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"]),s(ye,{rootTreeData:o.value,onRegister:S(O),onSuccess:p},null,8,["rootTreeData","onRegister"])]),_:1})}}});export{yt as default};
