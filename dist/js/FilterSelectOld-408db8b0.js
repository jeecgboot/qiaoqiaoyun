var se=Object.defineProperty,re=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var q=(t,i,r)=>i in t?se(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,J=(t,i)=>{for(var r in i||(i={}))ue.call(i,r)&&q(t,r,i[r]);if(Q)for(var r of Q(i))ce.call(i,r)&&q(t,r,i[r]);return t},z=(t,i)=>re(t,pe(i));var H=(t,i,r)=>new Promise((a,k)=>{var _=m=>{try{F(r.next(m))}catch(C){k(C)}},d=m=>{try{F(r.throw(m))}catch(C){k(C)}},F=m=>m.done?a(m.value):Promise.resolve(m.value).then(_,d);F((r=r.apply(t,i)).next())});import{d as me,f as A,r as W,e as G,as as de,I as fe,a5 as c,V as p,a6 as y,a7 as N,k as v,ai as h,E as ve,af as P,W as L,a8 as X,F as Y,am as ye,ak as Z}from"./vue-vendor-24c7dc61.js";import{cn as he,aC as _e,aH as ge,av as Fe,bU as Ce,i as Oe}from"./antd-vue-vendor-0d72f01e.js";import{a7 as ke,m as Se,l as Ne}from"./index-831af9dd.js";import Le from"./FilterFiledList-8a929f88.js";import be from"./FilterOperation-229e1139.js";import"./vxe-table-vendor-8813019a.js";import"./type.definition-4eb605ee.js";import"./SuperQueryValComponent-97f284a9.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./ComponentIcon-f1bbb90f.js";const Me="JSuperFilter_",Te=me({name:"FilterSelect",components:{FilterOutlined:he,PlusOutlined:_e,CheckOutlined:ge,CloseOutlined:Fe,EllipsisOutlined:Ce,FilterFiledList:Le,FilterOperation:be},props:{columnList:{type:Array,default:()=>[]}},emits:["selected","filter"],setup(t,{emit:i}){const r=A(!1),a=A([]),k=A("-1"),{userInfo:_}=ke(),d=W({selected:!1}),F=G(()=>{if(d.selected===!0)return"我创建的";{let e=a.value.filter(l=>l.selected===!0);if(e.length>0)return e[0].title}return""}),m=Se(),C=de(),w=Me+C.fullPath;function E(){let e=m.get(w);if(e&&e instanceof Array){let l=[];for(let o of e)o.isMyself===!0?d.selected=o.selected:l.push(J({},o));a.value=l}}E();function U(e,l){e&&V(e),d.selected=!1;let o=a.value;for(let u of o)u.selected=!1,u.title==l.title&&(u.selected=!0);a.value=o,r.value=!1,S()}function j(e){b(e),d.selected=!0,r.value=!1,S()}function D(e){b(e),S(),R()}function b(e){e&&V(e),d.selected=!1;let l=a.value;for(let o of l)o.selected=!1;a.value=l}const n=W({visible:!1,type:"save",filterName:"",validateStatue:!1}),I=G(()=>n.type=="save"?"保存":n.type=="copy"?"另存为":n.type=="rename"?"重命名":""),M=A(!1);let f={};function K(e){e&&V(e),M.value=!0,f={}}const s=A();function T(){s.value.validate().then(()=>{if(n.type=="save"){b();let l=a.value,o={selected:!0,title:n.filterName,conditionType:f.conditionType,conditions:f.conditions,isMyself:!1};l.push(o),a.value=l,S(),M.value=!1}else if(n.type=="copy"){let l=a.value,o={selected:!1,title:n.filterName,conditionType:f.conditionType,conditions:f.conditions,isMyself:!1};l.push(o),a.value=l}else if(n.type=="rename"){let l=a.value;for(let o of l)o.title==f.title&&(o.title=n.filterName);a.value=l}n.visible=!1,R(),f={}})}function g(e){n.visible=!0,n.filterName="自定义筛选",n.type="save",f=e}function x(e){let l=a.value;if(l&&l.length>0){let o=l.filter(u=>u.title==e);if(o&&o.length>0)return!1}return!0}const ee=[{required:!0,validator:()=>H(this,null,function*(){let e=n.filterName;return e===""?Promise.reject("请输入名称！"):x(e)===!0?Promise.resolve():Promise.reject("该名称已存在！")}),trigger:"change"}];function R(){let e=fe(a.value);d.selected===!0&&e.push({selected:!0,isMyself:!0}),m.set(w,e)}function S(){if(d.selected===!0){let e=[{field:"create_by",rule:"eq",val:_==null?void 0:_.username,type:"input"}],l={matchType:"and",superQueryParams:encodeURI(JSON.stringify(e))};i("filter",l)}else{let e=a.value;if(e&&e.length>0){let l=e.filter(o=>o.selected===!0);if(!l||l.length==0){i("filter",{matchType:"and",superQueryParams:""});return}if(l[0].isMyself===!0){let o=[{field:"create_by",rule:"eq",val:_==null?void 0:_.username,type:"input"}],u={matchType:"and",superQueryParams:encodeURI(JSON.stringify(o))};i("filter",u)}else{if(!l[0].conditions)return;let o=l[0].conditions,u=[];for(let B of o){let ae=B.field,O=B.val;O instanceof Array&&(O=O.join(",")),(B.type=="date"||B.type=="datetime")&&O&&(O=Oe(O).toDate().getTime()),u.push(z(J({},B),{field:ae,val:O}))}let $={matchType:l[0].conditionType,superQueryParams:encodeURI(JSON.stringify(u))};i("filter",$)}}}}function te(e,l,o){if(e=="save"||e=="copy")l.emitChange=e;else if(e=="remove"){let u=a.value,$=u[o].selected;u.splice(o,1),a.value=u,$===!0&&S(),R()}else e=="rename"&&(f={index:o,title:l.title},n.visible=!0,n.filterName=l.title,n.type="rename")}function le(e,l){e.emitChange="",e.conditions=l.conditions,e.conditionType=l.conditionType,e.selected===!0&&S(),R()}function ie(e,l){e.emitChange="",f=l,n.visible=!0,n.filterName=e.title+"-复制",n.type="copy"}function oe(e){return k.value==e}function ne(){return document.getElementsByClassName("jee-filter-select-pop")[0]}function V(e){e.preventDefault(),e.stopPropagation()}return{visible:r,handleSelect:U,filterList:a,selectMyCreate:j,mySelfFilter:d,filterTitle:F,myClearFilter:D,showAdding:M,nameModal:n,nameModalTitle:I,handleAdd:K,beforeSaveFiledList:g,handleModalSave:T,nameRules:ee,activeFilterKey:k,showOperation:oe,handleFilterOperation:te,saveInfo:le,copyInfo:ie,nameFormRef:s,getContainer:ne}}});const Be={class:"jee-filter-select-container"},Ae={class:"pop-title"},Pe={class:"right-icon"},we=c("div",{class:"ant-modal-content"},null,-1),Re={key:0,class:"inner-content filter-select-adding"},Ee=c("div",{class:"title"},"自定义筛选",-1),Ue=c("span",null,"我创建的",-1),je=c("hr",null,null,-1),De=c("div",{style:{color:"#9e9e9e","font-size":"12px",padding:"6px 20px"}}," 我的筛选 ",-1),Ie=["onClick"],Ke={key:0,style:{"margin-right":"10px",height:"38px","line-height":"38px","font-size":"18px"}},Ve={class:"inner-content filter-select-adding",style:{"padding-top":"1px"}},$e={key:0,class:"has-filter"},Je={class:"text"},Qe={class:"icon"},qe={style:{display:"flex","margin-top":"20px"}};function ze(t,i,r,a,k,_){const d=p("PlusOutlined"),F=p("FilterFiledList"),m=p("CheckOutlined"),C=p("FilterOperation"),w=p("a-collapse-panel"),E=p("a-collapse"),U=p("filter-outlined"),j=p("CloseOutlined"),D=p("FilterOutlined"),b=p("a-tooltip"),n=p("a-popover"),I=p("a-input"),M=p("a-form-item"),f=p("a-form"),K=p("a-modal");return y(),N("div",Be,[v(n,{open:t.visible,"onUpdate:open":i[2]||(i[2]=s=>t.visible=s),placement:"bottomLeft",trigger:"click",overlayClassName:"jee-filter-select-pop"},{title:h(()=>[c("div",Ae,[ve(" 筛选 "),c("span",Pe,[t.showAdding?L("",!0):(y(),P(d,{key:0,title:"添加",onClick:t.handleAdd},null,8,["onClick"]))])])]),content:h(()=>[we,t.showAdding?(y(),N("div",Re,[Ee,v(F,{columnList:t.columnList,onSave:t.beforeSaveFiledList,clear:t.showAdding},null,8,["columnList","onSave","clear"])])):L("",!0),c("div",{class:X(t.mySelfFilter.selected?"myself selected":"myself"),onClick:i[0]||(i[0]=(...s)=>t.selectMyCreate&&t.selectMyCreate(...s))},[t.mySelfFilter.selected?(y(),P(m,{key:0,style:{"margin-right":"8px"}})):L("",!0),Ue],2),t.filterList&&t.filterList.length>0?(y(),N(Y,{key:1},[je,De,v(E,{activeKey:t.activeFilterKey,"onUpdate:activeKey":i[1]||(i[1]=s=>t.activeFilterKey=s),"expand-icon-position":"right",ghost:"",accordion:"",class:"filter-list"},{default:h(()=>[(y(!0),N(Y,null,ye(t.filterList,(s,T)=>(y(),P(w,{key:T},{header:h(()=>[c("div",{class:X(s.selected?"header-content selected":"header-content"),onClick:g=>t.handleSelect(g,s)},[s.selected?(y(),P(m,{key:0})):L("",!0),c("span",null,Z(s.title),1)],10,Ie)]),extra:h(()=>[t.showOperation(T)?(y(),N("div",Ke,[v(C,{onOpt:g=>t.handleFilterOperation(g,s,T)},null,8,["onOpt"])])):L("",!0)]),default:h(()=>[c("div",Ve,[v(F,{columnList:t.columnList,onSave:g=>t.saveInfo(s,g),onCopy:g=>t.copyInfo(s,g),info:s,saveButton:!1},null,8,["columnList","onSave","onCopy","info"])])]),_:2},1024))),128))]),_:1},8,["activeKey"])],64)):L("",!0)]),default:h(()=>[v(b,{placement:"bottom",title:"筛选"},{default:h(()=>[t.filterTitle?(y(),N("span",$e,[v(U),c("span",Je,Z(t.filterTitle),1),c("span",Qe,[v(j,{onClick:t.myClearFilter},null,8,["onClick"])])])):(y(),P(D,{key:1}))]),_:1})]),_:1},8,["open"]),v(K,{open:t.nameModal.visible,"onUpdate:open":i[4]||(i[4]=s=>t.nameModal.visible=s),wrapClassName:"filter-name-modal",title:t.nameModalTitle,onOk:t.handleModalSave,getContainer:t.getContainer},{default:h(()=>[c("div",qe,[v(f,{labelCol:{span:8},wrapperCol:{span:16},ref:"nameFormRef",model:t.nameModal},{default:h(()=>[v(M,{label:"名称",name:"filterName",rules:t.nameRules},{default:h(()=>[v(I,{value:t.nameModal.filterName,"onUpdate:value":i[3]||(i[3]=s=>t.nameModal.filterName=s),style:{width:"300px"}},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])])]),_:1},8,["open","title","onOk","getContainer"])])}const Wt=Ne(Te,[["render",ze]]);export{Wt as default};
