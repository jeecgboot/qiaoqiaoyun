var q=Object.defineProperty,z=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var P=(n,s,a)=>s in n?q(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a,R=(n,s)=>{for(var a in s||(s={}))J.call(s,a)&&P(n,a,s[a]);if(j)for(var a of j(s))K.call(s,a)&&P(n,a,s[a]);return n},U=(n,s)=>z(n,G(s));var S=(n,s,a)=>new Promise((o,f)=>{var C=i=>{try{p(a.next(i))}catch(_){f(_)}},y=i=>{try{p(a.throw(i))}catch(_){f(_)}},p=i=>i.done?o(i.value):Promise.resolve(i.value).then(C,y);p((a=a.apply(n,s)).next())});import{f as N,h as M,e as X,a5 as w,V as b,a6 as m,af as O,ai as c,k as g,E,a7 as x,F as A,am as L,ak as D,W as I}from"./vue-vendor-24c7dc61.js";import{k as H,l as Y}from"./index-831af9dd.js";import{bO as Z,c5 as $}from"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";const Q=[{label:"不显示",type:""},{label:"已填写",type:"notEmpty"},{label:"未填写",type:"empty"}],W=[{label:"求和",type:"sum"},{label:"平均值",type:"avg"},{label:"最大值",type:"max"},{label:"最小值",type:"min"}],ee=["money","integer","number","rate","slider","formula"],te={name:"TableSummary",props:{tableColumns:{type:Array,default:()=>[]},dynamicConfig:{type:Object,default:()=>{}},superQueryParams:{type:Object,default:()=>{}},dataList:{type:Array,default:()=>[]},show:{type:Boolean,default:!0}},components:{DownOutlined:Z},emits:["load"],setup(n,{emit:s}){const a=N(!1),o=N(""),f=N([]);M(()=>{if(n.dynamicConfig)if(o.value=n.dynamicConfig.id,n.dynamicConfig.hasSummary===!0){let e=n.tableColumns,t=n.dataList;C(e,t)}else a.value=!1});function C(e,t){if(!e||e.length==0){a.value=!1;return}a.value=!0;let l=[];for(let d of e){const{compType:T,dataIndex:h}=d;let v="",u=y(T);for(let V=0;V<t.length;V++)if(h===t[V].field){v=U(R({},t[V]),{isNumber:u,popVisible:!1});break}v||(v={field:h,type:"",val:"",popVisible:!1,isNumber:u}),l.push(v)}f.value=l}function y(e){return ee.indexOf(e)>=0}function p(e){let t="  ";if(e.type){let l=Q.filter(d=>d.type===e.type);l.length==0&&(l=W.filter(d=>d.type===e.type)),t=l[0].label}return t}function i(e){e.preventDefault(),e.stopPropagation()}function _(e,t,l){return S(this,null,function*(){i(e),t.type=l,l?s("load",{field:t.field,type:l}):yield k(t.field,l,"")})}function F(e){return S(this,null,function*(){const t="/desform/data/statisticalValue";let l=yield H.get({url:t,params:e},{isTransformResponse:!1});if(l.success){let d=l.result;yield k(e.summaryField,e.summaryType,d)}})}function k(e,t,l){return S(this,null,function*(){const d="/desform/view/updateViewConfig";let T=f.value,h=[];for(let u of T)u.field===e&&(u.val=l,u.type=t,u.popVisible=!1),u.type&&h.push({field:u.field,type:u.type});let v={id:o.value,summaryList:h};yield H.put({url:d,params:v},{isTransformResponse:!1}),f.value=T})}function B(e){return e?$(e,2):0}const r=X(()=>n.show===!0&&a.value===!0);return{viewId:o,getText:p,visible:a,summaryOptions:Q,numberSummaryOptions:W,onChangeSummaryType:_,summaryList:f,loadFieldSummary:F,getTwoDecimal:B,summaryVisible:r}}};const ae=w("div",{class:"first",title:"统计行"},"=",-1),le=w("div",{class:"label"},"选择统计方式",-1),ne=["onClick"],se=["onClick"],oe={style:{width:"100%",display:"flex"}},ie=["title"],re={style:{display:"inline-block",width:"20px","text-align":"right"}};function ue(n,s,a,o,f,C){const y=b("a-table-summary-cell"),p=b("a-divider"),i=b("a-tag"),_=b("DownOutlined"),F=b("a-popover"),k=b("a-table-summary-row"),B=b("a-table-summary");return m(),O(B,{fixed:""},{default:c(()=>[o.summaryVisible?(m(),O(k,{key:0,class:"design-summary-row"},{default:c(()=>[g(y,{index:0},{default:c(()=>[ae]),_:1}),g(y,{index:1},{default:c(()=>[E("  ")]),_:1}),(m(!0),x(A,null,L(o.summaryList,(r,e)=>(m(),O(y,{index:e+2},{default:c(()=>[g(F,{open:r.popVisible,"onUpdate:open":t=>r.popVisible=t,overlayClassName:"pop-summary-container",placement:"topLeft",overlayStyle:{width:"160px"},trigger:"click"},{title:c(()=>[]),content:c(()=>[le,(m(!0),x(A,null,L(o.summaryOptions,t=>(m(),x("div",{onClick:l=>o.onChangeSummaryType(l,r,t.type),class:"item"},D(t.label),9,ne))),256)),r.isNumber?(m(),x(A,{key:0},[g(p,{style:{margin:"2px 0"}}),(m(!0),x(A,null,L(o.numberSummaryOptions,t=>(m(),x("div",{onClick:l=>o.onChangeSummaryType(l,r,t.type),class:"item"},D(t.label),9,se))),256))],64)):I("",!0)]),default:c(()=>[w("div",oe,[w("span",{style:{flex:"1",display:"inline-block","text-align":"center",overflow:"hidden"},title:o.getTwoDecimal(r.val)},[r.type?(m(),O(i,{key:0,color:"blue"},{default:c(()=>[E(D(o.getText(r))+"："+D(o.getTwoDecimal(r.val)),1)]),_:2},1024)):I("",!0)],8,ie),w("span",re,[g(_)])])]),_:2},1032,["open","onUpdate:open"])]),_:2},1032,["index"]))),256)),g(y,{index:a.tableColumns.length+2},{default:c(()=>[E("  ")]),_:1},8,["index"])]),_:1})):I("",!0)]),_:1})}const pe=Y(te,[["render",ue]]);export{pe as default};
