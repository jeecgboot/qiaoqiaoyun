var y=(o,i,l)=>new Promise((A,v)=>{var N=u=>{try{g(l.next(u))}catch(h){v(h)}},f=u=>{try{g(l.throw(u))}catch(h){v(h)}},g=u=>u.done?A(u.value):Promise.resolve(u.value).then(N,f);g((l=l.apply(o,i)).next())});import{d as J,f as C,as as Q,h as X,w as Y,av as Z,a3 as ee,a4 as te,a5 as m,V as c,a6 as M,a7 as w,F as oe,k as d,ai as p,af as ne,E as ae,ak as $,W as S}from"./vue-vendor-24c7dc61.js";import{d as ie}from"./vuedraggable-vendor-6ef4bc68.js";import{R as le,e as se,cp as de,cq as ue,cl as re,cm as pe,a as ce,l as fe}from"./index-831af9dd.js";import{bV as me}from"./antd-vue-vendor-0d72f01e.js";import ye from"./MenuAction-5d2e21ef.js";import ge from"./AppIconSelector-c6c055a9.js";import he from"./AppMenuUpdateModal-457fbbca.js";import{m as I}from"./low.app.api-97fc250a.js";import _e from"./MoveGroupSelectModal-b21b3188.js";import"./index-1c3affea.js";import"./vxe-table-vendor-8813019a.js";import"./VipPay.api-469f07f9.js";import"./lowAppAuth-3d637b7d.js";import"./lowAppUtils-56892d30.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";const V=J({name:"AppMenu",props:{menus:{type:Array,default:()=>[]},info:{type:Object,default:()=>{}},leftMoveGroupList:{type:Array,default:()=>[]},hasAdminAuth:{type:Boolean,default:!1}},components:{draggable:ie,Icon:le,FileExcelOutlined:me,MenuAction:ye,AppIconSelector:ge,AppMenuUpdateModal:he,MoveGroupSelectModal:_e},emits:["add","routeChange","updateTitle","delete","reload","copy"],setup(o,{emit:i}){const l=C([]),A=C(""),v=C(""),N=C([]),[f,{openModal:g}]=se(),u=Q();X(()=>{let e=o.menus,n=[];if(e&&e.length>0){for(let t of e){let a={id:t.id,menuName:t.menuName,orderNum:t.orderNum,menuUrl:t.menuUrl,appId:t.appId,iconType:"",showUpdateInfo:!1,type:t.type,hideFlag:t.hideFlag,menuNote:t.menuNote,addButtonLabel:t.addButtonLabel};t.iconType?a.iconType=t.iconType:t.type=="drag"?a.iconType="ant-design:gateway-outlined":a.iconType="ant-design:table-outlined",n.push(a)}n.sort(function(t,a){return t.orderNum-a.orderNum})}if(l.value=n,o.info&&(h(),o.info.openStatus===0&&(l.value=[]),o.info.maintStatus==1&&o.hasAdminAuth===!1&&(l.value=[])),u.query.type&&u.query.type=="drag"){let t=u.params.code;t&&k(t)}});function h(){let e=o.info.iconBackColor;A.value=e;let n=e;if(!e.startsWith("#")){let r=e.replace("rgb","").replace("(","").replace(")","").split(",");n=de(r[0],r[1],r[2])}const t=ue(n,5);v.value=t}const _=C(!1);function U(e){i("add",e.key),_.value=!1}function E(e){return y(this,null,function*(){let t=l.value.filter(a=>a.id===e.key);if(t&&t.length>0){let a=t[0].menuUrl;if(t[0].type==="drag"){let r=`/myapp/${o.info.id}/drag/${a}`;i("routeChange",r)}else if(t[0].type==="form"){let r=`/myapp/${o.info.id}/form/${a}`;i("routeChange",r)}else{let r=`/myapp/${o.info.id}/desform/${a}`;i("routeChange",r)}}})}Y(()=>u.fullPath,()=>y(this,null,function*(){let n=u.params.code;n&&(yield k(n))}),{immediate:!0});function k(e){return y(this,null,function*(){let n=l.value,t=n.filter(a=>a.menuUrl==e);(!t||t.length==0)&&(re(u.name)||(e=yield pe(e.toString()),t=n.filter(r=>r.menuUrl==e))),t&&t.length&&(N.value=[t[0].id],i("updateTitle",{id:t[0].id,title:t[0].menuName,type:t[0].type,code:e,addButtonLabel:t[0].addButtonLabel,menuNote:t[0].menuNote}))})}function T(){F()}function F(){return y(this,null,function*(){let e=l.value,n=[];for(let a=0;a<e.length;a++)n.push({id:e[a].id,orderNum:a+1});let t={info:n};yield I.changeOrder(t),i("reload")})}function s(e,n){return y(this,null,function*(){if(e=="update"){let t=l.value;for(let a of t)a.id===n.id?a.showUpdateInfo=!0:a.showUpdateInfo=!1;l.value=t,D.value=n.id}else if(e=="delete")i("delete",n);else if(e.startsWith("move")){let t=e.replace("move:","");yield B(n,t)}else e==="copy"?W(n):e==="hide"?(yield I.update({id:n.id,hideFlag:1}),i("reload")):e==="show"?(yield I.update({id:n.id,hideFlag:0}),i("reload")):e==="other-app"&&g(!0,{menu:n})})}function B(e,n){return y(this,null,function*(){yield I.moveToGroup(e.id,e.appId,n),i("reload",e.id)})}function K(e){let n=l.value;for(let t of n)t.id===e.id&&(t.menuName=e.menuName,t.iconType=e.iconType);l.value=n,i("updateTitle",e.menuName)}function q(e){let n=l.value;for(let t of n)t.id===e.id&&(t.showUpdateInfo=!1);for(let t of o.menus)t.id===e.id&&(t.menuName=e.menuName,t.iconType=e.iconType);l.value=n}const D=C("");function R(e){return e==1}function z(e){e.preventDefault(),e.stopPropagation()}function H(){return o.info&&o.info.openStatus===0?!1:o.hasAdminAuth===!0}const{createInfoModal:P,createMessage:L}=ce();function W(e){let n=`复制工作表 “${e.menuName}”`,t="仅复制目标工作表的所有配置，工作表下的数据不会被复制";e.type==="drag"&&(n=`复制自定义页面“${e.menuName}”`,t="仅复制当前自定义页面的所有配置"),P({title:n,content:t,okCancel:!0,okText:"复制",cancelText:"取消",onOk:()=>{j(e.id)}})}function j(e){return y(this,null,function*(){const n=yield I.copyMenu({id:e});n.success?(L.success("复制成功"),i("copy")):L.warn(n.message)})}function x(e){i("reload",e)}return{menuList:l,onMenuAction:s,selectedKeys:N,onDragEnd:T,menuColor:A,activeBgColor:v,actionVisible:_,onChangeMenu:E,handleActionClick:U,onUpdateData:q,onUpdateLocal:K,activeMenuId:D,menuActionClick:z,isHiddenMenu:R,hasAddFormAuth:H,registerModal:f,reloadMenu:x}}}),G=()=>{Z(o=>({"31d5a0fe":o.menuColor}))},O=V.setup;V.setup=O?(o,i)=>(G(),O(o,i)):G;const ve=V;const b=o=>(ee("data-v-de865f66"),o=o(),te(),o),Ce={class:"app-main-menu-chunk"},Me={class:"custom-app-menu-item"},Ae={class:"title",style:{flex:"1",display:"flex"}},Ne=["title"],ke={key:0,style:{"margin-top":"2px"}},we={key:0},Ie={key:0},be={class:"app-menu-item-add"},Ue=b(()=>m("span",{class:"title"},"应用项",-1)),Ee=b(()=>m("div",{style:{color:"#9e9e9e",padding:"8px 12px","font-size":"13px"}}," 工作表 ",-1)),Te=b(()=>m("span",{class:"label"},"从空白创建表单",-1)),Fe=b(()=>m("span",{class:"label"},"创建门户/仪表盘",-1));function Be(o,i,l,A,v,N){const f=c("Icon"),g=c("a-tooltip"),u=c("menu-action"),h=c("app-menu-update-modal"),_=c("a-menu-item"),U=c("draggable"),E=c("a-menu-divider"),k=c("a-menu"),T=c("a-dropdown"),F=c("MoveGroupSelectModal");return M(),w(oe,null,[m("div",Ce,[d(k,{selectedKeys:o.selectedKeys,"onUpdate:selectedKeys":i[2]||(i[2]=s=>o.selectedKeys=s),theme:"light",mode:"vertical",class:"my-app-menus",multiple:!1,onSelect:o.onChangeMenu},{default:p(()=>[d(U,{"item-key":"id",animation:"300",group:"menu",modelValue:o.menuList,"onUpdate:modelValue":i[0]||(i[0]=s=>o.menuList=s),dragClass:"dragClass",onEnd:o.onDragEnd},{item:p(({element:s})=>[(M(),w("div",{key:s.id},[(M(),ne(_,{key:s.id,id:s.id},{title:p(()=>[ae($(s.menuName),1)]),default:p(()=>[m("div",Me,[d(f,{icon:s.iconType,color:o.menuColor,style:{"font-size":"22px"}},null,8,["icon","color"]),m("span",Ae,[m("span",{class:"menu-text-span",title:s.menuName},$(s.menuName),9,Ne),s.hideFlag==1?(M(),w("span",ke,[d(g,{title:"仅管理员可见",placement:"bottom"},{default:p(()=>[d(f,{icon:"ant-design:eye-invisible-outlined",color:o.menuColor,style:{"font-size":"18px","margin-left":"7px"}},null,8,["color"])]),_:1})])):S("",!0)]),o.hasAdminAuth?(M(),w("span",we,[d(u,{hideFlag:o.isHiddenMenu(s.hideFlag),leftMoveGroupList:o.leftMoveGroupList,onAction:B=>o.onMenuAction(B,s),onClick:o.menuActionClick},null,8,["hideFlag","leftMoveGroupList","onAction","onClick"])])):S("",!0)]),d(h,{activeMenuId:o.activeMenuId,info:s,onUpdate:o.onUpdateLocal,onDbUpdate:o.onUpdateData},null,8,["activeMenuId","info","onUpdate","onDbUpdate"])]),_:2},1032,["id"]))]))]),_:1},8,["modelValue","onEnd"]),o.hasAddFormAuth()?(M(),w("div",Ie,[d(_,{title:"新建应用项",key:"addNew",disabled:""},{default:p(()=>[d(T,{open:o.actionVisible,"onUpdate:open":i[1]||(i[1]=s=>o.actionVisible=s),trigger:["click"],overlayClassName:"app-add-dropdown"},{overlay:p(()=>[d(k,{onClick:o.handleActionClick},{default:p(()=>[Ee,d(_,{key:"blank"},{default:p(()=>[d(f,{icon:"ant-design:plus-outlined",style:{"margin-right":"10px"}}),Te]),_:1}),d(E),d(_,{key:"chart",style:{"margin-top":"5px"}},{default:p(()=>[d(f,{icon:"ant-design:robot-outlined",style:{"margin-right":"10px"}}),Fe]),_:1})]),_:1},8,["onClick"])]),default:p(()=>[m("div",be,[d(f,{icon:"ant-design:plus-outlined"}),Ue])]),_:1},8,["open"])]),_:1})])):S("",!0)]),_:1},8,["selectedKeys","onSelect"])]),d(F,{onRegister:o.registerModal,onOk:o.reloadMenu},null,8,["onRegister","onOk"])],64)}const Qe=fe(ve,[["render",Be],["__scopeId","data-v-de865f66"]]);export{Qe as default};
