var ne=Object.defineProperty,oe=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var U=(e,l,a)=>l in e?ne(e,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[l]=a,G=(e,l)=>{for(var a in l||(l={}))ue.call(l,a)&&U(e,a,l[a]);if(P)for(var a of P(l))ce.call(l,a)&&U(e,a,l[a]);return e},Q=(e,l)=>oe(e,se(l));var R=(e,l,a)=>new Promise((y,m)=>{var p=n=>{try{o(a.next(n))}catch(u){m(u)}},r=n=>{try{o(a.throw(n))}catch(u){m(u)}},o=n=>n.done?y(n.value):Promise.resolve(n.value).then(p,r);o((a=a.apply(e,l)).next())});import{c as N,f as h,r as x,e as ie,w as A,u as D,n as W,d as ee,V as S,a6 as j,a7 as te,k as C,ag as F,ai as k,af as X,E as $,W as Y,p as z,h as re,I as Z}from"./vue-vendor-24c7dc61.js";import{B as de}from"./index-1c3affea.js";import{aD as fe,H as b,j as he,q as ae,aE as me,aF as ve,l as le,e as pe}from"./index-831af9dd.js";import{t as ge}from"./props-8a7ac45b.js";import{_ as ye}from"./index-f2fd5a28.js";import{o as ke}from"./antd-vue-vendor-0d72f01e.js";import{J as Ce}from"./JSelectBiz-55a9591f.js";import{u as Se}from"./useFormItem-86503382.js";function De(e,l,a,y){const m=N("selectOptions",h([])),p=N("selectValues",x({})),r=N("loadingEcho",h(!1)),o=h([]),n=h([]),u=h([]),g=h(!1),E=ie(()=>y.multiple?a.checkStrictly:!0);let w=!0;A(p,({value:t})=>{t&&g.value==!1&&t.length>0&&(r.value=w,w=!1,L(null,t.join(",")).finally(()=>{r.value=!1}))},{immediate:!0});function d(){const t=D(e);if(!t)throw new Error("tree is null!");return t}function B(){W(()=>{a.defaultExpandLevel&&a.defaultExpandLevel>0&&d().filterByLevel(a.defaultExpandLevel),n.value=p.value}).then()}function O(t,s){if(a.checkable==!1){n.value=a.checkStrictly?t.checked:t;const{selectedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function V(t,s){if(a.checkable==!0){if(!y.multiple){if(s.checked){n.value=[s.node.eventKey];let v=a.rowKey,q=s.checkedNodes.find(T=>T[v]===s.node.eventKey);u.value=[q]}else n.value=[],u.value=[];return}n.value=a.checkStrictly?t.checked:t;const{checkedNodes:c}=s;let i=[];c.forEach(v=>{i.push(v)}),u.value=i}}function f(t){return R(this,null,function*(){d().checkAll(t),yield W(),n.value=d().getCheckedKeys(),t?K():u.value=[]})}function K(){let t="";D(n).length>0&&(t=n.value.join(",")),l({ids:t}).then(s=>{u.value=s})}function H(t){d().expandAll(t)}function L(t,s){return R(this,null,function*(){let c={},i="";t&&(i=t.eventKey,c.pid=t.value),s&&(i="",c.ids=s);let v=yield l(c),q=v;if(a.serverTreeData||(v=fe(v,a,i),v.length==0&&t&&M(i,o.value)),g.value==!0){if(!t)o.value=v;else return new Promise(T=>{if(!t.children){T();return}const _=D(e);_&&(_.updateNodeByKey(t.eventKey,{children:v}),_.setExpandedKeys([t.eventKey,..._.getExpandedKeys()])),T()});B()}else{const T=[];q.forEach(_=>{T.push({label:_[a.labelKey],value:_[a.rowKey]})}),m.value=T}})}function M(t,s){if(s&&s.length>0)for(let c of s)if(c.key==t){c.child||(c.isLeaf=!0);break}else M(t,c.children)}function J(t){const s=[],c=[];u.value.forEach(i=>{s.push({label:i[a.labelKey],value:i[a.rowKey]})}),n.value.forEach(i=>{c.push(i)}),m.value=s,t&&t(s,c)}function I(t){return R(this,null,function*(){t?(g.value=!0,yield L(null,null)):g.value=!1})}return[{visibleChange:I,selectOptions:m,selectValues:p,onLoadData:L,onCheck:V,onSelect:O,checkALL:f,expandAll:H,checkedKeys:n,selectRows:u,treeData:o,getCheckStrictly:E,getSelectTreeData:J}]}const Ee=ee({name:"DeptSelectModal",components:{BasicModal:de,BasicTree:ye},props:Q(G({},ge),{modalTitle:{type:String,default:"部门选择"},maxHeight:{type:Number,default:500},value:b.oneOfType([b.string,b.array])}),emits:["register","getSelectResult"],setup(e,{emit:l,refs:a}){const[y,{closeModal:m}]=he(),p=ae(),r=h(null);let o=e.value===""?[]:e.value,n=Object.assign({},D(e),D(p),{value:o},{disabled:!1});const u=ke(n,"multiple"),g=s(),[{visibleChange:E,checkedKeys:w,getCheckStrictly:d,getSelectTreeData:B,onCheck:O,onLoadData:V,treeData:f,checkALL:K,expandAll:H,onSelect:L}]=De(r,g,u,e),M=h(e.params),J=h([]),I={key:e.rowKey};function t(){B((c,i)=>{l("getSelectResult",c,i),m()})}function s(){let c=e.sync?me:ve;return i=>c(Object.assign({},i,{primaryKey:e.rowKey}))}return{tree:J,handleOk:t,searchInfo:M,treeRef:r,treeData:f,onCheck:O,onSelect:L,checkALL:K,expandAll:H,fieldNames:I,checkedKeys:w,register:y,getBindValue:u,getCheckStrictly:d,visibleChange:E,onLoadData:V}}});function we(e,l,a,y,m,p){const r=S("BasicTree"),o=S("a-menu-item"),n=S("a-menu"),u=S("Icon"),g=S("a-button"),E=S("a-dropdown"),w=S("BasicModal");return j(),te("div",null,[C(w,F(e.$attrs,{onRegister:e.register,title:e.modalTitle,width:"500px",maxHeight:e.maxHeight,onOk:e.handleOk,destroyOnClose:"",onVisibleChange:e.visibleChange}),{insertFooter:k(()=>[C(E,{placement:"top"},{overlay:k(()=>[C(n,null,{default:k(()=>[e.multiple?(j(),X(o,{key:"1",onClick:l[0]||(l[0]=d=>e.checkALL(!0))},{default:k(()=>[$("全部勾选")]),_:1})):Y("",!0),e.multiple?(j(),X(o,{key:"2",onClick:l[1]||(l[1]=d=>e.checkALL(!1))},{default:k(()=>[$("取消全选")]),_:1})):Y("",!0),C(o,{key:"3",onClick:l[2]||(l[2]=d=>e.expandAll(!0))},{default:k(()=>[$("展开全部")]),_:1}),C(o,{key:"4",onClick:l[3]||(l[3]=d=>e.expandAll(!1))},{default:k(()=>[$("折叠全部")]),_:1})]),_:1})]),default:k(()=>[C(g,{style:{float:"left"}},{default:k(()=>[$(" 树操作 "),C(u,{icon:"ant-design:up-outlined"})]),_:1})]),_:1})]),default:k(()=>[C(r,F({ref:"treeRef",treeData:e.treeData,"load-data":e.sync==!1?null:e.onLoadData},e.getBindValue,{onSelect:e.onSelect,onCheck:e.onCheck,fieldNames:e.fieldNames,checkedKeys:e.checkedKeys,multiple:e.multiple,checkStrictly:e.getCheckStrictly}),null,16,["treeData","load-data","onSelect","onCheck","fieldNames","checkedKeys","multiple","checkStrictly"])]),_:1},16,["onRegister","title","maxHeight","onOk","onVisibleChange"])])}const Ke=le(Ee,[["render",we]]),Te=ee({name:"JSelectDept",components:{DeptSelectModal:Ke,JSelectBiz:Ce},inheritAttrs:!1,props:{value:b.oneOfType([b.string,b.array]),multiple:b.bool.def(!0)},emits:["options-change","change","select","update:value"],setup(e,{emit:l,refs:a}){const y=h(),[m,{openModal:p}]=pe(),[r]=Se(e,"value","change",y),o=h([]);let n=x({value:[]});const u=h(!1);z("selectOptions",o),z("selectValues",n),z("loadingEcho",u);const g=h(!1),E=ae();re(()=>{e.value&&d()}),A(()=>e.value,()=>{d()}),A(n,()=>{n&&(r.value=n.value)}),A(o,()=>{o&&l("select",Z(D(o)),Z(D(n)))});function w(){g.value=!0,p(!0,{isUpdate:!1})}function d(){let f=e.value?e.value:[];f&&typeof f=="string"?(r.value=f.split(","),n.value=f.split(",")):n.value=f}function B(f,K){o.value=f,r.value=K,n.value=K,l("update:value",K.join(","))}const O=Object.assign({},D(e),D(E));function V(f){l("update:value",f)}return{state:r,attrs:E,selectOptions:o,selectValues:n,loadingEcho:u,getBindValue:O,tag:g,regModal:m,setValue:B,handleOpen:w,handleChange:V}}});function _e(e,l,a,y,m,p){const r=S("JSelectBiz"),o=S("DeptSelectModal");return j(),te("div",null,[C(r,F({onHandleOpen:e.handleOpen,loading:e.loadingEcho},e.attrs,{onChange:e.handleChange}),null,16,["onHandleOpen","loading","onChange"]),C(o,F({onRegister:e.regModal,onGetSelectResult:e.setValue},e.getBindValue,{multiple:e.multiple}),null,16,["onRegister","onGetSelectResult","multiple"])])}const je=le(Te,[["render",_e],["__scopeId","data-v-a8d1e27c"]]);export{Ke as D,je as J};
