var Ue=Object.defineProperty,We=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Te=(o,c,p)=>c in o?Ue(o,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[c]=p,oe=(o,c)=>{for(var p in c||(c={}))Je.call(c,p)&&Te(o,p,c[p]);if(Se)for(var p of Se(c))Qe.call(c,p)&&Te(o,p,c[p]);return o},ge=(o,c)=>We(o,ze(c));var $=(o,c,p)=>new Promise((h,S)=>{var R=r=>{try{l(p.next(r))}catch(_){S(_)}},m=r=>{try{l(p.throw(r))}catch(_){S(_)}},l=r=>r.done?h(r.value):Promise.resolve(r.value).then(R,m);l((p=p.apply(o,c)).next())});import{u as Re,I as ae,f as M,h as Ge,e as be,r as Ie,k as E,V as N,l as ce,w as Ae,d as Pe,a6 as B,af as re,ai as le,a5 as K,E as Oe,ae as Le,a7 as H,F as ve,am as we,a8 as Me,ak as fe,al as Xe,W as qe,a3 as ol,a4 as rl}from"./vue-vendor-24c7dc61.js";import{i as pe,a0 as Ze,n as Ve,aH as et,m as tt,aC as lt,a8 as nt}from"./antd-vue-vendor-0d72f01e.js";import{B as ot}from"./index-1c3affea.js";import{b1 as rt,a as st,a7 as at,k as se,b2 as it,b3 as ut,b4 as ct,aQ as ft,D as dt,j as pt,l as je,e as mt}from"./index-831af9dd.js";import yt from"./SelectItem-04dd2229.js";import{g as ht}from"./lowAppUtils-56892d30.js";import{p as De,u as gt}from"./auto.desform.api-839115ed.js";import{r as bt,t as vt}from"./desformUtils-c7daaa89.js";import wt from"./LinkRecordTags-cf4c2463.js";import{s as ie}from"./type.definition-4eb605ee.js";import{F as Ct}from"./FormSchemaFactory-ec827fa7.js";import{h as kt}from"./componentMap-c857637c.js";import{u as _t}from"./lowAppAuth-3d637b7d.js";import{u as Ft}from"./useFuncSwitch-b7681246.js";import{g as St}from"./DictColors-73058d23.js";import Tt from"./TableImage-14ca1f5d.js";import Ot from"./SubTableTag-81763fd6.js";import Lt from"./CardCellFile-92b3c8c8.js";const xe={};function Dt(o,c,p){h();function h(){const s="linkRecordSelect";xe[s]||(kt(s,Ye),xe[s]=1)}function S(s){let a=[...Re(o.columnList)||[],...ie.map(t=>ge(oe({},t),{model:t.field}))];if(!a||a.length==0)return"";let e=a.filter(t=>t.model===s);return!e||e.length==0?"":e[0]}function R(s,a){let e=ie.filter(t=>t.field===s.field);return s.field==="create_by"||s.field==="update_by"?{view:"select_user2",multi:!0,store:"username",query:!0,key:s.field,title:e[0].name}:{key:s.field,view:a=="range"?"rangeDate":s.type,title:e[0].name,datetime:!0}}function m(s,a){const{type:e}=s;switch(e){case"radio":return C(s,!1);case"checkbox":return C(s,!0);case"select":return C(s,!1);case"time":return r(s,a);case"date":case"year":case"month":return _(s,a);case"datetime":return d(s,a);case"integer":case"number":case"money":case"rate":case"slider":case"formula":case"summary":return D(s,a);case"select-depart":return F(s);case"select-user":return g(s);case"table-dict":return b(s);case"select-tree":return T(s);case"switch":return y(s);case"link-record":return v(s);case"area-linkage":return w(s);default:return l(s)}}function l(s){return{view:"input",title:s.name}}function r(s,a){return a==="range"?{view:"rangeTime",title:s.name,format:s.format}:{view:"time",title:s.name}}function _(s,a){let e="date";return a==="range"&&(e="rangeDate"),{view:e,timestamp:s.timestamp,title:s.name,type:s.type}}function d(s,a){return a==="range"?{view:"rangeDate",datetime:!0,title:s.name}:{view:"datetime",title:s.name}}function D(s,a){return a==="range"?{view:"rangeNumber",title:s.name}:{view:"input",type:"number",title:s.name}}function F(s){let a=JSON.stringify({multiSelect:s.multiSelect,store:s.rowKey,primaryKey:s.rowKey});return{view:"sel_depart",title:s.name,fieldExtendJson:a}}function g(s){return{view:"select_user2",multi:s.multiSelect,store:s.rowKey,title:s.name,query:!0}}function b(s){const{dictTable:a,dictCode:e,dictText:t,multiple:n,subType:i,scope:O,name:u,model:L}=s;if(i=="select"){if(O=="database")return{view:"list",title:u,dictTable:a,dictCode:e,dictText:t};if(O=="cgreport")return{view:"popup",title:u,code:a,popupMulti:n,orgFields:e,destFields:L}}else if(i=="popup")return{view:"popup",title:u,code:a,popupMulti:n,orgFields:e,destFields:t};return l(s)}function T(s){const{conf:a,dataFrom:e,name:t}=s;if(e=="category")return{view:"cat_tree",title:t,pcode:a.category.code};{let{name:n,code:i,text:O,pidField:u,rootPid:L}=a.table,k=`${n},${O},${i}`;return{view:"sel_tree",title:s.name,dict:k,pidField:u,placeholder:"请选择",pidValue:L}}}function y(s){let a={view:"list",title:s.name,multi:!1};return a.enum=[{value:s.options[0],title:"是"},{value:s.options[1],title:"否"}],a}function v(s){const{multi:a,code:e,titleField:t,name:n}=s;return{view:"LinkTableForQuery",title:n,multi:a,code:e,titleField:t}}function w(s){const{name:a}=s;return{view:"CascaderPcaForQuery",title:a}}function C(s,a){const{remote:e,dictCode:t,options:n,name:i}=s;a||(a=s.multiple);let O={view:"list",title:i,multi:a||!1};return e||(t?O.dictCode=t:O.enum=n.map(u=>({value:u.value,title:u.label||u.title||u.text||u.value}))),O}const P=["create_time","create_by","update_time","update_by"];function Y(s){var L;let a=s.field,e=s.queryType||s.rule,t=S(a);if(["in","not_in"].includes(e)&&(t.multi=!0,t.multiple=!0,t.multiSelect=!0),t.type==="link-record")return X(t,s);if(t.type==="org-role")return z(t,s);let n=m(t,e);P.indexOf(a)>=0&&(n=R(s,e));let i=Ct.createFormSchema(s.field,n);if(i.noChange(),c===!0){i.isInPopover();let k=p||"jee-filter-select-pop";i.setCustomPopContainer(k)}else i.asSearchForm();const O=k=>{s.val=k[s.field]};i.setFunctionForFieldValue(O);let u=i.getFormItemSchema();return u.componentProps=(L=u.componentProps)!=null?L:{},(e==="empty"||e==="not_empty")&&(s.val="",u.componentProps?u.componentProps.disabled=!0:u.componentProps={disabled:!0}),u.component==="UserSelect"&&(u.componentProps.inSuperQuery=!0),n.type=="month"?(u.componentProps.picker=n.type,u.componentProps.valueFormat="YYYY-MM"):n.type=="year"&&(u.componentProps.picker=n.type,u.componentProps.valueFormat="YYYY",u.componentProps.timestamp=n.timestamp),["in","not_in"].includes(e)&&(u.componentProps.mode="multiple",u.componentProps.multi=!0,u.componentProps.multiple=!0),u}function X(s,a){const{model:e,code:t,name:n,multi:i,showFields:O}=s;let u={component:"linkRecordSelect",field:e,componentProps:{code:t,multi:i,titleField:s.titleField,showFields:ae(O),style:{width:"100%"},getContainer:()=>document.body},itemProps:{labelCol:{class:"online-form-label"}},label:n,labelLength:4},L=p||"jee-filter-select-pop";c===!0&&(u.componentProps.getContainer=()=>document.querySelector(`.${L}`));let k=a.queryType||a.rule;return(k==="empty"||k==="not_empty")&&(a.val="",u.componentProps.disabled=!0),u}function z(s,a){const{model:e,multiple:t,name:n}=s;let i={component:"RoleSelect",field:e,componentProps:{multi:t,store:"code",style:{width:"100%"},getContainer:()=>document.body},itemProps:{labelCol:{class:"online-form-label"}},label:n,labelLength:4},O=p||"jee-filter-select-pop";c===!0&&(i.componentProps.getContainer=()=>document.querySelector(`.${O}`));let u=a.queryType||a.rule;return(u==="empty"||u==="not_empty")&&(a.val="",i.componentProps.disabled=!0),i}return{getSchema:Y,getFieldConfig:S}}function xt(){const o=M([]);function c(S){let R=[],m=S.desformDesignJson;if(m){let l=JSON.parse(m),r=l.list,_="";l.config&&l.config.titleField&&(_=l.config.titleField),h(R,r,_)}o.value=R}const p=["button","buttons","grid","card","tabs","text","divider","barcode"];function h(S,R,m){if(R&&R.length>0){for(let l of R)if(l.delFlag!==!0){if(l.type==="sub-table-design"){S.push({name:l.name,key:l.key,model:l.model,type:l.type});continue}if(l.panes&&l.panes.length>0){let r=l.panes;for(let _ of r){let d=_.list;d&&d.length>0&&h(S,d,m)}continue}if(l.columns&&l.columns.length>0)for(let r of l.columns)r.list&&h(S,r.list,m);else if(p.indexOf(l.type)>=0)l.list&&h(S,l.list,m);else{let r={name:l.name,key:l.key,model:l.model,type:l.type,rules:l.rules||[]};m==l.model&&(r.isTitle=!0),l.options&&(r.required=l.options.required,r.unique=l.options.unique,l.type==="formula"&&(l.options.type==="date"?(l.options.mode==="DATEADD"?(l.type="date",l.options.format=l.options.datePrintFormat):l.type="input",l.options.type=l.type,l.options.timestamp=!1):l.type="number",r.type=l.type),l.type=="link-field"&&(r.saveType=l.options.saveType,r.realType=r.type,l.options.fieldType&&(r.type=l.options.fieldType),l.options.fieldOptions&&(l.options=oe(oe({},l.options),l.options.fieldOptions))),l.type=="link-record"?(r.multi=l.options.showMode==="many",r.titleField=l.options.titleField,r.showFields=l.options.showFields,r.code=l.options.sourceCode,r.multiple=l.options.showMode==="many",l.options.showMode=="many"&&l.options.showType=="table"?r.isSubTable=!0:r.isSubTable=l.isSubTable||!1):l.type=="select-depart"||l.type=="select-user"||l.type=="org-role"?(r.rowKey=l.options.customReturnField,r.multiSelect=l.options.multiple,r.multiple=l.options.multiple,r.dataAuthType=l.options.dataAuthType):l.type=="date"?(r.type=l.options.type,r.format=l.options.format,r.timestamp=l.options.timestamp):l.type==="time"?r.format=l.options.format:l.type=="switch"?r.options=[l.options.activeValue,l.options.inactiveValue]:l.type=="select-tree"?(r.dataFrom=l.options.dataFrom,r.conf=l.options.conf,r.multiple=l.options.multiple):(r.dictCode=l.options.dictCode,r.dictTable=l.options.dictTable,r.dictText=l.options.dictText,r.options=l.options.options,l.options.remote===!0&&(r.remote=l.options.remoteFunc,r.props=l.options.props),l.type==="select"&&(l.options.multiple===!0?r.multiple=!0:r.multiple=!1),l.type=="table-dict"&&(r.multiple=l.options.multiple,r.subType=l.options.style,r.scope=l.options.queryScope),["radio","checkbox","select"].includes(l.type)&&l.options.remote!=="dict"&&delete r.dictCode)),S.push(r)}}}}return{columnList:o,initColumnList:c}}function _l(){const o=[{label:"包含",value:"like"},{label:"等于",value:"eq"},{label:"以..开始",value:"right_like"},{label:"以..结尾",value:"left_like"},{label:"在...中",value:"in"},{label:"不等于",value:"ne"},{label:"大于",value:"gt"},{label:"大于等于",value:"ge"},{label:"小于",value:"lt"},{label:"小于等于",value:"le"},{label:"多词匹配",value:"like_with_and"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],c=[{label:"包含",value:"like"},{label:"等于",value:"eq"},{label:"以..开始",value:"right_like"},{label:"以..结尾",value:"left_like"},{label:"在...中",value:"in"},{label:"不等于",value:"ne"},{label:"多词匹配",value:"like_with_and"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],p=[{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"大于",value:"gt"},{label:"大于等于",value:"ge"},{label:"小于",value:"lt"},{label:"小于等于",value:"le"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"},{label:"在范围内",value:"range"}],h=[{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"是其中一个",value:"in"},{label:"不是其中一个",value:"not_in"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],S=[{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"是其中一个",value:"in"},{label:"不是其中一个",value:"not_in"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],R=[...S,{label:"查询工作表",value:"linkage"}],m=[{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"是其中一个",value:"in"},{label:"不是其中一个",value:"not_in"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],l=[{label:"等于",value:"eq"},{label:"不等于",value:"ne"},{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],r=[{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],_=[{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}],d=[{label:"为空",value:"empty"},{label:"不为空",value:"not_empty"}];function D(e,t,n=!1){if(e=="select"&&t===!1)return m;switch(e){case"radio":case"area-linkage":return m;case"switch":return l;case"time":case"year":case"month":case"date":case"datetime":case"integer":case"number":case"money":case"rate":case"slider":case"formula":case"summary":return p;case"select-depart":case"select-user":case"table-dict":case"select-tree":case"org-role":return h;case"checkbox":case"select":return S;case"link-record":return n&&!t?R:S;case"sub-table-design":return r;case"map":case"location":return _;case"color":case"markdown":case"imgupload":case"file-upload":return d;default:return c}}function F(e){switch(e){case"radio":case"switch":case"time":case"year":case"month":case"date":case"datetime":case"integer":case"number":case"money":case"checkbox":case"select":case"select-depart":case"select-user":case"org-role":case"table-dict":case"select-tree":case"link-record":case"area-linkage":case"rate":case"slider":case"formula":case"summary":return"eq";case"map":case"location":case"sub-table-design":case"color":case"markdown":case"imgupload":case"file-upload":return"empty";default:return"like"}}function g(e){const t=["select","radio","checkbox","link-record"];return e=="slider"||e=="rate"?0:t.indexOf(e)>=0?[]:""}function b(e){let t=o.filter(n=>n.value===e);return t.length==0&&(t=p.filter(n=>n.value===e)),t.length==0&&(t=h.filter(n=>n.value===e)),t.length==0&&(t=S.filter(n=>n.value===e)),t.length==0&&(t=m.filter(n=>n.value===e)),t.length==0?e:t[0].label}function T(e,t,n){if(!Array.isArray(e)||e.length==0)return!0;let i=!0;for(const O of e){const{matchType:u,queryItems:L}=O;if(u==="and"?i=v(L,n):u==="or"&&(i=w(L,n)),t==="and"&&!i)return!1;if(t==="or"&&i)return!0}return i}function y(e,t,n){return!e||e.length==0?!0:t==="and"?v(e,n):t==="or"?w(e,n):!1}function v(e,t){let n=!0;for(let i of e){let{field:O,rule:u,val:L}=i,k=!1;if(u&&(k=a(u,L,t[O])),n=k&&n,n===!1)break}return n}function w(e,t){let n=!1;for(let i of e){let{field:O,rule:u,val:L}=i,k=!1;if(u&&(k=a(u,L,t[O])),n=k||n,n===!0)break}return n}function C(e,t){let n=[];t instanceof Array?n=[...t]:n=t.split(",");for(let i of n)if(e.indexOf(i)>=0)return!0;return!1}function P(e,t){if(t instanceof Array)return e>=t[0]&&e<=t[1];{let n=t.split(",");return e>=n[0]&&e<=n[1]}}function Y(e,t){let n=[];t instanceof Array?n=[...t]:n=t.split(",");for(let i of n)if(e.indexOf(i)>=0)return!0;return!1}function X(e){return e===0?!1:e instanceof Array?e.length==0:!e}function z(e){return e===0?!0:e?e instanceof Array?e.length>0:!0:!1}function s(e,t){let n=Array.isArray(t)?t:t.split(",");if(e instanceof Array&&e.length==1){let i=e[0];if(n.indexOf(i)>=0)return!0}else if(n.indexOf(e)>=0)return!0;return!1}function a(e,t,n){switch(t=rt(t),t==null&&(t=""),n==null&&(n=""),e){case"like":return n.indexOf(t)>=0;case"eq":return t==n;case"right_like":return n.startsWith(t);case"left_like":return n.endsWith(t);case"in":return s(n,t);case"ne":return n!=t;case"gt":return n>t;case"ge":return n>=t;case"lt":return n<t;case"le":return n<=t;case"like_with_and":return C(n,t);case"empty":return X(n);case"not_empty":return z(n);case"range":return P(n,t);case"elemMatch":return Y(n,t);default:return!1}}return{getConditionOptions:D,getDefaultRule:F,getDefaultVal:g,getTypeLabel:b,ifTrue:y,ifGroupTrue:T}}function Fl(o,c,p){let h="";const S=M([]),{getItem:R}=Rt(S);Ge(()=>$(this,null,function*(){let g=o.dynamicConfig,b=p.value;g.lineHeight&&(yield de(c.getTableRef()),c.setProps({size:g.lineHeight})),m(g),b.length>0&&d(g)}));function m(g){g.autoRefresh>0?(h&&clearInterval(h),h=setInterval(()=>$(this,null,function*(){yield de(c.getTableRef()),c.reload()}),g.autoRefresh*1e3)):h&&clearInterval(h)}function l(g){let b=ae(p.value),T=g.showColumnList;if(T&&T.length>0){let v=T.filter(w=>w.show==!1).map(w=>w.field);b=b.filter(w=>v.indexOf(w.key)<0)}let y=g.systemColumnList;if(y&&y.length>0){let v=y.filter(C=>C.show==!1).map(C=>C.field);b=b.filter(C=>v.indexOf(C.key)<0);let w=y.filter(C=>C.show==!0).map(C=>C.field);for(let C of w)if(!F(C,b)){let P=D(C,ie);b.push(P)}}return b}function r(g){let b=ae(p.value),T=g.columnList;if(T&&T.length>0){let y=[],v=[],w=g.showColumnList;w&&w.length>0&&(v=w.filter(C=>C.show==!1).map(C=>C.field)),T.sort(function(C,P){return C.seq-P.seq});for(let C=0;C<T.length;C++){let P=T[C].field;if(v.indexOf(P)<0&&T[C].show==!0){let{temp:Y}=R(P,b);Y&&y.push(Y)}}return y}else return b}const _=M([]);function d(g){return $(this,null,function*(){yield de(c.getTableRef());let b=[];g.showColumn=="default"||!g.showColumn?b=l(g):g.showColumn=="diy"&&(b=r(g));let T=window.innerWidth-530,y=0;for(let v of b)y+=v.width;y<T&&b.length>0&&delete b[b.length-1].width,c.setColumns(b),_.value=b})}function D(g,b){let T=b.filter(y=>y.field==g);return Be(T[0])}function F(g,b){let T=!1;for(let y of b)y.key==g&&(T=!0);return T}return{tableColumns:_}}function de(o){return new Promise(c=>{(function p(){let h=o.value;h?c(h):setTimeout(()=>{p()},100)})()})}function Rt(o){function c(m,l){let r=!1;if(m.showColumn=="default"){let _=o.value,d=m.systemColumnList;if(d&&d.length>0){let D=d.filter(F=>F.show==!0).map(F=>F.field);for(let F of D)if(!R(F,l)){let b=ie.filter(T=>T.field==F)[0];_.push(b.field),r=!0,l.push({label:b.name,value:b.field})}}o.value=_}else if(m.showColumn=="diy"){let _=[],d=o.value,D=m.columnList;if(D){D.sort(function(F,g){return F.seq-g.seq}),D.filter(F=>F.show==!0).length!=l.length&&(r=!0);for(let F=0;F<D.length;F++){let g=D[F].field;D[F].show===!0?d.push(g):d=d.filter(y=>y!=g);let{temp:b,index:T}=h(g,l);_.push(b),T!=F&&(r=!0)}}_.length>0&&(l=_),o.value=d}return{hasChange:r,newOptions:l}}const p=[{name:"创建时间",show:!1,field:"create_time",type:"date",seq:100},{name:"创建人",show:!1,field:"create_by",type:"input",seq:101},{name:"修改时间",show:!1,field:"update_time",type:"input",seq:102},{name:"修改人",show:!1,field:"update_by",type:"input",seq:103},{name:"流程状态",show:!1,field:"bpm_status",type:"select",seq:104}];function h(m,l){let r="",_=-1;for(let d=0;d<l.length;d++)if(m===l[d].value||m===l[d].key){r=l[d],_=d;break}if(!r)for(let d=0;d<p.length;d++){let D=p[d];if(m===D.field){r=Be(D);break}}return{index:_,temp:r}}function S(m,l){if(m.showColumn=="default"){let r=m.systemColumnList;if(r&&r.length>0){let _=r.filter(d=>d.show==!0).map(d=>d.field);for(let d of _)if(!R(d,l)){let D=ie.filter(g=>g.field==d),F={key:D[0].field,title:D[0].name,align:"center",sorter:!0,dataIndex:D[0].field};(F.key=="create_time"||F.key=="update_time")&&(F.customRender=({text:g})=>g?pe(g).format("YYYY-MM-DD HH:mm:ss"):""),l.push(F)}}}else if(m.showColumn=="diy"){let r=[],_=m.columnList;if(_){_.sort(function(d,D){return d.seq-D.seq});for(let d=0;d<_.length;d++){let D=_[d].field;if(_[d].show==!0){let{temp:F}=h(D,l);r.push(F)}}}l=r}return l}function R(m,l){let r=!1;for(let _ of l)(_.value==m||_.key==m)&&(r=!0);return r}return{addOptions:c,addColumns:S,getItem:h}}function Be(o){let c=o,p={key:c.field,title:c.name,align:"center",sorter:!0,width:["date","datetime"].includes(c.type)?200:150,dataIndex:c.field};return p.key=="create_time"||p.key=="update_time"?p.customRender=({text:h})=>h?pe(h).format("YYYY-MM-DD HH:mm:ss"):"":p.customRender=({text:h,record:S})=>h?S[p.dataIndex+"_dictText"]:"",p}function It(o){const{columnList:c,initColumnList:p}=xt(),{getSchema:h}=Dt({columnList:c});function S(m,l){return $(this,null,function*(){let r=m.queryList,_=m.queryButton,d=yield R(r,l);yield de(o.getTableRef());let D=!0;if(_===!1&&(D=!1),d&&d.length>0){let F={labelWidth:120,schemas:d,autoAdvancedCol:3,showResetButton:D,showSubmitButton:D,autoSearch:!D,actionColOptions:{style:{textAlign:"left",paddingLeft:"10px"}}};o.setProps({formConfig:F,useSearchForm:!0})}else o.setProps({formConfig:{schemas:[]},useSearchForm:!1})})}function R(m,l){return $(this,null,function*(){p(l);let r=[];if(m&&m.length>0)for(let _ of m){let d=h(_);r.push(ge(oe({},d),{colProps:{span:6}}))}return r})}return{reloadSearchFormSchema:S}}function $e(o,c,p){const{createMessage:h}=st(),S=M([]),R=new Map,m=M({}),l=M({}),r=M({}),{reloadSearchFormSchema:_}=It(c.tableAction),d=_t(),{allowFuncList:D}=Ft(),F=Ie({dictCountList:[],total:0,treeModel:{}}),g=at();function b(e){return $(this,null,function*(){const t="/desform/auth/query/"+e,n=yield se.get({url:t});let i=[];if(n&&n.length>0){const u="/desform/auth/queryUser/"+g.getUserInfo.username,L=yield se.get({url:u}),{departs:k,roles:j,userInfo:Z}=L;for(let J of n)if(J.permissionType=="field"&&J.authType=="1"&&J.authScopeIsAll==="N"){let te=J.authScopeUsersVal,V=!1;if(te){let Q=te.split(",");Z&&Z.username&&Q.indexOf(Z.username)>=0&&(V=!0)}let ne=J.authScopeRolesVal;if(ne){let Q=ne.split(",");if(j&&j.length>0){for(let G=0;G<Q.length;G++)if(j.indexOf(Q[G])>=0){V=!0;break}}}let ue=J.authScopeDepartsVal;if(ue){let Q=ue.split(",");if(k&&k.length>0){for(let G=0;G<Q.length;G++)if(k.indexOf(Q[G])>=0){V=!0;break}}}V===!1&&i.push(J.authComKey)}}return i})}function T(e,t,n){return $(this,null,function*(){var Ce;let i={};o.dynamicConfig&&o.dynamicConfig.id&&(i.listViewId=o.dynamicConfig.id);const O=yield b(e);let{designForm:u,buttonsAuth:L,listView:k,allowFunc:j}=yield De.getColumns(e,i);if(Array.isArray(j)&&(D.value=j),o.notBaseList!==1&&(t?o.buttonsAuth.value=t:o.buttonsAuth.value=L,o.desformCode.value=u.desformCode,o.desformName.value=u.desformName,u.desformType===2))return o.desformCode.value=u.parentCode,T(u.parentCode,L);let Z=u.desformDesignJson;if(Z==null){p.notDesignForm=!0;return}let J=JSON.parse(Z);S.value=[],R.clear(),m.value={};const te={},V=["select","radio","checkbox"],ne=[];let ue=d.getExcludeFields(e)||[],Q=d.getLowAppAdminAuth();const G=f=>O.indexOf(f)>=0?!1:Q===!0?!0:ue.indexOf(f)<0;let Ee=1;const Ke=f=>{var ke;if(f.delFlag===!0||y(f))return;if(["button","buttons","grid","card","tabs","text","divider","barcode"].indexOf(f.type)===-1&&G(f.key)){let I=f.options,_e=f.name.trim()||f.model,A={key:f.key,title:_e,ellipsis:!0,align:"center",sorter:{multiple:Ee++},width:190,dataIndex:f.model,compType:f.type};f.type==="link-record"&&(I.showMode=="many"&&I.showType=="table"?A.isSubTable=!0:A.isSubTable=f.isSubTable||!1),f.type==="link-field"&&(A.saveType=f.options.saveType),f.key==="bpmStatus"&&(A.ifShow=!1);let ee=f.type;if(f.type==="link-field"&&f.options&&f.options.fieldType&&["rate","slider","color","imgupload","file-upload"].includes(f.options.fieldType)&&(f.type=f.options.fieldType,A.compType=f.options.fieldType,A.dataIndex=f.model+"_dictText"),V.includes(f.type))for(let x=0;x<V.length;x++){let{remote:q,remoteFunc:U}=I;q===!0&&U&&(it(ne,f),A.customRender=({text:W})=>ut(o.remoteOptionsMap.value[f.key],W))}else if(f.type==="imgupload")A.slots={customRender:"view-picture"};else if(f.type==="file-upload")A.slots={customRender:"view-file"};else if(f.type==="sub-table-design")A.slots={customRender:"view-sub-table"};else if(f.type==="switch")A.customRender=({text:x})=>{let q=I.activeValue||!0;return E(N("a-switch"),{size:"small",checked:x===q,disabled:!0},null)};else if(f.type==="slider"){ee="number";let{min:x,max:q}=I;A.customRender=({text:U})=>E(N("a-slider"),{value:U,min:x,max:q,disabled:!0,style:"margin:0;"},null)}else if(f.type==="rate"){ee="number";let{max:x,allowHalf:q}=I;A.customRender=({text:U})=>{let W=parseInt(U);return E(N("a-rate"),{value:W,count:x,allowHalf:q,disabled:!0,style:"margin:0;font-size: 16px;"},null)}}else f.type==="color"?A.slots={customRender:"view-color"}:f.type==="link-record"?(l.value[f.key]=f,r.value[f.options.sourceCode]=[],A.customRender=({text:x,record:q})=>s(x,q,f)):f.type==="date"&&(A.customRender=({text:x,record:q})=>{const U=f.model+"_dictText";if(q[U])return q[U];if(I.timestamp&&x!=null&&x!==""){I.format=I.format.replace(/yyyy/g,"YYYY"),I.format=I.format.replace(/dd/g,"DD");const W=He=>pe(He).format(I.format);return Array.isArray(x)?x.map(W).join(","):W(x)}return x});S.value.push(A),R.set(A.key,A);let ye=null;if(f.type==="input"&&Array.isArray(f.rules)&&f.rules.length>0){for(let x of f.rules)if(["number","integer","float"].includes(x.type)){ee="number";break}}f.type==="money"&&(ee="number"),f.type==="integer"&&(ee="number"),f.type==="date"&&(I.type==="datetime"&&(ee="datetime"),ye=I.format),f.type==="time"&&(ye=I.format),Array.isArray(I.options)&&I.options.length>0&&I.options.forEach(x=>{x.label=x.label?x.label:x.value}),!A.customRender&&!((ke=A.slots)!=null&&ke.customRender)&&(A.customRender=({record:x})=>{let q=f.model,U=q+"_dictText";x.hasOwnProperty(U)&&(q=U);let W=x[q];return(W==null||W==="")&&(W=x[f.model]),a(f,x,W)});let he=I.remote===!0&&I.remoteFunc,Fe=m;if(/#/.test(f.model)){let x=f.model.split("#")[0],q=te[x]||{};te[x]=q,Fe=q}Re(Fe)[f.model]={view:ee,title:_e,dictCode:I.remote==="dict"?I.dictCode:null,dictTable:I.dictTable,remoteOptionsKey:he?f.key:null,options:he?[]:I.options,timestamp:he?[]:I.timestamp,customReturnField:I.customReturnField,formatStr:ye,formatValue:x=>f.type==="date"&&I.timestamp?pe(x).toDate().getTime():x}}};return bt(J.list,(f,me)=>{me&&me.type==="sub-table-design"||Ke(f)}),w(ne),C(te),o.notBaseList!==1&&(yield _(k,u),c.tableAction.setProps({immediate:!1}),(((Ce=k.queryList)==null?void 0:Ce.length)===0||!k.waitQuery||n)&&(yield c.loadData(o.desformCode.value)),F.dictCountList=k.dictCountList,F.total=k.total,F.treeModel=k.treeModel),k})}function y(e){if(["link-record"].includes(e.type)){const{options:{sourceIsDelete:t}}=e;return t===!0}return!1}function v(){if(ht()){let e="bpmStatus",t={title:"流程状态",key:e,dataIndex:"_record.bpmStatus_dictText",width:100};S.value.push(t),R.set(e,t)}}function w(e){e.forEach(t=>$(this,null,function*(){let{key:n,options:i}=t,{remoteFunc:O,props:u}=i;O=O.trim();let L;/^https?/.test(O)?L=yield vt.get({url:O},{isTransformResponse:!1}):L=yield se.get({url:O},{isTransformResponse:!1});let k=null;if(Array.isArray(L)?k=L:L.success&&(Array.isArray(L.result)?k=L.result:L.result&&Array.isArray(L.result.records)&&(k=L.result.records)),k==null)return Promise.reject(L);k=k.map(j=>({value:j[u.value],label:j[u.label],text:j[u.label]})),o.remoteOptionsMap.value[n]=k;for(let[,j]of Object.entries(m.value))if(j.remoteOptionsKey===n){j.options=k;break}}))}function C(e){return $(this,null,function*(){let t=Object.keys(e);if(t.length>0){let n=yield P(t);for(const i of t)m[i]={view:"table",title:n.has(i)?n.get(i):i,fields:e[i],onlyFieldName:!0}}})}function P(e){return $(this,null,function*(){let t=new Map;try{let n="onl_cgform_head,table_txt,table_name",i=` (table_name = '${e.join("' or table_name = '")}')`,{success:O,result:u,message:L}=yield ct(`${n},${i}`,!1);if(O)for(let k of u)t.set(k.value,k.text);else h.warn("查询附表名失败："+(L||"未知错误"))}catch(n){h.warn("查询附表名失败："+n.message)}return t})}let Y=new Map;const X=ft((e,t)=>{for(let[n,i]of Y.entries())z(n,i,e,t)},100);function z(e,t,n,i){return $(this,null,function*(){if(!t||t.length===0)return;let O=yield De.list({desformCode:e,id:t.join(","),pageSize:t.length,translInData:!0});if(!O.success){if(O.code===404){i.options.sourceIsDelete=!0,S.value=S.value.filter(u=>u.key!==i.key);try{gt(n,{model:i.model},"update",{options:{sourceIsDelete:!0}})}catch(u){}}else h.warn(O.message);return}for(const u of O.result.records){let L=JSON.parse(u.desformDataJson);r.value[e].push({id:u.id,fields:L});let k=Y.get(e);k.splice(k.indexOf(u.id),1)}})}function s(e,t,n){if(!e||e.length==0)return"";e instanceof Array||(e=e.split(",")),e=e.filter(k=>!!k);let i;const{options:{sourceCode:O},model:u}=n,L=u+"_dictRecords";return Array.isArray(t[L])?i=t[L]:i=e.map(k=>({id:k,text:k})),ce(wt,{records:i,onOpen(k){c.openLinkRecord(O,k)}})}function a(e,t,n){if(["select","radio","checkbox"].indexOf(e.type)!=-1){let O=t[e.model+"_dictColor"];if(!O||O.length==0){if(Array.isArray(n))return n.join(",")}else if(O){let u=[],L=O.split(","),k=n.split(",");for(let j=0;j<k.length;j++){let Z=St(L[j]);u.push(ce(Ze,{color:L[j],style:{"margin-left":"5px",color:Z}},()=>k[j]))}return ce("div",u)}}else if(Array.isArray(n))return n.join(",");return n}return{allColumns:S,allColumnKeys:R,superQueryFields:m,loadColumnsInfo:T,linkRecordDataMap:r}}function At(o){return new Promise(c=>{(function p(){let h=o.value;h?c(h):setTimeout(()=>{p()},100)})()})}const Sl=Object.freeze(Object.defineProperty({__proto__:null,getRefPromise:At,useColumns:$e},Symbol.toStringTag,{value:"Module"}));function Pt(o,c){const p=M([]),h=M(0),S=M(1),R=M(""),m=M([]),l=M({}),r=M({}),_=M(),d=M(""),D={setProps(){}},F=Ie({notDesignForm:!1}),{allColumns:g,allColumnKeys:b,loadColumnsInfo:T}=$e({desformCode:d,translData:l,remoteOptionsMap:r,desformName:_,notBaseList:1},{loadData:y,openLinkRecord:v,tableAction:D},F);function y(){}function v(){}Ae(()=>o.code,a=>$(this,null,function*(){a&&(d.value=a,yield T(a),C(),c===!0&&(yield w()))}),{immediate:!0});function w(a){return $(this,null,function*(){const e="/desform/data/list";a&&(S.value=a);const t={order:"desc",column:"createTime",desformCode:o.code,pageNo:S.value};R.value&&(t.global_keyword=R.value);const n=yield se.get({url:e,params:t},{isTransformResponse:!1});n.success?(p.value=n.result.records,h.value=n.result.total):(h.value=0,p.value=[])})}function C(){let a=[];if(o.showFields&&o.showFields.length>0){let e=g.value;for(let t of o.showFields)for(let n of e)(n.dataIndex===t||n.key===t)&&a.push({model:n.dataIndex,compType:n.compType,title:n.title})}m.value=a}function P(a,e){let t=g.value,n=a[e];if(n===0)return 0;if(!n)return"";for(let i of t)if(i.dataIndex===e){i.customRender&&(n=i.customRender({text:n,record:a}));break}return n}function Y(a,e){let t=g.value,n=a[e];if(n!==0&&!n)return ce("span");for(let i of t)if(i.dataIndex===e){i.customRender&&(n=i.customRender({text:n,record:a}));break}return n}const X=["slider","rate","switch","link-record"];function z(a,e){let t=e.desformData[a.model];return t!==0&&!t?!1:X.indexOf(a.compType)>=0}function s(){w(1)}return{filterValue:R,pageNo:S,getFieldValue:P,isComponent:z,showFieldList:m,onLoadData:w,dataList:p,allColumnKeys:b,totalRecord:h,allColumns:g,getComponentValue:Y,onChangeFilter:dt(s,350)}}const Mt=tt,qt=Pe({name:"SelectModal",components:{BasicModal:ot,APagination:Mt,SearchOutlined:Ve,CheckOutlined:et,TableImage:Tt,CardCellFile:Lt,SubTableTag:Ot},props:{code:{type:String,default:""},titleField:{type:String,default:""},showFields:{type:Array,default:()=>[]},multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null}},emits:["selected","register"],setup(o,{emit:c}){const{pageNo:p,totalRecord:h,dataList:S,filterValue:R,onLoadData:m,showFieldList:l,getFieldValue:r,getComponentValue:_,isComponent:d,onChangeFilter:D}=Pt(o,!0),[F,{closeModal:g}]=pt(a=>{let e=a.list;e.length>0?(b.value=e.map(t=>t.value),T.value=e):(b.value=[],T.value=[])}),b=M([]),T=M([]);function y(a,e){a.preventDefault(),a.stopPropagation();let t=b.value,n=t.indexOf(e.id);n>=0?(t.splice(n,1),b.value=t,X(e,n)):(o.multi===!1?b.value=[e.id]:(t.push(e.id),b.value=t),z(e))}function v(){m()}function w(){let a=ae(T.value);c("selected",a),g()}function C(){g()}const P=M(300);P.value=window.innerHeight-200;function Y(a){return a.desformData[o.titleField]}function X(a,e){let t=T.value;if(t[e].id===a.id)t.splice(e,1);else{for(let i=0;i<t.length;i++)if(t[i].id===a.id){e=i;break}t.splice(e,1)}T.value=t}function z(a){let e=T.value;o.multi===!1&&(e=[]);let t=Y(a);e.push({value:a.id,label:t}),T.value=e}function s(a){return b.value.indexOf(a.id)>=0?"data-item selected":"data-item"}return{getDataItemClass:s,register:F,pageNo:p,totalRecord:h,onPageChange:v,onCancel:C,onOk:w,onLoadData:m,filterValue:R,dataList:S,maxHeight:P,getTitle:Y,onSelect:y,onChangeFilter:D,showFieldList:l,getFieldValue:r,isComponent:d,getComponentValue:_}}});const jt=["onClick"],Bt={class:"selected-icon"},$t={class:"title ellipsis-text"},Nt={class:"others"},Yt={class:"label ellipsis-text"},Et={class:"value"},Kt={key:1},Ht={key:2},Ut={key:3},Wt={key:5},zt={style:{display:"flex","justify-content":"space-between",width:"100%"}},Jt={class:"page-info"};function Qt(o,c,p,h,S,R){const m=N("SearchOutlined"),l=N("a-input"),r=N("CheckOutlined"),_=N("TableImage"),d=N("card-cell-file"),D=N("sub-table-tag"),F=N("a-tooltip"),g=N("a-empty"),b=N("a-pagination"),T=N("a-button"),y=N("BasicModal");return B(),re(y,{onRegister:o.register,canFullscreen:!1,title:"选择记录",width:800,centered:"",destroyOnClose:"",getContainer:o.getContainer,wrapClassName:"link-record-select-modal"},{footer:le(()=>[K("div",zt,[K("div",Jt,[E(b,{current:o.pageNo,"onUpdate:current":c[1]||(c[1]=v=>o.pageNo=v),size:"small",total:o.totalRecord,"show-quick-jumper":"",onChange:o.onPageChange},null,8,["current","total","onChange"])]),K("div",null,[E(T,{onClick:o.onCancel},{default:le(()=>[Oe("取 消")]),_:1},8,["onClick"]),E(T,{type:"primary",onClick:o.onOk},{default:le(()=>[Oe("确 定")]),_:1},8,["onClick"])])])]),default:le(()=>[E(l,{placeholder:"搜索关键字",class:"my-input",value:o.filterValue,"onUpdate:value":c[0]||(c[0]=v=>o.filterValue=v),onPressEnter:o.onLoadData,onChange:o.onChangeFilter},{prefix:le(()=>[E(m,{style:{color:"#c0c0c0"}})]),_:1},8,["value","onPressEnter","onChange"]),K("div",{class:"link-record-select-list",style:Le({height:o.maxHeight+"px"})},[(B(!0),H(ve,null,we(o.dataList,v=>(B(),H("div",{class:Me(o.getDataItemClass(v)),onClick:w=>o.onSelect(w,v)},[K("div",Bt,[E(r)]),K("div",$t,fe(o.getTitle(v)),1),(B(!0),H(ve,null,we(o.showFieldList,w=>(B(),H("div",Nt,[K("div",Yt,fe(w.title),1),K("div",Et,[o.isComponent(w,v)?(B(),re(Xe(o.getComponentValue(v.desformData,w.model)),{key:0})):w.compType=="imgupload"?(B(),H("div",Kt,[E(_,{text:o.getFieldValue(v.desformData,w.model)},null,8,["text"])])):w.compType=="file-upload"?(B(),H("div",Ht,[E(d,{text:o.getFieldValue(v.desformData,w.model)},null,8,["text"])])):w.compType=="sub-table-design"?(B(),H("div",Ut,[E(D,{text:o.getFieldValue(v.desformData,w.name)},null,8,["text"])])):w.compType=="color"&&v.desformData[w.model]?(B(),re(F,{key:4,placement:"top",title:o.getFieldValue(v.desformData,w.model),getPopupContainer:C=>C==null?void 0:C.parentNode},{default:le(()=>[K("div",{style:Le({width:"20px",height:"20px",backgroundColor:o.getFieldValue(v.desformData,w.model)})},null,4)]),_:2},1032,["title","getPopupContainer"])):(B(),H("span",Wt,fe(o.getFieldValue(v.desformData,w.model)),1))])]))),256))],10,jt))),256)),o.dataList.length==0?(B(),re(g,{key:0})):qe("",!0)],4)]),_:1},8,["onRegister","getContainer"])}const Ne=je(qt,[["render",Qt]]),Tl=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),Gt=Pe({name:"LinkRecordSelect",components:{PlusOutlined:lt,SelectItem:yt,SelectModal:Ne},props:{value:{type:[String,Array],default:""},multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},maxCount:{type:Number,default:2},titleField:{type:String,default:""},code:{type:String,default:""},showFields:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:value","change"],setup(o,{emit:c}){const p=nt.useInjectFormItemContext(),h=M([]),S=be(()=>{let y=o.maxCount,v=h.value.length;return v>y?{status:!0,count:v-y}:{status:!1}}),R=be(()=>{let y=h.value,v=o.maxCount;return y.length<=v?y:y.filter((w,C)=>C<v)}),[m,{openModal:l}]=mt();function r(y){y.preventDefault(),y.stopPropagation(),_()}function _(){if(o.disabled===!0)return;let y=ae(h.value);l(!0,{list:y})}function d(y){let v=h.value,w=v.findIndex(C=>C.value===y);v.splice(w,1),h.value=v,g()}function D(y){h.value=y,g()}const F=M(!0);function g(){F.value=!1;let y=h.value;if(y.length>0){let w=y.map(C=>C.value).join(",");c("update:value",w),c("change",w)}else c("update:value",""),c("change","");p.onFieldChange()}const b=be(()=>{let{value:y}=o;return y&&y.length>0?Array.isArray(y)?y.join(","):y:""});Ae(b,y=>$(this,null,function*(){if(F.value===!0){let v=[];if(y&&y.length>0){const w=yield T(y);for(let C of w)v.push({label:C.desformData[o.titleField],value:C.id})}h.value=v}F.value=!0}),{immediate:!0});function T(y){return $(this,null,function*(){const v="/desform/data/list",w={desformCode:o.code,id:y},C=yield se.get({url:v,params:w},{isTransformResponse:!1});if(C.success){let P=C.result.records;if(P&&P.length>0)return P}return[]})}return{selectList:h,showList:R,click2Add:r,unSelect:d,onSelected:D,registerModal:m,ellipsisInfo:S}}});const Xt={key:1,style:{height:"30px","line-height":"30px",display:"inline-block","margin-left":"7px",color:"#bfbfbf"}},Zt={key:2,class:"user-selected-item"},Vt={class:"user-select-ellipsis"},el={style:{color:"red"}};function tl(o,c,p,h,S,R){const m=N("SelectItem"),l=N("select-modal");return B(),H("div",null,[K("div",{onClick:c[0]||(c[0]=(...r)=>o.click2Add&&o.click2Add(...r)),class:Me(o.disabled?"link-record-container disabled":"link-record-container")},[o.selectList.length>0?(B(!0),H(ve,{key:0},we(o.showList,r=>(B(),re(m,{info:r,onUnSelect:o.unSelect,titleField:o.titleField},null,8,["info","onUnSelect","titleField"]))),256)):(B(),H("span",Xt,"请选择")),o.ellipsisInfo.status?(B(),H("div",Zt,[K("div",Vt,[K("span",el,"+"+fe(o.ellipsisInfo.count)+"...",1)])])):qe("",!0)],2),E(l,{onRegister:o.registerModal,onSelected:o.onSelected,code:o.code,titleField:o.titleField,showFields:o.showFields,multi:o.multi,getContainer:o.getContainer},null,8,["onRegister","onSelected","code","titleField","showFields","multi","getContainer"])])}const Ye=je(Gt,[["render",tl],["__scopeId","data-v-1b171be7"]]),Ol=Object.freeze(Object.defineProperty({__proto__:null,default:Ye},Symbol.toStringTag,{value:"Module"}));export{Ye as L,Tl as S,$e as a,xt as b,Dt as c,Fl as d,It as e,Pt as f,At as g,Rt as h,Sl as i,Ol as j,_l as u};
