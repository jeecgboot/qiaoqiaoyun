var $o=Object.defineProperty,Ao=Object.defineProperties;var Lo=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var No=Object.prototype.hasOwnProperty,Oo=Object.prototype.propertyIsEnumerable;var xe=(n,r,o)=>r in n?$o(n,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[r]=o,Y=(n,r)=>{for(var o in r||(r={}))No.call(r,o)&&xe(n,o,r[o]);if(Se)for(var o of Se(r))Oo.call(r,o)&&xe(n,o,r[o]);return n},Z=(n,r)=>Ao(n,Lo(r));var _=(n,r,o)=>new Promise((M,C)=>{var H=w=>{try{I(o.next(w))}catch(v){C(v)}},S=w=>{try{I(o.throw(w))}catch(v){C(v)}},I=w=>w.done?M(w.value):Promise.resolve(w.value).then(H,S);I((o=o.apply(n,r)).next())});import{d as Oe,f as t,V as h,a6 as u,af as p,ai as a,a5 as f,k as l,ak as oe,u as b,E as te,a3 as Po,a4 as To,e as d,r as Be,n as $e,h as Ae,c as Ho,a7 as j,W as m,a8 as ee,F as Le,am as Vo,ae as qo,ag as Eo}from"./vue-vendor-24c7dc61.js";import{j as Pe,a as Te,cH as jo,l as Uo,H as g,h as Go,e as Ne,cm as Wo,k as U,bI as zo}from"./index-831af9dd.js";import{B as He}from"./index-1c3affea.js";import{C as Qo}from"./CommentPanel-4027e3d7.js";import{c as Jo}from"./useCustomButton-fa741dda.js";import{Q as Ko}from"./index-8553d60f.js";import{u as Xo}from"./lowAppAuth-3d637b7d.js";import{a as Yo}from"./useAuth-d62eecf0.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./UserSelectModal-d78c1490.js";import"./useComment-c2ce47e3.js";import"./index-d508f1f4.js";import"./index-4b5608cc.js";import"./FileList.api-9749c044.js";import"./JUpload-76e119c7.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./Qrcode-8252d989.js";const Ve=n=>(Po("data-v-4731cb38"),n=n(),To(),n),Zo={class:"share-item"},et=Ve(()=>f("div",{class:"share-item-title"},"内部成员访问",-1)),ot=Ve(()=>f("div",{class:"share-item-desc"},[f("span",null,"只有应用成员登录后才能根据权限访问")],-1)),tt={class:"href-box"},nt=["title"],at={style:{"text-align":"center",position:"absolute",left:"0",right:"0",bottom:"0"}},lt=Oe({__name:"ShareRecordModal",setup(n){const r=t(),{createMessage:o}=Te(),[M]=Pe(H),C=t("");function H(v){C.value=v.href}function S(){window.open(C.value,"_blank")}function I(){return _(this,null,function*(){jo(C.value)?o.success("复制成功"):prompt("复制失败，请手动复制",C.value)})}function w(){const v=b(r);v&&v.download("分享二维码-"+new Date().getTime()+".png")}return(v,y)=>{const k=h("Icon"),A=h("a-tooltip"),c=h("a-button"),L=h("a-popover"),D=h("a-space");return u(),p(b(He),{title:"分享记录",width:"580px",canFullscreen:!1,footer:null,minHeight:120,destroyOnClose:"",onRegister:b(M)},{default:a(()=>[f("div",Zo,[et,ot,l(D,{class:"share-item-content"},{default:a(()=>[f("div",tt,[f("div",{class:"href-left",title:C.value},oe(C.value),9,nt),l(A,{title:"新页面打开"},{default:a(()=>[f("div",{class:"href-right",onClick:S},[l(k,{icon:"ic:round-launch"})])]),_:1})]),l(A,{title:"复制"},{default:a(()=>[l(c,{preIcon:"ant-design:copy",onClick:I})]),_:1}),l(L,{placement:"bottom",overlayClassName:"share-record-qrcode-popover"},{content:a(()=>[l(b(Ko),{ref_key:"qrRef",ref:r,value:C.value},null,8,["value"]),f("div",at,[l(c,{type:"link",onClick:w},{default:a(()=>[te("点击下载")]),_:1})])]),default:a(()=>[l(c,{preIcon:"ic:round-qrcode"})]),_:1})]),_:1})])]),_:1},8,["onRegister"])}}});const st=Uo(lt,[["__scopeId","data-v-4731cb38"]]),rt={class:"left-content"},it={key:0,style:{"font-weight":"normal"}},ut={key:1,class:"header-icon-btns",style:{"margin-right":"20px"}},ct={style:{color:"white"}},dt={class:"right-content"},ft={class:"header-icon-btns"},mt=f("span",null,"分享",-1),pt=f("span",null,"复制",-1),vt=f("span",null,"打印",-1),gt=f("span",null,"新页签打开",-1),ht=f("span",null,"删除",-1),_t=f("span",null,"编辑表单",-1);const In=Oe({__name:"DesformViewModal",props:{zIndex:g.number.def(999),defaultFormData:g.object.def({}),widgetConfig:g.array,showComment:g.bool.def(!0),showFiles:g.bool.def(!0),showDataLog:g.bool.def(!0),showRecordCopy:g.bool.def(!0),showRecordShare:g.bool.def(!0),showRecordSysPrint:g.bool.def(!0),showDesignFormBtn:g.bool.def(!0),dynamicConfig:{type:Object,default:()=>{}},index:g.number,total:g.number,inlineMode:g.bool.def(!1),bodyHeight:g.string,closeFunc:g.func},emits:["register","success","close","goto-record","design-form"],setup(n,{emit:r}){const o=n,{prefixCls:M}=Go("desform-view-modal"),{createInfoModal:C,createMessage:H,createConfirmSync:S}=Te(),I=t(),w=t(),v=t(!1),y=t(),k=t("add"),A=t(null),c=t(null),L=t(null),D=t(null),x=t(null),B=t(null),wt=t("rgba(0,0,0,0.6)"),ne=t(!1),ae=t(!1),G=d(()=>k.value==="edit"),R=d(()=>k.value==="add"),qe=d(()=>k.value==="detail"),le=t(!1),se=Be({delete:!1}),N=t(null),re=d(()=>o.showComment&&P("comment_record")),ie=d(()=>o.showFiles&&P("download_record")),ue=d(()=>o.showDataLog&&P("log_record")),Ee=d(()=>{var e;return((e=N.value)==null?void 0:e.enableComment)===!1||!re.value&&!ie.value&&!ue.value?!1:!R.value&&c.value!=null}),je=d(()=>o.inlineMode?60:0),Ue=d(()=>`desform:${c.value}`),Ge=d(()=>{var e,s;return R.value?(s=(e=N.value)==null?void 0:e.dialogOptions)!=null&&s.width?`${N.value.dialogOptions.width}px`:"900px":"100%"}),ce=d(()=>L.value?L.value:"加载中"),We=d(()=>{let e;return o.bodyHeight?e=o.bodyHeight:e=window.innerHeight-110+"px",{padding:"0",height:e}}),ze=d(()=>R.value),Qe=d(()=>!R.value),Je=d(()=>{var e,s,i,F;return(F=(i=(s=(e=w.value)==null?void 0:e.modalWrapperRef)==null?void 0:s.wrapperRef)==null?void 0:i.scrollbarRef)==null?void 0:F.wrap}),de=d(()=>R.value||o.total==null||o.index==null?!1:o.total!==1),fe=t(!1),W=t(""),me=t(""),pe=t(""),ve=t(!1),ge=t(""),[Ke,{closeModal:he}]=Pe(oo),z=t(!1),[Xe,Q]=Ne(),Ye=Q.openModal;Q.openModal=function(...e){return _(this,null,function*(){z.value||(z.value=!0,yield $e()),Ye(...e)})};const J=t([]),O=Be(Z(Y({},o),{code:c.value,designFormCode:c.value,viewId:x.value}));Ae(()=>{O.dynamicConfig=o.dynamicConfig,O.code=c.value,O.designFormCode=c.value,O.viewId=x.value});const{designButtonList:Ze,getCustomButtons:eo}=Jo(O,Q,c,B),_e=t(!0),we=t(!0);Ae(()=>{o.inlineMode&&(we.value=!1,_e.value=!1)});function oo(e){return _(this,null,function*(){ne.value=e.isOnline,ae.value=e.isLinkDialog,k.value=e.mode,D.value=e.dataId,x.value=e.viewId,B.value=e.lowAppId,c.value=e.desformCode,A.value=yield Wo(e.desformCode),le.value=e.hideCustomButton||!1,fe.value=e.isLinkRecordForm||!1,W.value=e.customButtonId||"",me.value=e.currentRecordId||"",ve.value=e.flowStatus,pe.value=e.processId,ge.value=e.linkRecordId,yield to(),y.value&&(Do(),typeof e.setMode=="function"&&(k.value=e.setMode({mode:k.value,record:y.value}))),no(),so(c.value)})}function to(){return _(this,null,function*(){if(y.value=void 0,!R.value)try{let e="/desform/data/queryById";y.value=yield U.get({url:e,params:{id:D.value,desformCode:c.value}})}catch(e){}})}function no(){return _(this,null,function*(){if(!R.value)try{if(y.value&&y.value.desformData){let e=Z(Y({},y.value.desformData),{id:y.value.id}),s=eo(e,Ze);J.value=s}else J.value=[]}catch(e){}})}function ao(e,s){return _(this,null,function*(){const i=yield lo(s);if(typeof i=="function"){v.value=!0;try{yield i(...e),yield zo(500),be()}finally{v.value=!1}}})}function lo(e){return _(this,null,function*(){return e?e.popConfirm?(yield S({content:e.popConfirm.title,okText:e.popConfirm.okText,cancelText:e.popConfirm.cancelText}))?e.popConfirm.confirm:null:e.onClick?e.onClick:null:null})}function so(e){return _(this,null,function*(){try{const s=`/desform/api/config/${e}`,i=yield U.get({url:s});L.value=i.desformName,N.value=i.config}catch(s){}})}function ro(){return typeof o.closeFunc=="function"&&o.closeFunc()===!1?!1:(o.inlineMode&&r("close"),!0)}function ye(){I.value.doActionSubmit()}function io(e){I.value.reload(),r("success",e)}const Ce=d(()=>o.index==null?!0:o.index===0);function uo(){Ce.value||K(o.index-1)}const ke=d(()=>o.index==null?!0:o.index===o.total-1);function co(){ke.value||K(o.index+1)}function be(){return _(this,null,function*(){K(o.index)})}const V=t(!1);function K(e){return _(this,null,function*(){r("goto-record",{index:e,mode:k.value}),V.value=!0,yield $e(),V.value=!1})}function Ie(){return`/myapp/${B.value}/form/${A.value}/${x.value}/share/${D.value}`}const[fo,mo]=Ne();function po(){const e=`${window.location.origin}${Ie()}`;mo.openModal(!0,{href:e})}function vo(){window.open(Ie(),"_blank")}function go(){return _(this,null,function*(){try{if(!(yield S({title:"复制",content:"确定要复制这条数据吗？"})))return;let s=yield U.put({url:"/desform/data/${desformCode}/copyRecord".replace("${desformCode}",c.value),params:{id:D.value}},{joinParamsToUrl:!0});r("goto-record",{id:s.id,mode:k.value})}catch(e){}})}const ho=d(()=>{const{allowJmReport:e,allowPrint:s}=N.value||{};return e||s});function _o(){I.value.doPrint()}function wo(){return _(this,null,function*(){try{if(!(yield S({title:"删除",content:"确定要删除这条数据吗？"})))return;yield U.delete({url:"/desform/data/${desformCode}/delete".replace("${desformCode}",c.value),params:{id:D.value}},{joinParamsToUrl:!0}),q(),Re({dataId:D.value})}catch(e){}})}let De=Ho("doDesignForm",!1);function yo(){De?(q(),De()):Co()}function Co(){window.open("/online/desform?open="+c.value,"_blank)")}function X(){if(typeof o.closeFunc=="function"&&o.closeFunc()===!1)return!1;q()}function q(){he(),r("close")}function Re({dataId:e},s=!0){r("success",{dataId:e,isLinkRecordForm:fe.value,linkRecordId:ge.value,customButtonId:W.value,currentRecordId:me.value,flowStatus:ve.value,processId:pe.value}),o.inlineMode||s&&he()}function ko(){q()}function bo(){r("success")}const Fe=Xo();function P(e){if(Fe.getLowAppAdminAuth()===!0)return!0;let i=c.value;return(Fe.getOperationAuth(i)||{})[e]||!1}const{hasDeleteAuth:Io}=Yo();function Do(){var s;let e=(s=y.value)!=null&&s.desformData?y.value.desformData:y.value;se.delete=Io(c.value,x.value,[e])}return(e,s)=>{const i=h("Icon"),F=h("a-tooltip"),E=h("a-button"),Me=h("a-space"),$=h("a-menu-item"),Ro=h("a-menu-divider"),Fo=h("a-menu"),Mo=h("a-dropdown"),So=h("DesformView"),xo=h("DesformViewModal",!0);return u(),j(Le,null,[l(b(He),Eo({ref_key:"modalRef",ref:w,title:ce.value,width:Ge.value,height:800,enableComment:Ee.value,loading:v.value,style:{top:0,padding:0},bodyStyle:We.value,canFullscreen:ze.value,mask:_e.value,keyboard:we.value,destroyOnClose:"",draggable:!1,maskClosable:!1,closeFunc:ro,wrapClassName:`${b(M)}-wrapper`,defaultFullscreen:Qe.value},e.$attrs,{onOk:ye,onCancel:X,onRegister:b(Ke)}),{title:a(()=>[f("div",{class:ee([`${b(M)}-custom-header`])},[f("div",rt,[R.value?(u(),j("span",it,oe(ce.value),1)):m("",!0),R.value?m("",!0):(u(),j("div",ut,[de.value?(u(),p(F,{key:0,title:"上一条记录",placement:"left"},{default:a(()=>[l(i,{icon:"ant-design:up",class:ee([{disabled:Ce.value}]),onClick:uo},null,8,["class"])]),_:1})):m("",!0),de.value?(u(),p(F,{key:1,title:"下一条记录"},{default:a(()=>[l(i,{icon:"ant-design:down",class:ee([{disabled:ke.value}]),onClick:co},null,8,["class"])]),_:1})):m("",!0),l(F,{title:"刷新记录"},{default:a(()=>[l(i,{icon:"ant-design:reload",onClick:be})]),_:1})])),G.value&&!le.value?(u(),p(Me,{key:2,class:"custom-button-box"},{default:a(()=>[(u(!0),j(Le,null,Vo(J.value,T=>(u(),p(F,{title:T.tooltip},{default:a(()=>[l(E,{disabled:v.value,style:qo({"background-color":T.iconColor,border:"none",outline:"none"}),onClick:(...Bo)=>ao(Bo,T)},{default:a(()=>[l(i,{icon:T.icon,color:"white"},null,8,["icon"]),f("span",ct,oe(T.label),1)]),_:2},1032,["disabled","style","onClick"])]),_:2},1032,["title"]))),256))]),_:1})):m("",!0)]),f("div",dt,[l(Me),f("div",ft,[R.value?m("",!0):(u(),p(Mo,{key:0,trigger:["click"],placement:"bottom",overlayClassName:`${b(M)}-header-more-dropdown`},{overlay:a(()=>[l(Fo,{onClick:s[0]||(s[0]=()=>{})},{default:a(()=>[n.showRecordShare&&B.value&&P("share_record")?(u(),p($,{key:0,onClick:po},{default:a(()=>[l(i,{icon:"ant-design:share-alt"}),mt]),_:1})):m("",!0),!n.inlineMode&&G.value&&n.showRecordCopy?(u(),p($,{key:1,onClick:go},{default:a(()=>[l(i,{icon:"ant-design:copy"}),pt]),_:1})):m("",!0),ho.value&&n.showRecordSysPrint&&P("print_record")?(u(),p($,{key:2,onClick:_o},{default:a(()=>[l(i,{icon:"ant-design:printer-filled"}),vt]),_:1})):m("",!0),B.value&&!n.inlineMode?(u(),p($,{key:3,onClick:vo},{default:a(()=>[l(i,{icon:"ic:round-launch"}),gt]),_:1})):m("",!0),se.delete&&G.value?(u(),p($,{key:4,class:"delete-item",onClick:wo},{default:a(()=>[l(i,{icon:"ant-design:delete-filled"}),ht]),_:1})):m("",!0),n.showDesignFormBtn?(u(),p(Ro,{key:5})):m("",!0),n.showDesignFormBtn?(u(),p($,{key:6,onClick:yo},{default:a(()=>[l(i,{icon:"ant-design:setting-filled"}),_t]),_:1})):m("",!0)]),_:1})]),default:a(()=>[l(i,{icon:"ep:more-filled"})]),_:1},8,["overlayClassName"]))])])],2)]),comment:a(()=>[V.value?m("",!0):(u(),p(Qo,{key:0,ref:"commentPanelRef",tableName:Ue.value,dataId:D.value,showComment:re.value,showFiles:ie.value,showDataLog:ue.value,otherHeight:je.value},null,8,["tableName","dataId","showComment","showFiles","showDataLog","otherHeight"]))]),footer:a(()=>[l(E,{onClick:X},{default:a(()=>[te("关闭")]),_:1}),qe.value?m("",!0):(u(),p(E,{key:0,type:"primary",loading:v.value,preIcon:"ant-design:save",onClick:ye},{default:a(()=>[te("保存 ")]),_:1},8,["loading"]))]),default:a(()=>[V.value?m("",!0):(u(),p(So,{key:0,ref_key:"viewRef",ref:I,class:"desform-view",mode:k.value,dataId:D.value,viewId:x.value,lowAppId:B.value,isOnline:ne.value,isLinkDialog:ae.value,desformCode:c.value,parentNode:Je.value,defaultFormData:n.defaultFormData,widgetConfig:n.widgetConfig,customButtonId:W.value,skipPage:!1,showFooter:!1,eventDialog:!1,onClose:X,onForceClose:ko,onSuccess:Re,onReload:bo},null,8,["mode","dataId","viewId","lowAppId","isOnline","isLinkDialog","desformCode","parentNode","defaultFormData","widgetConfig","customButtonId"]))]),_:1},16,["title","width","enableComment","loading","bodyStyle","canFullscreen","mask","keyboard","wrapClassName","defaultFullscreen","onRegister"]),z.value?(u(),p(xo,{key:0,dynamicConfig:n.dynamicConfig,onRegister:b(Xe),onSuccess:io},null,8,["dynamicConfig","onRegister"])):m("",!0),l(st,{onRegister:b(fo)},null,8,["onRegister"])],64)}}});export{In as default};
