var Q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var j=(e,a,n)=>a in e?Q(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,A=(e,a)=>{for(var n in a||(a={}))Z.call(a,n)&&j(e,n,a[n]);if(R)for(var n of R(a))x.call(a,n)&&j(e,n,a[n]);return e},O=(e,a)=>X(e,Y(a));var I=(e,a,n)=>new Promise((F,b)=>{var E=r=>{try{u(n.next(r))}catch(i){b(i)}},_=r=>{try{u(n.throw(r))}catch(i){b(i)}},u=r=>r.done?F(r.value):Promise.resolve(r.value).then(E,_);u((n=n.apply(e,a)).next())});import{d as ee,a2 as te,f as w,r as N,w as ae,h as le,e as M,u as h,H,I as W,a3 as se,a4 as oe,a5 as t,E as m,V as c,a6 as v,a7 as y,F as q,k as o,ai as d,ak as g,am as G,af as ne,ae as ie,W as ue}from"./vue-vendor-24c7dc61.js";import{J as de}from"./JImageUpload-d644253a.js";import{_ as re}from"./JUpload-76e119c7.js";import ce from"./JEditor-249b2194.js";import{R as pe,cs as me,a5 as $,a6 as C,l as fe}from"./index-831af9dd.js";import{J as ge}from"./JDictSelectTag-54dc3bdb.js";import{b as _e,s as he}from"./market.api-af34a608.js";import{f as k}from"./antd-vue-vendor-0d72f01e.js";import"./useFormItem-86503382.js";import"./index-d508f1f4.js";import"./index-b845562c.js";import"./vxe-table-vendor-8813019a.js";const ve=ee({name:"templateEdit",components:{JDictSelectTag:ge,Icon:pe,JEditor:ce,JImageUpload:de,JUpload:re},props:{lowAppInfo:{type:Object,default:()=>{}},templateId:{type:String,default:""}},setup(e){const a=te(),n=w([]),F=w([]),b=w([]),E=w([]),_=w(!1),u=w(!1),r=N({modalVisible:!1,modalTitle:"",modalDesc:""}),i=N({id:"",title:"",subTitle:"",category:"1",industry:"1",tag:"",coverUrl:"",videoUrl:"",rotationPics:"",introduce:"",izPublish:"0",bindLowAppId:"",status:0});ae(()=>e.lowAppInfo,l=>{l&&(i.bindLowAppId=e.lowAppInfo.value,i.title=e.lowAppInfo.label)},{immediate:!0}),le(()=>{e.templateId&&J()});const U=M(()=>{let l=h(F).filter(f=>f.value===i.category);return l&&l.length>0?l[0].text:""}),D=M(()=>{let l=h(b).filter(f=>f.value===i.industry);return l&&l.length>0?l[0].text:""});function J(){return I(this,null,function*(){let l=yield _e({id:e.templateId});l.id&&(Object.assign(i,A({},l)),n.value=i.tag.length>0?i.tag.split(","):[],_.value=i.izPublish=="1")})}function S(l){i.izPublish=h(_)?"1":"0"}function z(l){return I(this,null,function*(){if(P()){i.status=l,i.tag=h(n).length>0?h(n).join(","):"";let f=W(i);u.value=!0;const T=yield he(f,i.id);u.value=!1,T&&(i.id=T),r.modalVisible=!0,r.modalTitle=l==0?"保存成功":"提交成功",r.modalDesc=l==0?"可在我的应用-草稿中查看":"我们会在七个工作日内完成审核！"}})}function V(){r.modalVisible=!1,i.status!==0&&a.push({name:"myapps-template-manage",query:{status:1}})}function B(l){return h(E).filter(f=>f.value===l)[0].text}function L(){return I(this,null,function*(){F.value=yield $("template_category"),b.value=yield $("template_industry"),E.value=yield $("template_tag")})}L();function P(){let l=W(i);return C(l.title)?(k.warning("标题不能为空!"),!1):C(l.coverUrl)?(k.warning("封面不能为空!"),!1):C(l.category)?(k.warning("分类不能为空!"),!1):C(l.industry)?(k.warning("行业不能为空!"),!1):C(l.subTitle)?(k.warning("模版描述不能为空！"),!1):C(l.rotationPics)&&C(l.videoUrl)?(k.warning("请配置模版轮播图或视频简介！"),!1):!0}function s(l,f){const T=f?[...h(n),l]:h(n).filter(K=>K!==l);n.value=T.length>3?T.slice(-3):T}return O(A(A({publishChecked:_,izPublishChange:S},H(r)),H(i)),{handleSubmit:z,handleComplete:V,categoryDictText:U,industryDictText:D,tagsList:E,selectedTags:n,handleChange:s,getRandomColor:me,getTagLabel:B,loading:u})}}),ye="/assets/template_cover-60b531ae.jpg";const p=e=>(se("data-v-52948a91"),e=e(),oe(),e),Ce={class:"template-edit-page"},be={class:"container"},Ee={class:"logo"},Te={class:"icon"},we={class:"title"},ke=p(()=>t("p",null,[t("span",{class:"required-flag"},"*"),m("标题")],-1)),Fe=p(()=>t("p",null,[t("span",{class:"required-flag"},"*"),m("封面")],-1)),Be=p(()=>t("p",{style:{"font-size":"12px",color:"gray"}},"建议上传10MB以内,不小于450*200px的封面图片",-1)),Ue=p(()=>t("p",null,[t("span",{class:"required-flag"},"*"),m("分类")],-1)),Ae=p(()=>t("p",null,[t("span",{class:"required-flag"},"*"),m("行业")],-1)),Ie=p(()=>t("p",null,[t("span",{class:"required-flag"},"*"),m("描述")],-1)),De=p(()=>t("p",null,[m("标签"),t("span",{style:{"margin-left":"5px"}},"(最多打3个)")],-1)),Je=p(()=>t("p",null,"详情",-1)),Se=p(()=>t("p",null,"模版图片轮播",-1)),ze=p(()=>t("p",null,"模版视频简介",-1)),Ve=p(()=>t("p",null,"是否上架",-1)),Le={class:"right-content"},Pe={class:"template-item"},qe={class:"template-cover"},$e=["src","alt"],Re=["alt"],je={class:"template-info"},Oe={class:"title",style:{display:"flex"}},Ne={class:"link-darker",href:"javascript:void(0)"},Me={key:0,class:"tag",style:{"margin-left":"10px"}},He={class:"text"},We={class:"desc"},Ge={class:"desc_intro"},Ke={class:"desc_widget"},Qe={class:"desc_classification"},Xe={class:"classification-item flexCenter"},Ye={class:"title"},Ze={class:"classification-item flexCenter"},xe={class:"title"},et=p(()=>t("div",{class:"num-item"}," 0次安装 ",-1)),tt={class:"footer-box"},at={style:{"margin-left":"12%"}},lt={style:{display:"flex","align-items":"center","flex-direction":"column",padding:"50px"}},st={style:{"font-size":"22px","font-weight":"600"}},ot={style:{"font-size":"14px"}};function nt(e,a,n,F,b,E){const _=c("Icon"),u=c("a-col"),r=c("a-input"),i=c("JImageUpload"),U=c("JDictSelectTag"),D=c("a-checkable-tag"),J=c("JEditor"),S=c("JUpload"),z=c("a-checkbox"),V=c("a-row"),B=c("a-button"),L=c("a-spin"),P=c("a-modal");return v(),y(q,null,[t("div",Ce,[o(L,{spinning:e.loading},{default:d(()=>[t("div",be,[o(V,{class:"left-form-content"},{default:d(()=>[o(u,{class:"marginTop10"},{default:d(()=>[t("div",Ee,[t("div",Te,[o(_,{icon:"ant-design:appstore-add-outlined",size:30,color:"#ffffff"})]),t("div",we,[t("span",null,g(e.title),1)])])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[ke,t("p",null,[o(r,{placeholder:"请输入标题名称",value:e.title,"onUpdate:value":a[0]||(a[0]=s=>e.title=s),"show-count":"",maxlength:20},null,8,["value"])])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Fe,o(i,{fileMax:1,value:e.coverUrl,"onUpdate:value":a[1]||(a[1]=s=>e.coverUrl=s)},null,8,["value"]),Be]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Ue,t("p",null,[o(U,{type:"radio",value:e.category,"onUpdate:value":a[2]||(a[2]=s=>e.category=s),dictCode:"template_category",placeholder:"请选择分类"},null,8,["value"])])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Ae,t("p",null,[o(U,{type:"radio",value:e.industry,"onUpdate:value":a[3]||(a[3]=s=>e.industry=s),dictCode:"template_industry",placeholder:"请选择行业"},null,8,["value"])])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Ie,t("p",null,[o(r,{placeholder:"请输入简单描述",value:e.subTitle,"onUpdate:value":a[4]||(a[4]=s=>e.subTitle=s),maxlength:50,showCount:""},null,8,["value"])])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[De,t("p",null,[(v(!0),y(q,null,G(e.tagsList,s=>(v(),ne(D,{key:s.value,checked:e.selectedTags.indexOf(s.value)>-1,onChange:l=>e.handleChange(s.value,l)},{default:d(()=>[m(g(s.label),1)]),_:2},1032,["checked","onChange"]))),128))])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Je,o(J,{placeholder:"请输入详情",value:e.introduce,"onUpdate:value":a[5]||(a[5]=s=>e.introduce=s),showImageUpload:!1,height:200},null,8,["value"])]),_:1}),o(u,{style:{"margin-top":"30px"}},{default:d(()=>[Se,o(i,{fileMax:3,value:e.rotationPics,"onUpdate:value":a[6]||(a[6]=s=>e.rotationPics=s)},null,8,["value"])]),_:1}),o(u,{style:{"margin-top":"30px"}},{default:d(()=>[ze,o(S,{maxCount:1,value:e.videoUrl,"onUpdate:value":a[7]||(a[7]=s=>e.videoUrl=s),text:"视频",accept:"video/*"},null,8,["value"])]),_:1}),o(u,{class:"marginTop10"},{default:d(()=>[Ve,o(z,{checked:e.publishChecked,"onUpdate:checked":a[8]||(a[8]=s=>e.publishChecked=s),onChange:e.izPublishChange},{default:d(()=>[m("审核通过后直接上架到模版库")]),_:1},8,["checked","onChange"])]),_:1})]),_:1}),t("div",Le,[t("div",Pe,[t("div",qe,[e.coverUrl?(v(),y("img",{key:0,src:e.coverUrl,alt:e.title},null,8,$e)):(v(),y("img",{key:1,src:ye,alt:e.title},null,8,Re))]),t("div",je,[t("div",Oe,[t("a",Ne,g(e.title),1),e.selectedTags&&e.selectedTags.length>0?(v(),y("div",Me,[(v(!0),y(q,null,G(e.selectedTags,(s,l)=>(v(),y("span",{class:"tag-widget",style:ie({background:e.getRandomColor(l)}),key:l},[t("span",He,g(e.getTagLabel(s)),1)],4))),128))])):ue("",!0)]),t("div",We,[t("div",Ge,g(e.subTitle),1),t("div",Ke,[t("ul",Qe,[t("li",Xe,[t("span",Ye,g(e.categoryDictText),1)]),t("li",Ze,[t("span",xe,g(e.industryDictText),1)])]),et])])])])])]),t("div",tt,[t("div",at,[o(B,{type:"primary",onClick:a[9]||(a[9]=s=>e.handleSubmit(1))},{default:d(()=>[m("提交审核")]),_:1}),o(B,{type:"ghost",style:{"margin-left":"20px"},onClick:a[10]||(a[10]=s=>e.handleSubmit(0))},{default:d(()=>[m("保存为草稿")]),_:1})])])]),_:1},8,["spinning"])]),o(P,{open:e.modalVisible,"onUpdate:open":a[11]||(a[11]=s=>e.modalVisible=s),centered:"",footer:null},{default:d(()=>[t("div",lt,[t("p",null,[o(_,{icon:"ant-design:check-circle-outlined",size:"64",style:{color:"#00db00"}})]),t("p",st,g(e.modalTitle),1),t("p",ot,g(e.modalDesc),1),t("p",null,[o(B,{style:{"min-width":"200px"},type:"primary",shape:"round",onClick:e.handleComplete},{default:d(()=>[m("完成")]),_:1},8,["onClick"])])])]),_:1},8,["open"])],64)}const Ct=fe(ve,[["render",nt],["__scopeId","data-v-52948a91"]]);export{Ct as default};
