var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var q=(t,n,i)=>n in t?X(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,O=(t,n)=>{for(var i in n||(n={}))$.call(n,i)&&q(t,i,n[i]);if(N)for(var i of N(n))tt.call(n,i)&&q(t,i,n[i]);return t},T=(t,n)=>Y(t,Z(n));var w=(t,n,i)=>new Promise((o,h)=>{var p=s=>{try{f(i.next(s))}catch(l){h(l)}},k=s=>{try{f(i.throw(s))}catch(l){h(l)}},f=s=>s.done?o(s.value):Promise.resolve(s.value).then(p,k);f((i=i.apply(t,n)).next())});import{f as A,h as ot,w as V,c as et,e as D,I as nt,V as B,q as it,a6 as r,a7 as c,a5 as b,F as R,am as H,ak as _,W as L,af as j,al as rt,k as x,ai as G,E,A as st}from"./vue-vendor-24c7dc61.js";import{a_ as at,p as lt}from"./antd-vue-vendor-0d72f01e.js";import{s as ct}from"./type.definition-4eb605ee.js";import{u as dt}from"./LinkRecordSelect-385d0eae.js";import{u as ut,a as mt}from"./useCustomButton-fa741dda.js";import pt from"./FilterFiledListNew-bbda127c.js";import{l as ft}from"./index-831af9dd.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";const yt={name:"ButtonConditions",props:{visible:{type:Boolean,default:!1},conditions:{type:Array,default:()=>[]},conditionsGroup:{type:Array,default:()=>[]},type:{type:String,default:""},code:{type:String,default:""},allColumns:{type:Array,default:()=>[]}},components:{EditOutlined:at,FilterFiledListNew:pt},emits:["ok","back","update:conditions","update:conditionsGroup"],setup(t,{emit:n}){const i=A([]),o=A("and"),{translateCondition:h}=ut(t);ot(()=>w(this,null,function*(){o.value=t.type})),V(()=>t.conditions,()=>w(this,null,function*(){if(Array.isArray(t.conditions)&&t.conditions.length>0){const e=mt(t.conditions,t.type);n("update:conditions",[]),n("update:conditionsGroup",e)}}),{immediate:!0}),V(()=>t.conditionsGroup,()=>w(this,null,function*(){const e=Array.isArray(t.conditionsGroup)?t.conditionsGroup:[];for(const a of e){if(!a.queryItems||a.queryItems.length===0)continue;let m=[];for(let C of a.queryItems){let v=lt(C,"field","rule","val","type");m.push(v)}let g=JSON.stringify(m);const y=yield h(g);y.length>0?a.queryItems=y:a.queryItems=m}i.value=e}),{immediate:!0});const p=et("globalColumnList"),{getTypeLabel:k}=dt(),f=D(()=>[...(p==null?void 0:p.value)||[],...ct.map(e=>T(O({},e),{model:e.field}))]);function s(e){let m=f.value.filter(g=>g.model===e);return m.length>0?m[0].name:e}const l=A(!1),u=A();function F(){l.value=!0}function d(){u.value.saveCondition()}function S(e){n("ok",e),l.value=!1}function J(){n("back"),l.value=!1}const U=D(()=>({conditionsGroup:i.value,conditionType:o.value}));V(()=>t.visible,e=>{e===!0&&(t.conditions&&t.conditions.length>0||t.conditionsGroup&&t.conditionsGroup.length>0||(l.value=!0))});const W={maxHeight:window.innerHeight-200+"px",overflow:"auto"};function z(){n("ok",{conditions:[],conditionsGroup:[],conditionType:"and"}),l.value=!1}const K=["radio","checkbox","select","select-user","select-depart","table-dict","select-tree","link-record"];function M(e){let{val:a,field:m,type:g}=e,y=nt(a);if(K.indexOf(g)>=0){let C=t.allColumns;if(!C||C.length==0)return y;for(let v of C)if(v.dataIndex===m){v.customRender&&(y=v.customRender({text:y,record:{}}));break}}return y}const P=["link-record"];function Q(e){let a=t.allColumns;return!a||a.length==0?!1:P.indexOf(e.type)>=0}function I(e){return e&&(Array.isArray(e)?e=e.map(a=>I(a)).join(","):typeof e.replace=="function"&&(e=e.replace(/#\{\s*sys_user_code\s*}/g,"当前用户")),e)}return{conditionsGroupList:i,conditionType:o,getFieldLabel:s,getTypeLabel:k,goEdit:F,onConditionSelected:d,modalVisible:l,columnList:p,filterInfo:U,onSaveFilter:S,bodyStyle:W,filterRef:u,onBack:J,clearAll:z,isLinkrecordComponent:Q,getFieldValue:M,getValueText:I}}};const _t={class:"button-conditions"},ht={key:0,class:"button-conditions-text"},kt={style:{flex:"1"}},gt={class:"condition-group-item"},Ct={key:0,class:"condition-right"},vt={key:1,class:"condition-right"},bt={class:"condition-item"},Lt={key:0},xt={style:{color:"#333","font-weight":"700"}},Gt={key:1,class:"link-record-span"},wt={key:2},At={key:3},Bt={class:"button-edit-icon"},Ft={class:"inner-content filter-select-adding",style:{padding:"0 20px 20px 15px",height:"100%",overflow:"auto"}};function St(t,n,i,o,h,p){const k=B("EditOutlined"),f=B("FilterFiledListNew"),s=B("a-button"),l=B("a-modal");return it((r(),c("div",_t,[o.conditionsGroupList&&o.conditionsGroupList.length>0?(r(),c("div",ht,[b("div",kt,[(r(!0),c(R,null,H(o.conditionsGroupList,(u,F)=>(r(),c("div",gt,[F===0?(r(),c("span",Ct,"当")):(r(),c("span",vt,_(o.conditionType==="and"?"且":"或"),1)),u.queryItems?(r(!0),c(R,{key:2},H(u.queryItems,(d,S)=>(r(),c("div",bt,[S>0?(r(),c("span",Lt,_(u.matchType==="and"?"且":"或"),1)):L("",!0),b("span",null,_(o.getFieldLabel(d.field)),1),b("span",xt,_(o.getTypeLabel(d.rule)),1),o.isLinkrecordComponent(d)?(r(),c("span",Gt,[d.val?(r(),j(rt(o.getFieldValue(d)),{key:0})):L("",!0)])):d.valText?(r(),c("span",wt,_(o.getValueText(d.valText)),1)):(r(),c("span",At,_(o.getValueText(d.val)),1))]))),256)):L("",!0)]))),256))]),b("div",Bt,[x(k,{onClick:o.goEdit},null,8,["onClick"])])])):L("",!0),x(l,{centered:"",open:o.modalVisible,"onUpdate:open":n[0]||(n[0]=u=>o.modalVisible=u),title:"筛选",bodyStyle:o.bodyStyle,onCancel:o.onBack,onOk:o.onConditionSelected,wrapClassName:"button-condition-modal"},{footer:G(()=>[o.conditionsGroupList.length>0?(r(),j(s,{key:0,onClick:o.clearAll},{default:G(()=>[E("清空")]),_:1},8,["onClick"])):L("",!0),x(s,{style:{"margin-left":"18px"},onClick:o.onBack},{default:G(()=>[E("取消")]),_:1},8,["onClick"]),x(s,{style:{"margin-left":"10px"},type:"primary",onClick:o.onConditionSelected},{default:G(()=>[E("确定")]),_:1},8,["onClick"])]),default:G(()=>[b("div",Ft,[x(f,{ref:"filterRef",columnList:o.columnList,info:o.filterInfo,parentContainer:"button-condition-modal",saveButton:!1,onSave:o.onSaveFilter},null,8,["columnList","info","onSave"])])]),_:1},8,["open","bodyStyle","onCancel","onOk"])],512)),[[st,i.visible]])}const Io=ft(yt,[["render",St]]);export{Io as default};
