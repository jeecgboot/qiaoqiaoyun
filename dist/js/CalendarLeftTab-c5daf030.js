var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var W=(t,l,a)=>l in t?ee(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,B=(t,l)=>{for(var a in l||(l={}))ne.call(l,a)&&W(t,a,l[a]);if(J)for(var a of J(l))ie.call(l,a)&&W(t,a,l[a]);return t},G=(t,l)=>te(t,ae(l));var H=(t,l,a)=>new Promise((n,L)=>{var g=i=>{try{y(a.next(i))}catch(r){L(r)}},h=i=>{try{y(a.throw(i))}catch(r){L(r)}},y=i=>i.done?n(i.value):Promise.resolve(i.value).then(g,h);y((a=a.apply(t,l)).next())});import{f as m,r as le,w as R,o as oe,j as re,I as se,a5 as A,V as _,q as ue,a6 as o,a7 as u,k as v,ai as P,ae as ce,af as w,F as p,am as z,W as F,ak as de,E as fe,A as me}from"./vue-vendor-24c7dc61.js";import{ak as ve,n as ye,aI as _e,i as ge}from"./antd-vue-vendor-0d72f01e.js";import he from"./InfoItem-08fdcae7.js";import{k as pe,l as Le}from"./index-831af9dd.js";import"./vxe-table-vendor-8813019a.js";const Ee={name:"CalendarLeftTab",components:{LoadingOutlined:ve,SearchOutlined:ye,InfoItem:he},props:{appId:{type:String,default:""},viewId:{type:String,default:""},routeCode:{type:String,default:""},superQuery:{type:Object,default:()=>{}},calendarColumnList:{type:Array,default:()=>[]},titleField:{type:String,default:""},timestamp:{type:Number,default:0},visible:{type:Boolean,default:!1}},emits:["tap"],setup(t,{emit:l}){const a=m(""),n=m("1"),L=m({}),g=m(),h=m(!1),y=m(!0),i=le({current:1,size:20,isEnd:!1}),r=m([]),K=m({}),E=m([]),D=m([]);R([()=>t.routeCode,()=>t.viewId,()=>t.superQuery],()=>{if(t.routeCode&&t.viewId){if(t.superQuery){let e=t.superQuery;L.value={matchType:e.matchType,superQueryParams:e.superQueryParams}}S()}},{immediate:!0}),R(()=>t.timestamp,e=>{e&&S()},{immediate:!0});const N=_e(Z,150);oe(()=>{g.value.addEventListener("scroll",N)}),re(()=>{var e;(e=g.value)==null||e.removeEventListener("scroll",N)});function C(){return{code:t.routeCode,appId:t.appId,listViewId:t.viewId,superQuery:JSON.stringify(L.value),global_keyword:a.value,pageNo:i.current,pageSize:i.size}}function S(){return H(this,null,function*(){var s;i.current=1,i.isEnd=!1,(s=g.value)==null||s.scrollTo(0,0),r.value=[],y.value=!0;let e=C();yield x(e)})}function O(){return H(this,null,function*(){if(i.isEnd)return;i.current=i.current+1;let e=C();yield x(e)})}function x(e){return H(this,null,function*(){try{h.value=!0;const s="/desform/data/calendarList",d=yield pe.get({url:s,params:e,timeout:6e4});if(!d||d.length==0)r.value=[],i.isEnd=!0;else{let f=[];for(let b of d)f.push(B({},b.desformData));f.length<i.size&&(i.isEnd=!0),r.value=r.value.concat(f),T(r.value)}}catch(s){}finally{h.value=!1,y.value=!1}})}R(()=>t.calendarColumnList,e=>{!e||e.length==0||!r.value||r.value.length==0||T(r.value)},{immediate:!0});function T(e){let s=t.calendarColumnList;if(!s||s.length==0||!e||e.length==0)return;let d={},f=[],b=[];for(let I of e){let Q=!1;for(let Y of s){let $=Y.beginDateField,j=I[$];if(j){Q=!0;let U=Y.type;if(U==="datetime"||U==="date"){let q=ge(new Date(j)).format("YYYY年MM月DD日");c(q,j,f);let V=d[q];V||(V=[]),V.push(G(B({},I),{tagSeq:Y.seq})),d[q]=V}}}Q===!1&&b.push(B({},I))}D.value=b,f.sort(function(I,Q){return Q.value-I.value}),E.value=f,K.value=d}function c(e,s,d){let f=!0;for(let b of d)if(b.title===e){f=!1;break}f===!0&&d.push({value:s,title:e})}function k(e){a.value=e.target.value}const M=m(0);M.value=window.innerHeight-240;function X(e){l("tap",se(e))}function Z(){if(i.isEnd||h.value)return;const{scrollTop:e,clientHeight:s,scrollHeight:d}=g.value;e+s>=d-50&&O()}return{listRef:g,activeKey:n,paging:i,loading:h,pageLoading:y,filterValue:a,maxHeight:M,goEdit:X,dataList:r,secondDataListMap:K,secondDateList:E,thirdDataList:D,onSearch:k}}};const De={class:"calendar-left-tab-container"},ke={class:"search"},be={key:0,class:"empty"},we={style:{color:"#757575","font-weight":"700",margin:"12px 12px 0"}},Fe={key:0,class:"empty"},Ce={key:0,class:"empty"},Se={key:4,class:"bottom"},xe=A("span",{style:{"margin-left":"8px"}},"加载中",-1);function Te(t,l,a,n,L,g){var S,O,x,T;const h=_("SearchOutlined"),y=_("a-input"),i=_("a-tab-pane"),r=_("a-tabs"),K=_("a-skeleton"),E=_("info-item"),D=_("a-empty"),N=_("LoadingOutlined"),C=_("a-divider");return ue((o(),u("div",De,[A("div",ke,[v(y,{placeholder:"输入关键字按回车搜索",class:"my-input",onPressEnter:n.onSearch},{prefix:P(()=>[v(h,{style:{color:"#c0c0c0"}})]),_:1},8,["onPressEnter"])]),v(r,{activeKey:n.activeKey,"onUpdate:activeKey":l[0]||(l[0]=c=>n.activeKey=c),class:"tab-back",centered:""},{default:P(()=>[v(i,{key:"1",tab:"全部"}),v(i,{key:"2",tab:"已排期"}),v(i,{key:"3",tab:"未排期"})]),_:1},8,["activeKey"]),A("div",{ref:"listRef",class:"data-list-box",style:ce({height:n.maxHeight+"px"})},[n.pageLoading?(o(),w(K,{key:0,active:""})):n.activeKey==="1"?(o(),u(p,{key:1},[(o(!0),u(p,null,z(n.dataList,c=>(o(),w(E,{info:c,titleField:a.titleField,"calendar-column-list":a.calendarColumnList,onTap:k=>n.goEdit(c)},null,8,["info","titleField","calendar-column-list","onTap"]))),256)),((S=n.dataList)==null?void 0:S.length)===0?(o(),u("div",be,[v(D,{description:"暂无数据"})])):F("",!0)],64)):n.activeKey==="2"?(o(),u(p,{key:2},[(o(!0),u(p,null,z(n.secondDateList,c=>(o(),u("div",null,[A("div",we,de(c.title),1),(o(!0),u(p,null,z(n.secondDataListMap[c.title],k=>(o(),w(E,{info:k,titleField:a.titleField,"calendar-column-list":a.calendarColumnList,onTap:M=>n.goEdit(k)},null,8,["info","titleField","calendar-column-list","onTap"]))),256))]))),256)),((O=n.secondDateList)==null?void 0:O.length)===0?(o(),u("div",Fe,[v(D,{description:"暂无数据"})])):F("",!0)],64)):n.activeKey==="3"?(o(),u(p,{key:3},[(o(!0),u(p,null,z(n.thirdDataList,c=>(o(),w(E,{info:c,"calendar-column-list":[],titleField:a.titleField,onTap:k=>n.goEdit(c)},null,8,["info","titleField","onTap"]))),256)),((x=n.thirdDataList)==null?void 0:x.length)===0?(o(),u("div",Ce,[v(D,{description:"暂无数据"})])):F("",!0)],64)):F("",!0),!n.pageLoading&&((T=n.dataList)==null?void 0:T.length)>0?(o(),u("div",Se,[n.loading?(o(),w(C,{key:0},{default:P(()=>[v(N),xe]),_:1})):n.paging.isEnd?(o(),w(C,{key:1},{default:P(()=>[fe("已经到底了")]),_:1})):F("",!0)])):F("",!0)],4)],512)),[[me,a.visible]])}const Be=Le(Ee,[["render",Te]]);export{Be as default};
