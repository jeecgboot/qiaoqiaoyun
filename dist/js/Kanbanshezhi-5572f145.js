var se=Object.defineProperty,de=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var K=(l,o,r)=>o in l?se(l,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[o]=r,I=(l,o)=>{for(var r in o||(o={}))ue.call(o,r)&&K(l,r,o[r]);if(R)for(var r of R(o))ce.call(o,r)&&K(l,r,o[r]);return l},W=(l,o)=>de(l,re(o));var H=(l,o,r)=>new Promise((i,T)=>{var u=d=>{try{C(r.next(d))}catch(v){T(v)}},w=d=>{try{C(r.throw(d))}catch(v){T(v)}},C=d=>d.done?i(d.value):Promise.resolve(d.value).then(u,w);C((r=r.apply(l,o)).next())});import{r as Z,e as G,f as U,w as pe,h as J,I as M,H as fe,a3 as he,a4 as me,a5 as a,V as g,a6 as h,a7 as y,k as p,ai as m,F as D,am as V,af as E,E as F,ak as O,W as Q}from"./vue-vendor-24c7dc61.js";import{aZ as ve,cn as ge,b9 as Ce,cr as ye,n as _e,bH as we,bO as Fe,cs as be}from"./antd-vue-vendor-0d72f01e.js";import{d as Be}from"./vuedraggable-vendor-6ef4bc68.js";import{u as ke}from"./useFieldSelect-1dde1da7.js";import{a5 as X,k as Ee,a6 as Oe,l as Te}from"./index-831af9dd.js";import{U as Le}from"./index-4d0525a5.js";import"./vxe-table-vendor-8813019a.js";import"./type.definition-4eb605ee.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./UserSelectModal-d78c1490.js";const xe={name:"Kanbanshezhi",components:{TableOutlined:ve,FilterOutlined:ge,EyeOutlined:Ce,OrderedListOutlined:ye,SearchOutlined:_e,AppstoreOutlined:we,DownOutlined:Fe,ControlOutlined:be,draggable:Be,UserSelect:Le},props:{columnList:{type:Array,default:()=>[]},info:{type:[Object,String],required:!1}},emits:["save"],setup(l,{emit:o}){const r=["radio","select","select-user","table-dict","link-record","switch"],{selectFieldList:i,myFilter:T}=ke(l,{type:r,multi:!1}),u=Z({groupField:"",filterGroupType:"all",filterGroupCondition:"",titleField:[],showLabel:!1,coverField:[],coverView:!0}),w=G({get(){return u.filterGroupCondition?u.filterGroupCondition.split(","):[]},set(e){e.length>0?u.filterGroupCondition=e.join(","):u.filterGroupCondition=""}}),C=[{value:"all",label:"全部"},{value:"part",label:"显示指定的项"}],d=Z({static:!1,options:[],dictCode:"",dictTable:"",dictText:"",type:""}),v=U();function b(e){d.type=e.type,e.type==="link-record"?(d.dictText=e.titleField,d.dictTable=e.code,d.dictCode="id"):(d.dictText=e.dictText,d.dictTable=e.dictTable,d.dictCode=e.dictCode,d.options=e.options,d.static=!e.dictCode&&!Oe(e.options))}pe(d,e=>H(this,null,function*(){if(e.type==="link-record"){const t=yield ae();v.value=t}else if(e.dictTable&&e.dictText&&e.dictCode){let t=`${e.dictTable},${e.dictText},${e.dictCode}`,s=yield X(t);v.value=s}else if(e.static)v.value=e.options;else if(e.dictCode){let t=yield X(e.dictCode);v.value=t}else v.value=[]}),{deep:!0,immediate:!0}),J(()=>{let e=l.info;if(e&&Object.keys(u).map(t=>{t=="titleField"||t=="coverField"?u[t]=e[t]||[]:u[t]=e[t]}),u.filterGroupType=="part"&&l.columnList){let t=l.columnList.filter(s=>s.model==u.groupField);t.length>0&&b(t[0])}});function A(){let e=l.columnList.filter(t=>t.model==u.groupField);e.length>0&&b(e[0]),o("save",{filterGroupType:u.filterGroupType})}const f=U([]);J(()=>{let e=l.columnList;if(!e||e.length==0)f.value=[];else{let t=l.info.cardColumnList||[],s=[];for(let c of e){let{show:B,seq:k}=q(c,t);s.push({name:c.name,key:c.key,type:c.type,show:B,seq:k})}s.sort(function(c,B){return c.seq-B.seq}),f.value=s}});const L=G(()=>{let e=f.value;return e.length==0?0:e.filter(t=>t.show===!0).length});function q(e,t){let s=t,c=!0,B=99;if(s&&s.length>0)for(let k of s)(k.field===e.key||k.field===e.field)&&(c=k.show,B=k.seq);else c=!1;return{show:c,seq:B}}const x=U("");function j(e){let t=x.value;return t?e.name.indexOf(t)>=0:!0}function z(){let e=f.value;for(let t of e)t.show=!0;f.value=e,S()}function n(){let e=f.value;for(let t of e)t.show=!1;f.value=e,S()}function N(e){if(e==!1){let t=f.value,s=[];for(let c of t)c.show==!0&&s.push(c);for(let c of t)c.show==!1&&s.push(c);f.value=s}S()}function Y(){S()}function S(){let e=f.value,t=[];for(let s=0;s<e.length;s++){let c={field:e[s].key,show:e[s].show,seq:s};t.push(c)}o("save",{cardColumnList:t})}function $(){u.filterGroupCondition="",P()}function P(){let e=M(u);Object.keys(e).map(t=>{e[t]instanceof Array&&(e[t]=e[t].join(","))}),o("save",I({},e))}function ee(e){let t=e.join(",");o("save",{filterGroupCondition:t})}function te(){o("save",{filterGroupCondition:u.filterGroupCondition})}const oe=U(!1),le=["input","textarea","money","integer","number","phone","email","link-record"],ne=G(()=>f.value.filter(t=>le.indexOf(t.type)>=0)),ie=G(()=>{let t=f.value.filter(s=>s.type=="imgupload");return t.push({name:"不显示",key:"none"}),t});function ae(){return H(this,null,function*(){const e="/desform/view/queryLinkRecordData";let t=M(d);const s=yield Ee.get({url:e,params:t},{isTransformResponse:!1});return s.success?s.result:[]})}return W(I({selectFieldList:i},fe(u)),{onChange:P,dataFilterOptions:C,myFilter:T,onTypeChange:A,selectPartDataList:v,partCondition:w,showPop:oe,filterValue:x,isFilterField:j,myFields:f,allHide:n,allShow:z,showColumnNum:L,handleChangeShow:N,onDragEnd:Y,titleFieldSelections:ne,imageFieldSelections:ie,onConditionChange:ee,onChangeGroupField:$,onConditionChange2:te})}};const _=l=>(he("data-v-9ce4c739"),l=l(),me(),l),Se={class:"inner-content"},Ge=_(()=>a("div",{class:"title"},"看板设置",-1)),Ue={class:"config-detail"},De=_(()=>a("div",{class:"label"},"分组字段",-1)),Ve={class:"config-item"},Ae=_(()=>a("div",{class:"label"},"显示项",-1)),qe={class:"config-item"},je={key:0,style:{"margin-top":"5px",width:"100%"}},ze=_(()=>a("div",{class:"label",style:{margin:"20px 0"}},"卡片外观",-1)),Ne=_(()=>a("div",{class:"label"},"标题字段",-1)),Ie={class:"config-item"},He={class:"label",style:{width:"280px",display:"flex","justify-content":"space-between"}},Pe=_(()=>a("div",null,"显示字段",-1)),Re=_(()=>a("span",{style:{color:"#9e9e9e!important","font-weight":"normal","font-size":"12px"}},"显示字段名称",-1)),Ke={class:"config-item"},We={class:"field-warp all-fields"},Ze={key:0,class:"field"},Je={class:"icon",title:"调整顺序"},Me={style:{width:"100%","border-top":"1px solid #f0f0f0","padding-top":"6px"}},Qe={class:"pop-buttons"},Xe={class:"virtual-select"},Ye={key:0},$e={key:1,style:{color:"rgb(158, 158, 158)"}},et={class:"label",style:{width:"280px",display:"flex","justify-content":"space-between"}},tt=_(()=>a("div",null,"封面",-1)),ot=_(()=>a("span",{style:{color:"#9e9e9e !important","font-weight":"normal","font-size":"12px"}},"允许点击查看",-1)),lt={class:"config-item"};function nt(l,o,r,i,T,u){const w=g("a-select-option"),C=g("a-select"),d=g("UserSelect"),v=g("a-divider"),b=g("a-switch"),A=g("OrderedListOutlined"),f=g("draggable"),L=g("a-button"),q=g("SearchOutlined"),x=g("a-input"),j=g("DownOutlined"),z=g("a-popover");return h(),y("div",Se,[Ge,a("div",Ue,[a("div",null,[De,a("div",Ve,[p(C,{style:{width:"280px"},value:l.groupField,"onUpdate:value":o[0]||(o[0]=n=>l.groupField=n),onChange:i.onChangeGroupField},{default:m(()=>[(h(!0),y(D,null,V(i.selectFieldList,n=>(h(),E(w,{value:n.value},{default:m(()=>[F(O(n.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"])]),Ae,a("div",qe,[p(C,{style:{width:"280px"},value:l.filterGroupType,"onUpdate:value":o[1]||(o[1]=n=>l.filterGroupType=n),onChange:i.onTypeChange},{default:m(()=>[(h(!0),y(D,null,V(i.dataFilterOptions,n=>(h(),E(w,{value:n.value},{default:m(()=>[F(O(n.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"]),l.filterGroupType=="part"?(h(),y("div",je,[l.groupField=="create_by"||l.groupField=="update_by"?(h(),E(d,{key:0,query:"",multi:"",value:l.filterGroupCondition,"onUpdate:value":o[2]||(o[2]=n=>l.filterGroupCondition=n),store:"username",onChange:i.onConditionChange2},null,8,["value","onChange"])):(h(),E(C,{key:1,value:i.partCondition,"onUpdate:value":o[3]||(o[3]=n=>i.partCondition=n),"show-search":"",maxTagCount:3,mode:"multiple",placeholder:"请选择指定的项",style:{width:"280px",cursor:"pointer"},options:i.selectPartDataList,onChange:i.onConditionChange,"filter-option":i.myFilter},null,8,["value","options","onChange","filter-option"]))])):Q("",!0)]),p(v),ze,Ne,a("div",Ie,[p(C,{style:{width:"280px"},placeholder:"请选择标题字段",value:l.titleField,"onUpdate:value":o[4]||(o[4]=n=>l.titleField=n),onChange:i.onChange},{default:m(()=>[(h(!0),y(D,null,V(i.titleFieldSelections,n=>(h(),E(w,{value:n.key},{default:m(()=>[F(O(n.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"])]),a("div",He,[Pe,a("div",null,[Re,p(b,{style:{"margin-bottom":"2px","margin-left":"3px"},checked:l.showLabel,"onUpdate:checked":o[5]||(o[5]=n=>l.showLabel=n),onChange:i.onChange,size:"small"},null,8,["checked","onChange"])])]),a("div",Ke,[p(z,{overlayClassName:"view-pop-field-select",open:i.showPop,"onUpdate:open":o[8]||(o[8]=n=>i.showPop=n),trigger:"click"},{content:m(()=>[a("div",We,[p(f,{"item-key":"name",animation:"300",modelValue:i.myFields,"onUpdate:modelValue":o[6]||(o[6]=n=>i.myFields=n),dragClass:"dragClass",onEnd:i.onDragEnd},{item:m(({element:n})=>[i.isFilterField(n)?(h(),y("div",Ze,[a("div",null,[p(b,{checked:n.show,"onUpdate:checked":N=>n.show=N,onChange:i.handleChangeShow,size:"small"},null,8,["checked","onUpdate:checked","onChange"]),F(),a("span",null,O(n.name),1)]),a("div",Je,[p(A)])])):Q("",!0)]),_:1},8,["modelValue","onEnd"])]),a("div",Me,[a("div",Qe,[p(L,{type:"text",onClick:i.allShow},{default:m(()=>[F("显示全部")]),_:1},8,["onClick"]),p(L,{type:"text",onClick:i.allHide},{default:m(()=>[F("隐藏全部")]),_:1},8,["onClick"])])])]),title:m(()=>[p(x,{placeholder:"搜索字段",class:"my-input",value:i.filterValue,"onUpdate:value":o[7]||(o[7]=n=>i.filterValue=n)},{prefix:m(()=>[p(q,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:m(()=>[a("div",Xe,[a("div",null,[i.showColumnNum?(h(),y("span",Ye," 显示"+O(i.showColumnNum)+"列 ",1)):(h(),y("span",$e," 请选择显示字段 "))]),a("div",null,[p(j)])])]),_:1},8,["open"])]),a("div",et,[tt,a("div",null,[ot,p(b,{style:{"margin-bottom":"2px","margin-left":"3px"},checked:l.coverView,"onUpdate:checked":o[9]||(o[9]=n=>l.coverView=n),onChange:i.onChange,size:"small"},null,8,["checked","onChange"])])]),a("div",lt,[p(C,{style:{width:"280px"},placeholder:"请选择封面图字段",value:l.coverField,"onUpdate:value":o[10]||(o[10]=n=>l.coverField=n),onChange:i.onChange},{default:m(()=>[(h(!0),y(D,null,V(i.imageFieldSelections,n=>(h(),E(w,{value:n.key},{default:m(()=>[F(O(n.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"])])])])])}const Ct=Te(xe,[["render",nt],["__scopeId","data-v-9ce4c739"]]);export{Ct as default};
