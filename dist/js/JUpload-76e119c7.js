var oe=Object.defineProperty;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var S=(l,r,i)=>r in l?oe(l,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[r]=i,j=(l,r)=>{for(var i in r||(r={}))le.call(r,i)&&S(l,i,r[i]);if(q)for(var i of q(r))re.call(r,i)&&S(l,i,r[i]);return l};import{d as Q,e as y,u as m,a6 as C,a7 as k,q as z,A as R,a5 as h,k as b,F as X,f as O,w as D,n as ie,S as ue,V as J,ai as H,ak as G,W,af as ce,ag as de,a8 as fe}from"./vue-vendor-24c7dc61.js";import{R as x,a as Y,H as u,h as me,q as pe,aL as ge,ap as F,aN as ve}from"./index-831af9dd.js";import{c as he}from"./index-d508f1f4.js";var I=(l=>(l.all="all",l.image="image",l.file="file",l))(I||{});const be={class:"upload-download-handler"},we={class:"upload-mover-handler"},ye=Q({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(l){const r=l,{createMessage:i}=Y(),a=y(()=>m(r.fileList));function w(){let t=_();if(t===-1){i.warn("移动失败："+t);return}if(t===0){p(t,m(a).length-1);return}p(t,t-1)}function N(){let t=_();if(t===-1){i.warn("移动失败："+t);return}if(t==m(a).length-1){p(t,0);return}p(t,t+1)}function p(t,d){if(t!==d){let c=[...m(a)],g=c[t];c[t]=c[d],c[d]=g,r.emitValue(c.map(f=>f.url).join(","))}}function _(){var d,c;const t=(c=(d=r.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:c.src;if(t){const g=m(a);for(let f=0;f<g.length;f++){let L=g[f].url;const U=t.replace(window.location.origin,"");if(L===U||encodeURI(L)===U)return f}}return-1}function A(){var d,c;const t=(c=(d=r.element)==null?void 0:d.getElementsByTagName("img")[0])==null?void 0:c.src;window.open(t)}return(t,d)=>(C(),k(X,null,[z(h("div",be,[h("a",{class:"download",title:"下载",onClick:A},[b(m(x),{icon:"ant-design:download"})])],512),[[R,l.download]]),z(h("div",we,[h("a",{title:"向前移动",onClick:w},[b(m(x),{icon:"ant-design:arrow-left"})]),h("a",{title:"向后移动",onClick:N},[b(m(x),{icon:"ant-design:arrow-right"})])],512),[[R,l.mover&&a.value.length>1]])],64))}}),Ce={key:0},xe={class:"ant-upload-text"},K="ant-upload-list-item",Ne=Q({__name:"JUpload",props:{value:u.oneOfType([u.string,u.array]),text:u.string.def("上传"),fileType:u.string.def(I.all),bizPath:u.string.def("temp"),returnUrl:u.bool.def(!0),maxCount:u.number.def(0),buttonVisible:u.bool.def(!0),multiple:u.bool.def(!0),mover:u.bool.def(!0),download:u.bool.def(!0),removeConfirm:u.bool.def(!1),beforeUpload:u.func,disabled:u.bool.def(!1),replaceLastOne:u.bool.def(!1)},emits:["change","update:value"],setup(l,{expose:r,emit:i}){const a=l,{createMessage:w,createConfirm:N}=Y(),{prefixCls:p}=me("j-upload"),_=pe(),A=ge(),t=O([]),d=O(!0),c=O(),g=y(()=>a.maxCount>0&&t.value.length>=a.maxCount),f=y(()=>a.fileType===I.image),L=y(()=>a.disabled===!0?!0:g.value===!0?a.replaceLastOne!==!0:!1),U=y(()=>{const e=Object.assign({},a,m(_));return e.name="file",e.listType=f.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":a.disabled}],e.data=j({biz:a.bizPath},e.data),e.beforeUpload||(e.beforeUpload=Z),f.value&&!e.accept&&(e.accept="image/*"),e});D(()=>a.value,e=>{Array.isArray(e)?a.returnUrl?T(e.join(",")):E(e):a.returnUrl?T(e):e&&E(JSON.parse(e))},{immediate:!0}),D(t,()=>ie(()=>V()),{immediate:!0});function V(){if(!f.value)return;const e=c.value?c.value.getElementsByClassName(K):null;if(!(!e||e.length===0))for(const s of e)s.getAttribute("data-has-actions")==="true"||s.addEventListener("mouseover",M)}function M(e){const n=(()=>{for(const P of e.path){if(P.classList.contains(K))return P;if(P.classList.contains(`${p}-container`))return null}return null})();if(!n)return;const o=n.getElementsByClassName("ant-upload-list-item-actions");if(!o||o.length===0)return;const v=document.createElement("div");v.className="upload-actions-container",ue(ye,{element:n,fileList:t,mover:a.mover,download:a.download,emitValue:B}).mount(v),o[0].appendChild(v),n.setAttribute("data-has-actions","true"),n.removeEventListener("mouseover",M)}function T(e){if(!e||e.length==0){t.value=[];return}let s=[];for(const n of e.split(",")){let o=F(n);s.push({uid:$(),name:se(n),status:"done",url:o,response:{status:"history",message:n}})}t.value=s}function E(e){if(!e||e.length==0){t.value=[];return}let s=[];for(const n of e){let o=F(n.filePath);s.push({uid:$(),name:n.fileName,url:o,status:"done",response:{status:"history",message:n.filePath}})}t.value=s}function Z(e){return d.value=!0,f.value&&e.type.indexOf("image")<0?(w.warning("请上传图片"),d.value=!1,!1):typeof a.beforeUpload=="function"?a.beforeUpload(e):!0}function ee(){return a.removeConfirm?new Promise(e=>{N({title:"删除",content:`确定要删除这${f.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}):!0}function te(e){!e.file.status&&d.value===!1&&e.fileList.pop();let s=e.fileList;if(a.maxCount>0&&s.length>=a.maxCount)if(a.maxCount-s.length>=0)s=s.slice(-a.maxCount);else return;if(e.file.status==="done"){let n=[];e.file.response.success?n=s.map(o=>{if(o.response){let v=o.response.message;o.url=F(v)}return o}):(n=s.filter(o=>o.uid!=e.file.uid),w.error(`${e.file.name} 上传失败.`)),s=n}else e.file.status==="error"&&w.error(`${e.file.name} 上传失败.`);if(t.value=s,e.file.status==="done"||e.file.status==="removed")if(a.returnUrl)ne();else{let n=[];for(const o of s)if(o.status==="done"){let v={fileName:o.name,filePath:o.response.message,fileSize:o.size};n.push(v)}else return;B(JSON.stringify(n))}}function ne(){let e=t.value,s="";(!e||e.length==0)&&(s="");let n=[];for(const o of e)if(o.status==="done")n.push(o.response.message);else return;n.length>0&&(s=n.join(",")),B(s)}function ae(e){f.value?he({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function B(e){i("change",e),i("update:value",e)}function $(){return"-"+parseInt(Math.random()*1e4+1,10)}function se(e){if(e.lastIndexOf("\\")>=0){let s=new RegExp("\\\\","g");e=e.replace(s,"/")}return e.substring(e.lastIndexOf("/")+1)}return r({addActionsListener:V}),(e,s)=>{const n=J("a-button"),o=J("a-upload");return C(),k("div",{ref_key:"containerRef",ref:c,class:fe(`${m(p)}-container`)},[b(o,de({headers:m(A),multiple:l.multiple,action:m(ve),fileList:t.value,disabled:l.disabled},U.value,{onRemove:ee,onChange:te,onPreview:ae}),{default:H(()=>[f.value?(C(),k(X,{key:0},[g.value?W("",!0):(C(),k("div",Ce,[b(m(x),{icon:"ant-design:plus-outlined"}),h("div",xe,G(l.text),1)]))],64)):l.buttonVisible?(C(),ce(n,{key:1,disabled:L.value},{default:H(()=>[b(m(x),{icon:"ant-design:upload-outlined"}),h("span",null,G(l.text),1)]),_:1},8,["disabled"])):W("",!0)]),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{I as U,Ne as _};
