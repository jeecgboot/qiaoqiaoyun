var ue=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var H=(e,t,s)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,R=(e,t)=>{for(var s in t||(t={}))ye.call(t,s)&&H(e,s,t[s]);if(E)for(var s of E(t))fe.call(t,s)&&H(e,s,t[s]);return e},V=(e,t)=>me(e,ge(t));var z=(e,t,s)=>new Promise((p,r)=>{var f=a=>{try{l(s.next(a))}catch(i){r(i)}},g=a=>{try{l(s.throw(a))}catch(i){r(i)}},l=a=>a.done?p(a.value):Promise.resolve(a.value).then(f,g);l((s=s.apply(e,t)).next())});import{d as O,f as b,e as U,u as S,w as Y,a3 as nt,a4 as it,V as c,a6 as m,af as D,a8 as Z,ai as v,a7 as M,F as J,am as he,ae as Q,k as d,a5 as G,E as ve,ak as K,W as T,r as ee,o as _e,g as ke,ag as be}from"./vue-vendor-24c7dc61.js";import{a6 as W,V as $,cF as we,a0 as x,P as Ce,cG as Me,a7 as q,a1 as Se}from"./antd-vue-vendor-0d72f01e.js";import{k as te,h as ae,ac as Be,l as L,c2 as Ne,a7 as se,b as oe,b9 as De,bz as Ae,a as Ie,d as Te,e as P,bB as $e}from"./index-831af9dd.js";import{T as je}from"./index-6507b9cd.js";import Ue from"./DetailModal-e4466009.js";import Ge from"./DynamicNotice-6f420954.js";import"./index-1c3affea.js";import{c as Re,o as ze}from"./useWebSocket-df578a5f.js";import{r as Pe}from"./mynews.api-87c0b0d4.js";import Oe from"./SysMessageModal-0e482b8d.js";import Le from"./AddressBook-ce96655c.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./useFormItem-86503382.js";import"./AddressLeftTree-f084803d.js";import"./AddressBookMore-5a4ee64b.js";import"./header-55b09394.js";import"./FileList.api-9749c044.js";var ne=(e=>(e.L="L",e.M="M",e.H="H",e))(ne||{});const Fe=[{key:"1",name:"通知",list:[{id:"000000001",avatar:"https://gw.alipayobjects.com/zos/rmsportal/ThXAXghbEsBCCSDihZxY.png",title:"你收到了 14 份新周报",description:"",datetime:"2017-08-09",type:"1"},{id:"000000002",avatar:"https://gw.alipayobjects.com/zos/rmsportal/OKJXDXrmkNshAMvwtvhu.png",title:"你推荐的 曲妮妮 已通过第三轮面试",description:"",datetime:"2017-08-08",type:"1"},{id:"000000003",avatar:"https://gw.alipayobjects.com/zos/rmsportal/kISTdvpyTAhtGxpovNWd.png",title:"这种模板可以区分多种通知类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000004",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000005",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"标题可以设置自动显示省略号，本例中标题行数已设为1行，如果内容超过1行将自动截断并支持tooltip显示完整标题。",description:"",datetime:"2017-08-07",type:"1"},{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000009",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"},{id:"000000010",avatar:"https://gw.alipayobjects.com/zos/rmsportal/GvqBnKhFgObvnSGkDsje.png",title:"左侧图标用于区分不同的类型",description:"",datetime:"2017-08-07",type:"1"}],count:0},{key:"2",name:"系统消息",list:[{id:"000000006",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"曲丽丽 评论了你",description:"描述信息描述信息描述信息",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000007",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"朱偏右 回复了你",description:"这种模板用于提醒谁与你发生了互动",datetime:"2017-08-07",type:"2",clickClose:!0},{id:"000000008",avatar:"https://gw.alipayobjects.com/zos/rmsportal/fcHMVNCjPOsbUGdEduuv.jpeg",title:"标题",description:"请将鼠标移动到此处，以便测试超长的消息在此处将如何处理。本例中设置的描述最大行数为2，超过2行的描述内容将被省略并且可以通过tooltip查看完整内容",datetime:"2017-08-07",type:"2",clickClose:!0}],count:0}];const Ee=e=>te.get({url:"/sys/annountCement/listByUser",params:e}),X=(e,t)=>te.put({url:"/sys/sysAnnouncementSend/editByAnntIdAndUserId",params:R({anntId:e},t)});const He=O({components:{[W.name]:W,[$.name]:$,[$.Item.name]:$.Item,AListItemMeta:$.Item.Meta,ATypographyParagraph:we.Paragraph,[x.name]:x,Time:je},props:{list:{type:Array,default:()=>[]},pageSize:{type:[Boolean,Number],default:5},currentPage:{type:Number,default:1},titleRows:{type:Number,default:1},descRows:{type:Number,default:1},onTitleClick:{type:Function}},emits:["update:currentPage"],setup(e,{emit:t}){const{prefixCls:s}=ae("header-notify-list"),p=b(e.currentPage||1),r=U(()=>{const{pageSize:a,list:i}=e;if(a===!1)return[];let u=Be(a)?a:5;return i.slice(u*(S(p)-1),u*S(p))});Y(()=>e.currentPage,a=>{p.value=a});const f=U(()=>!!e.onTitleClick),g=U(()=>{const{list:a,pageSize:i}=e;return i>0&&a&&a.length>i?{total:a.length,pageSize:i,current:S(p),onChange(u){p.value=u,t("update:currentPage",u)}}:!1});function l(a){e.onTitleClick&&e.onTitleClick(a)}return{prefixCls:s,getPagination:g,getData:r,handleTitleClick:l,isTitleClickable:f,PriorityTypes:ne}}});const Ve={class:"title"},Je={key:0,class:"extra"},Ke={key:2},We={key:0,class:"description"},xe={class:"datetime"};function qe(e,t,s,p,r,f){const g=c("a-typography-paragraph"),l=c("a-tag"),a=c("a-avatar"),i=c("Icon"),u=c("Time"),h=c("a-list-item-meta"),C=c("a-list-item"),_=c("a-list");return m(),D(_,{class:Z(e.prefixCls),pagination:e.getPagination},{default:v(()=>[(m(!0),M(J,null,he(e.getData,n=>(m(),D(C,{key:n.id,class:"list-item",onClick:B=>e.handleTitleClick(n),style:Q({cursor:e.isTitleClickable?"pointer":""})},{default:v(()=>[d(h,null,{title:v(()=>[G("div",Ve,[d(g,{style:{width:"100%","margin-bottom":"0 !important"},delete:!!n.titleDelete,ellipsis:e.$props.titleRows&&e.$props.titleRows>0?{rows:e.$props.titleRows,tooltip:!!n.title}:!1,content:n.title},null,8,["delete","ellipsis","content"]),n.extra?(m(),M("div",Je,[d(l,{class:"tag",color:n.color},{default:v(()=>[ve(K(n.extra),1)]),_:2},1032,["color"])])):T("",!0)])]),avatar:v(()=>[n.avatar?(m(),D(a,{key:0,class:"avatar",src:n.avatar},null,8,["src"])):n.priority?(m(),M(J,{key:1},[n.priority===e.PriorityTypes.L?(m(),D(a,{key:0,class:"avatar priority-L",title:"一般消息"},{icon:v(()=>[d(i,{icon:"entypo:info"})]),_:1})):T("",!0),n.priority===e.PriorityTypes.M?(m(),D(a,{key:1,class:"avatar priority-M",title:"重要消息"},{icon:v(()=>[d(i,{icon:"bi:exclamation-lg"})]),_:1})):T("",!0),n.priority===e.PriorityTypes.H?(m(),D(a,{key:2,class:"avatar priority-H",title:"紧急消息"},{icon:v(()=>[d(i,{icon:"ant-design:warning-filled"})]),_:1})):T("",!0)],64)):(m(),M("span",Ke,K(n.avatar),1))]),description:v(()=>[G("div",null,[n.description?(m(),M("div",We,[d(g,{style:{width:"100%","margin-bottom":"0 !important"},ellipsis:e.$props.descRows&&e.$props.descRows>0?{rows:e.$props.descRows,tooltip:!!n.description}:!1,content:n.description},null,8,["ellipsis","content"])])):T("",!0),G("div",xe,[d(u,{value:n.datetime,title:n.datetime},null,8,["value","title"])])])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1},8,["class","pagination"])}const Xe=L(He,[["render",qe],["__scopeId","data-v-f011ee3f"]]),Ye=O({name:"JNewChat",props:{chatStatus:{type:String},titleHeight:{type:Number,default:50},isLowApp:{type:Boolean,default:!1}},emits:["update:chatStatus","showMessageModal","getSystemUnreadNum","getAddressBook","expand","clearAllUnMessage"],setup(e,{emit:t}){const s=b(Ne(16)),{createMessage:p}=Ie(),r=ee({width:"0px",height:"0px",right:"8px"}),f=se();let g=oe(),l=f.getTenant;De(Ae,s.value);const a=window._CONFIG.domianURL+`/eoa/im/newApi/index?token=${g}&messageId=${s.value}&tenantId=${l}`,i=b(""),u=b(!1),h=b(!1);window.addEventListener("message",function(_){let{messageId:n,type:B,data:k}=_.data;if(`${s.value}`===n)switch(B){case"expand-change":k.expand===!0?t("expand",!0):t("expand",!1);break;case"change-size":let N=k.height,w=document.body;N.indexOf("calc")!=-1&&!S(h)?(w.setAttribute("class","hide-scrollbar"),h.value=!0):N.indexOf("calc")==-1&&N!="100%"&&S(h)&&(w.setAttribute("class","show-scrollbar"),h.value=!1),r.width=k.width,r.height=k.height;break;case"show-info":p.info(k.message),t("update:chatStatus",JSON.stringify(k.status));break;case"get-dialog-height":document.getElementById("jChatOnline").contentWindow.postMessage({type:"change-height",messageId:`${s.value}`,data:{titleHeight:e.titleHeight}},"*");break;case"system-click":t("showMessageModal");break;case"get-system-unread-num":u.value=!0,t("getSystemUnreadNum");break;case"address-book-click":t("getAddressBook");break;case"clear-all-message":t("clearAllUnMessage");break}},!1);function C(_){S(u)&&document.getElementById("jChatOnline").contentWindow.postMessage({type:"system-unread-num",messageId:s.value,data:{systemUnreadNum:_}},"*")}return Y(()=>e.isLowApp,_=>{_===!0?(r.right="1px",i.value=a+"&hideClose=1"):(r.right="8px",i.value=a)},{immediate:!0}),{chatStyle:r,chatUrl:i,updateMessageCount:C}}});const Ze=["src"];function Qe(e,t,s,p,r,f){return m(),M("div",{class:"j-chat-online",style:Q(e.chatStyle)},[G("iframe",{src:e.chatUrl,id:"jChatOnline"},null,8,Ze)],4)}const et=L(Ye,[["render",Qe],["__scopeId","data-v-6f7b2536"]]),tt=O({components:{AddressBook:Le,Popover:Ce,BellOutlined:Me,Tabs:q,TabPane:q.TabPane,Badge:Se,NoticeList:Xe,DetailModal:Ue,DynamicNotice:Ge,SysMessageModal:Oe,JNewChat:et},setup(){const{prefixCls:e}=ae("header-notify"),t=ke(),s=se(),p=Te(),r=ee({path:"",formData:{}}),[f,g]=P(),l=b(Fe),a=U(()=>{let o=0;for(let y=0;y<l.value.length;y++)o+=l.value[y].count;return o}),i=b(),[u,{openModal:h}]=P(),[C,{openModal:_}]=P();function n(){for(let o=0;o<l.value.length;o++)l.value[o].count=0;h(!0,{})}const B=b(!1);_e(()=>{ie()});const k=b(0);function N(o){return V(R({},o),{title:o.titile,description:o.msgAbstract,datetime:o.sendTime})}function w(){return z(this,null,function*(){try{let{anntMsgList:o,sysMsgList:y,anntMsgTotal:A,sysMsgTotal:j}=yield Ee({pageSize:5});l.value[0].list=o.map(N),l.value[1].list=y.map(N),l.value[0].count=A,l.value[1].count=j;let I=A+j;i.value.updateMessageCount(I),k.value=I}catch(o){}})}w();function F(o){var y;try{X(o.id),w()}catch(A){}o.openType==="component"?(r.path=o.openPage,r.formData={id:o.busId},(y=t.refs.dynamicNoticeRef)==null||y.detail(o.openPage)):g.openModal(!0,{record:o,isUpdate:!0}),B.value=!1}function ie(){var I;let o=oe(),y=$e(o),A=S(s.getUserInfo).id+"_"+y,j=((I=p.domainUrl)==null?void 0:I.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+A;Re(j),ze(le)}function le(o){(o.cmd==="topic"||o.cmd==="user")&&setTimeout(()=>{w()},1e3)}function re(){B.value=!1,Pe({},w)}function ce(o){return z(this,null,function*(){try{yield X(o),yield w()}catch(y){}})}function de(){i.value.updateMessageCount(k.value)}function pe(){_(!0,{})}return{prefixCls:e,listData:l,count:a,clickBadge:n,registerMessageModal:u,reloadCount:ce,onNoticeClick:F,onEmptyNotify:re,numberStyle:{},popoverVisible:B,registerDetail:f,dynamicNoticeProps:r,chatRef:i,getSystemUnreadNum:de,clickAddressBook:pe,registerBookModal:C}}});function at(e,t,s,p,r,f){const g=c("BellOutlined"),l=c("Badge"),a=c("DynamicNotice"),i=c("DetailModal"),u=c("sys-message-modal"),h=c("address-book"),C=c("JNewChat");return m(),M("div",{class:Z(e.prefixCls)},[d(l,{count:e.count,overflowCount:9,offset:[-4,10],numberStyle:e.numberStyle,onClick:e.clickBadge},{default:v(()=>[d(g)]),_:1},8,["count","numberStyle","onClick"]),d(a,be({ref:"dynamicNoticeRef"},e.dynamicNoticeProps),null,16),d(i,{onRegister:e.registerDetail},null,8,["onRegister"]),d(u,{onRegister:e.registerMessageModal,onRefresh:e.reloadCount},null,8,["onRegister","onRefresh"]),d(h,{onRegister:e.registerBookModal},null,8,["onRegister"]),d(C,{ref:"chatRef",onShowMessageModal:e.clickBadge,onGetSystemUnreadNum:e.getSystemUnreadNum,onGetAddressBook:e.clickAddressBook},null,8,["onShowMessageModal","onGetSystemUnreadNum","onGetAddressBook"])],2)}const At=L(tt,[["render",at]]);export{At as default};
