var H=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var M=(n,e,s)=>e in n?H(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,R=(n,e)=>{for(var s in e||(e={}))Q.call(e,s)&&M(n,s,e[s]);if(F)for(var s of F(e))X.call(e,s)&&M(n,s,e[s]);return n},z=(n,e)=>J(n,K(e));var k=(n,e,s)=>new Promise((a,I)=>{var v=d=>{try{p(s.next(d))}catch(m){I(m)}},g=d=>{try{p(s.throw(d))}catch(m){I(m)}},p=d=>d.done?a(d.value):Promise.resolve(d.value).then(v,g);p((s=s.apply(n,e)).next())});import{bI as Y,p as Z}from"./antd-vue-vendor-0d72f01e.js";import{f as h,h as $,e as O,n as ee,a3 as te,a4 as ae,a5 as c,V as _,a6 as b,a7 as A,k as r,ai as u,a8 as oe,ak as T,af as j,z as ne,W as le,E as L,F as se,am as de}from"./vue-vendor-24c7dc61.js";import{m as x}from"./low.app.api-97fc250a.js";import{d as ie}from"./vuedraggable-vendor-6ef4bc68.js";import{u as re}from"./lowAppAuth-3d637b7d.js";import{l as ue}from"./index-831af9dd.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";const ce={name:"AppGroupMenu",components:{CaretDownOutlined:Y,draggable:ie},props:{activeId:{type:String,default:""},groupList:{type:Array,default:()=>[]},appId:{type:String,default:""},hasSub:{type:Boolean,default:!1}},emits:["active","added","reload"],setup(n,{emit:e}){const s=re(),a=h(!1),I=h(!1),v=h([]),g=h(!1),p=h([]),d=h("");let m="";$(()=>{let t=[];for(let l of n.groupList){let i=z(R({},Z(l,"id","menuName","orderNum")),{update:!1,action:!1});m==l.id&&(i.update=!0),t.push(i)}v.value=t,a.value=s.getLowAppAdminAuth()});function N(t,l){t.preventDefault(),t.stopPropagation(),e("active",l.id)}function V(t){return n.activeId==t.id?"active":""}function G(t,l){return k(this,null,function*(){let i=t.key;if(i=="update")l.update=!0;else if(i=="add"){let y={menuName:"未命名分组",appId:n.appId};const E=yield x.createOrUpdateGroup(y,!1);m=E,e("added",E)}else i=="delete"&&(v.value.length>1&&n.hasSub===!0?(d.value=l.id,g.value=!0,p.value=[]):(yield x.deleteGroup({deleteId:l.id}),e("reload","")));l.action=!1})}function B(t){return k(this,null,function*(){t.menuName||(t.menuName="未命名分组"),yield x.updateName({id:t.id,menuName:t.menuName}),t.update=!1,m="",e("reload",n.activeId)})}const D=O(()=>{if(v.value.length>1){let t=v.value.filter(i=>i.id!=d.value),l=[];for(let i of t)l.push({value:i.id,label:i.menuName});return l}return[]}),w=O(()=>!(p.value&&p.value.length>0));function S(){return k(this,null,function*(){let t={deleteId:d.value,groupId:p.value};yield x.deleteGroup(t),e("reload",p.value),g.value=!1})}function o(){f()}function f(){return k(this,null,function*(){let t=v.value,l=[];for(let y=0;y<t.length;y++)l.push({id:t[y].id,orderNum:y+1});let i={info:l};yield x.changeOrder(i),e("reload",n.activeId)})}const P=O(()=>{let t=v.value;return!!(t&&t.length>0&&t.filter(i=>i.update==!0).length>0)}),U=h();function W(t,l){t&&ee(()=>{U[l]=t,U[l].focus()})}function q(t){t.target.select()}return{actionVisible:I,onClickItem:N,getActiveClass:V,handleActionClick:G,menuList:v,onBlur:B,deleteConfirmVisible:g,updateGroupId:p,deleteId:d,selectOptions:D,disabledDeleteButton:w,doRemove:S,onDragEnd:o,hasAdminAuth:a,disabledDrag:P,setItemRef:W,onFocus:q}}},C=n=>(te("data-v-fbcccf97"),n=n(),ae(),n),pe={class:"app-group-menu"},fe=["onClick"],me={key:0,class:"label"},_e={key:1,class:"label"},ve=C(()=>c("span",{class:"label"},"重命名",-1)),ge=C(()=>c("span",{class:"label"},"添加分组",-1)),he=C(()=>c("span",{class:"label"},"删除分组",-1)),ye={style:{padding:"0px 20px 15px 20px"}},be=C(()=>c("div",{style:{color:"#757575","font-size":"14px",margin:"16px 0 24px"}}," 当前分组下包含工作表,必须将他们移到其他分组后再进行删除 ",-1)),Ce={class:"inputVerify",style:{display:"flex","padding-bottom":"10px"}},Ie=C(()=>c("div",{style:{color:"#757575",height:"30px","line-height":"30px"}},"移动到:",-1)),ke={style:{"margin-left":"10px"}},xe=C(()=>c("div",{style:{color:"#f44336","font-size":"17px","font-weight":"700"}},[c("span",null,"删除分组")],-1));function we(n,e,s,a,I,v){const g=_("a-input"),p=_("CaretDownOutlined"),d=_("Icon"),m=_("a-menu-item"),N=_("a-menu"),V=_("a-dropdown"),G=_("draggable"),B=_("a-select-option"),D=_("a-select"),w=_("a-button"),S=_("a-modal");return b(),A("div",pe,[r(G,{"item-key":"id",animation:"300",tag:"ul",group:"menu",disabled:a.disabledDrag,modelValue:a.menuList,"onUpdate:modelValue":e[1]||(e[1]=o=>a.menuList=o),dragClass:"dragClass",onEnd:a.onDragEnd},{item:u(({element:o})=>[c("li",{class:oe(a.getActiveClass(o))},[c("div",{class:"group-item",onClick:f=>a.onClickItem(f,o)},[o.update?(b(),A("span",me,[r(g,{ref:f=>a.setItemRef(f,`rename${o.id}`),value:o.menuName,"onUpdate:value":f=>o.menuName=f,onBlur:f=>a.onBlur(o),onFocus:a.onFocus},null,8,["value","onUpdate:value","onBlur","onFocus"])])):(b(),A("span",_e,T(o.menuName),1)),a.hasAdminAuth?(b(),j(V,{key:2,open:o.action,"onUpdate:open":f=>o.action=f,trigger:["click"],overlayClassName:"app-item-actions-dropdown"},{overlay:u(()=>[r(N,{onClick:f=>a.handleActionClick(f,o)},{default:u(()=>[r(m,{key:"update"},{default:u(()=>[r(d,{icon:"ant-design:edit-outlined",style:{"margin-right":"10px"}}),ve]),_:1}),r(m,{key:"add"},{default:u(()=>[r(d,{icon:"ant-design:plus-outlined",style:{"margin-right":"10px"}}),ge]),_:1}),r(m,{key:"delete",class:"delete-item"},{default:u(()=>[r(d,{icon:"ant-design:delete-outlined",style:{"margin-right":"10px"}}),he]),_:1})]),_:2},1032,["onClick"])]),default:u(()=>[c("div",{onClick:e[0]||(e[0]=ne(()=>{},["prevent"])),class:"group-action"},[r(p)])]),_:2},1032,["open","onUpdate:open"])):le("",!0)],8,fe)],2)]),_:1},8,["disabled","modelValue","onEnd"]),r(S,{open:a.deleteConfirmVisible,"onUpdate:open":e[5]||(e[5]=o=>a.deleteConfirmVisible=o),wrapClassName:"remove-confirm-mdoal",width:"480px",destroyOnClose:"",centered:""},{footer:u(()=>[r(w,{onClick:e[3]||(e[3]=o=>a.deleteConfirmVisible=!1)},{default:u(()=>[L("取消")]),_:1}),r(w,{type:"primary",danger:"",onClick:e[4]||(e[4]=o=>a.doRemove()),disabled:a.disabledDeleteButton},{default:u(()=>[L("删除")]),_:1},8,["disabled"])]),title:u(()=>[xe]),default:u(()=>[c("div",ye,[be,c("div",Ce,[Ie,c("div",ke,[r(D,{placeholder:"请选择",value:a.updateGroupId,"onUpdate:value":e[2]||(e[2]=o=>a.updateGroupId=o),style:{width:"240px"}},{default:u(()=>[(b(!0),A(se,null,de(a.selectOptions,o=>(b(),j(B,{value:o.value},{default:u(()=>[L(T(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])])])])]),_:1},8,["open"])])}const Ue=ue(ce,[["render",we],["__scopeId","data-v-fbcccf97"]]);export{Ue as default};
