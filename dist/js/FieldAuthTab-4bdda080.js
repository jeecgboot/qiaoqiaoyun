var $=Object.defineProperty,D=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var M=(t,e,o)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,w=(t,e)=>{for(var o in e||(e={}))q.call(e,o)&&M(t,o,e[o]);if(F)for(var o of F(e))N.call(e,o)&&M(t,o,e[o]);return t},k=(t,e)=>D(t,V(e));var _=(t,e,o)=>new Promise((u,d)=>{var b=r=>{try{a(o.next(r))}catch(l){d(l)}},m=r=>{try{a(o.throw(r))}catch(l){d(l)}},a=r=>r.done?u(r.value):Promise.resolve(r.value).then(b,m);a((o=o.apply(t,e)).next())});import"./index-621e597c.js";import{d as E,f as A,e as H,w as O,V as f,a6 as h,a7 as v,F as C,k as y,ai as T,ag as L,af as B,am as W,W as j}from"./vue-vendor-24c7dc61.js";import{H as K,e as z,l as G}from"./index-831af9dd.js";import"./index-1c3affea.js";import{f as P}from"./auth.api-15f2ddd8.js";import J from"./DataAuthModal-e287ce29.js";import Q from"./FieldAuthTable-0d4d7166.js";import U from"./FieldAuthSettingModal-56af33f0.js";import X from"./BasicTable-d435f501.js";import{T as Y}from"./componentMap-c857637c.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./desformUtils-c7daaa89.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./useFormItem-86503382.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./EasyCronInput-b2123242.js";import"./JCheckbox-0b89d32a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./JImageUpload-d644253a.js";import"./auth.data-0f6cd267.js";import"./useListPage-62a041ef.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";const Z=E({name:"FieldAuthTab",components:{FieldAuthSettingModal:U,BasicTable:X,TableAction:Y,DataAuthModal:J,FieldAuthTable:Q},props:{visible:K.bool.def(!1),desformRecord:K.any.isRequired},setup(t){const e=A(!1),o=A([]),u=A([]),[d,b]=z(),m=H(()=>({onAuth:l,onReload:a,onDelete:s=>r.apply(null,s)}));O(()=>t.visible,()=>{t.visible&&t.desformRecord&&a()},{immediate:!0});function a(){return _(this,arguments,function*(s={}){var n;e.value=!0;try{let g=yield P.query(k(w({},s),{group:!0}),(n=t.desformRecord)==null?void 0:n.desformCode),c=[],p={};for(let i of g)if(i.subTable){let R=p[i.subKey]||{title:i.subTitle,key:i.subKey,list:[],selectedRowKeys:[],selectionRows:[]};R.list.push(i),p[i.subKey]=R}else c.push(i);let S=[];for(let i in p)p.hasOwnProperty(i)&&S.push(p[i]);o.value=c,u.value=S}finally{e.value=!1}})}function r(s,n){return _(this,null,function*(){var c;let g=(c=t.desformRecord)==null?void 0:c.desformCode;try{let p=yield P.deleteByAuthComKey(g,s);a(),n&&n(p)}finally{}})}function l(s){b.openModal(!0,{record:s})}return{loading:e,dataSource:o,subTableList:u,tableProps:m,registerAuthSettingModal:d}}});function I(t,e,o,u,d,b){const m=f("FieldAuthTable"),a=f("a-tab-pane"),r=f("a-tabs"),l=f("a-spin"),s=f("FieldAuthSettingModal");return h(),v(C,null,[y(l,{spinning:t.loading},{default:T(()=>[y(m,L({dataSource:t.dataSource,showTableSetting:""},t.tableProps),null,16,["dataSource"]),t.subTableList.length>0?(h(),B(r,{key:0,style:{"margin-top":"20px"}},{default:T(()=>[(h(!0),v(C,null,W(t.subTableList,n=>(h(),B(a,{key:n.key,tab:n.title},{default:T(()=>[y(m,L({dataSource:n.list},t.tableProps),null,16,["dataSource"])]),_:2},1032,["tab"]))),128))]),_:1})):j("",!0)]),_:1},8,["spinning"]),y(s,{onRegister:t.registerAuthSettingModal},null,8,["onRegister"])],64)}const xt=G(Z,[["render",I]]);export{xt as default};
