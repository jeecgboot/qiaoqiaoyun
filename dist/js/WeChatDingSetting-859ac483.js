var V=Object.defineProperty,P=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var B=(i,t,a)=>t in i?V(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a,F=(i,t)=>{for(var a in t||(t={}))G.call(t,a)&&B(i,a,t[a]);if(A)for(var a of A(t))O.call(t,a)&&B(i,a,t[a]);return i},E=(i,t)=>P(i,q(t));var p=(i,t,a)=>new Promise((D,o)=>{var c=r=>{try{m(a.next(r))}catch(f){o(f)}},y=r=>{try{m(a.throw(r))}catch(f){o(f)}},m=r=>r.done?D(r.value):Promise.resolve(r.value).then(c,y);m((a=a.apply(i,t)).next())});import{d as z,f as u,o as H,a6 as k,a7 as x,a5 as l,k as M,ae as S,u as n,ak as w,W as L,a8 as J}from"./vue-vendor-24c7dc61.js";import{f as K,h as Q,i as R}from"./UserSetting.api-d09d4ebb.js";import{h as X,a7 as Y,d as Z,a as ee}from"./index-831af9dd.js";import{b6 as se,ci as te,cj as ae,M as ne}from"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";const ie=l("div",{class:"my-account"},"第三方APP",-1),le={class:"account-row-item"},oe=l("div",{class:"account-label gray-75"},"钉钉绑定",-1),re=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"钉钉",-1),ce={key:0,class:"gray-75",style:{"margin-left":"8px"}},de={class:"account-row-item"},ue=l("div",{class:"account-label gray-75"},"账号绑定",-1),fe=l("span",{class:"gray-75",style:{"margin-left":"12px"}},"微信",-1),ge={key:0,class:"gray-75",style:{"margin-left":"8px"}},pe=z({name:"we-chat-ding-setting"}),Ie=z(E(F({},pe),{setup(i){const{prefixCls:t}=X("j-user-tenant-setting-container"),a=se({scriptUrl:"//at.alicdn.com/t/font_2316098_umqusozousr.js"}),D=Y(),o=u({}),c=u({}),y=u({}),m=Z(),r=u(""),f=u(""),ye=u({}),{createMessage:g}=ee(),_=u(""),v=u("");function T(){return p(this,null,function*(){let e=yield K({thirdType:"wechat_open,dingtalk,wechat_enterprise"});if(o.value="",c.value="",y.value="",e&&e.result){let s=e.result;for(let d=0;d<s.length;d++)C(s[d])}})}function me(){let e=n(y);e.sysUserId?I({sysUserId:e.sysUserId,id:e.id},"企业微信"):U("wechat_enterprise")}function W(){let e=n(c);e.sysUserId?I({sysUserId:e.sysUserId,id:e.id},"钉钉"):U("dingtalk")}function $(){let e=n(o);e.sysUserId?I({sysUserId:e.sysUserId,id:e.id},"微信"):U("wechat_open")}function U(e){let s=`${m.uploadUrl}/sys/thirdLogin/render/${e}`;n(_)&&(_.value.close(),window.removeEventListener("message",n(v),!1)),_.value=window.open(s,`login ${e}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),r.value=e,v.value=function(d){return p(this,null,function*(){let h=d.data;if(typeof h=="string")if(h==="登录失败")b();else if(h.includes("绑定手机号")){let N=h.split(",");f.value=N[1],yield j()}else h&&g.warning("该敲敲云账号已被其它第三方账号绑定,请解绑或绑定其它敲敲云账号");else b();window.removeEventListener("message",n(v),!1),_.value=""})},window.addEventListener("message",n(v),!1)}function j(){return p(this,null,function*(){if(!n(f)){b();return}let e={thirdUserUuid:n(f),thirdType:n(r)};yield Q(e).then(s=>{s.success?s.result&&C(s.result):g.warning(s.message)}).catch(s=>{g.warning(s.message)})})}function b(){g.warning("第三方账号绑定异常")}function C(e){let s=e.thirdType;s=="wechat_open"?o.value=e:s=="dingtalk"?c.value=e:s=="wechat_enterprise"&&(y.value=e)}function I(e,s){return p(this,null,function*(){ne.confirm({title:"解绑"+s,content:"确定要解绑吗",okText:"确认",cancelText:"取消",onOk:()=>p(this,null,function*(){yield R(e).then(d=>{d.success?(T(),g.success(d.message)):g.warning(d.message)})})})})}return H(()=>{T()}),(e,s)=>(k(),x("div",{class:J([`${n(t)}`])},[ie,l("div",le,[oe,l("span",null,[M(n(te),{style:S(c.value.sysUserId?{color:"#007FFF"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),re,c.value.realname?(k(),x("span",ce,w("已绑定："+c.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:W},w(c.value.sysUserId?"解绑":"绑定"),1)])]),l("div",de,[ue,l("span",null,[M(n(ae),{style:S(o.value.sysUserId?{color:"#1ec563"}:{color:"#9e9e9e"}),class:"item-icon"},null,8,["style"]),fe,o.value.realname?(k(),x("span",ge,w("已绑定："+o.value.realname),1)):L("",!0),l("span",{class:"blue-e5 pointer",style:{"margin-left":"24px"},onClick:$},w(o.value.sysUserId?"解绑":"绑定"),1)])])],2))}}));export{Ie as default};
