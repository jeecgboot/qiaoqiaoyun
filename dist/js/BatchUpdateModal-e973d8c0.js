var le=Object.defineProperty;var N=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var j=(t,l,n)=>l in t?le(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,z=(t,l)=>{for(var n in l||(l={}))ae.call(l,n)&&j(t,n,l[n]);if(N)for(var n of N(l))ie.call(l,n)&&j(t,n,l[n]);return t};var Q=(t,l,n)=>new Promise((k,y)=>{var o=s=>{try{c(n.next(s))}catch(g){y(g)}},r=s=>{try{c(n.throw(s))}catch(g){y(g)}},c=s=>s.done?k(s.value):Promise.resolve(s.value).then(o,r);c((n=n.apply(t,l)).next())});import{B as ne}from"./index-1c3affea.js";import{d as re,r as Y,f as A,c as se,h as Z,e as ue,I as pe,a3 as de,a4 as ce,a5 as u,V as p,a6 as d,af as C,ai as f,k as h,a7 as B,F as x,am as me,E as P,ak as D,W as M}from"./vue-vendor-24c7dc61.js";import{u as fe}from"./lowAppAuth-3d637b7d.js";import{C as ve}from"./ComponentIcon-f1bbb90f.js";import ye from"./SuperQueryValComponent-97f284a9.js";import{c as ge,u as he}from"./LinkRecordSelect-385d0eae.js";import{j as Fe,a as Ce,l as ke}from"./index-831af9dd.js";import{i as _e}from"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./lowAppUtils-56892d30.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./SelectItem-04dd2229.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const we=re({name:"BatchUpdateModal",components:{BasicModal:ne,ComponentIcon:ve,OnlineSuperQueryValComponent:ye},props:{tableColumns:{type:Array,default:()=>[]},designFormCode:{type:String,default:""}},emits:["register","ok"],setup(t,{emit:l}){const{getDefaultRule:n,getDefaultVal:k}=he(),{createMessage:y}=Ce(),o=Y({}),r=Y({value:"update",disabledClear:!1,showUpdate:!0}),c=A(!1),s=A(""),[g,{closeModal:U}]=Fe(e=>Q(this,null,function*(){if(s.value="",o.val){let i=k(o.type);o.val=i}}));let b=se("globalColumnList",void 0);const O=fe(),_=A([]),q=["summary","link-field","sub-table-design","formula","capital-money","auto-number"];Z(()=>{let e=t.tableColumns,i=[];if(e&&e.length>0&&b){let v=b.value,m=t.designFormCode;if(m){let F=O.getExcludeUpdateFields(m)||[];for(let w of e){if(q.indexOf(w.compType)>=0)continue;let L=w.key;for(let $ of v)$.unique,L===$.key&&F&&F.indexOf(L)<0&&i.push(z({},$))}}}i.length>0&&E(i[0]),_.value=i});function T(e){let i=s.value;return i?e?e.name.indexOf(i)>=0:!1:!0}function E(e){let i=e.field||e.model,v=n(e.type),m=k(e.type),F={field:i,rule:v,val:m,type:e.type,name:e.name,rules:e.rules,required:e.required===!0,unique:e.unique===!0};e.type=="switch"&&(F.options=e.options||["Y","N"]),Object.keys(F).map(w=>{o[w]=F[w]}),c.value=!1,e.type=="switch"&&e.options&&e.options.length>1&&(o.val=e.options[1])}const a=/^1[3456789]\d{9}$/,S=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,I=ue(()=>{var v;let e={error:!1,msg:""};if(o.type=="phone"){if(o.val&&!new RegExp(a).test(o.val))return e.error=!0,e.msg="手机号码格式有误",e}else if(o.type=="email"&&o.val&&!new RegExp(S).test(o.val))return e.error=!0,e.msg="邮箱格式有误",e;let i=o.rules;if(i&&i.length>0){for(let m of i)if(m.required===!0&&(o.val||(o.required=!0)),m.pattern&&!new RegExp(m.pattern).test(o.val))return e.error=!0,e.msg=(v=m.message)!=null?v:"",e.msg=e.msg.replace("${title}",o.name),e}return e}),G=["markdown","editor","file-upload","imgupload","color","map"];function W(){r.value="update",G.indexOf(o.type)>=0||o.unique==!0?(r.value="clear",r.showUpdate=!1):r.showUpdate=!0,o.required===!0?r.disabledClear=!0:r.disabledClear=!1}function H(e){e.preventDefault(),e.stopPropagation()}const{getSchema:R}=ge({columnList:_});function J(){let e=R(pe(o));return o.type==="select-user"&&(e.componentProps.inSuperQuery=!1),o.type==="money"&&(e.componentProps.precision=2),o.type==="integer"&&(e.componentProps.precision=0),e}function K(e,i,v){v.val=i}function X(){if(r.disabledClear&&r.value=="clear"){y.info("不可清空必填字段！");return}if(r.disabledClear&&!o.val){y.info("不可清空必填字段！");return}if(o.required===!0&&!o.val){y.info("不可清空必填字段！");return}if(!(I.value&&I.value.error===!0))if(r.value=="update"){let e=o.val;e===0||e==="0"||e||(e="");let i={field:o.field,val:e};i.val&&(o.type=="year"||o.type=="month")&&(i.val=ee(e)),l("ok",i)}else{let e={field:o.field,val:""};l("ok",e)}}function ee(e){return _e(e).unix()*1e3}Z(()=>{o.field&&W()});const te=["org-role","link-record"];function oe(){te.indexOf(o.type)>=0&&(o.val="")}return{registerModal:g,updateType:r,handleOk:X,showPop:c,filterValue:s,isFilterItem:T,onSelectField:E,goSelectField:H,fieldSelectOptions:_,getSchema:R,selectedField:o,setFormModel:K,getFieldValSchema:J,validator:I,afterClose:oe}}});const V=t=>(de("data-v-23d0ff7e"),t=t(),ce(),t),Be=V(()=>u("div",{style:{color:"#333","font-size":"17px","font-weight":"400"}}," 批量编辑 ",-1)),be=V(()=>u("div",{style:{color:"#757575","font-size":"14px","line-height":"20px","margin-bottom":"20px","word-break":"break-all"}}," 通过批量编辑可快速统一修改相同字段的数据内容，无编辑权限的记录无法修改。 ",-1)),Ee={style:{"font-size":"14px"}},Se={style:{"margin-bottom":"10px"}},Me=V(()=>u("span",{style:{display:"inline-block",height:"30px","line-height":"30px","text-align":"right",width:"100px",color:"#9e9e9e","margin-right":"10px"}}," 字段 ",-1)),Ve={class:"field-list"},Ue=["onClick"],Oe=V(()=>u("span",{style:{display:"inline-block","text-align":"right",width:"100px",color:"#9e9e9e","margin-right":"10px"}}," 字段内容 ",-1)),qe={style:{display:"inline-block","vertical-align":"middle",width:"260px"}},Te={key:0,class:"component-val"},Ie={key:4,class:"validate-error"};function $e(t,l,n,k,y,o){const r=p("component-icon"),c=p("Icon"),s=p("a-input"),g=p("a-popover"),U=p("a-radio"),b=p("a-radio-group"),O=p("a-slider"),_=p("a-switch"),q=p("a-rate"),T=p("online-super-query-val-component"),E=p("BasicModal");return d(),C(E,{onRegister:t.registerModal,afterClose:t.afterClose,width:560,canFullscreen:!1,destroyOnClose:"",closable:!0,onOk:t.handleOk},{title:f(()=>[Be]),default:f(()=>[u("div",null,[be,u("div",Ee,[u("div",Se,[Me,h(g,{overlayClassName:"view-pop-field-select",placement:"bottom",open:t.showPop,"onUpdate:open":l[2]||(l[2]=a=>t.showPop=a),trigger:"click"},{content:f(()=>[u("div",Ve,[(d(!0),B(x,null,me(t.fieldSelectOptions,a=>(d(),B(x,null,[t.isFilterItem(a)?(d(),B("div",{key:0,class:"field-item",onClick:S=>t.onSelectField(a)},[u("div",null,[h(r,{type:a.type},null,8,["type"]),P(D(a.name),1)])],8,Ue)):M("",!0)],64))),256))])]),title:f(()=>[h(s,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":l[0]||(l[0]=a=>t.filterValue=a)},{prefix:f(()=>[h(c,{icon:"ant-design:search-outlined",style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:f(()=>[u("span",{onClick:l[1]||(l[1]=(...a)=>t.goSelectField&&t.goSelectField(...a)),style:{display:"inline-block",height:"30px","line-height":"30px",width:"260px",cursor:"pointer"}},[u("span",null,D(t.selectedField.name),1),h(c,{icon:"ant-design:down-outlined"})])]),_:1},8,["open"])]),u("div",null,[Oe,u("div",qe,[h(b,{value:t.updateType.value,"onUpdate:value":l[3]||(l[3]=a=>t.updateType.value=a),name:"radioGroup"},{default:f(()=>[t.updateType.showUpdate?(d(),C(U,{key:0,value:"update"},{default:f(()=>[P("修改为新值")]),_:1})):M("",!0),h(U,{disabled:t.updateType.disabledClear,value:"clear"},{default:f(()=>[P("清空内容")]),_:1},8,["disabled"])]),_:1},8,["value"])])]),t.updateType.showUpdate&&t.updateType.value=="update"?(d(),B("div",Te,[t.selectedField.type=="slider"?(d(),C(O,{key:0,value:t.selectedField.val,"onUpdate:value":l[4]||(l[4]=a=>t.selectedField.val=a)},null,8,["value"])):t.selectedField.type=="switch"?(d(),C(_,{key:1,checkedValue:t.selectedField.options[0],unCheckedValue:t.selectedField.options[1],checked:t.selectedField.val,"onUpdate:checked":l[5]||(l[5]=a=>t.selectedField.val=a)},null,8,["checkedValue","unCheckedValue","checked"])):t.selectedField.type=="rate"?(d(),C(q,{key:2,value:t.selectedField.val,"onUpdate:value":l[6]||(l[6]=a=>t.selectedField.val=a)},null,8,["value"])):(d(),C(T,{key:3,style:{width:"100%"},schema:t.getFieldValSchema(),formModel:t.selectedField,setFormModel:(a,S)=>{t.setFormModel(a,S,t.selectedField)}},null,8,["schema","formModel","setFormModel"])),t.validator.error?(d(),B("div",Ie,D(t.validator.msg),1)):M("",!0)])):M("",!0)])])]),_:1},8,["onRegister","afterClose","onOk"])}const It=ke(we,[["render",$e],["__scopeId","data-v-23d0ff7e"]]);export{It as default};
