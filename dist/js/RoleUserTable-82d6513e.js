var T=(e,n,d)=>new Promise((r,y)=>{var U=h=>{try{_(d.next(h))}catch(I){y(I)}},a=h=>{try{_(d.throw(h))}catch(I){y(I)}},_=h=>h.done?r(h.value):Promise.resolve(h.value).then(U,a);_((d=d.apply(e,n)).next())});import{f as O,r as ne,e as H,w as G,I as le,a3 as Me,a4 as Oe,V as u,a6 as m,af as P,ai as R,a5 as v,k as c,a7 as S,F as V,am as ee,ak as $,d as De,W as Q,E as oe,z as Ae,a8 as Be}from"./vue-vendor-24c7dc61.js";import"./index-621e597c.js";import{n as xe,av as Ne,aA as Le,bO as Pe,cb as Fe,a$ as $e,aC as Ve}from"./antd-vue-vendor-0d72f01e.js";import{a5 as je,j as Ee,k as ze,l as se,e as X,D as Ke,a as He}from"./index-831af9dd.js";import Ge from"./UserNameCell-fcd4cd60.js";import{g as Je,b as We,e as Ze,f as qe}from"./application.api-4e2bde90.js";import{u as Qe}from"./useListPage-62a041ef.js";import{u as Xe}from"./lowAppAuth-3d637b7d.js";import Ye from"./RoleUserUpdateModal-7b72dabf.js";import{B as et}from"./index-1c3affea.js";import{S as tt,U as ot}from"./UserSelectModal-d78c1490.js";import"./index-52c8c841.js";import{J as lt,D as at}from"./JSelectDept-a90caee3.js";import{T as nt,k as st}from"./componentMap-c857637c.js";import it from"./BasicTable-d435f501.js";function eo(e){const n=O("all"),d=O(""),r=O([]),y=ne({authRoleId:"",authRoleName:"全部",code:""}),U=H(()=>{let s=r.value;if(!s||s.length==0)return 0;let p=0;for(let t of s)t&&(p+=t.count);return p}),a=O(""),_=H(()=>{let s=r.value,p=a.value;return p?!s||s.length==0?[]:s.filter(t=>t.name.indexOf(p)>=0):s});function h(){return T(this,null,function*(){const s={appId:e.appId,column:"orderNum",order:"asc",countFlag:"1"},p=yield Je(s);r.value=p||[]})}const{hasAdminAuth:I,getAuth:D}=ie();return G(()=>e.appId,s=>T(this,null,function*(){if(s){yield h();let p=r.value,t=!0;if(p&&p.length>0&&d.value){let i=p.filter(k=>k.id==d.value);i.length>0&&(t=!1,n.value=i[0].id,y.authRoleId=i[0].id,y.authRoleName=i[0].name,y.code=i[0].code)}t===!0&&(n.value="all"),D(s)}}),{immediate:!0}),{roleList:r,totalCount:U,searchRoleValue:a,showRoleList:_,activeLiKey:n,initRoleList:h,waitActiveRoleId:d,selectedRole:y,hasAdminAuth:I}}function rt(e){const n=O(""),d=O(""),r=O([]),y=O([]),U=O(""),a=ne({orderColumn:"create_time",orderType:"desc"});function _(){return T(this,null,function*(){yield Z();let l={appId:e.appId};n.value&&(l.relationName=n.value),d.value&&(l.type=d.value),e.selectedRole&&e.selectedRole.authRoleId&&(l.authRoleId=e.selectedRole.authRoleId),a.orderColumn&&(l.orderColumn=K(a.orderColumn),l.orderType=a.orderType);const g=yield We(l);let b=g.records;return w(b),b||(g.records=[]),g})}function h(l,g){if(g){let b=g.split(","),N=[];for(let M of b)for(let C of l)if(C.value==M){N.push(C.label);break}return N.length==0?g:N.join("；")}return g}function I({text:l}){return h(r.value,l)}function D({text:l}){return h(y.value,l)}function s({record:l}){return l.createBy_dictText}const p=[{title:"用户",dataIndex:"relationName",width:200,align:"left"},{title:"类型",dataIndex:"type",width:80,align:"left",sorter:!0,customRender:I,showSorterTooltip:!1},{title:"角色",dataIndex:"authRoleId",width:200,align:"left",customRender:D},{title:"操作人",dataIndex:"createBy",width:80,align:"left",customRender:s},{title:"添加时间",dataIndex:"createTime",width:100,align:"left",sorter:!0},{title:"操作",dataIndex:"action",width:50,align:"center"}];function t(l){let g="role-user-select-cell";return l.isOwner===!0?(g+=" owner",{class:g,disabled:!0}):{class:g}}const{prefixCls:i,tableContext:k}=Qe({designScope:"low-app-role-user",tableProps:{api:_,columns:p,pagination:!1,showTableSetting:!1,showActionColumn:!1,useSearchForm:!1,rowKey:"id",bordered:!1,immediate:!0,rowSelection:{columnWidth:30,getCheckboxProps:t},onChange:W}}),[B,{reload:F,getRawDataSource:x},{rowSelection:j,selectedRowKeys:J,selectedRows:E}]=k;function W(l,g,b,N){const{order:M,field:C}=b;M?(a.orderColumn=C,M=="descend"?a.orderType="desc":M=="ascend"&&(a.orderType="asc")):a.orderColumn=""}function z(l){l.key==="all"?d.value="":d.value=l.key,F()}function Z(){return T(this,null,function*(){if(r.value.length==0){const l=yield je("authRoleUserType");r.value=l}})}function K(l){return l.replace(/([A-Z])/g,"_$1").toLowerCase()}function w(l){let g={};if(l&&l.length>0)for(let M of l){let C=g[M.type];C||(C=0),C++,g[M.type]=C}let b=r.value,N=[];b.forEach(M=>{let C=g[M.value];C&&N.push(`${C}个${M.label}`)}),N.length>0?U.value=N.join("、"):U.value=""}G(()=>e.roleList,l=>{if(l&&l.length>0){let g=l.map(b=>({value:b.id,label:b.name}));y.value=g}},{immediate:!0,deep:!0});const{hasAdminAuth:A,getAuth:te}=ie();return G(()=>e.appId,l=>{l&&te(l)},{immediate:!0}),{prefixCls:i,registerTable:B,reload:F,rowSelection:j,selectedRowKeys:J,authRoleUserTypeOptions:r,selectedRoleUserDetail:U,tableOrder:a,selectedRows:E,authRoleOptions:y,searchUserValue:n,filterType:d,onFilterTypeChange:z,hasAdminAuth:A,getRawDataSource:x}}function ie(){const e=Xe(),n=O(!1);function d(r){n.value=e.getLowAppAdminAuth()}return{hasAdminAuth:n,getAuth:d}}const dt={name:"PositionSelectModal",components:{BasicModal:et,SearchOutlined:xe,CloseOutlined:Ne,SelectedUserItem:tt},props:{multi:{type:Boolean,default:!0},getContainer:{type:Function,default:null},title:{type:String,default:""},type:{type:String,default:"sys_position"},appId:{type:String,default:""}},emits:["selected","register"],setup(e,{emit:n}){const d=O(""),r=H(()=>{let t=h.value;return!t||t.length==0?[]:t.map(i=>i.id)});G(()=>e.appId,t=>T(this,null,function*(){t&&(yield D())}),{immediate:!0});const[y]=Ee(()=>{let t=a.value;!t||t.length==0;for(let i of t)i.checked=!1});function U(){let t=le(r.value);n("selected",t)}const a=O([]),_=H(()=>{let t=a.value;if(!t||t.length==0)return[];let i=d.value;return i?t.filter(k=>k.name.indexOf(i)>=0):t}),h=H(()=>{let t=a.value;return!t||t.length==0?[]:t.filter(i=>i.checked)});function I(t){let i=a.value;if(!i||i.length==0)return;let k=i.filter(B=>B.id==t);k[0].checked=!1}function D(){return T(this,null,function*(){let t={pageNo:1,pageSize:200,column:"createTime",order:"desc"};const i="/sys/position/list",k=yield ze.get({url:i,params:t},{isTransformResponse:!1});if(k.success){const{records:B}=k.result;let F=[];if(B&&B.length>0)for(let x of B)F.push({id:x.id,name:x.name||x.roleName,selectType:e.type,checked:!1});a.value=F}})}function s(t,i){p(t),i.checked=!i.checked}function p(t){t.preventDefault(),t.stopPropagation()}return{register:y,showDataList:_,searchText:d,handleOk:U,selectedList:h,selectedIdList:r,unSelect:I,onSelect:s}}};const ct={style:{position:"relative","min-height":"350px"}},ut={style:{width:"100%"}},pt={class:"modal-select-list-container"},ft={class:"scroll"},mt={class:"content",style:{right:"-10px"}},ht=["onClick"],yt={class:"selected-users",style:{width:"100%","overflow-x":"hidden"}};function _t(e,n,d,r,y,U){const a=u("SearchOutlined"),_=u("a-input"),h=u("a-checkbox"),I=u("SelectedUserItem"),D=u("BasicModal");return m(),P(D,{onRegister:r.register,getContainer:d.getContainer,canFullscreen:!1,title:d.title,width:500,destroyOnClose:"",onOk:r.handleOk,wrapClassName:"j-user-select-modal2"},{default:R(()=>[v("div",ct,[v("div",ut,[c(_,{value:r.searchText,"onUpdate:value":n[0]||(n[0]=s=>r.searchText=s),allowClear:"",style:{width:"100%"},placeholder:"搜索"},{prefix:R(()=>[c(a,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),v("div",pt,[v("div",ft,[v("div",mt,[(m(!0),S(V,null,ee(r.showDataList,s=>(m(),S("label",{class:"item",onClick:p=>r.onSelect(p,s)},[c(h,{checked:s.checked,"onUpdate:checked":p=>s.checked=p},{default:R(()=>[v("span",null,$(s.name),1)]),_:2},1032,["checked","onUpdate:checked"])],8,ht))),256))])])]),v("div",yt,[(m(!0),S(V,null,ee(r.selectedList,s=>(m(),P(I,{info:s,onUnSelect:r.unSelect},null,8,["info","onUnSelect"]))),256))])])]),_:1},8,["onRegister","getContainer","title","onOk"])}const gt=se(dt,[["render",_t],["__scopeId","data-v-59e2f050"]]),Rt=De({name:"RoleUserTable",components:{BasicTable:it,TableAction:nt,MoreOutlined:Le,DownOutlined:Pe,SwapOutlined:Fe,DeleteOutlined:$e,PlusOutlined:Ve,UserNameCell:Ge,RoleUserUpdateModal:Ye,UserSelectModal:ot,JSelectDept:lt,DeptSelectModal:at,RoleSelectModal:st,PositionSelectModal:gt},props:{appId:{type:String,default:""},selectedRole:{type:Object,default:()=>{}},roleList:{type:Array,default:()=>[]}},emits:["tab-change","count-reload"],setup(e,{emit:n}){const{prefixCls:d,registerTable:r,reload:y,rowSelection:U,selectedRowKeys:a,selectedRows:_,authRoleUserTypeOptions:h,selectedRoleUserDetail:I,tableOrder:D,authRoleOptions:s,searchUserValue:p,filterType:t,onFilterTypeChange:i,hasAdminAuth:k,getRawDataSource:B}=rt(e),{createMessage:F,createInfoModal:x}=He(),j=H(()=>e.selectedRole&&e.selectedRole.authRoleId?"移到其他角色":"修改角色");G(a,()=>{});const J=o=>[{label:j.value,onClick:w.bind(null,o)},{label:"移出",onClick:E.bind(null,o)}];function E(o){let f=[o.relationId];x({title:`你确认将“${o.relationName}”移出本应用吗？`,okCancel:!0,okText:"确认",cancelText:"取消",onOk:()=>{z(f)}})}function W(){let o=a.value;if(o.length!=0)if(o.length==1){let f=_.value[0];E(f)}else{let L=_.value.map(q=>q.relationId);x({title:`你确认将${o.length}个用户移出本应用吗？`,okCancel:!0,okText:"确认",cancelText:"取消",onOk:()=>{z(L)}})}}function z(o){return T(this,null,function*(){let f={appId:e.appId,relationIdList:o,authRoleId:e.selectedRole.authRoleId};yield Ze(f),yield y(),_.value=[],a.value=[],n("count-reload")})}const[Z,{openModal:K}]=X();function w(o){let f=le(o);K(!0,{rows:[f],appId:e.appId,authRoleId:e.selectedRole.authRoleId})}function A(){let o=a.value;if(o.length!=0)if(o.length==1){let f=_.value[0];w(f)}else{let f=le(_.value);K(!0,{rows:f,appId:e.appId,authRoleId:e.selectedRole.authRoleId})}}function te(){return T(this,null,function*(){yield y(),_.value=[],a.value=[],n("count-reload")})}function l(o){o.key=="sys_user"?M():o.key=="sys_depart"?pe():o.key=="sys_role"?_e():o.key=="sys_position"&&we()}const[g,{openModal:b,closeModal:N}]=X();function M(){let o=[];const f=B();if(f.records&&f.records.length>0){let L=f.records.filter(q=>q.type==="sys_user").map(q=>q.relationId);L&&L.length>0&&(o=L)}b(!0,{list:[],excludeUserIdList:o})}function C(o){return T(this,null,function*(){if(o&&o.length>0){let f=o.map(L=>L.id);yield Y(f,"sys_user")}N()})}function Y(o,f){return T(this,null,function*(){let L={appId:e.appId,authRoleId:e.selectedRole.authRoleId,relationIdList:o,type:f};yield qe(L),yield y(),n("count-reload")})}const[de,{openModal:ce,closeModal:ue}]=X();function pe(){ce(!0,{isUpdate:!1})}function fe(o,f){return T(this,null,function*(){f&&f.length>0&&(yield Y(f,"sys_depart")),ue()})}const[me,{openModal:he,closeModal:ye}]=X();function _e(){he(!0,{})}function ge(o){return T(this,null,function*(){o&&o.length>0&&(yield Y(o,"sys_role")),ye()})}const[Re,{openModal:Ie,closeModal:ve}]=X();function we(){Ie(!0,{})}function ke(o){return T(this,null,function*(){o&&o.length>0&&(yield Y(o,"sys_position")),ve()})}function Te(o){o.preventDefault(),o.stopPropagation()}function Se(){n("tab-change")}function Ce(){a.value=[],_.value=[],p.value="",t.value="",I.value="",D.orderColumn="create_time",D.orderType="desc"}G(()=>e.selectedRole,()=>{Ce(),y()},{deep:!0});function Ue(){return T(this,null,function*(){yield y()})}const ae=O(200);ae.value=window.innerHeight-240-32;function be(o){return e.selectedRole.authRoleId&&e.selectedRole.code!="admin"?!0:!o.isOwner}return{maxTableHeight:ae,prefixCls:d,goRoleAuthTab:Se,registerTable:r,getDropDownActions:J,onFilterTypeChange:i,authRoleUserTypeOptions:h,onClickTitleType:Te,selectedRoleUserDetail:I,searchUserValue:p,filterType:t,rowSelection:U,selectedRowKeys:a,updateUserText:j,onAddRoleUser:l,confirmUpdateUsers:A,confirmRemoveUsers:W,updateSuccess:te,authRoleOptions:s,registerUpdateModal:Z,registerUserModal:g,onSelectedUserOk:C,registerDepartModal:de,onSelectedDepartOk:fe,registerRoleModal:me,onSelectedRoleOk:ge,registerPositionModal:Re,onSelectedPositionOk:ke,hasAdminAuth:k,showUserAction:be,reloadTableData:Ke(Ue,350)}}});const re=e=>(Me("data-v-39be64f9"),e=e(),Oe(),e),It={class:"user-table-top",style:{width:"100%",display:"flex","justify-content":"space-between",padding:"0px 40px"}},vt={style:{flex:"1",display:"flex","line-height":"26px","align-items":"center"}},wt={style:{"font-size":"17px","font-weight":"700","line-height":"26px"}},kt={key:0,style:{"margin-left":"5px","line-height":"26px",height:"24px"}},Tt={style:{color:"#9e9e9e","margin-left":"15px"}},St={key:0,style:{width:"350px",display:"flex","justify-content":"flex-end"}},Ct={key:0,style:{"text-align":"right"}},Ut={class:"label"},bt={key:1,style:{width:"350px",display:"flex","justify-content":"flex-end"}},Mt={key:0},Ot=re(()=>v("span",{class:"title-text hover-blue"},"类型",-1)),Dt=re(()=>v("span",{class:"label"},"所有类型",-1)),At={class:"label"},Bt={key:1,class:"title-text"},xt={class:"action-icons"},Nt={key:1};function Lt(e,n,d,r,y,U){const a=u("Icon"),_=u("a-tooltip"),h=u("SwapOutlined"),I=u("a-button"),D=u("DeleteOutlined"),s=u("a-input"),p=u("PlusOutlined"),t=u("a-menu-item"),i=u("a-menu"),k=u("a-dropdown"),B=u("DownOutlined"),F=u("MoreOutlined"),x=u("TableAction"),j=u("user-name-cell"),J=u("BasicTable"),E=u("RoleUserUpdateModal"),W=u("DeptSelectModal"),z=u("user-select-modal"),Z=u("RoleSelectModal"),K=u("PositionSelectModal");return m(),S(V,null,[v("div",null,[v("div",It,[v("div",vt,[v("span",wt,$(e.selectedRole.authRoleName),1),e.selectedRole.authRoleId?(m(),S("span",kt,[e.hasAdminAuth?(m(),P(_,{key:0,placement:"top",title:"设置角色权限"},{default:R(()=>[c(a,{class:"role-setting-icons",icon:"ant-design:setting-outlined",onClick:e.goRoleAuthTab},null,8,["onClick"])]),_:1})):Q("",!0)])):Q("",!0),v("span",Tt,$(e.selectedRoleUserDetail),1)]),e.hasAdminAuth?(m(),S("div",St,[e.selectedRowKeys&&e.selectedRowKeys.length>0?(m(),S("div",Ct,[c(I,{onClick:e.confirmUpdateUsers},{default:R(()=>[c(h),oe($(e.updateUserText),1)]),_:1},8,["onClick"]),c(I,{onClick:e.confirmRemoveUsers,style:{"margin-left":"10px"}},{default:R(()=>[c(D),oe("移出")]),_:1},8,["onClick"])])):(m(),S(V,{key:1},[c(s,{style:{width:"220px"},placeholder:"搜索用户",allowClear:"",value:e.searchUserValue,"onUpdate:value":n[0]||(n[0]=w=>e.searchUserValue=w),class:"my-input",onChange:e.reloadTableData},{prefix:R(()=>[c(a,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value","onChange"]),e.selectedRole.authRoleId?(m(),P(k,{key:0,trigger:["click"],overlayClassName:"app-role-user-add-dropdown",placement:"bottom"},{overlay:R(()=>[c(i,{onClick:e.onAddRoleUser},{default:R(()=>[(m(!0),S(V,null,ee(e.authRoleUserTypeOptions,w=>(m(),P(t,{key:w.value},{default:R(()=>[v("span",Ut,$(w.label),1)]),_:2},1024))),128))]),_:1},8,["onClick"])]),default:R(()=>[c(I,{onClick:n[1]||(n[1]=Ae(()=>{},["prevent"])),type:"primary",style:{"margin-left":"15px"}},{default:R(()=>[c(p),oe(" 添加用户 ")]),_:1})]),_:1})):Q("",!0)],64))])):(m(),S("div",bt,[c(s,{style:{width:"220px"},placeholder:"搜索用户",allowClear:"",value:e.searchUserValue,"onUpdate:value":n[2]||(n[2]=w=>e.searchUserValue=w),class:"my-input",onChange:e.reloadTableData},{prefix:R(()=>[c(a,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value","onChange"])]))]),c(J,{scroll:{y:e.maxTableHeight},class:Be(e.prefixCls),onRegister:e.registerTable,rowSelection:e.rowSelection},{headerCell:R(({column:w})=>[w.dataIndex=="type"?(m(),S("div",Mt,[c(k,{trigger:["click"],overlayClassName:"app-role-user-type-dropdown"},{overlay:R(()=>[c(i,{onClick:e.onFilterTypeChange},{default:R(()=>[c(t,{key:"all"},{default:R(()=>[Dt]),_:1}),(m(!0),S(V,null,ee(e.authRoleUserTypeOptions,A=>(m(),P(t,{key:A.value},{default:R(()=>[v("span",At,$(A.label),1)]),_:2},1024))),128))]),_:1},8,["onClick"])]),default:R(()=>[v("div",{onClick:n[3]||(n[3]=(...A)=>e.onClickTitleType&&e.onClickTitleType(...A)),class:"group-action"},[Ot,c(B,{style:{"margin-left":"5px",color:"#9e9e9e"}})])]),_:1})])):(m(),S("span",Bt,$(w.customTitle),1))]),bodyCell:R(({column:w,record:A})=>[w.dataIndex==="action"?(m(),S(V,{key:0},[e.hasAdminAuth?(m(),P(x,{key:0,dropDownActions:e.getDropDownActions(A)},{more:R(()=>[v("span",xt,[e.showUserAction(A)?(m(),P(F,{key:0,style:{"font-size":"18px",cursor:"pointer"}})):Q("",!0)])]),_:2},1032,["dropDownActions"])):(m(),S("span",Nt))],64)):w.dataIndex==="relationName"?(m(),P(j,{key:1,info:A},null,8,["info"])):Q("",!0)]),_:1},8,["scroll","class","onRegister","rowSelection"])]),c(E,{title:e.updateUserText,typeOptions:e.authRoleUserTypeOptions,roleList:e.roleList,onRegister:e.registerUpdateModal,onSuccess:e.updateSuccess},null,8,["title","typeOptions","roleList","onRegister","onSuccess"]),c(W,{value:[],onRegister:e.registerDepartModal,onGetSelectResult:e.onSelectedDepartOk,multiple:"",checkStrictly:""},null,8,["onRegister","onGetSelectResult"]),c(z,{multi:!0,onRegister:e.registerUserModal,onSelected:e.onSelectedUserOk},null,8,["onRegister","onSelected"]),c(Z,{appId:e.appId,title:"选择组织角色",onRegister:e.registerRoleModal,onSelected:e.onSelectedRoleOk},null,8,["appId","onRegister","onSelected"]),c(K,{appId:e.appId,title:"选择职位",onRegister:e.registerPositionModal,onSelected:e.onSelectedPositionOk},null,8,["appId","onRegister","onSelected"])],64)}const Pt=se(Rt,[["render",Lt],["__scopeId","data-v-39be64f9"]]),to=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"}));export{Pt as R,to as a,eo as u};
