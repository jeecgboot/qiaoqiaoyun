var J=Object.defineProperty;var T=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var D=(o,e,n)=>e in o?J(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,U=(o,e)=>{for(var n in e||(e={}))K.call(e,n)&&D(o,n,e[n]);if(T)for(var n of T(e))W.call(e,n)&&D(o,n,e[n]);return o};var M=(o,e,n)=>new Promise((_,v)=>{var k=l=>{try{r(n.next(l))}catch(p){v(p)}},h=l=>{try{r(n.throw(l))}catch(p){v(p)}},r=l=>l.done?_(l.value):Promise.resolve(l.value).then(k,h);r((n=n.apply(o,e)).next())});import{f as u,u as f,d as X,a5 as b,V as m,a6 as Y,a7 as Z,F as x,k as i,ai as d,a8 as ee,E as I,ae as $}from"./vue-vendor-24c7dc61.js";import{a8 as O,be as oe,l as ne}from"./antd-vue-vendor-0d72f01e.js";import{C as se}from"./index-f99b266a.js";import{a as te,o as ae,d as ie,a7 as re,by as le,k as A,bt as ue,l as de}from"./index-831af9dd.js";import"./vxe-table-vendor-8813019a.js";function pe(o){const{createMessage:e,notification:n}=te(),{t:_}=ae(),v=ie(),k=re(),h=u(""),r=u({}),l=u(!1),p=u(!1),F=u(""),g=u(!1),C=u(!1),w=u(""),y=u(""),s=u(!1),B=u(""),P=u("");function z(t){let a=`${v.uploadUrl}/sys/thirdLogin/render/${t}`;window.open(a,`login ${t}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),h.value=t,r.value={},l.value=!1;let R=function(G){let c=G.data;if(typeof c=="string")if(c==="登录失败")e.warning(c);else if(c.includes("绑定手机号")){p.value=!0;let q=c.split(",");F.value=q[1]}else L(c);else typeof c=="object"?c.isObj===!0&&(g.value=!0,r.value=U({},c)):e.warning("不识别的信息传递")};window.addEventListener("message",R,!1)}function L(t){return M(this,null,function*(){f(l)||(l.value=!0,yield le({token:t,thirdType:f(h)}).then(a=>{a&&a.userInfo&&o("success",a)}))})}function N(){w.value="",y.value=r.value.uuid,g.value=!1,C.value=!0}function V(){s.value=!0,r.value.suffix=parseInt(Math.random()*98+1),A.post({url:"/sys/third/user/create",params:{thirdLoginInfo:f(r)}},{isTransformResponse:!1}).then(t=>{if(t.success){let a=t.result;L(a),g.value=!1}else e.warning(t.message)}).finally(()=>{s.value=!1})}function j(){let t=Object.assign({},f(r),{password:f(w)});A.post({url:"/sys/third/user/checkPassword",params:t},{isTransformResponse:!1}).then(a=>{a.success?(E(),L(a.result)):e.warning(a.message)})}function E(){C.value=!1,w.value="",y.value=""}function H(){return ue({mobile:f(B),smsmode:"0"})}function Q(){f(B)||S("请输入手机号"),f(P)||S("请输入验证码");let t={mobile:f(B),captcha:f(P),thirdUserUuid:f(F)};A.post({url:"/sys/thirdLogin/bindingThirdPhone",params:t},{isTransformResponse:!1}).then(a=>{a.success?(p.value=!1,L(a.result)):e.warning(a.message)})}function S(t){n.error({message:"登录失败",description:t,duration:4})}return{thirdPasswordShow:C,thirdLoginCheckPassword:j,thirdLoginNoPassword:E,thirdLoginPassword:w,thirdConfirmShow:g,thirdCreateUserLoding:s,thirdLoginUserCreate:V,thirdLoginUserBind:N,bindingPhoneModal:p,thirdHandleOk:Q,thirdPhone:B,thirdCaptcha:P,onThirdLogin:z,sendCodeApi:H}}const fe=O.Item,ce=ne.Password,me=X({name:"file-third-modal",components:{FormItem:fe,Form:O,InputPassword:ce,CountdownInput:se,QuestionCircleFilled:oe},emits:["success","register"],setup(o,{emit:e}){return U({},pe(e))}}),he={class:"ant-modal-confirm-body-wrapper"},ge={class:"ant-modal-confirm-body"},Ce=b("span",{class:"ant-modal-confirm-title"},"提示",-1),we=b("div",{class:"ant-modal-confirm-content"}," 已有同名账号存在,请确认是否绑定该账号？ ",-1),ve={class:"ant-modal-confirm-btns"};function Fe(o,e,n,_,v,k){const h=m("a-input-password"),r=m("a-modal"),l=m("QuestionCircleFilled"),p=m("a-button"),F=m("Icon"),g=m("a-input"),C=m("FormItem"),w=m("CountdownInput"),y=m("Form");return Y(),Z(x,null,[i(r,{title:"请输入密码",open:o.thirdPasswordShow,"onUpdate:open":e[1]||(e[1]=s=>o.thirdPasswordShow=s),onOk:o.thirdLoginCheckPassword,onCancel:o.thirdLoginNoPassword},{default:d(()=>[i(h,{placeholder:"请输入密码",value:o.thirdLoginPassword,"onUpdate:value":e[0]||(e[0]=s=>o.thirdLoginPassword=s),style:{margin:"15px",width:"80%"}},null,8,["value"])]),_:1},8,["open","onOk","onCancel"]),i(r,{footer:null,closable:!1,open:o.thirdConfirmShow,"onUpdate:open":e[2]||(e[2]=s=>o.thirdConfirmShow=s),class:ee("ant-modal-confirm")},{default:d(()=>[b("div",he,[b("div",ge,[i(l,{style:{color:"#faad14"}}),Ce,we]),b("div",ve,[i(p,{onClick:o.thirdLoginUserCreate,loading:o.thirdCreateUserLoding},{default:d(()=>[I("创建新账号")]),_:1},8,["onClick","loading"]),i(p,{onClick:o.thirdLoginUserBind,type:"primary"},{default:d(()=>[I("确认绑定")]),_:1},8,["onClick"])])])]),_:1},8,["open"]),i(r,{title:"绑定手机号",open:o.bindingPhoneModal,"onUpdate:open":e[5]||(e[5]=s=>o.bindingPhoneModal=s),maskClosable:!1},{footer:d(()=>[i(p,{type:"primary",onClick:o.thirdHandleOk},{default:d(()=>[I("确定")]),_:1},8,["onClick"])]),default:d(()=>[i(y,{class:"p-4 enter-x",style:{margin:"15px 10px"}},{default:d(()=>[i(C,{class:"enter-x"},{default:d(()=>[i(g,{size:"large",placeholder:"请输入手机号",value:o.thirdPhone,"onUpdate:value":e[3]||(e[3]=s=>o.thirdPhone=s),class:"fix-auto-fill"},{prefix:d(()=>[i(F,{icon:"ant-design:mobile-outlined",style:$({color:"rgba(0,0,0,.25)"})},null,8,["style"])]),_:1},8,["value"])]),_:1}),i(C,{name:"sms",class:"enter-x"},{default:d(()=>[i(w,{size:"large",class:"fix-auto-fill",value:o.thirdCaptcha,"onUpdate:value":e[4]||(e[4]=s=>o.thirdCaptcha=s),placeholder:"请输入验证码",sendCodeApi:o.sendCodeApi},{prefix:d(()=>[i(F,{icon:"ant-design:mail-outlined",style:$({color:"rgba(0,0,0,.25)"})},null,8,["style"])]),_:1},8,["value","sendCodeApi"])]),_:1})]),_:1})]),_:1},8,["open"])],64)}const Pe=de(me,[["render",Fe]]);export{Pe as default};
