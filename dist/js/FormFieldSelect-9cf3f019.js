var W=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var N=(r,n,a)=>n in r?W(r,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[n]=a,g=(r,n)=>{for(var a in n||(n={}))J.call(n,a)&&N(r,a,n[a]);if(E)for(var a of E(n))K.call(n,a)&&N(r,a,n[a]);return r},D=(r,n)=>G(r,H(n));import{a$ as X,n as Y,aC as Z}from"./antd-vue-vendor-0d72f01e.js";import{f as w,c as $,r as T,h as M,I as U,w as S,e as ee,ay as te,V as p,a6 as h,a7 as y,F as x,k as d,a5 as c,am as j,ak as q,ai as v,E as B,W as Q}from"./vue-vendor-24c7dc61.js";import{c as le,u as oe}from"./LinkRecordSelect-385d0eae.js";import ie from"./SuperQueryValComponent-97f284a9.js";import{l as re}from"./index-831af9dd.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./helper-22dafba0.js";const ne={name:"FormFieldSelect",components:{DeleteOutlined:X,SearchOutlined:Y,PlusOutlined:Z,OnlineSuperQueryValComponent:ie},props:{dbFieldList:{type:Array,default:()=>[]},formTable:{type:String,default:""},linkRecordColumnList:{type:Array,default:()=>[]},linkRecordField:{type:String,default:""}},setup(r){const n=w(!1),a=$("globalColumnList"),o=w([]),C=T({});M(()=>{r.formTable==="link-record"&&Array.isArray(r.linkRecordColumnList)?C.columnList=r.linkRecordColumnList:C.columnList=a.value});const{getSchema:P}=le(C);M(()=>{if(r.formTable==="current")if(a){let e=a.value,t=[];if(e&&e.length>0){for(let l of e)t.push(D(g({},l),{selectedItem:!1}));o.value=t}else o.value=[]}else o.value=[];else if(r.formTable==="link-record")if(r.linkRecordColumnList){let e=r.linkRecordColumnList,t=[];if(e&&e.length>0){for(let l of e){let i=U(l);t.push(D(g({},i),{selectedItem:!1}))}o.value=t}else o.value=[]}else o.value=[]}),S(a,()=>{},{deep:!0,immediate:!0}),S(()=>r.linkRecordField,()=>{s.value=[]}),S(()=>r.formTable,e=>{e=="current"&&(s.value=[])});const s=w([]);S(()=>r.dbFieldList,e=>{if(!e||e.length==0)s.value=[];else{let t=[];for(let l of e)t.push(g({},l));s.value=t}},{deep:!0,immediate:!0});const{getDefaultVal:k}=oe(),F=ee(()=>{if(s.value&&s.value.length>0){let e=s.value,t=[];for(let l of e){let i=T({key:l.key,field:l.field,model:l.model,name:l.name,type:l.type,attr:l.attr,rule:"",val:l.defaultVal});if(!i.type){let f=o.value.find(z=>z.key===i.key);f&&(i.name=f.name,i.type=f.type,i.model=f.model,i.field=i.model)}let _=k(i.type);!i.val||i.val.length==0?i.val=_:typeof _=="number"?i.val=Number(i.val):Array.isArray(_)&&(i.val=i.val.split(",")),t.push(i)}return t}return[]});function V(e,t){s.value[e].defaultVal=Array.isArray(t)?t.join(","):t,F.value[e].val=t}function O(e,t){e.preventDefault(),e.stopPropagation(),L(t)}function L(e){let t=e.selectedItem,l=s.value,i=e.key;if(t===!0)l.push({key:i,attr:e.required===!0?"required":"",defaultVal:"",type:e.type,field:e.model,model:e.model,name:e.name}),s.value=l;else{let _=-1;for(let f=0;f<l.length;f++)l[f].key===i&&(_=f);_>=0&&(l.splice(_,1),s.value=l)}}function R(e){e.selectedItem===!0?e.selectedItem=!1:e.selectedItem=!0,L(e)}const b=w("");function I(e){let t=b.value;return t?e?e.name.indexOf(t)>=0:!1:!0}function A(e){if(r.formTable==="current"){if(a){let l=a.value.filter(i=>i.key===e);if(l.length>0)return l[0].name}return e}else{if(r.linkRecordColumnList){let l=U(r.linkRecordColumnList).filter(i=>i.key===e);if(l.length>0)return l[0].name}return e}}function u(e,t){e.preventDefault(),e.stopPropagation();let l=s.value;l.splice(t,1),s.value=l}function m(){let e=s.value,t=[];for(let l of e)t.push(g({},l));return t}return{showPop:n,columnList:a,onSelectField:R,filterValue:b,isFilterItem:I,getFieldLabel:A,myList:s,conditions:F,getSchema:P,setFormModel:V,onRemove:u,selectList:o,onClickSwitch:O,getFieldListData:m}}};const ae={class:"button-form-field-config"},se=te('<table><colgroup><col style="width:180px;"><col style="width:110px;"><col style=""><col style="width:50px;"></colgroup><thead><tr><th style="padding-left:8px;">字段</th><th style="padding-left:8px;">属性</th><th style="padding-left:8px;">默认值</th><th></th></tr></thead></table>',1),ue={style:{"max-height":"440px","overflow-y":"auto"}},ce={class:"field-name"},de={style:{width:"230px",margin:"0 10px"}},me={class:"field-list"},pe=["onClick"],fe={style:{display:"flex"}},ve={style:{"line-height":"32px"}},_e={style:{"margin-left":"10px"}},he={class:"add-field-button"};function ye(r,n,a,o,C,P){const s=p("a-divider"),k=p("a-select-option"),F=p("a-select"),V=p("OnlineSuperQueryValComponent"),O=p("DeleteOutlined"),L=p("a-switch"),R=p("SearchOutlined"),b=p("a-input"),I=p("PlusOutlined"),A=p("a-popover");return h(),y("div",ae,[o.myList.length>0?(h(),y(x,{key:0},[d(s),se,c("div",ue,[c("table",null,[c("tbody",null,[(h(!0),y(x,null,j(o.conditions,(u,m)=>(h(),y("tr",null,[c("td",null,[c("div",ce,q(o.getFieldLabel(u.key)),1)]),c("td",null,[d(F,{style:{width:"100px"},value:o.myList[m].attr,"onUpdate:value":e=>o.myList[m].attr=e},{default:v(()=>[d(k,{value:"readonly"},{default:v(()=>[B("只读")]),_:1}),d(k,{value:""},{default:v(()=>[B("填写")]),_:1}),d(k,{value:"required"},{default:v(()=>[B("必填")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),c("td",null,[c("div",de,[d(V,{schema:o.getSchema(u,m),formModel:u,setFormModel:(e,t)=>o.setFormModel(m,t)},null,8,["schema","formModel","setFormModel"])])]),c("td",null,[d(O,{class:"field-remove",onClick:e=>o.onRemove(e,m)},null,8,["onClick"])])]))),256))])])])],64)):Q("",!0),d(A,{overlayClassName:"view-pop-field-select2",open:o.showPop,"onUpdate:open":n[1]||(n[1]=u=>o.showPop=u),trigger:"click"},{content:v(()=>[c("div",me,[(h(!0),y(x,null,j(o.selectList,u=>(h(),y(x,null,[o.isFilterItem(u)?(h(),y("div",{key:0,class:"field-item",onClick:m=>o.onSelectField(u)},[c("div",fe,[c("div",ve,[d(L,{checked:u.selectedItem,"onUpdate:checked":m=>u.selectedItem=m,size:"small",onClick:(m,e)=>o.onClickSwitch(e,u)},null,8,["checked","onUpdate:checked","onClick"])]),c("div",_e,q(u.name),1)])],8,pe)):Q("",!0)],64))),256))])]),title:v(()=>[d(b,{placeholder:"搜索字段",class:"my-input",value:o.filterValue,"onUpdate:value":n[0]||(n[0]=u=>o.filterValue=u)},{prefix:v(()=>[d(R,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:v(()=>[c("div",he,[d(I,{style:{"margin-right":"5px"}}),B(" 选择填写字段 ")])]),_:1},8,["open"])])}const _t=re(ne,[["render",ye]]);export{_t as default};
