var Q=Object.defineProperty,Z=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var q=(e,l,u)=>l in e?Q(e,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[l]=u,A=(e,l)=>{for(var u in l||(l={}))H.call(l,u)&&q(e,u,l[u]);if(j)for(var u of j(l))J.call(l,u)&&q(e,u,l[u]);return e},x=(e,l)=>Z(e,G(l));import{d as K,f as S,h as X,a3 as Y,a4 as ee,a5 as i,V as p,a6 as a,a7 as d,F as g,am as b,k as r,ak as B,ai as c,af as M,E as _,z as te,W as R}from"./vue-vendor-24c7dc61.js";import{aC as oe,n as ne,av as le,aZ as ie,cm as se,p as z}from"./antd-vue-vendor-0d72f01e.js";import{s as W,d as ae}from"./type.definition-4eb605ee.js";import re from"./SuperQueryValComponent-97f284a9.js";import{c as ue,u as pe}from"./LinkRecordSelect-385d0eae.js";import{C as de}from"./ComponentIcon-f1bbb90f.js";import{l as ce}from"./index-831af9dd.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const me=K({name:"Shujuguolv",components:{PlusOutlined:oe,SearchOutlined:ne,CloseOutlined:le,TableOutlined:ie,OnlineSuperQueryValComponent:re,SaveOutlined:se,ComponentIcon:de},emits:["save"],props:{columnList:{type:Array,default:()=>[]},info:{type:Object,require:!1,default:{}}},setup(e,{emit:l}){const{getSchema:u}=ue(e),{getConditionOptions:P,getDefaultRule:N,getDefaultVal:U}=pe(),v=S([]);function C(t){if(!t||t.length==0){v.value=[];return}let o=t.filter(s=>ae.includes(s.type)?s.type==="link-field"?s.saveType==="save":!1:!0);v.value=o}const F=S(!1),h=S("and"),m=S([]);X(()=>{let t=e.columnList;C(t);let o=e.info;h.value=o.conditionType||"and";let s=[];if(o.conditions){let y=o.conditions;if(y&&y.length>0)for(let k of y){let w="";if(t&&t.length>0){let f=t.filter($=>$.model==k.field);f&&f.length>0&&(w=f[0].name)}if(!w){let f=W.filter($=>$.field==k.field);f&&f.length>0&&(w=f[0].name)}if(w){let f=z(k,"field","rule","val","type");s.push(x(A({},f),{name:w}))}}}m.value=s});function L(t){let o=t.field||t.model,s=m.value,y=N(t.type),k=U(t.type);s.push({field:o,rule:y,val:k,type:t.type,name:t.name}),m.value=s,F.value=!1}const E=S("");function V(t){let o=E.value;return o?t?t.name.indexOf(o)>=0:!1:!0}function O(){let t=[];for(let o of m.value){let s=z(o,"field","rule","val","type");t.push(s)}t.length>0&&l("save",{conditions:t,conditionType:h.value})}function D(t){let o=m.value;o.splice(t,1),m.value=o,o.length==0&&l("save",{conditions:[],conditionType:h.value})}function I(t){let o=P(t);return!o||o.length==0?[]:o}function n(t,o,s){s.val=o}return{conditionList:m,conditionRelation:h,systemFields:W,showPop:F,filterValue:E,onSelectField:L,isFilterItem:V,saveCondition:O,onRemove:D,getOptions:I,getSchema:u,setFormModel:n,filterColumnList:v}}});const T=e=>(Y("data-v-26d79c5a"),e=e(),ee(),e),fe={class:"inner-content"},ve=T(()=>i("div",{class:"title"},"数据过滤",-1)),_e=T(()=>i("div",{class:"tip"},"添加筛选条件，限制出现在此视图中的记录",-1)),he={class:"config-detail",style:{width:"320px","padding-top":"0"}},ye={class:"condition-item",style:{"margin-top":"25px"}},ge={style:{display:"flex"}},Ce={style:{flex:"1"}},Fe={style:{"margin-right":"10px","max-width":"100px","font-weight":"bold"}},ke={class:"condition-select"},we={class:"icon-remove"},Se={class:"condition-val"},Be={style:{width:"calc(100% - 70px)"}},Ee={class:"condition-rela"},Oe={key:1,style:{color:"rgb(117, 117, 117)",display:"inline-block",width:"40px"}},be={class:"field-list"},Le=["onClick"],Ve=T(()=>i("div",{class:"split"},null,-1)),De=["onClick"],Ie={style:{width:"100%","text-align":"right",position:"relative"}};function $e(e,l,u,P,N,U){const v=p("component-icon"),C=p("a-select-option"),F=p("a-select"),h=p("close-outlined"),m=p("online-super-query-val-component"),L=p("search-outlined"),E=p("a-input"),V=p("PlusOutlined"),O=p("a-button"),D=p("a-popover"),I=p("save-outlined");return a(),d("div",fe,[ve,_e,i("div",he,[(a(!0),d(g,null,b(e.conditionList,(n,t)=>(a(),d("div",ye,[i("div",ge,[i("div",Ce,[r(v,{type:n.type,style:{color:"rgb(158, 158, 158)"}},null,8,["type"]),i("span",Fe,B(n.name),1),i("span",ke,[r(F,{style:{"min-width":"70px"},size:"small",value:n.rule,"onUpdate:value":o=>n.rule=o,dropdownStyle:{minWidth:"100px"}},{default:c(()=>[(a(!0),d(g,null,b(e.getOptions(n.type),o=>(a(),M(C,{value:o.value},{default:c(()=>[_(B(o.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value"])])]),i("div",we,[r(h,{onClick:te(o=>e.onRemove(t),["prevent"])},null,8,["onClick"])])]),i("div",Se,[i("div",Be,[r(m,{style:{width:"100%"},schema:e.getSchema(n,t),formModel:n,setFormModel:(o,s)=>{e.setFormModel(o,s,n)}},null,8,["schema","formModel","setFormModel"])]),i("div",Ee,[t==0?(a(),M(F,{key:0,style:{width:"50px"},size:"small",value:e.conditionRelation,"onUpdate:value":l[0]||(l[0]=o=>e.conditionRelation=o)},{default:c(()=>[r(C,{value:"and"},{default:c(()=>[_("且")]),_:1}),r(C,{value:"or"},{default:c(()=>[_("或")]),_:1})]),_:1},8,["value"])):(a(),d("span",Oe,B(e.conditionRelation=="and"?"且":"或"),1))])])]))),256)),r(D,{overlayClassName:"view-pop-field-select",open:e.showPop,"onUpdate:open":l[2]||(l[2]=n=>e.showPop=n),trigger:"click"},{content:c(()=>[i("div",be,[(a(!0),d(g,null,b(e.filterColumnList,n=>(a(),d(g,null,[e.isFilterItem(n)?(a(),d("div",{key:0,class:"field-item",onClick:t=>e.onSelectField(n)},[i("div",null,[r(v,{type:n.type},null,8,["type"]),_(B(n.name),1)])],8,Le)):R("",!0)],64))),256)),Ve,(a(!0),d(g,null,b(e.systemFields,n=>(a(),d(g,null,[e.isFilterItem(n)?(a(),d("div",{key:0,class:"field-item",onClick:t=>e.onSelectField(n)},[i("div",null,[r(v,{type:n.type},null,8,["type"]),_(B(n.name),1)])],8,De)):R("",!0)],64))),256))])]),title:c(()=>[r(E,{placeholder:"搜索字段",class:"my-input",value:e.filterValue,"onUpdate:value":l[1]||(l[1]=n=>e.filterValue=n)},{prefix:c(()=>[r(L,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:c(()=>[r(O,{class:"add-button",style:{"margin-top":"20px"}},{default:c(()=>[r(V),_(" 添加筛选条件 ")]),_:1})]),_:1},8,["open"]),i("div",Ie,[e.conditionList.length>0?(a(),M(O,{key:0,onClick:e.saveCondition,type:"primary",style:{color:"#fff","border-radius":"20px",position:"absolute",right:"45px",top:"-33px"}},{default:c(()=>[r(I),_("保 存 ")]),_:1},8,["onClick"])):R("",!0)])])])}const It=ce(me,[["render",$e],["__scopeId","data-v-26d79c5a"]]);export{It as default};
