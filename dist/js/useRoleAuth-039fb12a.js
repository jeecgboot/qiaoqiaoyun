var z=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var q=(l,i,d)=>i in l?z(l,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[i]=d,A=(l,i)=>{for(var d in i||(i={}))Q.call(i,d)&&q(l,d,i[d]);if(V)for(var d of V(i))W.call(i,d)&&q(l,d,i[d]);return l},M=(l,i)=>G(l,J(i));var _=(l,i,d)=>new Promise((k,h)=>{var f=C=>{try{g(d.next(C))}catch(b){h(b)}},F=C=>{try{g(d.throw(C))}catch(b){h(b)}},g=C=>C.done?k(C.value):Promise.resolve(C.value).then(f,F);g((d=d.apply(l,i)).next())});import{f as v,r as E,e as O,w as X,h as Y,I as Z}from"./vue-vendor-24c7dc61.js";import{a5 as P,D as $}from"./index-831af9dd.js";import{h as ee,q as te}from"./application.api-4e2bde90.js";import{p as H}from"./antd-vue-vendor-0d72f01e.js";let re=[{id:"11123",title:"表单true",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!0,children:[{pid:"11123",id:"23",title:"视图true",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1},{pid:"11123",id:"2true",title:"视图2",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1},{pid:"11123",id:"22",title:"视图3",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1}]},{id:"2",title:"表单2",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!0,children:[{pid:"2",id:"25",title:"视图true",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1},{pid:"2",id:"26",title:"视图2",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1},{pid:"2",id:"27",title:"视图3",readChecked:!0,deleteChecked:!0,updateChecked:!0,createChecked:!0,isForm:!1}]}];function B(l){return["desform","form"].includes(l)}function le(l){const i=v([]),d=v([]);let k="";const h=E({id:"",name:"",code:"",authMode:"",description:"",appId:"",orderNum:0}),f=E({id:"",scopeKey:"",subordinate:1}),F=O({get(){return f.subordinate!==0},set(e){e===!0?f.subordinate=1:f.subordinate=0}}),g=v([]),C=v([]),b=v([]),L=v([]),R=v([]),x=v([]);function N(){return _(this,null,function*(){if(d.value.length==0){const e=yield P("easyAuthOperation");d.value=e}if(i.value.length==0){const e=yield P("easyAuthRecord");i.value=e}})}function S(e){return _(this,null,function*(){let a=e.id;r(),a=="-1"?(h.name=e.name,h.orderNum=e.orderNum,h.authMode="easy",h.appId=l.appId):(k=yield ee(a),y(k),s())})}function s(){Object.keys(h).map(e=>{h[e]=k[e]}),k.authMode=="easy"?o(k):p(k)}function o(e){if(e.recordAuthList&&e.recordAuthList.length>0){let a=e.recordAuthList[0];Object.keys(f).map(t=>{f[t]=a[t]})}if(g.value=[],e.operationAuthList&&e.operationAuthList.length>0){let a=[];for(let t of e.operationAuthList)t.opStatus===1&&a.push(t.opKey);g.value=a}}function p(e){let a=[];if(e.formAuthList&&e.formAuthList.length>0)for(let m of e.formAuthList){let I=H(m,"designFormCode","viewId","authType","authCreate","authUpdate","authRead","authDelete");a.push(A({},I))}C.value=a;let t=[];if(e.recordAuthList&&e.recordAuthList.length>0)for(let m of e.recordAuthList){let I=H(m,"designFormCode","scopeKey","subordinate","scopeType");t.push(A({},I))}b.value=t;let c=[];if(e.operationAuthList&&e.operationAuthList.length>0)for(let m of e.operationAuthList){let I=H(m,"designFormCode","opKey","opType","opStatus");c.push(A({},I))}L.value=c;let n=[];if(e.fieldAuthList&&e.fieldAuthList.length>0)for(let m of e.fieldAuthList){let I=H(m,"designFormCode","fieldKey","authCreate","authUpdate","authRead");n.push(A({},I))}R.value=n}function y(e){let a=[];if(e.menuList&&e.menuList.length>0)for(let t of e.menuList){let c=H(t,"menuUrl","iconType","menuName","orderNum");a.push(A({},c))}x.value=a}function r(){Object.keys(h).map(e=>{h[e]=""}),f.id="",f.scopeKey="read_all_update_myself",f.subordinate=0,u(),C.value=[],b.value=[],L.value=[],R.value=[],x.value=[]}function u(){let e=f.scopeKey==="readonly",a=[];for(let t of d.value)e===!0&&t.value==="add"||a.push(t.value);g.value=a}return{roleInfo:h,easyAuthRecord:f,selectOptions:i,checkboxOptions:d,easyAuthOperations:g,initAuthInfo:S,subordinateBool:F,initDictData:N,selectAllEasyAuthOperations:u,resetForm:s,superAuthFormData:C,superAuthRecordData:b,superAuthOperationData:L,superAuthFieldData:R,menuList:x}}function oe(l){const i=v([]),d=v([]),k=v([]),h=v([]);X(()=>l.appId,()=>_(this,null,function*(){if(l.appId){const r=yield te(l.appId);if(r){const{formList:u,viewList:e}=r;let a=[];for(let t of u)t.type=="form"?a.push(M(A({},t),{id:t.compatibleCode})):a.push(A({},t));k.value=a,h.value=e||[]}else k.value=[],h.value=[]}}),{immediate:!0}),Y(()=>{let r=k.value,u=h.value,e=l.authData,a=l.menuList;g(e,r,u,a)});function f(r){return r=="base"?"ant-design:credit-card-outlined":r=="card"?"ant-design:sliders-outlined":r=="calendar"?"ant-design:calendar-outlined":""}function F(r,u,e){let a=[],t={readChecked:!0,readInterChecked:!1,updateChecked:!0,updateInterChecked:!1,deleteChecked:!0,deleteInterChecked:!1},c=["read","update","delete"];for(let n of u)if(n.designFormCode==r){const{id:m,type:I,title:U}=n;let K=L(e,m),w=M(A({id:m,title:U,type:I,isForm:!1},K),{pid:r,icon:f(I)});a.push(w),c.forEach(T=>{let D=T+"Checked";t[D]=t[D]&&K[D],K[D]&&(t[T+"InterChecked"]=!0)})}return c.forEach(n=>{t[n+"Checked"]===!0&&(t[n+"InterChecked"]=!1)}),{children:a,parentCheckStatus:t}}function g(r,u,e,a){let t=[];if(u&&u.length>0)for(let c of u){const{id:n,type:m,title:I,compatibleCode:U}=c;let K=b(r,n,U),w=M(A({id:n,title:I,type:m,isForm:!0},K),{orderNum:1});m==="form"&&(w.compatibleCode=U);let T=C(a,n);if(T&&(w.title=T.menuName,w.icon=T.iconType,w.orderNum=T.orderNum),w.icon||(m=="drag"?w.icon="ant-design:gateway-outlined":w.icon="ant-design:table-outlined"),m=="desform"){const{children:D,parentCheckStatus:j}=F(n,e,r);Object.assign(w,A({children:D},j))}else if(m=="form"){const{children:D,parentCheckStatus:j}=F(U,e,r);Object.assign(w,A({children:D},j))}t.push(w)}t.sort(function(c,n){return c.orderNum-n.orderNum}),i.value=t}function C(r,u){let e="";if(r&&r.length>0){let a=r.filter(t=>t.menuUrl===u);a&&a.length>0&&(e=a[0])}return e}function b(r,u,e){let a={readChecked:!1,createChecked:!1};if(r&&r.length>0){let t=r.filter(n=>n.designFormCode==u&&n.authType=="desform"||n.designFormCode==e&&n.authType=="form");t&&t.length>0&&t[0].authCreate==1&&(a.createChecked=!0);let c=r.filter(n=>n.designFormCode==u&&n.authType=="drag");c&&c.length>0&&c[0].authRead==1&&(a.readChecked=!0)}return a}function L(r,u){let e={readChecked:!1,updateChecked:!1,deleteChecked:!1};if(r&&r.length>0){let a=r.filter(t=>t.viewId==u&&t.authType=="view");if(a&&a.length>0){const{authRead:t,authUpdate:c,authDelete:n}=a[0];t==1&&(e.readChecked=!0),c==1&&(e.updateChecked=!0),n==1&&(e.deleteChecked=!0)}}return e}const R=E({read:!1,update:!1,delete:!1,create:!1});function x(r,u,e){let a={};if(r.isForm===!0){let t=Z(d.value);r.children&&(t&&t.indexOf(r.id)>=0?a.rowspan=r.children.length+1:a.rowspan=1)}else a.style={display:"none"};return a}function N(r){return!0}const S=[{title:"应用项",dataIndex:"title",width:400,align:"left"},{title:"查看",dataIndex:"read",width:150,align:"left"},{title:"编辑",dataIndex:"update",width:150,align:"left"},{title:"删除",dataIndex:"delete",width:150,align:"left"},{title:"新增",dataIndex:"create",width:150,align:"left"},{title:"数据操作权限",dataIndex:"action2",width:80,align:"center",ifShow:N,customCell:x}];function s(r){let u=!1,e=["readChecked","updateChecked","deleteChecked","createChecked","readInterChecked","updateInterChecked","deleteInterChecked","createInterChecked"];for(let a of e)if(r[a]===!0){u=!0;break}return u}function o(r,u){return r.children.filter(a=>a[u+"Checked"]===!0).length}function p(r,u,e){if(e.target.tagName=="INPUT"||e.target.tagName=="SPAN")return;const a=r.id;let t=d.value,c=t.indexOf(a);c>=0?t.splice(c,1):t.push(a),d.value=t}function y(){let r=i.value,u=[];if(r&&r.length>0){for(let e of r)if(e.isForm){let a=e.type==="form"?e.compatibleCode:e.id,t={designFormCode:a,authType:e.type};if(B(e.type)){if(t.authCreate=e.createChecked?1:0,t.authUpdate=e.updateChecked||e.updateInterChecked?1:0,t.authDelete=e.deleteChecked||e.deleteInterChecked?1:0,t.authRead=e.readChecked||e.readInterChecked?1:0,e.children&&e.children.length>0)for(let c of e.children){let n={designFormCode:a,viewId:c.id,authType:"view",authCreate:t.authCreate,authUpdate:c.updateChecked?1:0,authDelete:c.deleteChecked?1:0,authRead:c.readChecked?1:0};u.push(n)}}else t.authRead=e.readChecked?1:0;u.push(t)}}return u}return{authTableColumns:S,titleChecked:R,expandedRowKeys:d,settingAccess:s,mockRecords:re,childrenCheckCount:o,authDataList:i,onRowClick:p,getSaveData:y,isDesform:B}}function ce(l,i){const d=v([]);function k(){let s=S();i("data-change",s)}const h=$(k,350);function f(s){let o=d.value;if(!o||o.length==0)return!1;let p=!0;for(let y of d.value)if(y[s]===!1){p=!1;break}return p}function F(s){let o=!1,p=0,y=d.value;for(let r of y)r[s+"Checked"]===!0&&(p++,o=!0),r[s+"InterChecked"]===!0&&(o=!0);return p==y.length&&(o=!1),o}function g(s,o,p,y){if(s&&s.length>0)for(let r of s)r[o+"Checked"]=p,r.isForm&&(r[o+"InterChecked"]=!1,r.children&&g(r.children,o,p,!0));y||p===!0&&o=="update"&&(C.value=!0),h()}const C=O({get(){return f("readChecked")},set(s){let o=d.value;g(o,"read",s)}}),b=O(()=>F("read")),L=O({get(){return f("updateChecked")},set(s){let o=d.value;g(o,"update",s)}}),R=O(()=>F("update")),x=O({get(){return f("createChecked")},set(s){let o=d.value;g(o,"create",s)}}),N=O(()=>F("create"));function S(){let s=[],o=d.value;if(o&&o.length>0)for(let p of o){let y={fieldKey:p.fieldKey,authCreate:p.createChecked?1:0,authUpdate:p.updateChecked?1:0,authRead:p.readChecked?1:0,designFormCode:l.code};s.push(y)}return s}return{authDataList:d,headerRead:C,headerInterRead:b,headerUpdate:L,headerInterUpdate:R,headerCreate:x,headerInterCreate:N,onCheckboxChange:k}}function se(){const l=v(0),i=v(0);return l.value=window.innerHeight-145,i.value=window.innerHeight-250,{maxHeight:l,maxTableHeight:i}}export{oe as a,se as b,ce as c,le as u};
