var ye=Object.defineProperty,be=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var me=(r,a,l)=>a in r?ye(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l,_=(r,a)=>{for(var l in a||(a={}))Me.call(a,l)&&me(r,l,a[l]);if(ue)for(var l of ue(a))Te.call(a,l)&&me(r,l,a[l]);return r},fe=(r,a)=>be(r,we(a));var k=(r,a,l)=>new Promise((o,h)=>{var w=f=>{try{t(l.next(f))}catch(g){h(g)}},v=f=>{try{t(l.throw(f))}catch(g){h(g)}},t=f=>f.done?o(f.value):Promise.resolve(f.value).then(w,v);t((l=l.apply(r,a)).next())});import{f as O,r as ke,p as $,e as ee,H as Oe,n as pe,I as te,a3 as Se,a4 as xe,a5 as n,V as d,a6 as p,a7 as y,F as J,k as s,ai as u,ak as oe,E as S,af as x,W as b,q as ge,am as _e,A as ve}from"./vue-vendor-24c7dc61.js";import{B as Ie}from"./index-1c3affea.js";import De from"./DataSourcesModal-9f42b669.js";import Le from"./ValidateModal-f0e777cd.js";import Ne from"./CalculateModal-3ab8a410.js";import Ee from"./MergeTableFieldConfig-f5de5ff2.js";import Be from"./DynamicTable-6790729c.js";import Ve from"./FilterConditionConfig-8b3b3b7c.js";import{T as Re,aE as Je,b0 as Ae,aC as Ue,b1 as je,b2 as ze}from"./antd-vue-vendor-0d72f01e.js";import{a as He,s as Pe}from"./aggregation.api-c441389c.js";import{e as ie,j as We,a as qe,a6 as Ke,l as Ge}from"./index-831af9dd.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./page.api-9d0cf9bc.js";import"./page.data-58dba86c.js";import"./DBFormTable-bda07bb7.js";import"./JCalclateInput-0d22db8c.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./searchcursor-9651c8d5.js";import"./RenameModal-eec148b3.js";import"./vuedraggable-vendor-6ef4bc68.js";import"./vxe-table-vendor-8813019a.js";import"./ComponentIcon-f1bbb90f.js";import"./AggregationAdvancedFilter-a52ae827.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./type.definition-4eb605ee.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";const Qe={name:"AggregationTableHandleModal",components:{Tooltip:Re,BasicModal:Ie,FormOutlined:Je,FunctionOutlined:Ae,PlusOutlined:Ue,ReloadOutlined:je,ExclamationCircleOutlined:ze,MergeTableFieldConfig:Ee,DataSourcesModal:De,ValidateModal:Le,CalculateModal:Ne,DynamicTable:Be,FilterConditionConfig:Ve},emits:["success","register"],setup(r,{emit:a}){const l=O(!1),o=O(!1),h=O([]),w=O([]),v=O(!1),t=ke({id:"",aggregationName:"",aggregationDesc:"",relationForms:{formList:[],fieldList:[]},filterCondition:[],headerFields:[],calculateFields:[],validateInfo:[]});$("tableRelationObj",t),$("formOptions",h),$("reloadTable",l);const{createMessage:f}=qe(),[g,{openModal:A}]=ie(),[U,{openModal:D}]=ie(),[j,{openModal:M}]=ie(),[L,{closeModal:z}]=We(e=>k(this,null,function*(){yield ne(),yield N(e);const i=yield He({pageSize:100});i&&i.length>0&&(h.value=i.map(m=>({label:m.label,value:m.value,fieldOptions:[]}))),yield E(),yield pe(),o.value=!0,l.value=!l.value})),H=ee(()=>t.id),P=ee(()=>t.filterCondition.length>0?"已设置过滤条件":"未设置过滤条件"),W=ee(()=>{var e;return(e=t.relationForms)!=null&&e.formList&&t.relationForms.formList.length>0?t.relationForms.formList.map(i=>i.label).join(","):""});function N(e){let i=e.record;i&&(t.id=i.id,t.aggregationName=i.aggregationName,t.aggregationDesc=i.aggregationDesc,t.relationForms=i.relationForms?JSON.parse(i.relationForms):{},t.filterCondition=i.filterCondition?JSON.parse(i.filterCondition):[],t.headerFields=i.headerFields?JSON.parse(i.headerFields):[],t.calculateFields=i.calculateFields?JSON.parse(i.calculateFields):[],t.validateInfo=i.validateInfo?JSON.parse(i.validateInfo):[])}function E(){let e=[],i=t.relationForms;if(i!=null&&i.fieldList&&(i==null?void 0:i.fieldList.length)>0){const m=i.formList.map(F=>F.value);i==null||i.fieldList.forEach(F=>{let se="",re="";m.forEach((de,Ce)=>{let ce=i.formList.find(T=>T.value==de);if(ce){let T=ce.fieldOptions.find(R=>R.value==F[de]);if(T){let R=Ce==0?"":"-";se+=R+T.title,re+=R+T.value}}}),e.push({label:se,value:re})}),w.value=e}}function B(e){t.aggregationName=e.target.innerText}function q(){A(!0,{isUpdate:t.relationForms.length>0,relationForms:t.relationForms})}function K(e){t.relationForms={formList:e.formList,fieldList:e.fieldList},t.filterCondition=[],t.headerFields=[],t.calculateFields=[],t.validateInfo=[],E(),l.value=!l.value}function G(e,i){if(i){let m=t.calculateFields.find(F=>F.id==e.id);m.name=e.name,m.formulas=e.formulas}else t.calculateFields.push(_({},e));l.value=!l.value}function Q(e,i){if(i){let m=t.validateInfo.find(F=>F.id==e.id);m.name=e.name,m.formulas=e.formulas}else t.validateInfo.push(_({},e))}function X(){D(!0,{isUpdate:!1,calculateFields:t.calculateFields})}function Y(e){D(!0,{isUpdate:!0,calculateFields:t.calculateFields,record:e})}function Z(e){t.validateInfo.splice(e,1)}function c(){M(!0,{isUpdate:!1,relationForms:_({},te(t.relationForms))})}function C(e){M(!0,{isUpdate:!0,relationForms:_({},te(t.relationForms)),record:_({},e)})}function V(e){ae(e)||(t.headerFields.push({name:e.label||e.name,value:e.value}),l.value=!l.value)}function ae(e){return t.headerFields.some(m=>m.value==e.value)}function Fe(){return k(this,null,function*(){let e=_({},te(t));if(Ke(e.aggregationName)){f.warning("名称不能为空!");return}e.relationForms=JSON.stringify(e.relationForms),e.filterCondition=JSON.stringify(e.filterCondition),e.headerFields=JSON.stringify(e.headerFields),e.calculateFields=JSON.stringify(e.calculateFields),e.validateInfo=JSON.stringify(e.validateInfo),yield Pe(e,e.id),yield le()})}function le(){return k(this,null,function*(){yield z(),yield ne(),a("success")})}function ne(){return k(this,null,function*(){t.id="",t.aggregationName="",t.aggregationDesc="",t.relationForms={formList:[],fieldList:[]},t.filterCondition=[],t.headerFields=[],t.calculateFields=[],t.validateInfo=[],o.value=!1,v.value=!1,yield pe()})}function he(){v.value=!1,l.value=!l.value}return fe(_({registerModal:L,registerTableModal:g,registerValidateModal:U,registerCalcModal:j,configId:H,loaded:o,showFliter:v,headerList:w,filterText:P,relationFormText:W,headerFieldSelected:ae},Oe(t)),{showCalcModal:c,showDsModal:q,editValidate:Y,addValidate:X,delValidate:Z,editCalcField:C,dsSuccess:K,calculateSuccess:G,validateSuccess:Q,handleClose:le,handleSubmit:Fe,changeTitle:B,headerClick:V,filterSave:he,reloadTable:l})}};const I=r=>(Se("data-v-270ac916"),r=r(),xe(),r),Xe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ye={style:{display:"flex","align-items":"center"}},Ze=I(()=>n("span",null,"简介",-1)),$e={class:"left-container",style:{"overflow-y":"auto",margin:"24px"}},et={class:"right-container"},tt={class:"settingsWarp relative"},ot={class:"settingItem"},it=I(()=>n("div",{class:"settingTitle"},"数据来源",-1)),at={class:"settingItem"},lt={class:"settingTitle flexBetween"},nt=I(()=>n("span",null,"行表头",-1)),st={class:"overflow_ellipsis",style:{width:"140px"}},rt={class:"settingItem"},dt={class:"settingTitle flexBetween"},ct=I(()=>n("span",null,"公式",-1)),ut={key:0,class:"settingItem"},mt=I(()=>n("div",{class:"settingTitle flexBetween"},[n("span",null,"数据提交校验")],-1)),ft={style:{"list-style":"none","padding-inline-start":"0"}},pt={class:"fieldItem pointer"},gt={class:"title"},_t={class:"operator"},vt={class:"settingsWarp relative"},Ft={class:"settingItem"};function ht(r,a,l,o,h,w){const v=d("a-textarea"),t=d("ExclamationCircleOutlined"),f=d("a-popover"),g=d("a-button"),A=d("ReloadOutlined"),U=d("Tooltip"),D=d("DynamicTable"),j=d("a-layout-content"),M=d("FormOutlined"),L=d("a-input"),z=d("PlusOutlined"),H=d("a-menu-item"),P=d("a-menu"),W=d("a-dropdown"),N=d("MergeTableFieldConfig"),E=d("FunctionOutlined"),B=d("JIcon"),q=d("FilterConditionConfig"),K=d("a-layout-sider"),G=d("a-layout"),Q=d("BasicModal"),X=d("DataSourcesModal"),Y=d("ValidateModal"),Z=d("CalculateModal");return p(),y(J,null,[s(Q,{onRegister:o.registerModal,defaultFullscreen:!0,canFullscreen:!1,closable:!1,footer:null,destroyOnClose:""},{title:u(()=>[n("div",Xe,[n("div",Ye,[n("div",{contentEditable:"true",class:"name overflow_ellipsis",onInput:a[0]||(a[0]=(...c)=>o.changeTitle&&o.changeTitle(...c))},oe(r.aggregationName),33),n("span",null,[s(f,{placement:"bottomLeft"},{content:u(()=>[s(v,{value:r.aggregationDesc,"onUpdate:value":a[1]||(a[1]=c=>r.aggregationDesc=c),rows:5},null,8,["value"])]),title:u(()=>[Ze]),default:u(()=>[s(t)]),_:1})])]),n("div",null,[s(g,{onClick:o.handleClose},{default:u(()=>[S("关闭")]),_:1},8,["onClick"]),s(g,{style:{"margin-left":"10px"},type:"primary",onClick:o.handleSubmit},{default:u(()=>[S("保存")]),_:1},8,["onClick"])])])]),default:u(()=>[s(G,{style:{"margin-top":"18px"}},{default:u(()=>[s(j,{class:"relative",style:{background:"#ffffff"}},{default:u(()=>[n("div",$e,[s(U,null,{title:u(()=>[S("刷新")]),default:u(()=>[n("div",{class:"pointer",style:{float:"right","margin-bottom":"10px"},onClick:a[2]||(a[2]=c=>o.reloadTable=!o.reloadTable)},[s(A)])]),_:1}),o.loaded?(p(),x(D,{key:0,id:o.configId},null,8,["id"])):b("",!0)])]),_:1}),s(K,{width:300,theme:"light"},{default:u(()=>[n("div",et,[ge(n("div",tt,[n("div",ot,[it,s(L,{class:"pointer",value:o.relationFormText,"onUpdate:value":a[3]||(a[3]=c=>o.relationFormText=c),readOnly:"",onClick:o.showDsModal},{suffix:u(()=>[s(M,{onClick:o.showDsModal},null,8,["onClick"])]),_:1},8,["value","onClick"]),o.relationFormText?(p(),x(L,{key:0,value:o.filterText,"onUpdate:value":a[5]||(a[5]=c=>o.filterText=c),readOnly:"",class:"marginTop15 pointer",onClick:a[6]||(a[6]=c=>o.showFliter=!o.showFliter)},{suffix:u(()=>[s(M,{onClick:a[4]||(a[4]=c=>o.showFliter=!o.showFliter)})]),_:1},8,["value"])):b("",!0)]),o.relationFormText?(p(),y(J,{key:0},[n("div",at,[n("div",lt,[nt,s(W,null,{overlay:u(()=>[s(P,null,{default:u(()=>[(p(!0),y(J,null,_e(o.headerList,(c,C)=>(p(),x(H,{key:C,disabled:o.headerFieldSelected(c),style:{"max-width":"150px"},onClick:V=>o.headerClick(c)},{default:u(()=>[n("div",st,oe(c.label||c.name),1)]),_:2},1032,["disabled","onClick"]))),128))]),_:1})]),default:u(()=>[s(z,{class:"pointer",style:{"font-size":"18px",color:"rgb(86, 190, 250)"}})]),_:1})]),r.headerFields.length>0?(p(),x(N,{key:0,bizType:"name"})):b("",!0)]),n("div",rt,[n("div",dt,[ct,s(E,{class:"pointer",style:{"font-size":"20px",color:"rgb(86, 190, 250)"},onClick:o.showCalcModal},null,8,["onClick"])]),r.calculateFields.length>0?(p(),x(N,{key:0,bizType:"number",onEdit:o.editCalcField},null,8,["onEdit"])):b("",!0)]),r.calculateFields.length<0?(p(),y("div",ut,[mt,n("ul",ft,[(p(!0),y(J,null,_e(r.validateInfo,(c,C)=>(p(),y("li",{key:C,class:"field-li"},[n("div",pt,[n("span",gt,oe(c.name),1),n("div",_t,[s(B,{icon:"ant-design:form-outlined",class:"edit",onClick:V=>o.editValidate(c)},null,8,["onClick"]),s(B,{icon:"ant-design:close-outlined",class:"del marginLeft5",onClick:V=>o.delValidate(C)},null,8,["onClick"])])])]))),128))]),s(g,{type:"primary",style:{width:"100%"},onClick:o.addValidate},{default:u(()=>[S("添加校验条件")]),_:1},8,["onClick"])])):b("",!0)],64)):b("",!0)],512),[[ve,!o.showFliter]]),ge(n("div",vt,[n("div",Ft,[s(g,{type:"primary",style:{width:"100%","margin-bottom":"20px"},onClick:o.filterSave},{default:u(()=>[S("确认")]),_:1},8,["onClick"])]),s(q)],512),[[ve,o.showFliter]])])]),_:1})]),_:1})]),_:1},8,["onRegister"]),s(X,{onRegister:o.registerTableModal,onSuccess:o.dsSuccess},null,8,["onRegister","onSuccess"]),s(Y,{onRegister:o.registerValidateModal,onSuccess:o.validateSuccess},null,8,["onRegister","onSuccess"]),s(Z,{onRegister:o.registerCalcModal,onSuccess:o.calculateSuccess},null,8,["onRegister","onSuccess"])],64)}const Vo=Ge(Qe,[["render",ht],["__scopeId","data-v-270ac916"]]);export{Vo as default};
