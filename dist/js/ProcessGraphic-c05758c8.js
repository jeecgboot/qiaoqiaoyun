var z=(e,t,o)=>new Promise((n,s)=>{var i=d=>{try{c(o.next(d))}catch(f){s(f)}},a=d=>{try{c(o.throw(d))}catch(f){s(f)}},c=d=>d.done?n(d.value):Promise.resolve(d.value).then(i,a);c((o=o.apply(e,t)).next())});import{o as K,w as X,a6 as U,a7 as J,a5 as j,a8 as E}from"./vue-vendor-24c7dc61.js";import{b as Q,c as O,i as tt,e as _,a as et,t as $,d as A,f as D,q as ot,g as B,V as I}from"./bpmn-js-vendor-09dcfbc9.js";import{a as nt}from"./antd-vue-vendor-0d72f01e.js";import{h as at,e as st,k as w,l as rt}from"./index-831af9dd.js";import"./index-1c3affea.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";var v={exports:{}},At=v.exports;typeof Object.create=="function"?v.exports=function(t,o){o&&(t.super_=o,t.prototype=Object.create(o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:v.exports=function(t,o){if(o){t.super_=o;var n=function(){};n.prototype=o.prototype,t.prototype=new n,t.prototype.constructor=t}};var it=v.exports;const lt=nt(it);function C(e,t){return{x:e.x-t.x,y:e.y-t.y}}function x(e){return Math.log(e)/Math.log(10)}function Z(e,t){var o=x(e.min),n=x(e.max),s=Math.abs(o)+Math.abs(n);return s/t}function ct(e,t){return Math.max(e.min,Math.min(e.max,t))}var ut=Math.sign||function(e){return e>=0?1:-1},L={min:.2,max:4},G=10,dt=.1,ft=.75;function p(e,t,o){e=e||{},this._enabled=!1,this._canvas=o,this._container=o._container,this._handleWheel=Q(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||ft;var n=this;t.on("canvas.init",function(s){n._init(e.enabled!==!1)})}p.$inject=["config.zoomScroll","eventBus","canvas"];p.prototype.scroll=function(t){this._canvas.scroll(t)};p.prototype.reset=function(){this._canvas.zoom("fit-viewport")};p.prototype.zoom=function(t,o){var n=Z(L,G*2);this._totalDelta+=t,Math.abs(this._totalDelta)>dt&&(this._zoom(t,o,n),this._totalDelta=0)};p.prototype._handleWheel=function(t){if(!O(t.target,".djs-scrollable",!0)){var o=this._container;t.preventDefault();var n=t.ctrlKey||tt()&&t.metaKey,s=t.shiftKey,i=-1*this._scale,a;if(n?i*=t.deltaMode===0?.02:.32:i*=t.deltaMode===0?1:16,n){var c=o.getBoundingClientRect(),d={x:t.clientX-c.left,y:t.clientY-c.top};a=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*ut(t.deltaY)*i,this.zoom(a,d)}else s?a={dx:i*t.deltaY,dy:0}:a={dx:i*t.deltaX,dy:i*t.deltaY},this.scroll(a)}};p.prototype.stepZoom=function(t,o){var n=Z(L,G);this._zoom(t,o,n)};p.prototype._zoom=function(e,t,o){var n=this._canvas,s=e>0?1:-1,i=x(n.zoom()),a=Math.round(i/o)*o;a+=o*s;var c=Math.pow(10,a);n.zoom(ct(L,c),t)};p.prototype.toggle=function(t){var o=this._container,n=this._handleWheel,s=this._enabled;return typeof t=="undefined"&&(t=!s),s!==t&&_[t?"bind":"unbind"](o,"wheel",n,!1),this._enabled=t,t};p.prototype._init=function(e){this.toggle(e)};const pt={__init__:["zoomScroll"],zoomScroll:["type",p]};var ht=/^djs-cursor-.*$/;function H(e){var t=et(document.body);t.removeMatching(ht),e&&t.add("djs-cursor-"+e)}function mt(){H(null)}var gt=5e3;function yt(e,t){t=t||"element.click";function o(){return!1}return e.once(t,gt,o),function(){e.off(t,o)}}var _t=15;function N(e,t){var o;e.on("element.mousedown",500,function(a){return i(a.originalEvent)});function n(a){var c=o.start,d=o.button,f=$(a),h=C(f,c);if(!o.dragging&&vt(h)>_t&&(o.dragging=!0,d===0&&yt(e),H("grab")),o.dragging){var y=o.last||o.start;h=C(f,y),t.scroll({dx:h.x,dy:h.y}),o.last=f}a.preventDefault()}function s(a){_.unbind(document,"mousemove",n),_.unbind(document,"mouseup",s),o=null,mt()}function i(a){if(!O(a.target,".djs-draggable")){var c=a.button;if(!(c>=2||a.ctrlKey||a.shiftKey||a.altKey))return o={button:c,start:$(a)},_.bind(document,"mousemove",n),_.bind(document,"mouseup",s),!0}}this.isActive=function(){return!!o}}N.$inject=["eventBus","canvas"];function vt(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}const bt={__init__:["moveCanvas"],moveCanvas:["type",N]};function k(e){I.call(this,e)}lt(k,I);k.prototype._modules=[].concat(I.prototype._modules,[pt,bt]);const Mt={name:"ProcessGraphic",props:{instanceId:{type:String,required:!1}},components:{},emits:["task"],setup(e,{emit:t}){const o="low-app-process-graphic",{prefixCls:n}=at(o),s=`${o}-canvas`,i={getProcessInfo:"/act/designer/api/getProcessXmlByInstanceId",getInstanceInfo:"/act/task/getFlowMsgByProcInstId",getNodePositionInfo:"/act/task/getNodePositionInfo"},[a,{openModal:c,closeModal:d}]=st();let f=null;K(()=>{T()});let h=[],y="",b=[],M=[],S=[],P=0;X(()=>e.instanceId,r=>{r&&V()},{immediate:!0});function V(){return z(this,null,function*(){let r={processInstanceId:e.instanceId},m=yield w.get({url:i.getProcessInfo,params:r},{isTransformResponse:!1}),l=yield w.get({url:i.getInstanceInfo,params:r},{isTransformResponse:!1}),u=yield w.get({url:i.getNodePositionInfo,params:r},{isTransformResponse:!1});u.success&&(h=u.result.hisTasks,t("task",h));try{l.success&&(M=l.result.highLightedActivitiIdList,b=l.result.runningActivitiIdList,S=l.result.highLightedFlowIds),T();const g=yield f.importXML(m),{warnings:Lt}=g;Y(),W()}catch(g){}})}function W(){const r=f.get("canvas");f.get("elementRegistry").getAll().forEach(l=>{const u=l.businessObject.id;let g=l.type;(g=="bpmn:ExclusiveGateway"||g=="bpmn:InclusiveGateway"||g=="bpmn:ParallelGateway")&&r.addMarker(u,`${n}-gateway`),l.businessObject.$type!="bpmn:Group"&&(l.businessObject.$type=="bpmn:SequenceFlow"?S.includes(u)&&r.addMarker(u,`${n}-history-line`):(M.includes(u)&&!b.includes(u)&&r.addMarker(u,`${n}-history-node`),b.includes(u)&&r.addMarker(u,`${n}-current-node`)))})}function Y(){const r=A("marker");D(r,{id:"active-arrow",viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto",fill:"#408AF1"});const m=A("path");D(m,{d:"M 1 5 L 11 10 L 1 15 Z",style:"stroke-width: 1px; stroke-linecap: round; stroke-dasharray: 10000, 1;"});const l=ot("defs");B(r,m),B(l,r)}function It(){f.get("eventBus").on("element.hover",m=>{const{element:l}=m;if(!l.parent){F(),y="";return}if(!m||l.type==="bpmn:Process")return!1;{let u=l.id,g=l.type;y!=u&&g=="bpmn:UserTask"&&M.indexOf(u)>=0&&(y=u,R())}})}function R(){d(),c(!0,{dataList:h,taskId:y})}function q(r){r==!0&&clearTimeout(P)}function F(){P=setTimeout(()=>{y?R():d()},500)}function T(){if(f==null){let r=document.getElementById(s);f=new k({container:r})}}return{registerModal:a,prefixCls:n,containerId:s,handleModalVisible:q}}};const wt=["id"];function xt(e,t,o,n,s,i){return U(),J("div",null,[j("div",{class:E([`${n.prefixCls}-containers`])},[j("div",{class:E([`${n.prefixCls}-canvas`]),id:n.containerId},null,10,wt)],2)])}const Dt=rt(Mt,[["render",xt]]);export{Dt as default};
