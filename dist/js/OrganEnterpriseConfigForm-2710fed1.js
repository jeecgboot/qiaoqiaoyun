var b=(e,n,a)=>new Promise((m,d)=>{var y=o=>{try{r(a.next(o))}catch(c){d(c)}},l=o=>{try{r(a.throw(o))}catch(c){d(c)}},r=o=>o.done?m(o.value):Promise.resolve(o.value).then(y,l);r((a=a.apply(e,n)).next())});import{d as V,e as j,V as g,a6 as _,af as w,ai as i,k as p,E as v,ak as M,W as D,f as I,a7 as W,ag as U,ah as q,F as K,l as x,c as ne,r as oe,w as se,a3 as ae,a4 as ie,a5 as t}from"./vue-vendor-24c7dc61.js";import{g as re}from"./OrganAppThird.api-f164f206.js";import{M as S,b2 as le}from"./antd-vue-vendor-0d72f01e.js";import{cu as P,k as X,a as Y,l as Z,e as G}from"./index-831af9dd.js";import pe from"./ThirdAppConfigModal-6a290156.js";import ce from"./OrganBindEnterpriseModal-6438a21d.js";import"./index-1c3affea.js";import"./vxe-table-vendor-8813019a.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./organization.data-23f4609c.js";import"./renderUtils-7ad8f436.js";const ee={getEnabledType:"/sys/thirdApp/getEnabledType",wechatEnterprise:{user:"/sys/thirdApp/sync/wechatEnterprise/user",depart:"/sys/thirdApp/sync/wechatEnterprise/depart"},dingtalk:{user:"/sys/thirdApp/sync/dingtalk/user",depart:"/sys/thirdApp/sync/dingtalk/depart"}};let R=null;const ue=()=>b(void 0,null,function*(){if(R!=null)return P(R);{let{success:e,result:n}=yield X.get({url:ee.getEnabledType},{isTransformResponse:!1});if(e)return R=P(n),n}return{}}),Q=V({__name:"JThirdAppDropdown",props:{type:String,name:String,syncToApp:Boolean,syncToLocal:Boolean},emits:["to-app","to-local"],setup(e,{emit:n}){const a=e,m=j(()=>a.type==="wechatEnterprise"?!1:a.syncToLocal);function d(y){n(y.key,{type:a.type})}return(y,l)=>{const r=g("a-button"),o=g("a-menu-item"),c=g("a-menu"),k=g("a-dropdown");return e.syncToApp&&e.syncToLocal?(_(),w(k,{key:0},{overlay:i(()=>[p(c,{onClick:d},{default:i(()=>[e.syncToApp?(_(),w(o,{key:"to-app"},{default:i(()=>[v("同步到"+M(e.name),1)]),_:1})):D("",!0),m.value?(_(),w(o,{key:"to-local"},{default:i(()=>[v("同步到本地")]),_:1})):D("",!0)]),_:1})]),default:i(()=>[p(r,{type:"primary",preIcon:"ant-design:sync-outlined"},{default:i(()=>[v("同步"+M(e.name),1)]),_:1})]),_:1})):e.syncToApp?(_(),w(r,{key:1,type:"primary",preIcon:"ant-design:sync-outlined",onClick:l[0]||(l[0]=A=>d({key:"to-app"}))},{default:i(()=>[v("同步"+M(e.name),1)]),_:1})):(_(),w(r,{key:2,type:"primary",preIcon:"ant-design:sync-outlined",onClick:l[1]||(l[1]=A=>d({key:"to-local"}))},{default:i(()=>[v("同步"+M(e.name)+"到本地",1)]),_:1}))}}}),de=V({__name:"JThirdAppButton",props:{bizType:{type:String,required:!0},syncToApp:Boolean,syncToLocal:Boolean,selectedRowKeys:Array},emits:["sync-ok","sync-error","sync-finally"],setup(e,{emit:n}){const a=e,{createMessage:m,createWarningModal:d}=Y(),y=I({}),l=j(()=>({syncToApp:a.syncToApp,syncToLocal:a.syncToLocal})),r=j(()=>({"to-app":o,"to-local":c}));function o(f){A(f.type,"/toApp")}function c(f){A(f.type,"/toLocal")}function k(){return b(this,null,function*(){y.value=yield ue()})}function A(f,h){let F=ee[f];if(!(F&&F[a.bizType]))return;let L=F[a.bizType]+h,s=a.selectedRowKeys,C="确定要开始同步全部数据吗？可能花费较长时间！";return Array.isArray(s)&&s.length>0?C=`确定要开始同步这 ${s.length} 项吗？`:s=[],new Promise((H,ze)=>{const J=S.confirm({icon:p(le),title:"同步",content:C,onOk:()=>{J.update({keyboard:!1,okText:"同步中…",cancelButtonProps:{disabled:!0}});let te={ids:s.join(",")};return X.get({url:L,params:te},{isTransformResponse:!1}).then(T=>{let B={};T.result&&(B={width:600,title:T.message,content:()=>{let $,N=["成功信息如下：",u(x,T.result.successInfo.map((z,O)=>`${O+1}. ${z}`).join(`
`))];return T.success?$=[...N,x("br"),"无失败信息！"]:$=["失败信息如下：",u(x,T.result.failInfo.map((z,O)=>`${O+1}. ${z}`).join(`
`)),x("br"),...N],$}}),T.success?(B!=null?S.success(B):m.warning(T.message),n("sync-ok")):(B!=null?S.warning(B):m.warning(T.message),n("sync-error"))}).catch(()=>J.destroy()).finally(()=>{H(),n("sync-finally",{type:f,direction:h,isToApp:h==="/toApp",isToLocal:h==="/toLocal"})})},onCancel(){H()}})})}function u(f,h){return f("div",{id:"box",style:{minHeight:"100px",border:"1px solid #d9d9d9",fontSize:"14px",maxHeight:"250px",whiteSpace:"pre",overflow:"auto",padding:"10px"}},h)}return k(),(f,h)=>e.syncToApp||e.syncToLocal?(_(),W(K,{key:0},[y.value.wechatEnterprise?(_(),w(Q,U({key:0,type:"wechatEnterprise",name:"企微"},l.value,q(r.value)),null,16)):D("",!0),y.value.dingtalk?(_(),w(Q,U({key:1,type:"dingtalk",name:"钉钉"},l.value,q(r.value)),null,16)):D("",!0)],64)):(_(),W(K,{key:1},[v("未设置任何同步方向")],64))}});const me=Z(de,[["__scopeId","data-v-d8023e59"]]),ye=V({name:"OrganDingAppConfigForm",components:{JThirdAppButton:me,ThirdAppConfigModal:pe,OrganBindEnterpriseModal:ce},setup(){const e=I("base"),n=I(""),a=I(!1),m=I({agentId:"",clientId:"",clientSecret:"",agentAppSecret:""}),d=ne("myTenantInfo",oe({})),[y,{openModal:l}]=G(),[r,{openModal:o}]=G(),{createMessage:c}=Y();function k(s){e.value=s}function A(){return b(this,null,function*(){l(!0,{tenantId:d.id,thirdType:"wechat_enterprise"})})}function u(s){return b(this,null,function*(){let C=yield re(s);C&&(m.value=C)})}se(d,s=>b(this,null,function*(){s&&s.id&&(m.value={agentId:void 0,clientId:"",clientSecret:""},yield u({tenantId:s.id,thirdType:"wechat_enterprise"}))}),{immediate:!0,deep:!0});function f(){u({tenantId:d.id,thirdType:"wechat_enterprise"})}function h(){return b(this,null,function*(){o(!0,{izBind:!1})})}function F(){o(!0,{izBind:!0})}function L(s,C){C.success?s!=null?S.success(s):c.warning(C.message):s&&s.title?S.warning(s):c.warning({content:"同步失败，请检查对接信息录入中是否填写正确，并确认是否已开启企业微信配置！",duration:5})}return{activeKey:e,dingLiClick:k,dingCheck:a,collapseActiveKey:n,dingEditClick:A,appConfigData:m,handleSuccess:f,registerAppConfigModal:y,syncWeChatTalk:h,registerBindEnterpriseModal:r,handleBindSuccess:L,seeBindWeChat:F}}});const E=e=>(ae("data-v-2b80cb55"),e=e(),ie(),e),fe={class:"base-collapse"},ge=E(()=>t("div",{class:"header"}," 企业微信集成 ",-1)),_e=E(()=>t("div",{style:{"font-size":"16px"}}," 1.获取对接信息",-1)),he=E(()=>t("div",{class:"base-desc"},"从企业微信平台获取对接信息，即可开始集成以及同步通讯录",-1)),ve=E(()=>t("div",{style:{"margin-top":"5px"}},[t("a",{href:"https://help.qiaoqiaoyun.com/expand/dingding.html",target:"_blank"},"如何获取对接信息?")],-1)),Ee=E(()=>t("div",{style:{width:"100%","justify-content":"space-between",display:"flex"}},[t("div",{style:{"font-size":"16px"}}," 2.对接信息录入")],-1)),Ae={class:"flex-flow"},Ce=E(()=>t("div",{class:"base-title"},"Agentld",-1)),Te={class:"base-message"},ke={class:"flex-flow"},be=E(()=>t("div",{class:"base-title"},"AppKey",-1)),we={class:"base-message"},Fe={class:"flex-flow"},Be=E(()=>t("div",{class:"base-title"},"AppSecret",-1)),Ie={class:"base-message"},Se={style:{"margin-top":"20px",width:"100%","text-align":"right"}},Me={class:"sync-padding"},xe=E(()=>t("div",{style:{"font-size":"16px",width:"100%"}}," 3.数据同步",-1)),De={style:{"margin-top":"20px"},class:"base-desc"},Le={style:{float:"right"}};function $e(e,n,a,m,d,y){const l=g("a-collapse-panel"),r=g("a-collapse"),o=g("a-input-password"),c=g("a-button"),k=g("ThirdAppConfigModal"),A=g("OrganBindEnterpriseModal");return _(),W(K,null,[t("div",fe,[ge,p(r,{"expand-icon-position":"right",bordered:!1},{default:i(()=>[p(l,{key:"1"},{header:i(()=>[_e]),default:i(()=>[he,ve]),_:1})]),_:1}),t("div",null,[p(r,{"expand-icon-position":"right",bordered:!1},{default:i(()=>[p(l,{key:"2"},{header:i(()=>[Ee]),default:i(()=>[t("div",Ae,[Ce,t("div",Te,[p(o,{value:e.appConfigData.agentId,"onUpdate:value":n[0]||(n[0]=u=>e.appConfigData.agentId=u),readonly:""},null,8,["value"])])]),t("div",ke,[be,t("div",we,[p(o,{value:e.appConfigData.clientId,"onUpdate:value":n[1]||(n[1]=u=>e.appConfigData.clientId=u),readonly:""},null,8,["value"])])]),t("div",Fe,[Be,t("div",Ie,[p(o,{value:e.appConfigData.clientSecret,"onUpdate:value":n[2]||(n[2]=u=>e.appConfigData.clientSecret=u),readonly:""},null,8,["value"])])]),t("div",Se,[p(c,{onClick:e.dingEditClick},{default:i(()=>[v("编辑")]),_:1},8,["onClick"])])]),_:1})]),_:1}),t("div",Me,[xe,t("div",De,[v(" 从企业微信同步到敲敲云 "),t("a",{style:{"margin-left":"10px"},onClick:n[3]||(n[3]=(...u)=>e.seeBindWeChat&&e.seeBindWeChat(...u))},"查看已绑定的企业微信用户"),t("div",Le,[p(c,{onClick:e.syncWeChatTalk},{default:i(()=>[v("同步")]),_:1},8,["onClick"])])])])])]),p(k,{onRegister:e.registerAppConfigModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),p(A,{onRegister:e.registerBindEnterpriseModal,onSuccess:e.handleBindSuccess},null,8,["onRegister","onSuccess"])],64)}const Dt=Z(ye,[["render",$e],["__scopeId","data-v-2b80cb55"]]);export{Dt as default};
