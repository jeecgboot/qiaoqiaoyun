var Q=Object.defineProperty;var R=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var N=(e,t,o)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,O=(e,t)=>{for(var o in t||(t={}))X.call(t,o)&&N(e,o,t[o]);if(R)for(var o of R(t))Y.call(t,o)&&N(e,o,t[o]);return e};var U=(e,t,o)=>new Promise((A,y)=>{var v=i=>{try{d(o.next(i))}catch(a){y(a)}},m=i=>{try{d(o.throw(i))}catch(a){y(a)}},d=i=>i.done?A(i.value):Promise.resolve(i.value).then(v,m);d((o=o.apply(e,t)).next())});import{d as Z,f as r,c as x,r as ee,w as te,a3 as oe,a4 as se,a5 as n,V as c,a6 as h,a7 as g,F as V,k as u,ai as p,E as B,ak as b,W as K,a8 as $,am as ne,ae}from"./vue-vendor-24c7dc61.js";import{a as ie}from"./useAdminConfig-4dc7202c.js";import{v as le,w as re,x as pe}from"./organization.api-98a6e46c.js";import ue from"./AdminConfigLogList-7b063e7a.js";import de from"./AdminUserList-a327d7e4.js";import ce from"./ApplyUserListModal-7055ec75.js";import"./index-1c3affea.js";import{e as me,l as fe}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./UserAvatar-1a3df675.js";import"./UserSelectModal-d78c1490.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const ye=Z({name:"AdminConfigPage",components:{AdminConfigLogList:ue,AdminUserList:de,ApplyUserListModal:ce},setup(){const e=r("config"),t=r([]),o=r(!1),A=r([]),y=r(),v=r(""),m=r(!1),d=r(0),i=r(!1),a=x("myTenantInfo",ee);te(a,s=>{o.value=!1,s&&(C(),v.value=s.createBy,m.value=s.applyStatus==1,F(),i.value=a.superAdmin)},{immediate:!0,deep:!0});function C(){return U(this,null,function*(){let s=a.id;const f=yield le(s),{packCodes:T,superAdmin:G}=a;let M=[];for(let E of ie){let _=O({},E);if(f&&f.length>0){let D=f.filter(J=>J.packCode==_.code);D&&D.length>0?_.count=D[0].userCount:_.count=0}(G===!0||T&&T.indexOf(E.code)>=0)&&M.push(_)}t.value=M})}function w(s){o.value=!0,y.value.show(s)}function I(){o.value=!1}const k=r(0);k.value=window.innerHeight-150;function S(){return U(this,null,function*(){let s={id:a.id,applyStatus:m.value===!0?1:0};yield pe(s),a.applyStatus=s.applyStatus})}const[l,{openModal:L}]=me();function H(s){s.preventDefault(),s.stopPropagation(),L(!0,{tenantId:a.id})}const P=r();function j(s){s=="log"&&P.value.loadData()}function F(){return U(this,null,function*(){let s={tenantId:a.id};const f=yield re(s);f&&f.length>0?d.value=f.length:d.value=0})}function W(){F(),C()}function q(){F()}return{activeKey:e,goAddUser:w,roleList:t,myTenantInfo:a,hideUserList:I,userListRef:y,showUser:o,tenantCreateBy:v,loadCount:C,maxHeight:k,applyStatusChecked:m,onChangeApplyStatus:S,roleApplyUserList:A,registerUserModal:l,showApplyModal:H,onTabChange:j,logRef:P,applyCount:d,passApplyOk:W,deleteApplyOk:q,superAdmin:i}}});const z=e=>(oe("data-v-e914b933"),e=e(),se(),e),he={class:"auth-config-page"},ge={key:0},ve={class:"my-content"},Ce=z(()=>n("div",{class:"role-list-title"},[n("div",{class:"role-name"},"角色名称"),n("div",{class:"role-count"},"人数"),n("div",{class:"role-auth"},"描述"),n("div",{class:"role-operation",style:{"padding-left":"25px"}},"操作")],-1)),_e={class:"role-name ellipsis role-line-height"},Ae={class:"role-count role-line-height"},ke={class:"role-auth ellipsis role-line-height"},Le={style:{"margin-right":"16px"}},Ue=z(()=>n("span",{style:{color:"#9e9e9e"}},"(所有权限)",-1)),Be={class:"role-operation role-line-height"},be={key:0,style:{display:"flex"}},we={key:0,style:{color:"#ff4d4f","font-size":"14px"}};function Ie(e,t,o,A,y,v){const m=c("a-button"),d=c("a-list-item"),i=c("a-list"),a=c("a-tab-pane"),C=c("AdminConfigLogList"),w=c("a-checkbox"),I=c("a-tabs"),k=c("AdminUserList"),S=c("ApplyUserListModal");return h(),g(V,null,[n("div",he,[e.showUser?K("",!0):(h(),g("div",ge,[u(I,{activeKey:e.activeKey,"onUpdate:activeKey":t[2]||(t[2]=l=>e.activeKey=l),onChange:e.onTabChange},{rightExtra:p(()=>[e.superAdmin?(h(),g("div",be,[n("span",null,[u(w,{checked:e.applyStatusChecked,"onUpdate:checked":t[0]||(t[0]=l=>e.applyStatusChecked=l),onChange:e.onChangeApplyStatus},{default:p(()=>[B("允许申请管理员")]),_:1},8,["checked","onChange"])]),n("span",{style:{color:"#9e9e9e","font-size":"13px",margin:"0 40px",cursor:"pointer"},onClick:t[1]||(t[1]=(...l)=>e.showApplyModal&&e.showApplyModal(...l))},[B(" 申请角色请求 "),e.applyCount?(h(),g("span",we,"["+b(e.applyCount)+"]",1)):K("",!0)])])):K("",!0)]),default:p(()=>[u(a,{key:"config"},{tab:p(()=>[n("span",{class:$(e.activeKey=="config"?"my-title active":"my-title")},"管理配置角色",2)]),default:p(()=>[n("div",ve,[u(i,{class:"list-background","data-source":e.roleList},{header:p(()=>[Ce]),renderItem:p(({item:l})=>[u(d,{class:"role-list-item",onClick:L=>e.goAddUser(l)},{default:p(()=>[n("div",_e,b(l.roleName),1),n("div",Ae,b(l.count),1),n("div",ke,[(h(!0),g(V,null,ne(l.description,L=>(h(),g("span",Le,[B(b(L)+" ",1),Ue]))),256))]),n("div",Be,[u(m,{type:"link"},{default:p(()=>[B(" 查看成员 ")]),_:1})])]),_:2},1032,["onClick"])]),_:1},8,["data-source"])])]),_:1}),u(a,{key:"log","force-render":""},{tab:p(()=>[n("span",{class:$(e.activeKey=="log"?"my-title active":"my-title")},"日志",2)]),default:p(()=>[n("div",{class:"my-content",style:ae({height:e.maxHeight+"px"})},[u(C,{ref:"logRef",tenantId:e.myTenantInfo.id},null,8,["tenantId"])],4)]),_:1})]),_:1},8,["activeKey","onChange"])])),u(k,{ref:"userListRef",visible:e.showUser,createBy:e.tenantCreateBy,tenantId:e.myTenantInfo.id,superAdmin:e.superAdmin,onBack:e.hideUserList,onChange:e.loadCount},null,8,["visible","createBy","tenantId","superAdmin","onBack","onChange"])]),u(S,{onRegister:e.registerUserModal,onPass:e.passApplyOk,onCancel:e.deleteApplyOk},null,8,["onRegister","onPass","onCancel"])],64)}const je=fe(ye,[["render",Ie],["__scopeId","data-v-e914b933"]]);export{je as default};
