var w=Object.defineProperty,T=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var a=(n,i,e)=>i in n?w(n,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[i]=e,h=(n,i)=>{for(var e in i||(i={}))F.call(i,e)&&a(n,e,i[e]);if(g)for(var e of g(i))O.call(i,e)&&a(n,e,i[e]);return n},f=(n,i)=>T(n,I(i));var s=(n,i,e)=>(a(n,typeof i!="symbol"?i+"":i,e),e);var m=(n,i,e)=>new Promise((t,o)=>{var c=u=>{try{l(e.next(u))}catch(d){o(d)}},p=u=>{try{l(e.throw(u))}catch(d){o(d)}},l=u=>u.done?t(u.value):Promise.resolve(u.value).then(c,p);l((e=e.apply(n,i)).next())});import"./index-bff0b654.js";import{U as _}from"./JUpload-76e119c7.js";const S=".jeecg-online-modal .ant-modal-content";const R=6;class r{constructor(i,e){s(this,"_data");s(this,"field");s(this,"label");s(this,"labelLength");s(this,"formRef");s(this,"hidden");s(this,"order");s(this,"required");s(this,"onlyValidator");s(this,"hasChange");s(this,"pre");s(this,"setFieldsValue");s(this,"schemaProp");s(this,"searchForm");s(this,"disabled");s(this,"popContainer");s(this,"inPopover");this._data=e,this.field=i,this.label=e.title,this.hidden=!1,this.order=e.order||999,this.required=!1,this.onlyValidator="",this.setFieldsValue="",this.hasChange=!0,i.indexOf("@")>0?this.pre=i.substring(0,i.indexOf("@")+1):this.pre="",this.schemaProp={},this.searchForm=!1,this.disabled=!1,this.popContainer="",this.handleWidgetAttr(e),this.inPopover=!1,this.labelLength=R,this.initLabelLength()}getFormItemSchema(){let i=this.getItem();return this.addDefaultChangeEvent(i),i}getItem(){let i={field:this.field,label:this.label,labelLength:this.labelLength,component:"Input",itemProps:{labelCol:{class:"online-form-label"}}},e=this.getRule();return e.length>0&&this.onlyValidator&&(i.rules=e),this.hidden===!0&&(i.show=!1),i}setFormRef(i){this.formRef=i}isHidden(){return this.hidden=!0,this}isRequired(i){return i&&i.length>0&&i.indexOf(this.field)>=0&&(this.required=!0),this}initLabelLength(){let i=this.getExtendData();i&&i.labelLength&&(this.labelLength=i.labelLength)}getExtendData(){let i={},{fieldExtendJson:e}=this._data;if(e&&typeof e=="string")try{let t=JSON.parse(e);i=h({},t)}catch(t){}return i}getRelatedHideFields(){return[]}getPlaceholder(){return"请输入"+this.label}setOnlyValidateFun(i){i&&(this.onlyValidator=(e,t)=>m(this,null,function*(){let o=yield i(e,t);return o?Promise.reject(o):Promise.resolve()}))}getRule(){let i=[];const{view:e,errorInfo:t,pattern:o,type:c}=this._data;if(this.required===!0){let p=this.getPlaceholder();t&&(p=t),e=="sel_depart"||e=="sel_user"?this.schemaProp.required=!0:i.push({required:!0,message:p})}if(e=="sel_user"&&o==="only"&&this.onlyValidator&&i.push({validator:this.onlyValidator}),e==="list"||e==="radio"||e==="markdown"||e==="pca"||e.indexOf("sel")>=0||e==="time"||e.indexOf("upload")>=0||e.indexOf("file")>=0||e.indexOf("image")>=0)return i;if(o)if(o==="only")this.onlyValidator&&i.push({validator:this.onlyValidator});else if(o==="z")c=="number"||c=="integer"||i.push({pattern:/^-?\d+$/,message:"请输入整数"});else{let p=t||"正则校验失败",l;try{l=new RegExp(o),l||(l=o)}catch(u){l=o}i.push({pattern:l,message:p})}return i}addDefaultChangeEvent(i){this.hasChange&&(i.componentProps||(i.componentProps={}),this.disabled==!0&&(i.componentProps.disabled=!0),i.componentProps.hasOwnProperty("onChange")||(i.componentProps.onChange=(e,t)=>{e instanceof Event&&(e=e.target.value),e instanceof Array&&(e=e.join(",")),!this.formRef||!this.formRef.value||!this.formRef.value.$formValueChange||this.formRef.value.$formValueChange(this.field,e,t)})),Object.keys(this.schemaProp).map(e=>{i[e]=this.schemaProp[e]})}noChange(){this.hasChange=!1}updateField(i){this.field=i}setFunctionForFieldValue(i){i&&(this.setFieldsValue=i)}asSearchForm(){this.searchForm=!0}getModalAsContainer(){let i=this.getPopContainer();if(i!="body"){const e=document.querySelectorAll(i);if(e&&e.length>1){const t=[];if(e.forEach(o=>{o.offsetWidth==0&&o.offsetHeight==0||t.push(o)}),t.length===1)return t[0]}}return document.querySelector(i)}getPopContainer(){return this.searchForm===!0?"body":this.inPopover===!0?`.${this.popContainer}`:this.popContainer?`.${this.popContainer} .ant-modal-content`:S}handleWidgetAttr(i){i.ui&&i.ui.widgetattrs&&i.ui.widgetattrs.disabled==!0&&(this.disabled=!0)}setCustomPopContainer(i){this.popContainer=i}getLinkFieldInfo(){return""}setOtherInfo(i){}isInPopover(){this.inPopover=!0}}class C extends r{getItem(){let i=super.getItem();return this.hidden===!0&&(i.show=!1),i}}var x=(n=>(n.datetime="YYYY-MM-DD HH:mm:ss",n.date="YYYY-MM-DD",n))(x||{});class L extends r{constructor(e,t){super(e,t);s(this,"format");s(this,"showTime");this.format=x[t.view],this.showTime=t.view!="date"}getItem(){let e=super.getItem();return Object.assign({},e,{component:"DatePicker",componentProps:{placeholder:`请选择${this.label}`,showTime:this.showTime,valueFormat:this.format,style:{width:"100%"},getPopupContainer:t=>this.getModalAsContainer()}})}}class E extends r{constructor(e,t){super(e,t);s(this,"options");s(this,"dictTable");s(this,"dictText");s(this,"dictCode");s(this,"multi");this.options=this.getOptions(t.enum,t.type),this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.multi=t.multi||!1}getItem(){let e=super.getItem(),t=this.getFormComponent(),o=this.getComponentProps();return Object.assign({},e,{component:t,componentProps:o})}getFormComponent(){return this.options.length>0?"Select":"JDictSelectTag"}getComponentProps(){let t={allowClear:!0,mode:this.multi===!0?"multiple":"combobox",style:{width:"100%"},getPopupContainer:o=>this.getModalAsContainer()};if(this.options.length>0)t.options=this.options;else if(!this.dictTable)t.dictCode=this.dictCode,t.useDicColor=!0;else{let o=`${this.dictTable},${this.dictText},${this.dictCode}`;t.dictCode=encodeURI(o)}return t}getOptions(e,t){if(!e||e.length==0)return[];let o=t=="number",c=[];for(let p of e){let l=p.value;o&&(l=parseInt(l)),c.push({value:l,label:p.title})}return c}}class v extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"InputPassword"})}}class j extends r{getItem(){let i=super.getItem(),e=this.getComponentProps();return Object.assign({},i,{component:"JUpload",componentProps:e})}getComponentProps(){let i=this.getExtendData();return i&&i.uploadnum?{maxCount:Number(i.uploadnum)}:{}}}class W extends r{getItem(){let i=super.getItem(),e=this.getComponentProps();return Object.assign({},i,{component:"JUpload",componentProps:e})}getComponentProps(){let i={fileType:_.image},e=this.getExtendData();return e&&e.uploadnum&&(i.maxCount=Number(e.uploadnum)),i}}class D extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"InputTextArea",componentProps:{autoSize:{minRows:4,maxRows:10}}})}}class y extends r{constructor(e,t){super(e,t);s(this,"dictTable");s(this,"dictText");s(this,"dictCode");this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectMultiple",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};{let e={};if(!this.dictTable)e.dictCode=this.dictCode,e.useDicColor=!0;else{let t=`${this.dictTable},${this.dictText},${this.dictCode}`;e.dictCode=encodeURI(t)}return e.triggerChange=!0,e.popContainer=this.getPopContainer(),e}}}class V extends r{constructor(e,t){super(e,t);s(this,"dict");t.dictTable&&t.dictText&&t.dictCode?this.dict=encodeURI(`${t.dictTable},${t.dictText},${t.dictCode}`):this.dict=encodeURI(`${t.dictCode}`)}getItem(){let e=super.getItem(),t=this.getPopContainer();return Object.assign({},e,{component:"JSearchSelect",componentProps:{dict:this.dict,pageSize:10,async:!0,popContainer:t}})}}class A extends r{constructor(e,t){super(e,t);s(this,"code");s(this,"multi");s(this,"fieldConfig");this.code=t.code,this.multi=t.popupMulti,this.fieldConfig=this.getFieldConfig(t)}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JPopup",componentProps:t})}getComponentProps(){let e={code:this.code,multi:this.multi,fieldConfig:this.fieldConfig};return this.formRef?e.formElRef=this.formRef:e.setFieldsValue=this.setFieldsValue,this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}getFieldConfig(e){let{destFields:t,orgFields:o}=e;if(!t||t.length==0)return[];let c=t.split(","),p=o.split(","),l=[];const u=this.pre;for(let d=0;d<c.length;d++)l.push({target:u+c[d],source:p[d]});return l}}class N extends r{constructor(e,t){super(e,t);s(this,"dictCode");s(this,"multi");this.dictCode=`${t.code},${t.destFields},${t.orgFields}`,this.multi=t.popupMulti}getItem(){const e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JPopupDict",componentProps:t})}getComponentProps(){const e={dictCode:this.dictCode,multi:this.multi};return this.inPopover&&(e.getContainer=()=>this.getModalAsContainer()),e}}class M extends r{constructor(e,t){super(e,t);s(this,"pid");s(this,"multi");s(this,"textField");s(this,"pcode");this.multi=!1,this.pid=t.pidValue,this.pcode=t.pcode,this.textField=t.textField}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{componentProps:t,component:"JCategorySelect"})}getComponentProps(){let e={placeholder:"请选择"+this.label};if(this.pcode)e.pcode=this.pcode;else{let t=this.pid||"EMPTY_PID";e.pid=t}return this.textField?f(h({loadTriggleChange:!0,multiple:this.multi},e),{back:this.textField,onChange:(t,o)=>{this.formRef&&(this.formRef.value.setFieldsValue(o),this.formRef.value.$formValueChange(this.field,t))}}):h({multiple:this.multi},e)}getRelatedHideFields(){let e=[];return this.textField&&e.push(this.textField),e}}class $ extends r{getItem(){let i=super.getItem(),e=this.getComponentProps();return Object.assign({},i,{component:"JSelectDept",componentProps:e})}getComponentProps(){let i=this.getExtendData(),e={checkStrictly:!0,showButton:!1};return i.text&&(e.labelKey=i.text),i.store&&(e.rowKey=i.store),i.multiSelect===!1&&(e.multiple=!1),i.multiSelect===!0&&(e.multiple=!0),this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}}class J extends r{constructor(e,t){super(e,t);s(this,"showButton");this.showButton=t.showButton!==!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JSelectUser",componentProps:t})}getComponentProps(){let e=this.getExtendData(),t={showSelected:!1,allowClear:!0,isRadioSelection:!1,showButton:this.showButton};return e.text&&(t.labelKey=e.text),e.store&&(t.rowKey=e.store),e.multiSelect===!1&&(t.isRadioSelection=!0),this.inPopover===!0&&(t.getContainer=()=>this.getModalAsContainer()),t}}class U extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"JEditor",componentProps:{options:{auto_focus:!1}}})}}class q extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"JMarkdownEditor",componentProps:{}})}}class Y extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"JAreaSelect"})}}class B extends r{constructor(e,t){super(e,t);s(this,"dict");s(this,"pidField");s(this,"pidValue");this.dict=t.dict,this.pidField=t.pidField,this.pidValue=t.pidValue}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JTreeSelect",componentProps:{dict:this.dict,pidField:this.pidField,pidValue:this.pidValue}})}}class H extends r{constructor(e,t){super(e,t);s(this,"dictTable");s(this,"dictText");s(this,"dictCode");this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"JDictSelectTag",componentProps:t})}getComponentProps(){if(!this.dictTable&&!this.dictCode)return{};if(this.dictTable){let e=`${this.dictTable},${this.dictText},${this.dictCode}`;return{dictCode:encodeURI(e),type:"radio"}}else return{useDicColor:!0,dictCode:this.dictCode,type:"radio"}}}class Q extends r{constructor(e,t){super(e,t);s(this,"options");this.options=this.getOptions(t.enum)}getItem(){let e=super.getItem();return Object.assign({},e,{component:"JCheckbox",componentProps:{options:this.options,triggerChange:!0,useDicColor:!0}})}getOptions(e){if(!e||e.length==0)return[];let t=[];for(let o of e)t.push({value:o.value,label:o.title,color:o.color});return t}}class K extends r{constructor(i,e){super(i,e),this.hasChange=!1}getItem(){let i=super.getItem(),e=this.getComponentProps();return Object.assign({},i,{component:"JSwitch",componentProps:e})}getComponentProps(){let{fieldExtendJson:i}=this._data,e=["Y","N"];if(i&&typeof i=="string"){let t=JSON.parse(i);t.length==2&&(e=t)}return{options:e}}}class z extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"TimePicker",componentProps:{placeholder:`请选择${this.label}`,valueFormat:"HH:mm:ss",getPopupContainer:e=>this.getModalAsContainer(),style:{width:"100%"}}})}}class G extends r{constructor(e,t){super(e,t);s(this,"options");s(this,"next");s(this,"type");s(this,"table");s(this,"txt");s(this,"store");s(this,"pidField");s(this,"idField");s(this,"origin");s(this,"condition");const{dictTable:o,dictText:c,dictCode:p,pidField:l,idField:u,origin:d,condition:P}=t;this.table=o,this.txt=c,this.store=p,this.idField=u,this.pidField=l,this.origin=d,this.condition=P,this.options=[],this.next=t.next||"",this.type=t.type}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"OnlineSelectCascade",componentProps:t})}getComponentProps(){let e={table:this.table,txt:this.txt,store:this.store,pidField:this.pidField,idField:this.idField,origin:this.origin,pidValue:"-1",style:{width:"100%"},onChange:t=>{this.valueChange(t)},onNext:t=>{this.nextOptionsChange(t)}};return this._data.origin===!0&&(e.condition=this.condition),e}nextOptionsChange(e){return m(this,null,function*(){if(!this.formRef||!this.next)return;yield this.formRef.value.updateSchema({field:this.next,componentProps:{pidValue:e}})})}valueChange(e){return m(this,null,function*(){if(!this.formRef||!this.next)return;let t=this.formRef.value;t.$formValueChange(this.field,e),yield t.setFieldsValue({[this.next]:""})})}}class b extends r{constructor(e,t){super(e,t);s(this,"slot");this.slot=""}getItem(){let e=super.getItem(),t=this.slot;return Object.assign({},e,{slot:t})}groupDate(){return this.slot="groupDate",this}groupDatetime(){return this.slot="groupDatetime",this}groupNumber(){return this.slot="groupNumber",this}}class X extends r{constructor(e,t){super(e,t);s(this,"dbPointLength");this.dbPointLength=t.dbPointLength}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"InputNumber",componentProps:t})}getComponentProps(){const e={style:{width:"100%"}};return this.dbPointLength>=0&&(e.precision=this.dbPointLength),e}}class Z extends r{constructor(e,t){super(e,t);s(this,"dictTable");s(this,"dictText");s(this,"dictCode");s(this,"view");s(this,"componentString");s(this,"linkFields");this.dictTable=t.dictTable,this.dictText=t.dictText,this.dictCode=t.dictCode,this.view=t.view,this.componentString="",this.linkFields=[]}getItem(){let e=super.getItem();const t=this.getComponentProps();return Object.assign({},e,{component:this.componentString,componentProps:t})}getComponentProps(){let e={textField:this.dictText,tableName:this.dictTable,valueField:this.dictCode},t=this.getExtendData();if(t.multiSelect?e.multi=!0:e.multi=!1,t.imageField?e.imageField=t.imageField:e.imageField="",t.showType=="select"){this.componentString="LinkTableSelect";let o=this.getPopContainer();e.popContainer=o}else this.componentString="LinkTableCard";return this.linkFields.length>0&&(e.linkFields=this.linkFields),e}setOtherInfo(e){this.linkFields=e}}class k extends r{constructor(e,t){super(e,t);s(this,"dictTable");s(this,"dictText");this.dictTable=t.dictTable,this.dictText=t.dictText}getItem(){let e=super.getItem();return Object.assign({},e,{componentProps:{readOnly:!0,allowClear:!1,disabled:!0,style:{background:"none",color:"rgba(0, 0, 0, 0.85)",border:"none"}}})}getLinkFieldInfo(){return[this.dictTable,`${this.field},${this.dictText}`]}}class ee extends r{constructor(e,t){super(e,t);s(this,"code");s(this,"titleField");s(this,"multi");this.code=t.code,this.titleField=t.titleField,this.multi=t.multi||!1}getItem(){let e=super.getItem();return Object.assign({},e,{component:"LinkTableForQuery",componentProps:{code:this.code,multi:this.multi,field:this.titleField,style:{width:"100%"}}})}}class te extends r{getItem(){let i=super.getItem();return Object.assign({},i,{component:"CascaderPcaForQuery",componentProps:{style:{width:"100%"}}})}}class ie extends r{constructor(e,t){super(e,t);s(this,"multi");s(this,"store");s(this,"query");this.multi=t.multi===!0,this.store=t.store||"",this.query=t.query||!1}getItem(){let e=super.getItem(),t=this.getComponentProps();return Object.assign({},e,{component:"UserSelect",componentProps:t})}getComponentProps(){let e={multi:this.multi,store:this.store,query:this.query};return this.inPopover===!0&&(e.getContainer=()=>this.getModalAsContainer()),e}}class se extends r{constructor(e,t){super(e,t);s(this,"componentType");s(this,"datetime");s(this,"format");let o=t.view;this.format=t.format,this.datetime=!1,o==="rangeNumber"?this.componentType="JRangeNumber":o==="rangeTime"?this.componentType="RangeTime":(this.componentType="RangeDate",t.datetime===!0&&(this.datetime=!0))}getItem(){let e=super.getItem();return Object.assign({},e,{component:this.componentType,componentProps:{datetime:this.datetime,format:this.format,getPopupContainer:t=>this.getModalAsContainer()}})}}class le{static createFormSchema(i,e){switch(e.view){case"password":return new v(i,e);case"list":return new E(i,e);case"radio":return new H(i,e);case"checkbox":return new Q(i,e);case"date":case"datetime":return new L(i,e);case"time":return new z(i,e);case"file":return new j(i,e);case"image":return new W(i,e);case"textarea":return new D(i,e);case"list_multi":return new y(i,e);case"sel_search":return new V(i,e);case"popup":return new A(i,e);case"cat_tree":return new M(i,e);case"sel_depart":return new $(i,e);case"sel_user":return new J(i,e);case"umeditor":return new U(i,e);case"markdown":return new q(i,e);case"pca":return new Y(i,e);case"link_down":return new G(i,e);case"sel_tree":return new B(i,e);case"switch":return new K(i,e);case"link_table":return new Z(i,e);case"link_table_field":return new k(i,e);case"popup_dict":return new N(i,e);case"slot":return new b(i,e);case"LinkTableForQuery":return new ee(i,e);case"CascaderPcaForQuery":return new te(i,e);case"select_user2":return new ie(i,e);case"rangeDate":case"rangeTime":case"rangeNumber":return new se(i,e);case"hidden":return new C(i,e).isHidden();default:return e.type=="number"?new X(i,e):new C(i,e)}}static createSlotFormSchema(i,e){let t=new b(i,e),o=e.view;if(o=="date")t.groupDate();else if(o=="datetime")t.groupDatetime();else{let c=e.type;(c=="number"||c=="integer")&&t.groupNumber()}return t}static createIdField(){return{label:"",field:"id",component:"Input",show:!1}}}export{le as F};
