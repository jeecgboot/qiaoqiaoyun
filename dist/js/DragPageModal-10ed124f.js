var h=(c,p,m)=>new Promise((i,u)=>{var l=s=>{try{r(m.next(s))}catch(a){u(a)}},g=s=>{try{r(m.throw(s))}catch(a){u(a)}},r=s=>s.done?i(s.value):Promise.resolve(s.value).then(l,g);r((m=m.apply(c,p)).next())});import{d as E,g as P,f as d,V as S,a6 as C,a7 as F,k as T,ai as R,a5 as L,af as N,u as n,W as V,ag as J,F as O,n as U}from"./vue-vendor-24c7dc61.js";import{j as W,b as q,c as $,b6 as j,b7 as G}from"./index-831af9dd.js";import{q as H}from"./page.api-9d0cf9bc.js";import{B as K}from"./index-1c3affea.js";import X from"./PasswordModal-105dafd8.js";import{J as z}from"./index.umd.min-e2b28327.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./searchcursor-9651c8d5.js";import"./codemirror-26b29690.js";import"./china-area-data-vendor-556d14ee.js";import"./renderers-81963a7f.js";import"./vuedraggable-vendor-6ef4bc68.js";import"./grid-layout-vendor-83979c40.js";import"./active-line-512fef49.js";const Q={id:"dragEngineBox",style:{height:"100vh","overflow-y":"auto"}},ye=E({__name:"DragPageModal",props:{lowAppId:{type:String},isLowApp:{type:Boolean,default:!0}},emits:["success","register","close"],setup(c,{emit:p}){var v;const m=c;(v=P())==null||v.appContext.app.use(z);const i={padding:"0",height:window.innerHeight+"px"},u=[{name:"流程门户",value:"bpm",child:[{name:"我的申请",compType:"eoa-cms-apply-process"},{name:"流程中心",compType:"eoa-cms-my-process"},{name:"流程提醒",compType:"eoa-cms-process-notice"},{name:"近期邮件",compType:"eoa-cms-email"},{name:"常用流程",compType:"eoa-cms-comm-use",h:22},{name:"数据分析",compType:"eoa-cms-process-chart"},{name:"流程类型",compType:"eoa-cms-process-type"}]},{name:"企业门户",value:"oa",child:[{name:"轮播图",value:"eoa-cms-banner",h:22},{name:"常用链接",compType:"eoa-cms-link",h:26},{name:"新闻中心",compType:"eoa-cms-news-info"},{name:"日程计划",compType:"eoa-cms-plan"},{name:"规章制度",compType:"eoa-cms-rule-info"},{name:"签约新闻",compType:"eoa-cms-sign-news"},{name:"通知公告",compType:"eoa-cms-user-notice"}]}],l=d(""),g=d(""),r=d(!1),s=d(),a=d({componentData:[],name:"",coverUrl:"",backgroundColor:"",backgroundImage:"",designType:100,updateCount:null,theme:"default",style:"default"}),[k,{setModalProps:I,closeModal:y}]=W(o=>h(this,null,function*(){I({showCancelBtn:!1,showOkBtn:!1}),yield _(),l.value=o.record.id,b(o.record),g.value=`页面设计 [${o.record.name}]`;const e=yield H({id:n(l)});if(e.success){a.value.name=e.result.name,a.value.coverUrl=e.result.coverUrl;let t=e.result.template?JSON.parse(e.result.template):[];a.value.componentData=t,a.value.backgroundColor=e.result.backgroundColor,a.value.backgroundImage=e.result.backgroundImage,a.value.designType=e.result.designType,a.value.style=e.result.style||"default",a.value.theme=e.result.theme||"default",a.value.updateCount=e.result.updateCount}setTimeout(()=>{U(()=>{r.value=!0})},300)}));function _(){a.value.componentData=[]}function b(o){const e=o.protectionCode;let t=j(G.DRAG_CACHE_PREFIX+n(l));e&&e.length>0&&!t&&(s.value.showModal("design",o),s.value.extraMsg="")}function D(){y(),p("success"),p("close")}function B(o){p("success")}function M(o){let e=document.getElementById("dragEngineBox");x(e,o)}function x(o,e){let t=o.scrollTop;const f=()=>{let w=e-t;t=t+w/10,Math.abs(w)<1?o.scrollTo(0,e):(o.scrollTo(0,t),setTimeout(f,20))};f()}function A(o){window.open(o,"_blank")}return(o,e)=>{const t=S("DragEngine");return C(),F(O,null,[T(n(K),J(o.$attrs,{footer:null,wrapClassName:"drag-design-process-modal",style:{top:"0",padding:"0"},onRegister:n(k),bodyStyle:i,canFullscreen:!1,closable:!1,defaultFullscreen:"",destroyOnClose:""}),{default:R(()=>[L("div",Q,[r.value?(C(),N(t,{key:0,dragData:a.value,pageId:l.value,token:n(q)(),tenantId:n($)(),lowAppId:c.lowAppId,isLowApp:c.isLowApp,pluginList:u,onSave:B,onClose:D,onScroll:M,onOpenWindow:A},null,8,["dragData","pageId","token","tenantId","lowAppId","isLowApp"])):V("",!0)])]),_:1},16,["onRegister"]),T(X,{ref_key:"passwordRef",ref:s,onClosed:n(y)},null,8,["onClosed"])],64)}}});export{ye as default};
