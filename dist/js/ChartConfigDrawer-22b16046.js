var me=Object.defineProperty,Ce=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var G=(e,n,l)=>n in e?me(e,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[n]=l,H=(e,n)=>{for(var l in n||(n={}))ye.call(n,l)&&G(e,l,n[l]);if(j)for(var l of j(n))ge.call(n,l)&&G(e,l,n[l]);return e},z=(e,n)=>Ce(e,he(n));var s=(e,n,l)=>new Promise((T,h)=>{var b=p=>{try{y(l.next(p))}catch(i){h(i)}},A=p=>{try{y(l.throw(p))}catch(i){h(i)}},y=p=>p.done?T(p.value):Promise.resolve(p.value).then(b,A);y((l=l.apply(e,n)).next())});import{B as ve,a as we}from"./index-44229d9b.js";import{d as Ee,f as O,r as be,w as Q,e as Ae,a3 as ke,a4 as De,a5 as c,V as f,a6 as C,af as R,ai as d,a8 as M,k as m,a7 as _,ae as S,E as X}from"./vue-vendor-24c7dc61.js";import{cv as Te,b1 as Ie,cw as Fe,cx as Oe,bU as _e,cr as Se,aC as Be,aP as Re,I as Pe,E as Le}from"./antd-vue-vendor-0d72f01e.js";import{d as Me}from"./vuedraggable-vendor-6ef4bc68.js";import Ve from"./RightMoreAction-64132985.js";import{k as w,b as $e,c as Ne,r as Ue,l as He}from"./index-831af9dd.js";import{a as ze}from"./useViewTabs-276e2e92.js";import"./vxe-table-vendor-8813019a.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";const E={save:"/desform/chart/save",saveMulti:"/desform/chart/saveMulti",updateType:"/desform/chart/updateType",remove:"/desform/chart/remove",copy:"/desform/chart/copy",list:"/desform/chart/list",resetOrder:"/desform/chart/resetOrder",createDefChart:"/drag/page/comp/createDefChart"};function qe(e){function n(i){return s(this,null,function*(){let o=z(H({},i),{designFormCode:e.routeCode});yield w.post({url:E.save,params:o},{isTransformResponse:!1})})}function l(i){return s(this,null,function*(){let o=z(H({},i),{designFormCode:e.routeCode});yield w.post({url:E.saveMulti,params:o},{isTransformResponse:!1})})}function T(i){return s(this,null,function*(){let o={id:i};yield w.post({url:E.copy,params:o},{isTransformResponse:!1})})}function h(i,o){return s(this,null,function*(){let g={id:i,type:o};return(yield w.post({url:E.updateType,params:g},{isTransformResponse:!1})).success,{}})}function b(i){return s(this,null,function*(){let o={id:i};yield w.delete({url:E.remove,data:o},{joinParamsToUrl:!0})})}function A(){return s(this,null,function*(){let i={code:e.routeCode};const o=yield w.get({url:E.list,params:i},{isTransformResponse:!1});return o.success?o.result:[]})}function y(i){return s(this,null,function*(){let o={list:i};return(yield w.post({url:E.resetOrder,params:o},{isTransformResponse:!1})).success,{}})}function p(i,o){return s(this,null,function*(){let g={name:i,code:o};return yield w.get({url:E.createDefChart,params:g})})}return{queryChartConfigList:A,removeChartConfig:b,updateType:h,copyChartConfig:T,saveChartConfig:n,saveMultiChartConfig:l,resetOrder:y,createDefChart:p}}const Je=Ee({name:"ChartConfigDrawer",components:{BasicDrawer:ve,ShrinkOutlined:Te,ReloadOutlined:Ie,HolderOutlined:Fe,ArrowsAltOutlined:Oe,EllipsisOutlined:_e,OrderedListOutlined:Se,PlusOutlined:Be,UserOutlined:Re,InfoCircleFilled:Pe,RightMoreAction:Ve,draggable:Me},emits:["reload","register"],props:{routeCode:{type:String,default:""},desformName:{type:String,default:""},isLowApp:{type:Boolean,default:!1}},setup(e,{emit:n}){const{saveChartConfig:l,saveMultiChartConfig:T,updateType:h,queryChartConfigList:b,removeChartConfig:A,createDefChart:y,resetOrder:p}=qe(e),i=O(),o=O("public"),{myHeight:g,getDrawerClass:I}=ze(e),F=O(560),k=O(!1),B=be({display:"flex",flex:"1 0 auto","flex-flow":"row wrap","justify-content":"center",margin:" 0 auto",width:"521px"});Q(k,()=>{if(k.value===!0){let t=window.innerWidth;F.value=t,B.width=t*.8+"px"}else F.value=560,B.width="521px"},{immediate:!0});const[$,{closeDrawer:q}]=we(t=>s(this,null,function*(){yield D()}));function r(t,a){v(t),o.value=a}function N(t){return o.value===t?"tab-title active":"tab-title"}function v(t){t.preventDefault(),t.stopPropagation()}const P=O([]),L=O([]);function Y(t,a){}function Z(t){v(t);let a=o.value;i.value.showModal("add",{label:e.desformName,key:e.routeCode,type:a})}function x(t,a){v(t),k.value=a}const ee={height:"340px"},te={padding:"10px 10px 0"};function J(t){let a=t.length;if(a!=0){for(let u of t)u.reload=!0;return a%2!=0&&t.push({empty:!0}),t}}function D(){return s(this,null,function*(){const t=yield b();let a=[],u=[];t&&t.length>0&&(a=t.filter(U=>U.type==="public"),u=t.filter(U=>U.type==="private"),a.length>0&&(a=J(a)),u.length>0&&(u=J(u))),P.value=u,L.value=a})}Q(()=>e.routeCode,t=>s(this,null,function*(){if(t){const a=yield b();(!a||a.length==0)&&setTimeout(()=>{ae()},1500)}}),{immediate:!0});function ae(){return s(this,null,function*(){const t=yield y(e.desformName,e.routeCode);t&&t.length>0&&(yield T({multiChart:t,type:o.value}))})}function ne(t){if(o.value=="public"){let a=L.value.filter(u=>u.chartId==t);a[0].reload=!a[0].reload}else{let a=P.value.filter(u=>u.chartId==t);a[0].reload=!a[0].reload}}function K(t){return s(this,null,function*(){yield l({chartId:t,type:o.value}),yield D()})}function oe(t){return{id:t.chartId,reload:t.reload,chartType:t.type}}function ie(t){i.value.showModal("edeit",t)}function re(t,a){return s(this,null,function*(){t==1&&(yield K(a),yield D())})}function se(t){return s(this,null,function*(){yield h(t,"private"),yield D()})}function le(t){return s(this,null,function*(){yield h(t,"public"),yield D()})}function ue(t){return s(this,null,function*(){yield h(t,"private"),yield D()})}function de(t){return s(this,null,function*(){yield A(t),yield D()})}function W(t){return s(this,null,function*(){if(t&&t.length){let a=[];for(let u=0;u<t.length;u++)a.push({id:t[u].id,seq:u+1});yield p(a)}})}function pe(){let t=L.value;W(t)}function ce(){return s(this,null,function*(){let t=P.value;W(t)})}const fe=Ae(()=>{var a,u;let t=(u=(a=Ue.currentRoute.value)==null?void 0:a.params)==null?void 0:u.appId;return t||(t=""),t});return{register:$,myHeight:g,activeKey:o,handleChangeTab:r,drawerWidth:F,maxScreen:k,getTabTitleClass:N,privateChartList:P,publicChartList:L,simpleImage:Le.PRESENTED_IMAGE_SIMPLE,createChart:Z,changeScreen:x,bodyStyle:ee,headStyle:te,onDragEnd:Y,dragStyle:B,getToken:$e,onEditChart:ne,onAddChart:K,chartEditRef:i,getChartId:oe,onEdit:ie,onCopy:re,update2Private:ue,update2Public:le,onRemoveOut:se,onDelete:de,onPrivateDragEnd:ce,onPublicDragEnd:pe,getDrawerClass:I,lowAppId:fe,getTenantId:Ne}}});const V=e=>(ke("data-v-699fc5b9"),e=e(),De(),e),Ke={style:{height:"50px",width:"100%",padding:"0 20px",display:"flex"}},We=V(()=>c("div",{style:{width:"50px","line-height":"50px",color:"#000","font-size":"18px"}}," 统计 ",-1)),je={style:{flex:"1","align-items":"center",display:"flex"}},Ge={style:{margin:"0 auto",display:"flex"}},Qe={class:"custom-header-icons"},Xe=V(()=>c("div",null,null,-1)),Ye=V(()=>c("span",null,[c("div",{style:{width:"100%",padding:"0 40px","font-size":"17px",color:"#9e9e9e","margin-top":"30px"}}," 自由定义图表，支持数量或数值统计、维度或周期对比、数据透视等多种分析 "),c("div",{style:{"font-size":"14px",color:"#9e9e9e",width:"100%",padding:"0 40px","margin-top":"5px"}}," 管理员可把个人图表转为公共，供成员一同使用 ")],-1)),Ze=V(()=>c("span",null,[c("div",{style:{color:"#9e9e9e","margin-top":"30px"}},"还没有个人图表")],-1));function xe(e,n,l,T,h,b){const A=f("PlusOutlined"),y=f("a-tooltip"),p=f("ShrinkOutlined"),i=f("ArrowsAltOutlined"),o=f("a-button"),g=f("a-empty"),I=f("JSingleChart"),F=f("draggable"),k=f("a-tab-pane"),B=f("a-tabs"),$=f("JChartEditModal"),q=f("BasicDrawer");return C(),R(q,{closable:!1,push:!1,rootClassName:e.getDrawerClass(),onRegister:e.register,width:e.drawerWidth,headerStyle:{padding:"0"}},{title:d(()=>[c("div",Ke,[We,c("div",je,[c("div",Ge,[c("div",{class:M(e.getTabTitleClass("public")),onClick:n[0]||(n[0]=r=>e.handleChangeTab(r,"public"))},"公共",2),c("div",{class:M(e.getTabTitleClass("private")),onClick:n[1]||(n[1]=r=>e.handleChangeTab(r,"private"))},"个人",2)])]),c("div",Qe,[m(y,{placement:"bottom",title:"新建图表"},{default:d(()=>[m(A,{onClick:e.createChart},null,8,["onClick"])]),_:1}),e.maxScreen?(C(),R(p,{key:0,title:"小屏",onClick:n[2]||(n[2]=r=>e.changeScreen(r,!1))})):(C(),R(i,{key:1,title:"全屏",onClick:n[3]||(n[3]=r=>e.changeScreen(r,!0))}))])])]),default:d(()=>[m(B,{activeKey:e.activeKey,center:""},{renderTabBar:d(()=>[Xe]),default:d(()=>[m(k,{tab:"公共",key:"public",forceRender:""},{default:d(()=>[e.publicChartList.length==0?(C(),_("div",{key:0,style:S({height:e.myHeight+"px"}),class:"custom-no-data"},[m(g,{image:e.simpleImage},{description:d(()=>[Ye]),default:d(()=>[m(o,{type:"primary",onClick:e.createChart},{default:d(()=>[X(" 创建图表 ")]),_:1},8,["onClick"])]),_:1},8,["image"])],4)):(C(),_("div",{key:1,class:"view-config-container public-list",style:S({height:e.myHeight+"px"})},[m(F,{"item-key":"name",animation:"300",modelValue:e.publicChartList,"onUpdate:modelValue":n[4]||(n[4]=r=>e.publicChartList=r),style:S(e.dragStyle),dragClass:"dragClass",onEnd:e.onPublicDragEnd},{item:d(({element:r,index:N})=>[r.empty?(C(),_("div",{key:0,style:{height:"0",width:"500px"},class:M(e.maxScreen?"max-screen-card ant-card":"ant-card")},null,2)):(C(),R(I,{key:1,comp:e.getChartId(r),token:e.getToken(),lowAppId:e.lowAppId,tenantId:e.getTenantId(),onUpdateType:v=>e.update2Private(r.id),onEditComp:e.onEdit,onCopy:e.onCopy,onRemoveOut:v=>e.onRemoveOut(r.id),onDelComp:v=>e.onDelete(r.id)},null,8,["comp","token","lowAppId","tenantId","onUpdateType","onEditComp","onCopy","onRemoveOut","onDelComp"]))]),_:1},8,["modelValue","style","onEnd"])],4))]),_:1}),m(k,{tab:"个人",key:"private",forceRender:""},{default:d(()=>[e.privateChartList.length==0?(C(),_("div",{key:0,style:S({height:e.myHeight+"px"}),class:"custom-no-data"},[m(g,{image:e.simpleImage},{description:d(()=>[Ze]),default:d(()=>[m(o,{type:"primary",onClick:e.createChart},{default:d(()=>[X(" 创建图表 ")]),_:1},8,["onClick"])]),_:1},8,["image"])],4)):(C(),_("div",{key:1,class:"view-config-container public-list",style:S({height:e.myHeight+"px"})},[m(F,{"item-key":"name",animation:"300",modelValue:e.privateChartList,"onUpdate:modelValue":n[5]||(n[5]=r=>e.privateChartList=r),style:S(e.dragStyle),dragClass:"dragClass",onEnd:e.onPrivateDragEnd},{item:d(({element:r,index:N})=>[r.empty?(C(),_("div",{key:0,style:{height:"0",width:"500px"},class:M(e.maxScreen?"max-screen-card ant-card":"ant-card")},null,2)):(C(),R(I,{key:1,comp:e.getChartId(r),token:e.getToken(),onEditComp:e.onEdit,onCopy:e.onCopy,onUpdateType:v=>e.update2Public(r.id),onRemoveOut:v=>e.onRemoveOut(r.id),lowAppId:e.lowAppId,tenantId:e.getTenantId(),onDelComp:v=>e.onDelete(r.id)},null,8,["comp","token","onEditComp","onCopy","onUpdateType","onRemoveOut","lowAppId","tenantId","onDelComp"]))]),_:1},8,["modelValue","style","onEnd"])],4))]),_:1})]),_:1},8,["activeKey"]),m($,{ref:"chartEditRef",lowAppId:e.lowAppId,token:e.getToken(),onAdd:e.onAddChart,onEdit:e.onEditChart},null,8,["lowAppId","token","onAdd","onEdit"])]),_:1},8,["rootClassName","onRegister","width"])}const ct=He(Je,[["render",xe],["__scopeId","data-v-699fc5b9"]]);export{ct as default};
