var b=(t,d,r)=>new Promise((w,F)=>{var p=n=>{try{h(r.next(n))}catch(m){F(m)}},k=n=>{try{h(r.throw(n))}catch(m){F(m)}},h=n=>n.done?w(n.value):Promise.resolve(n.value).then(p,k);h((r=r.apply(t,d)).next())});import{d as K,f as v,c as x,w as D,e as ee,a5 as a,V as L,a6 as c,a7 as T,F as $,ak as V,k as _,ai as s,E as C,am as P,af as S,W as A}from"./vue-vendor-24c7dc61.js";import{a_ as te}from"./antd-vue-vendor-0d72f01e.js";import le from"./FilterFiledList-8a929f88.js";import ie from"./FormFieldSelect-9cf3f019.js";import{b as oe}from"./LinkRecordSelect-385d0eae.js";import{k as ae,a as ne,bI as ue,l as re}from"./index-831af9dd.js";import"./type.definition-4eb605ee.js";import"./SuperQueryValComponent-97f284a9.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./ComponentIcon-f1bbb90f.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const se=K({name:"ButtonFormConfig",props:{visible:{type:Boolean,default:!1},info:{type:Object,default:()=>{}}},components:{EditOutlined:te,FilterFiledList:le,FormFieldSelect:ie},emits:["ok"],setup(t){const{createConfirmSync:d}=ne(),r=v(""),w=v([]),F=v([]),p=x("globalColumnList",void 0),{columnList:k,initColumnList:h}=oe(),n=v(""),m=v(""),f=v("");function N(){f.value=="update"&&(g.value="")}const g=v(""),u=v(""),R=v([]);D(()=>t.visible,e=>{if(e===!0){if(t.info){let o=t.info.formType;if(o){if(o==="create"){if(!t.info.createFormField){B.value=!0;return}}else if(!t.info.fieldList||t.info.fieldList.length==0){B.value=!0;return}}else{B.value=!0;return}}else{B.value=!0;return}H.value||(B.value=!0)}}),D(()=>t.info,e=>{r.value=e.formTable||"current",n.value=e.linkRecordField,m.value=e.linkRecordTable,f.value=e.formType||"update",g.value=e.createFormField,u.value=e.createFormCode,R.value=e.updateFieldList||[]},{immediate:!0,deep:!0}),D(r,e=>{if(e==="link-record"){if(!E(1))return;let l=p.value.filter(y=>y.type==="link-record"&&y.multi===!1),i=[];for(let y of l)i.push({value:y.key,label:y.name,table:y.code});w.value=i}else e=="current"&&(n.value="")},{immediate:!0}),D(n,e=>b(this,null,function*(){if(e){if(!E(2))return;yield j(e)}}),{immediate:!0});function j(e){return b(this,null,function*(){let l=p.value.filter(i=>i.key===e||i.model===e);if(l&&l.length>0){let i=l[0].code;i&&(yield Q(i))}})}D(f,e=>b(this,null,function*(){if(e=="update")g.value="";else if(r.value==="current"){if(!E(3))return;let o=p.value,l=U(o);F.value=l}else{let o=yield I(),l=U(o);F.value=l}}),{immediate:!0});function U(e){let o=e.filter(i=>i.type==="link-record"),l=[];for(let i of o)l.push({value:i.key,label:i.name,table:i.code});return l}function I(){return new Promise((e,o)=>{(function l(i){return b(this,null,function*(){if(i>10){if(!E(5)){o("columnList没获取到！");return}let M=n.value;if(!M){o("第一个下拉框的值没有获取到！");return}yield j(M),e(k.value);return}let y=k.value;y&&y.length>0?e(y):setTimeout(()=>{l(++i)},200)})})(0)})}function E(e){return!(!p||!p.value)}const B=v(!1);function W(){B.value=!0}const O=v();function z(){let e={};if(e.formTable=r.value,r.value==="link-record"&&(e.linkRecordField=n.value,e.linkRecordTable=m.value),e.formType=f.value,f.value==="create")e.createFormField=g.value,e.createFormCode=u.value;else if(f.value==="update"){let o=O.value.getFieldListData();e.updateFieldList=o}return e}function G(){if(f.value==="update"){let e=O.value.getFieldListData();e&&e.length>0?R.value=e:R.value=[]}B.value=!1}function J(){if(r.value==="link-record"){let e=n.value;if(!E(6))return"";let l=p.value.filter(i=>i.key===e||i.model===e);if(l&&l.length>0){let i=l[0].name;if(i)return"“"+i+"”"}}return""}function q(e){if(r.value==="current"){if(e&&p){let o=p.value;for(let l of o)if(l.key===e||l.model===e)return l.name}return""}else{if(e&&k){let o=k.value;for(let l of o)if(l.key===e||l.model===e)return l.name}return""}}const H=ee(()=>{if(f.value==="create"){let e=g.value,o=q(e);if(o)return o}else{let e=R.value,o=[];if(e&&e.length>0)for(let l of e){let i=q(l.key);i&&o.push(i)}return o.join("、")}});function Q(e){return b(this,null,function*(){const o="/desform/view/queryDesignByCode";let l={code:e},i=yield ae.get({url:o,params:l},{isTransformResponse:!1});i.success&&h(i.result)})}function X(){let e=F.value,o=g.value,l=e.filter(i=>i.value===o);l&&l.length>0&&(u.value=l[0].table)}function Y(){return b(this,null,function*(){let e=w.value,o=n.value,l=e.filter(i=>i.value===o);if(l&&l.length>0){m.value=l[0].table,g.value="",F.value=[],yield ue(300);let i=yield I();F.value=U(i)}})}function Z(e){return b(this,null,function*(){var l;let o=(l=O.value)==null?void 0:l.getFieldListData();if(o&&o.length>0){if(!(yield d({title:"切换填写对象",content:"这将会清空已经配置的字段列表，确定吗？"})))return;O.value.myList=[]}r.value=e.target.value})}return{formTable:r,linkRecordField:n,formType:f,onChangeFormType:N,createFormField:g,createFormCode:u,updateFieldList:R,modalVisible:B,onOk:G,goEdit:W,getData:z,whatFields:H,getLinkRecordFieldText:J,fieldListRef:O,selectOptions1:w,selectOptions2:F,dynamicColumnList:k,onChangeFormTable:Z,onChangeCreateFormField:X,onChangeLinkRecordField2:Y}}});const de={key:0},me={class:"button-conditions-text"},fe={style:{flex:"1"}},ce={class:"condition-item"},pe={key:0},ve=a("span",null,"在关联记录",-1),Fe={style:{"font-weight":"700"}},he=a("span",null,"中",-1),ge={class:"condition-item auto-height"},ye={style:{"font-weight":"700"}},_e={class:"button-edit-icon"},ke={class:"button-config",style:{padding:"0px 24px 20px"}},Be={class:"item"},be=a("h5",null,"填写对象",-1),Ce={class:"content"},Le={key:0,style:{"margin-top":"10px",width:"100%"}},Te=a("span",{style:{width:"70px"}},"关联字段：",-1),we={class:"item"},Re=a("h5",null,"填写内容",-1),Ee={class:"content"},Oe={key:0,style:{"margin-top":"10px",width:"100%"}},De=a("span",{style:{width:"70px"}},"关联字段：",-1);function Ve(t,d,r,w,F,p){const k=L("EditOutlined"),h=L("a-radio"),n=L("a-radio-group"),m=L("a-select-option"),f=L("a-select"),N=L("FormFieldSelect"),g=L("a-modal");return t.visible?(c(),T("div",de,[a("div",me,[a("div",fe,[a("div",ce,[t.formTable==="current"?(c(),T("span",pe,"在当前记录中")):(c(),T($,{key:1},[ve,a("span",Fe,V(t.getLinkRecordFieldText()),1),he],64))]),a("div",ge,[a("span",null,V(t.formType==="update"?"填写":"新建"),1),a("span",ye,V(t.whatFields),1)])]),a("div",_e,[_(k,{onClick:t.goEdit},null,8,["onClick"])])]),_(g,{centered:"",open:t.modalVisible,"onUpdate:open":d[3]||(d[3]=u=>t.modalVisible=u),title:"设置填写内容",onOk:t.onOk,width:"630px",forceRender:""},{default:s(()=>[a("div",ke,[a("div",Be,[be,a("div",Ce,[_(n,{value:t.formTable,onChange:t.onChangeFormTable},{default:s(()=>[_(h,{value:"current"},{default:s(()=>[C("当前记录")]),_:1}),_(h,{value:"link-record"},{default:s(()=>[C("关联记录（单条）")]),_:1})]),_:1},8,["value","onChange"]),t.formTable=="link-record"?(c(),T("div",Le,[Te,a("span",null,[_(f,{style:{width:"calc(100% - 70px)"},placeholder:"请选择",value:t.linkRecordField,"onUpdate:value":d[0]||(d[0]=u=>t.linkRecordField=u),onChange:t.onChangeLinkRecordField2},{default:s(()=>[t.selectOptions1.length>0?(c(!0),T($,{key:0},P(t.selectOptions1,u=>(c(),S(m,{value:u.value},{default:s(()=>[C(V(u.label),1)]),_:2},1032,["value"]))),256)):(c(),S(m,{key:1,disabled:"",value:""},{default:s(()=>[C("无数据")]),_:1}))]),_:1},8,["value","onChange"])])])):A("",!0)])]),a("div",we,[Re,a("div",Ee,[_(n,{value:t.formType,"onUpdate:value":d[1]||(d[1]=u=>t.formType=u),onChange:t.onChangeFormType},{default:s(()=>[_(h,{value:"update"},{default:s(()=>[C("填写指定字段")]),_:1}),_(h,{value:"create"},{default:s(()=>[C("新建关联记录")]),_:1})]),_:1},8,["value","onChange"]),t.formType=="create"?(c(),T("div",Oe,[De,a("span",null,[_(f,{style:{width:"calc(100% - 70px)"},placeholder:"请选择",value:t.createFormField,"onUpdate:value":d[2]||(d[2]=u=>t.createFormField=u),onChange:t.onChangeCreateFormField},{default:s(()=>[t.selectOptions2.length>0?(c(!0),T($,{key:0},P(t.selectOptions2,u=>(c(),S(m,{value:u.value},{default:s(()=>[C(V(u.label),1)]),_:2},1032,["value"]))),256)):(c(),S(m,{key:1,disabled:"",value:""},{default:s(()=>[C("无数据")]),_:1}))]),_:1},8,["value","onChange"])])])):A("",!0)])]),t.formType=="update"?(c(),S(N,{key:0,formTable:t.formTable,linkRecordField:t.linkRecordField,linkRecordColumnList:t.dynamicColumnList,dbFieldList:t.updateFieldList,ref:"fieldListRef"},null,8,["formTable","linkRecordField","linkRecordColumnList","dbFieldList"])):A("",!0)])]),_:1},8,["open","onOk"])])):A("",!0)}const St=re(se,[["render",Ve]]);export{St as default};
