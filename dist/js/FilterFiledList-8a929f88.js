var ie=Object.defineProperty,ae=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var G=(t,n,u)=>n in t?ie(t,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[n]=u,L=(t,n)=>{for(var u in n||(n={}))re.call(n,u)&&G(t,u,n[u]);if(Z)for(var u of Z(n))ue.call(n,u)&&G(t,u,n[u]);return t},O=(t,n)=>ae(t,se(n));import{d as pe,f as x,h as de,e as H,w as U,I as z,n as ce,a5 as r,V as v,a6 as a,a7 as p,F,am as V,k as d,ai as m,E as g,ak as R,af as A,z as me,W as D,O as fe,ap as ve,aq as ye}from"./vue-vendor-24c7dc61.js";import{aC as he,n as _e,av as ge,aZ as Ce,cm as Fe,p as $}from"./antd-vue-vendor-0d72f01e.js";import{s as J,d as K}from"./type.definition-4eb605ee.js";import ke from"./SuperQueryValComponent-97f284a9.js";import{c as we,u as be}from"./LinkRecordSelect-385d0eae.js";import{D as Se,a as Be,l as Le}from"./index-831af9dd.js";import{C as Oe}from"./ComponentIcon-f1bbb90f.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const xe=pe({name:"FilterFiledList",components:{PlusOutlined:he,SearchOutlined:_e,CloseOutlined:ge,TableOutlined:Ce,OnlineSuperQueryValComponent:ke,SaveOutlined:Fe,ComponentIcon:Oe},emits:["save","copy","search","update:clear"],props:{columnList:{type:Array,default:()=>[]},info:{type:Object,require:!1,default:{}},saveButton:{type:Boolean,default:!0},clear:{type:Boolean,default:!1},emitChange:{type:String,default:""},parentContainer:{type:String,default:""}},setup(t,{emit:n}){const{getConditionOptions:u,getDefaultRule:W,getDefaultVal:j}=be(),T=x([]);function k(e){if(!e||e.length==0){T.value=[];return}let l=e.filter(i=>K.includes(i.type)||K.includes(i.realType)?i.type=="link-field"||i.realType==="link-field"?i.saveType==="save":!1:!0);T.value=l}const C=x(!1),f=x("and"),s=x([]),{getSchema:E,getFieldConfig:M}=we(t,!0,t.parentContainer),{createMessage:P}=Be();de(()=>{let e=t.columnList;k(e);let l=t.info;f.value=l.conditionType||"and";let i=[];if(l.conditions){let h=l.conditions;if(h&&h.length>0)for(let S of h){let B="";if(e&&e.length>0){let _=e.filter(N=>N.model==S.field);_&&_.length>0&&(B=_[0].name)}if(!B){let _=J.filter(N=>N.field==S.field);_&&_.length>0&&(B=_[0].name)}if(B){let _=$(S,"field","rule","val","type","timestamp");i.push(O(L({},_),{name:B,reloading:!1}))}}}s.value=i});function q(e){let l=e.field||e.model,i=s.value,h=W(e.type),S=j(e.type);i.push({field:l,rule:h,val:S,type:e.type,name:e.name,timestamp:e.timestamp,reloading:!1}),s.value=i,C.value=!1}const w=x("");function I(e){let l=w.value;return l?e?e.name.indexOf(l)>=0:!1:!0}function o(){let e=[];for(let l of s.value)if(b(l)){let i=$(l,"field","rule","type","timestamp");e.push(O(L({},i),{val:z(l.val)}))}e.length>0?n("save",{conditions:e,conditionType:f.value}):P.warning("没有有效的条件值，不可保存！")}function y(){let e=[];for(let l of s.value)if(b(l)){let i=$(l,"field","rule","type","timestamp");e.push(O(L({},i),{val:z(l.val)}))}e.length>0&&n("copy",{conditions:e,conditionType:f.value})}function c(e){let l=s.value;l.splice(e,1),s.value=l,l.length==0&&(n("search",{conditions:[],conditionType:f.value}),n("update:clear",!1))}function b(e){return e.val==="0"||e.val===0||e.val?!0:e.rule==="empty"||e.rule==="not_empty"}const X=H(()=>{if(t.saveButton===!1)return!1;let e=s.value;return!(!e||e.length==0)}),Y=H(()=>{let e=s.value;if(!e||e.length==0)return!1;let l=!1;for(let i=0;i<e.length;i++)if(b(e[i]))l=!0;else{l=!1;break}return l});U(()=>t.clear,e=>{e===!0&&(s.value=[],C.value=!0)},{immediate:!0}),U(()=>t.info,e=>{let l=e.emitChange},{deep:!0});function ee(e,l,i){i.val=l}function te(e){const l=M(e.field);let i=e.type,h=u(i,l.multiple);return!h||h.length==0?[]:h}function le(){let e=[];for(let l of s.value){let i=$(l,"field","rule","type","timestamp");e.push(O(L({},i),{val:z(l.val)}))}e.length>0&&n("search",{conditions:e,conditionType:f.value})}const Q=Se(le,800);U(s.value,()=>{Q()},{deep:!0});function oe(){Q()}function ne(e){e.reloading=!0,ce(()=>{e.reloading=!1})}return{conditionList:s,getOptions:te,conditionRelation:f,systemFields:J,showPop:C,filterValue:w,onSelectField:q,isFilterItem:I,saveCondition:o,copyCondition:y,onRemove:c,showSave:X,getSchema:E,saveable:Y,setFormModel:ee,filterColumnList:T,onRelationChange:oe,onConditionRuleChange:ne}}});const Re={class:"config-detail",style:{"padding-top":"0"}},Te={class:"condition-item",style:{"margin-top":"12px",padding:"0 16px"}},Ve={style:{display:"flex"}},De={style:{width:"50px"}},$e={key:0,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0px 0px 6px"}},Ee={key:1,class:"condition-rela"},Me={key:2,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0px 0px 7px"}},Pe={style:{display:"flex",flex:"1","flex-direction":"column"}},qe={style:{"margin-bottom":"2px",display:"flex"}},Ie={style:{flex:"1"}},Ne={style:{"margin-right":"10px","max-width":"100px","font-weight":"bold"}},Ue={class:"condition-select",style:{width:"100px"}},ze={class:"icon-remove",style:{width:"60px","text-align":"right","margin-right":"0"}},Ae={style:{width:"100%","margin-top":"0"},class:"condition-val"},We={class:"field-list"},je=["onClick"],Qe=r("div",{class:"split"},null,-1),Ze=["onClick"],Ge={style:{width:"100%","text-align":"right",position:"relative"}};function He(t,n,u,W,j,T){const k=v("a-select-option"),C=v("a-select"),f=v("component-icon"),s=v("close-outlined"),E=v("online-super-query-val-component"),M=v("search-outlined"),P=v("a-input"),q=v("PlusOutlined"),w=v("a-button"),I=v("a-popover");return a(),p("div",Re,[(a(!0),p(F,null,V(t.conditionList,(o,y)=>(a(),p("div",Te,[r("div",Ve,[r("div",De,[y===0?(a(),p("span",$e,"当")):y===1?(a(),p("div",Ee,[d(C,{style:{width:"50px"},size:"small",value:t.conditionRelation,"onUpdate:value":n[0]||(n[0]=c=>t.conditionRelation=c),onChange:t.onRelationChange},{default:m(()=>[d(k,{value:"and"},{default:m(()=>[g("且")]),_:1}),d(k,{value:"or"},{default:m(()=>[g("或")]),_:1})]),_:1},8,["value","onChange"])])):(a(),p("span",Me,R(t.conditionRelation=="and"?"且":"或"),1))]),r("div",Pe,[r("div",qe,[r("div",Ie,[d(f,{type:o.type,style:{color:"rgb(158, 158, 158)"}},null,8,["type"]),r("span",Ne,R(o.name),1),r("span",Ue,[d(C,{style:{"min-width":"70px"},size:"small",value:o.rule,"onUpdate:value":c=>o.rule=c,dropdownStyle:{minWidth:"120px"},onChange:c=>t.onConditionRuleChange(o,y)},{default:m(()=>[(a(!0),p(F,null,V(t.getOptions(o),c=>(a(),A(k,{value:c.value},{default:m(()=>[g(R(c.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value","onChange"])])]),r("div",ze,[d(s,{title:"移除条件",onClick:me(c=>t.onRemove(y),["prevent"])},null,8,["onClick"])])]),r("div",Ae,[o.reloading?D("",!0):(a(),A(E,{key:0,style:{width:"100%"},schema:t.getSchema(o,y),formModel:o,setFormModel:(c,b)=>{t.setFormModel(c,b,o)}},null,8,["schema","formModel","setFormModel"]))])])])]))),256)),d(I,{overlayClassName:"view-pop-field-select",open:t.showPop,"onUpdate:open":n[2]||(n[2]=o=>t.showPop=o),trigger:"click"},{content:m(()=>[r("div",We,[(a(!0),p(F,null,V(t.filterColumnList,o=>(a(),p(F,null,[t.isFilterItem(o)?(a(),p("div",{key:0,class:"field-item",onClick:y=>t.onSelectField(o)},[r("div",null,[d(f,{type:o.type},null,8,["type"]),g(" "+R(o.name),1)])],8,je)):D("",!0)],64))),256)),Qe,(a(!0),p(F,null,V(t.systemFields,o=>(a(),p(F,null,[t.isFilterItem(o)?(a(),p("div",{key:0,class:"field-item",onClick:y=>t.onSelectField(o)},[r("div",null,[d(f,{type:o.type},null,8,["type"]),g(R(o.name),1)])],8,Ze)):D("",!0)],64))),256))])]),title:m(()=>[d(P,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":n[1]||(n[1]=o=>t.filterValue=o)},{prefix:m(()=>[d(M,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:m(()=>[d(w,{class:"add-button add-filter",style:{"margin-top":"20px"},type:"text"},{default:m(()=>[d(q),g(" 添加筛选条件 ")]),_:1})]),_:1},8,["open"]),r("div",Ge,[t.showSave?(a(),A(w,{key:0,class:"save-button",onClick:t.saveCondition,style:{right:"14px"}},{default:m(()=>[g("保存")]),_:1},8,["onClick"])):D("",!0),fe(t.$slots,"save-button",ve(ye({saveable:t.saveable})))])])}const Gt=Le(xe,[["render",He]]);export{Gt as default};
