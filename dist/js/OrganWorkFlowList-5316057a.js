var w=(e,s,g)=>new Promise((S,_)=>{var y=n=>{try{f(g.next(n))}catch(p){_(p)}},v=n=>{try{f(g.throw(n))}catch(p){_(p)}},f=n=>n.done?S(n.value):Promise.resolve(n.value).then(y,v);f((g=g.apply(e,s)).next())});import{d as Z,f as c,c as ee,r as te,u as N,a3 as oe,a4 as ae,a5 as a,V as r,a6 as m,a7 as R,k as i,ai as d,ak as B,E as x,F as se,am as ne,af as F,W as M}from"./vue-vendor-24c7dc61.js";import"./index-621e597c.js";import{u as le}from"./useListPage-62a041ef.js";import{w as ie,f as re}from"./organization.data-23f4609c.js";import{e as pe,a5 as ce,a as ue,ap as me,k as de,l as fe}from"./index-831af9dd.js";import{J as he}from"./JDictSelectTag-54dc3bdb.js";import{U as we}from"./UserAvatar-1a3df675.js";import{l as ge}from"./Workflow.data-a3a9f000.js";import{o as _e,c as ye}from"./Workflow.api-9dbd14ca.js";import"./index-1c3affea.js";import{A as ve,B as Ce}from"./organization.api-98a6e46c.js";import ke from"./BasicTable-d435f501.js";import"./componentMap-c857637c.js";import"./antd-vue-vendor-0d72f01e.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./renderUtils-7ad8f436.js";import"./index-b845562c.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";const Fe=Z({name:"OrganWorkFlowList",components:{JDictSelectTag:he,BasicTable:ke,UserAvatar:we},emits:["register","flow-total"],setup(e,{emit:s}){const{prefixCls:g,tableContext:S}=le({designScope:"low-app-work-flow",tableProps:{api:Ce,bordered:!1,columns:ie,canResize:!1,useSearchForm:!1,showTableSetting:!1,scroll:{y:600},actionColumn:{width:120,fixed:"right"},beforeFetch:t=>Object.assign(t,{tenantId:V.id,lowAppId:N(A),openStatus:N(T),processName:N(I),startType:N(o)}),afterFetch:t=>{setTimeout(()=>{let u=v();s("flow-total",u.total||0)},0)}}}),[_,{reload:y,getPaginationRef:v},{rowSelection:f,selectedRowKeys:n,selectedRows:p}]=S,b=c([]),U=c([{label:"全部状态",value:""},{label:"开启",value:"1"},{label:"关闭",value:"0"}]),O=re,T=c(""),A=c(""),I=c(""),o=c(""),V=ee("myTenantInfo",te({})),[l,{openModal:h}]=pe(),{createMessage:L}=ue(),C=c(!1),W=c("ant-design:table-outlined"),H=c(0);function $(t){return me(t)}function P(t,u){return w(this,null,function*(){if(yield D(t),C.value){let k=t.processKey;u=="1"?yield _e(k):yield ye(k)}else t.openStatus=t.openStatus==0?1:0})}function j(t){return w(this,null,function*(){yield D(t),C.value&&h(!0,{isUpdate:!0,id:t.id,startType:t.startType,toHistory:1})})}function K(){y()}function z(t){return w(this,null,function*(){yield D(t),C.value&&h(!0,{isUpdate:!0,id:t.id,startType:t.startType})})}J();function J(){return w(this,null,function*(){b.value=yield ce("low_app,app_name,id,del_flag = 0")})}function q({startType:t}){let u=ge.filter(k=>k.startType==t);return u.length>0?u[0].icon:W.value}function G(){y()}function D(t){return w(this,null,function*(){const u="/online/lowAppAuth/hasAdminAuth";let X={appId:t.lowAppId};const Y=yield de.get({url:u,params:X},{isTransformResponse:!1});C.value=Y.success,C.value||L.warning("您没有操作该流程的权限，请联系管理员！")})}Q();function Q(){return w(this,null,function*(){let t=yield ve();H.value=t})}return{registerTable:_,getImageSrc:$,statusSwitchClick:P,historyFlowClick:j,searchFlowOption:U,searchStatusValue:T,searchNameValue:I,allFlowOption:b,searchAllFlowValue:A,allTypeFlowOption:O,searchAllTypeValue:o,allHandleChange:K,toWorkFlowClick:z,getFlowIcon:q,registerMiniDesFlowModal:l,onSuccess:G,executeNumber:H}}});const E=e=>(oe("data-v-7ca72d2b"),e=e(),ae(),e),Se=E(()=>a("span",{style:{color:"#9e9e9e"}},"本月流程执行次数",-1)),be={style:{margin:"0 10px 0 5px",color:"rgb(51, 51, 51)"}},Te={class:"work-flow-search flex-flow"},Ae={style:{width:"180px"}},Ie={style:{width:"180px","margin-left":"10px"}},Ve={style:{width:"180px","margin-left":"10px"}},Ne=E(()=>a("div",{style:{flex:"1"}},null,-1)),Be={class:"search-name"},Ue=["onClick"],Oe={class:"icon-name"},De={class:"flow-name ellipsis"},Re={class:"flow-desc ellipsis"},Me={style:{display:"flex","justify-content":"center",width:"100%"}};function He(e,s,g,S,_,y){const v=r("a-alert"),f=r("a-select-option"),n=r("a-select"),p=r("Icon"),b=r("a-input"),U=r("a-switch"),O=r("UserAvatar"),T=r("a-tooltip"),A=r("BasicTable"),I=r("mini-des-flow-modal");return m(),R("div",null,[a("div",null,[i(v,{type:"info","show-icon":"",class:"alert",style:{margin:"10px 6px 0"}},{message:d(()=>[Se,a("span",be,B(e.executeNumber),1)]),_:1})]),a("div",Te,[a("div",Ae,[i(n,{style:{width:"100%"},value:e.searchAllFlowValue,"onUpdate:value":s[0]||(s[0]=o=>e.searchAllFlowValue=o),onChange:e.allHandleChange},{default:d(()=>[i(f,{value:""},{default:d(()=>[x("全部应用")]),_:1}),(m(!0),R(se,null,ne(e.allFlowOption,o=>(m(),F(f,{value:o.value},{default:d(()=>[x(B(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"])]),a("div",Ie,[i(n,{style:{width:"100%"},options:e.searchFlowOption,value:e.searchStatusValue,"onUpdate:value":s[1]||(s[1]=o=>e.searchStatusValue=o),onChange:e.allHandleChange},null,8,["options","value","onChange"])]),a("div",Ve,[i(n,{style:{width:"100%"},options:e.allTypeFlowOption,value:e.searchAllTypeValue,"onUpdate:value":s[2]||(s[2]=o=>e.searchAllTypeValue=o),onChange:e.allHandleChange},null,8,["options","value","onChange"])]),Ne,a("div",Be,[i(b,{value:e.searchNameValue,"onUpdate:value":s[3]||(s[3]=o=>e.searchNameValue=o),placeholder:"流程名称",allowClear:"",onChange:e.allHandleChange},{prefix:d(()=>[i(p,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value","onChange"])])]),i(A,{onRegister:e.registerTable},{bodyCell:d(({column:o,text:V,record:l})=>[o.dataIndex==="processName"?(m(),R("div",{key:0,class:"pointer work-flow-name",onClick:h=>e.toWorkFlowClick(l)},[a("div",Oe,[l.openStatus==0?(m(),F(p,{key:0,icon:e.getFlowIcon(l),class:"flow-item-icon item-close-icon"},null,8,["icon"])):(m(),F(p,{key:1,icon:e.getFlowIcon(l),class:"flow-item-icon item-open-icon"},null,8,["icon"]))]),a("div",De,B(V),1),a("span",Re,B(l.formTableTxt),1)],8,Ue)):M("",!0),o.dataIndex==="openStatus"?(m(),F(U,{key:1,checked:l.openStatus,"onUpdate:checked":h=>l.openStatus=h,checkedValue:1,checkedChildren:"开启",unCheckedValue:0,unCheckedChildren:"关闭",onClick:h=>e.statusSwitchClick(l,h)},null,8,["checked","onUpdate:checked","onClick"])):M("",!0),o.dataIndex==="createBy"?(m(),F(O,{key:2,username:l.createBy},null,8,["username"])):M("",!0)]),action:d(({record:o})=>[a("div",Me,[i(T,{title:"历史"},{default:d(()=>[i(p,{class:"operation-color pointer",style:{"font-size":"24px"},icon:"ant-design:field-time-outlined",onClick:V=>e.historyFlowClick(o)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["onRegister"]),i(I,{onRegister:e.registerMiniDesFlowModal,onSuccess:e.onSuccess},null,8,["onRegister","onSuccess"])])}const xt=fe(Fe,[["render",He],["__scopeId","data-v-7ca72d2b"]]);export{xt as default};
