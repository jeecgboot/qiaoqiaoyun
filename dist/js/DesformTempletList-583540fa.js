var R=(o,f,a)=>new Promise((g,d)=>{var _=t=>{try{m(a.next(t))}catch(r){d(r)}},s=t=>{try{m(a.throw(t))}catch(r){d(r)}},m=t=>t.done?g(t.value):Promise.resolve(t.value).then(_,s);m((a=a.apply(o,f)).next())});import"./index-621e597c.js";import{d as N,a5 as B,V as n,a6 as A,a7 as $,a8 as K,k as i,ai as p,E as O,af as P,W as U}from"./vue-vendor-24c7dc61.js";import"./index-1c3affea.js";import{u as q}from"./useListPage-62a041ef.js";import{t as y}from"./desform.data-92c54dbe.js";import{t as k}from"./desform.api-4c557ed3.js";import z from"./DesformTempletModal-b4a50f54.js";import W from"./FormDesignerIframeModal-44ee0d5b.js";import j from"./BasicTable-d435f501.js";import{T as G}from"./componentMap-c857637c.js";import{e as S,l as H}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./useMethods-f689b480.js";import"./user.api-ffaaa05b.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./useFormItem-86503382.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./JPopup-2a779923.js";import"./EasyCronInput-b2123242.js";import"./JCheckbox-0b89d32a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./JImageUpload-d644253a.js";import"./DesignerButtonDrawer-04cdfd92.js";import"./ZdyanDrawer-58ee121b.js";import"./ButtonColorSelector-58fbd93b.js";import"./ButtonConditions-9a9a88d5.js";import"./type.definition-4eb605ee.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./useCustomButton-fa741dda.js";import"./FilterFiledListNew-bbda127c.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./ButtonConfirmText-527dd2f0.js";import"./FilterFiledList-8a929f88.js";import"./ButtonFormConfig-7880f3ed.js";import"./FormFieldSelect-9cf3f019.js";const J=N({name:"DesformTempletList",components:{BasicTable:j,TableAction:G,DesformTempletModal:z,FormDesignerIframeModal:W},setup(){const o=q({tableProps:{api:k.list,columns:y.columns,formConfig:{schemas:y.searchFormSchemas},actionColumn:{width:200}}}),{prefixCls:f,tableContext:a,doRequest:g,doDeleteRecord:d}=o,[_,{reload:s,getDataSource:m},{rowSelection:t,selectedRowKeys:r}]=a,[M,D]=S(),[b,h]=S();function T(){s()}function C(){D.openModal(!0,{isUpdate:!1})}function v(e,u="default"){D.openModal(!0,{isUpdate:!0,record:e,action:u})}function F(e){return R(this,null,function*(){e.children?o.createErrorModal({content:"请删除完所有的子视图以后再删除主视图！"}):d(()=>k.delete(e.id))})}function E(e){h.openModal(!0,{record:e})}function I(){const e=(c,w)=>{for(let l of w){if(l.id===c)return l;if(l.children)return e(c,l.children)}};let u=[];r.value.forEach((c,w)=>{let l=e(c,m());l&&l.children&&u.push(w)}),u.reverse();for(let c of u)r.value.splice(c,1);r.value.length===0?o.createErrorModal({content:"请删除完所有的子视图以后再删除主视图！"}):g(()=>k.batchDelete(r.value))}function V(e){return[{label:"编辑",onClick:()=>v(e)},{label:"设计模板",icon:"ant-design:setting",onClick:()=>E(e)}]}function L(e){return[{label:"删除",popConfirm:{title:"确定要删除吗？",placement:"left",confirm:()=>F(e)}}]}return{prefixCls:f,rowSelection:t,selectedRowKeys:r,reload:s,onModalOk:T,onAddRecord:C,onDeleteBatch:I,getTableAction:V,getDropDownAction:L,registerTable:_,registerDesformModal:M,registerFormDesignerIframeModal:b}}}),Q=B("span",null,"删除",-1),X=B("span",null,"批量操作",-1);function Y(o,f,a,g,d,_){const s=n("a-button"),m=n("a-icon"),t=n("a-menu-item"),r=n("a-menu"),M=n("a-dropdown"),D=n("TableAction"),b=n("BasicTable"),h=n("DesformTempletModal"),T=n("FormDesignerIframeModal");return A(),$("div",{class:K(o.prefixCls)},[i(b,{onRegister:o.registerTable,rowSelection:o.rowSelection},{tableTitle:p(()=>[i(s,{onClick:o.onAddRecord,type:"primary",preIcon:"ant-design:plus"},{default:p(()=>[O("新增")]),_:1},8,["onClick"]),o.selectedRowKeys.length>0?(A(),P(M,{key:0},{overlay:p(()=>[i(r,null,{default:p(()=>[i(t,{key:"1",onClick:o.onDeleteBatch},{default:p(()=>[i(m,{type:"delete"}),Q]),_:1},8,["onClick"])]),_:1})]),default:p(()=>[i(s,null,{default:p(()=>[X,i(m,{type:"down"})]),_:1})]),_:1})):U("",!0)]),action:p(({record:C})=>[i(D,{actions:o.getTableAction(C),dropDownActions:o.getDropDownAction(C)},null,8,["actions","dropDownActions"])]),_:1},8,["onRegister","rowSelection"]),i(h,{onRegister:o.registerDesformModal,onSuccess:o.onModalOk},null,8,["onRegister","onSuccess"]),i(T,{templet:"",isLowApp:!1,onRegister:o.registerFormDesignerIframeModal,onSuccess:o.reload},null,8,["onRegister","onSuccess"])],2)}const Re=H(J,[["render",Y]]);export{Re as default};
