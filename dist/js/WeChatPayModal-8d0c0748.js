var I=(e,r,d)=>new Promise((h,u)=>{var i=c=>{try{o(d.next(c))}catch(p){u(p)}},n=c=>{try{o(d.throw(c))}catch(p){u(p)}},o=c=>c.done?h(c.value):Promise.resolve(c.value).then(i,n);o((d=d.apply(e,r)).next())});import{B as F}from"./index-1c3affea.js";import{d as b,a2 as W,f as B,o as U,b as q,u as P,a3 as T,a4 as V,a5 as t,E as m,V as f,a6 as A,af as N,ai as a,k as s,ak as g}from"./vue-vendor-24c7dc61.js";import{a7 as Q,d as $,j as R,a as j,b as z,bB as G,c as O,l as X}from"./index-831af9dd.js";import{Q as Y}from"./Qrcode-8252d989.js";import{a as M,c as H,o as J}from"./useWebSocket-df578a5f.js";import"./BasicModal-58413bab.js";import"./antd-vue-vendor-0d72f01e.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./download-1ac6acce.js";const K="/assets/wechat-code-affd1e03.png",L=b({name:"WeiXinPayModal",components:{BasicModal:F,Qrcode:Y},setup(e,{emit:r}){const d=W(),h=B("微信支付"),u=B({}),i=B(),n=Q(),o=$(),[c,{setModalProps:p,closeModal:v}]=R(l=>I(this,null,function*(){u.value=l,i.value=l.qrCode,u.value.payStatus="已下单"})),{createMessage:_}=j();function C(){var D;let l=z(),E=G(l),k=P(n.getUserInfo).id+"_"+E,w=((D=o.domainUrl)==null?void 0:D.replace("https://","wss://").replace("http://","ws://"))+"/websocket/"+k;H(w),J(y)}function y(l){l.cmd==="paySuccess"?(u.value.payStatus="支付成功!",_.success("支付成功,3s后自动跳转到租户页面"),M(y),setTimeout(()=>{d.push("/myapps/settings/organization/"+O())},3e3)):l.cmd==="payFail"?(u.value.payStatus="支付失败!",_.warning("支付失败!")):l.cmd==="hasBeenProcessed"&&(u.value.payStatus="此订单已被处理过了，请勿重新发起支付!",_.warning("此订单已被处理过了，请勿重新发起支付!"))}return U(()=>{C()}),q(()=>{M(y)}),{title:h,registerModal:c,payData:u,qrCodeImgUrl:i,WechatCode:K}}});const S=e=>(T("data-v-c28cfd3f"),e=e(),V(),e),Z=S(()=>t("span",{class:"title"},[m("购买内容："),t("span",{class:"title-desc"},"敲敲云VIP")],-1)),x={class:"title"},ss={class:"title-desc"},es={class:"title"},as={class:"title-desc"},ts={class:"title"},os={class:"title-desc color-red"},ns={class:"title"},cs={class:"title-desc color-red"},us={class:"qrcode-prompt"},ls=S(()=>t("span",{class:"scan"},"请使用微信扫一扫",-1)),ds=S(()=>t("span",{class:"qrcode-pay"},"扫描二维码支付",-1)),ps=["src"];function rs(e,r,d,h,u,i){const n=f("a-col"),o=f("a-row"),c=f("Qrcode"),p=f("Icon"),v=f("BasicModal");return A(),N(v,{onRegister:e.registerModal,width:800,title:e.title,showOkBtn:!1,cancelText:"关闭"},{default:a(()=>[s(o,{span:24},{default:a(()=>[s(n,{span:13},{default:a(()=>[s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[Z]),_:1})]),_:1}),s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[t("span",x,[m("订单号: "),t("span",ss,g(e.payData.payNo),1)])]),_:1})]),_:1}),s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[t("span",es,[m("购买年限: "),t("span",as,g(e.payData.buyYears+"年"),1)])]),_:1})]),_:1}),s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[t("span",ts,[m("总金额: "),t("span",os,g(e.payData.totalAmount+"元"),1)])]),_:1})]),_:1}),s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[t("span",ns,[m("支付状态: "),t("span",cs,g(e.payData.payStatus),1)])]),_:1})]),_:1}),s(o,{span:24},{default:a(()=>[s(n,{span:24},{default:a(()=>[s(c,{value:e.qrCodeImgUrl,"onUpdate:value":r[0]||(r[0]=_=>e.qrCodeImgUrl=_),class:"qr-code-img"},null,8,["value"]),t("div",us,[s(p,{icon:"ant-design:scan-outlined",class:"prompt-icon"}),ls,ds])]),_:1})]),_:1})]),_:1}),s(n,{span:11},{default:a(()=>[t("img",{src:e.WechatCode,style:{height:"445px"}},null,8,ps)]),_:1})]),_:1})]),_:1},8,["onRegister","title"])}const Is=X(L,[["render",rs],["__scopeId","data-v-c28cfd3f"]]);export{Is as default};
