var go=Object.defineProperty,Co=Object.defineProperties;var _o=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ho=Object.prototype.hasOwnProperty,Fo=Object.prototype.propertyIsEnumerable;var V=(n,t,r)=>t in n?go(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,I=(n,t)=>{for(var r in t||(t={}))ho.call(t,r)&&V(n,r,t[r]);if(j)for(var r of j(t))Fo.call(t,r)&&V(n,r,t[r]);return n},W=(n,t)=>Co(n,_o(t));var T=(n,t,r)=>new Promise((e,w)=>{var x=c=>{try{F(r.next(c))}catch(g){w(g)}},b=c=>{try{F(r.throw(c))}catch(g){w(g)}},F=c=>c.done?e(c.value):Promise.resolve(c.value).then(x,b);F((r=r.apply(n,t)).next())});import{f as v,r as U,e as q,H as yo,I as E,a5 as a,V as f,a6 as A,a7 as N,F as H,k as u,ai as d,E as h,ak as R,af as bo,W as Z}from"./vue-vendor-24c7dc61.js";import{a8 as ko,R as wo,e as So,l as Bo}from"./index-831af9dd.js";import To from"./ButtonColorSelector-58fbd93b.js";import Eo from"./ButtonConditions-9a9a88d5.js";import Ao from"./ButtonConfirmText-527dd2f0.js";import xo from"./ButtonFormConfig-7880f3ed.js";import{u as Do}from"./useCustomButton-fa741dda.js";import"./index-1c3affea.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./type.definition-4eb605ee.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./FilterFiledListNew-bbda127c.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";import"./FilterFiledList-8a929f88.js";import"./FormFieldSelect-9cf3f019.js";const Io={name:"ZdyanDrawer",props:{columnList:{type:Array,default:()=>[]},code:{type:String,require:!1,default:""},viewId:{type:String,require:!1,default:""},allColumns:{type:Array,default:()=>[]},designFormName:{type:String,require:!1,default:""},mask:{type:Boolean,default:!1},titleField:{type:String,require:!1,default:""},contentWrapperStyle:{type:Object,default:()=>({top:"100px"})}},components:{IconPicker:ko,ButtonColorSelector:To,ButtonConditions:Eo,ButtonConfirmText:Ao,ButtonFormConfig:xo,Icon:wo},emits:["register","success"],setup(n,{emit:t}){const{saveButton:r,updateButton:e,checkOnlyButtonLabel:w,getProcessInfo:x}=Do(n),[b,{openModal:F}]=So(),c=v(),g=v(""),l=U({label:"",showStatus:"",clickThen:"",flowStatus:!1,icon:"",color:"",note:"",processId:"",id:""}),k=v("and"),C=v([]),_=v([]),p=U({tip:"",ok:"",cancel:""}),m=U({formTable:"",linkRecordField:"",linkRecordTable:"",formType:"",createFormField:"",createFormCode:"",updateFieldList:[]}),y=v(!1),S=v(!1),B=v(!1),s=v(!1),D=v("");function z(o){return T(this,null,function*(){y.value=!0,g.value=o.title;const i=o.button;K(),Object.keys(i).map(O=>{l[O]=i[O]}),S.value=o.isUpdate,C.value=i.conditionList,_.value=i.conditionsGroup,k.value=i.conditionType,i.confirmText&&(p.tip=i.confirmText.tip,p.ok=i.confirmText.ok,p.cancel=i.confirmText.cancel),i.buttonFormConfig&&(m.formTable=i.buttonFormConfig.formTable,m.linkRecordField=i.buttonFormConfig.linkRecordField,m.linkRecordTable=i.buttonFormConfig.linkRecordTable,m.formType=i.buttonFormConfig.formType,m.createFormField=i.buttonFormConfig.createFormField,m.createFormCode=i.buttonFormConfig.createFormCode,m.updateFieldList=i.buttonFormConfig.updateFieldList),yield L()})}function J(){return D.value?D.value:l.processId?l.label:""}function K(){Object.keys(l).map(o=>{l[o]=""}),C.value=[],_.value=[],p.tip="你确认对记录执行此操作吗？",p.ok="确认",p.cancel="取消",Object.keys(m).map(o=>{o==="updateFieldList"?m[o]=[]:m[o]=""})}function Q(){}function X(){}function Y(){l.clickThen==="form"?l.flowStatus=!1:l.flowStatus=!0}function $(){}function oo(){}function eo(){}function to(){}const no=q(()=>l.flowStatus===!0||l.clickThen==="execute"||l.clickThen==="confirm"),P=v();function io(){return T(this,null,function*(){try{yield P.value.validateFields()}catch(i){return}let o=I({},E(l));if(o.showStatus==="condition"&&(o.conditionList=E(C.value),o.conditionsGroup=E(_.value),o.conditionType=E(k.value)),o.clickThen==="confirm")o.confirmText=I({},E(p));else if(o.clickThen==="form"){let i=c.value.getData();i&&(o.buttonFormConfig=i)}if((o.buttonFormConfig==null||o.buttonFormConfig==="")&&delete o.buttonFormConfig,Array.isArray(o.conditionList)||delete o.conditionList,Array.isArray(o.conditionsGroup)||delete o.conditionsGroup,(o.confirmText==null||o.confirmText==="")&&delete o.confirmText,S.value===!0)yield e(o);else{const i=yield r(o);lo(i)}y.value=!1,setTimeout(()=>{t("success")},500)})}function lo(o){if(o.success&&l.flowStatus===!0){let i=o.result.processId;F(!0,{customProcessId:i,processName:l.label,isUpdate:!1,startType:"buttonEvent",formName:n.designFormName,formCode:n.code,titleField:n.titleField})}}function ao(o){o.preventDefault(),o.stopPropagation();let i={};B.value===!0?i={id:l.processId,isUpdate:!0}:i={customProcessId:l.processId,processName:l.label,isUpdate:!1,startType:"buttonEvent",formName:n.designFormName,formCode:n.code,titleField:n.titleField},F(!0,i)}function L(){return T(this,null,function*(){if(B.value=!1,s.value=!1,D.value="",l.processId){const o=yield x(l.processId);o&&o.id&&(B.value=!0,D.value=o.processName,o.openStatus==1&&(s.value=!0))}})}function so(){y.value=!1}const ro={bottom:"100px",zIndex:9999},G=window.innerHeight-200,uo={height:G+"px",maxHeight:G+"px",padding:"0 0 20px"},co=q(()=>!l.label);function M(){return _.value&&_.value.length==0&&C.value&&C.value.length==0}function mo(){M()&&(l.showStatus="always")}function fo(o){C.value=o.conditions,_.value=o.conditionsGroup,k.value=o.conditionType,M()&&(l.showStatus="always")}function po(o){Object.keys(p).map(i=>{p[i]=o[i]})}const vo=[{validator:(o,i)=>T(this,null,function*(){return i===""?Promise.reject("请输入按钮名称！"):(yield w(l.id,l.label))===!1?Promise.reject("按钮名称重名，请重新定义！"):Promise.resolve()}),trigger:"change"}];return W(I({title:g,myButton:l},yo(l)),{bodyStyle:uo,showFlowTip:no,onChangeLabel:Q,onChangeShowStatus:X,onChangeClickThen:Y,onChangeFlowStatus:$,onChangeIcon:oo,onChangeColor:to,onChangeNote:eo,onSubmit:io,onClose:so,footerStyle:ro,visible:y,show:z,disabledSumbit:co,conditionType:k,conditions:C,conditionsGroup:_,onSelectBack:mo,onSelectOk:fo,confirmText:p,updateConfirmText:po,buttonFormConfigRef:c,isUpdate:S,formRef:P,labelValidate:vo,buttonFormConfig:m,registerFlowModal:b,getProcessName:J,processOpenStatus:s,editFlow:ao,reloadProcessInfo:L})}};const No={class:"button-config",style:{padding:"0px 24px"}},Oo={class:"item"},Uo=a("h5",null,"按钮名称",-1),Ro={class:"content"},Po={class:"item"},Lo=a("h5",null,"启用按钮",-1),Go={class:"content"},Mo={class:"item"},jo=a("h5",null,"点击后",-1),Vo={class:"content"},Wo={class:"item"},qo=a("h5",null,"执行工作流",-1),Ho={class:"content"},Zo={key:1,class:"tip"},zo={style:{"font-size":"13px","line-height":"20px",color:"#757575 !important",display:"flex",width:"100%"}},Jo={style:{flex:"1","margin-left":"3px",color:"#f44336"}},Ko={key:1,style:{flex:"1"}},Qo={class:"item"},Xo=a("h5",null,"按钮颜色",-1),Yo={class:"content"},$o={class:"item"},oe=a("h5",null,"按钮图标",-1),ee={class:"content"},te={class:"item"},ne=a("h5",null,"按钮说明",-1),ie={class:"content"};function le(n,t,r,e,w,x){const b=f("a-input"),F=f("a-form-item"),c=f("a-radio"),g=f("a-radio-group"),l=f("ButtonConditions"),k=f("button-confirm-text"),C=f("button-form-config"),_=f("button-color-selector"),p=f("IconPicker"),m=f("a-form"),y=f("a-button"),S=f("a-drawer"),B=f("MiniDesFlowModal");return A(),N(H,null,[u(S,{open:e.visible,"onUpdate:open":t[10]||(t[10]=s=>e.visible=s),push:!1,mask:r.mask,title:e.title,width:640,bodyStyle:e.bodyStyle,class:"designer-form-button-drawer",contentWrapperStyle:r.contentWrapperStyle,"footer-style":{textAlign:"left"},"header-style":{padding:"14px 20px"},destroyOnClose:"",maskClosable:!1},{footer:d(()=>[u(y,{style:{"margin-left":"10px"},type:"primary",disabled:e.disabledSumbit,onClick:e.onSubmit},{default:d(()=>[h(R(e.isUpdate?"保存":"添加按钮"),1)]),_:1},8,["disabled","onClick"]),u(y,{style:{"margin-left":"18px"},onClick:e.onClose},{default:d(()=>[h("取消")]),_:1},8,["onClick"])]),default:d(()=>[a("div",No,[u(m,{ref:"formRef",model:e.myButton},{default:d(()=>[a("div",Oo,[Uo,a("div",Ro,[u(F,{label:"",name:"label",style:{"margin-bottom":"0"},rules:e.labelValidate},{default:d(()=>[u(b,{value:e.myButton.label,"onUpdate:value":t[0]||(t[0]=s=>e.myButton.label=s),placeholder:"例如：添加线索，关闭机会",onChange:e.onChangeLabel},null,8,["value","onChange"])]),_:1},8,["rules"])])]),a("div",Po,[Lo,a("div",Go,[u(g,{value:n.showStatus,"onUpdate:value":t[1]||(t[1]=s=>n.showStatus=s),onChange:e.onChangeShowStatus},{default:d(()=>[u(c,{value:"always"},{default:d(()=>[h("一直")]),_:1}),u(c,{value:"condition"},{default:d(()=>[h("满足筛选条件")]),_:1})]),_:1},8,["value","onChange"]),u(l,{visible:n.showStatus=="condition",code:r.code,allColumns:r.allColumns,type:e.conditionType,conditions:e.conditions,"onUpdate:conditions":t[2]||(t[2]=s=>e.conditions=s),conditionsGroup:e.conditionsGroup,"onUpdate:conditionsGroup":t[3]||(t[3]=s=>e.conditionsGroup=s),onOk:e.onSelectOk,onBack:e.onSelectBack},null,8,["visible","code","allColumns","type","conditions","conditionsGroup","onOk","onBack"])])]),a("div",Mo,[jo,a("div",Vo,[u(g,{value:n.clickThen,"onUpdate:value":t[4]||(t[4]=s=>n.clickThen=s),onChange:e.onChangeClickThen},{default:d(()=>[u(c,{value:"execute"},{default:d(()=>[h("立即执行")]),_:1}),u(c,{value:"confirm"},{default:d(()=>[h("需要二次确认")]),_:1}),u(c,{value:"form"},{default:d(()=>[h("填写指定内容")]),_:1})]),_:1},8,["value","onChange"]),u(k,{visible:n.clickThen=="confirm",info:e.confirmText,onOk:e.updateConfirmText},null,8,["visible","info","onOk"]),u(C,{visible:n.clickThen=="form",info:e.buttonFormConfig,ref:"buttonFormConfigRef"},null,8,["visible","info"])])]),a("div",Wo,[qo,a("div",Ho,[n.clickThen=="form"?(A(),bo(g,{key:0,value:n.flowStatus,"onUpdate:value":t[5]||(t[5]=s=>n.flowStatus=s),onChange:e.onChangeFlowStatus},{default:d(()=>[u(c,{value:!1},{default:d(()=>[h("不执行")]),_:1}),u(c,{value:!0},{default:d(()=>[h("执行工作流")]),_:1})]),_:1},8,["value","onChange"])):Z("",!0),e.showFlowTip?(A(),N("div",Zo,[a("div",zo,[n.processId?(A(),N(H,{key:0},[a("span",null,R(e.getProcessName()),1),a("span",Jo,R(e.processOpenStatus?" ":"未启用"),1),a("span",{style:{color:"#2196f3",cursor:"pointer"},onClick:t[6]||(t[6]=(...s)=>e.editFlow&&e.editFlow(...s))},"编辑工作流")],64)):(A(),N("span",Ko,"添加按钮后自动创建流程"))])])):Z("",!0)])]),a("div",Qo,[Xo,a("div",Yo,[u(_,{value:n.color,"onUpdate:value":t[7]||(t[7]=s=>n.color=s),onChange:e.onChangeColor},null,8,["value","onChange"])])]),a("div",$o,[oe,a("div",ee,[u(p,{value:n.icon,"onUpdate:value":t[8]||(t[8]=s=>n.icon=s),onChange:e.onChangeIcon,clearSelect:""},null,8,["value","onChange"])])]),a("div",te,[ne,a("div",ie,[u(b,{value:n.note,"onUpdate:value":t[9]||(t[9]=s=>n.note=s),placeholder:"请输入按钮说明",onChange:e.onChangeNote},null,8,["value","onChange"])])])]),_:1},8,["model"])])]),_:1},8,["open","mask","title","bodyStyle","contentWrapperStyle"]),u(B,{onRegister:e.registerFlowModal,onSuccess:e.reloadProcessInfo},null,8,["onRegister","onSuccess"])],64)}const ft=Bo(Io,[["render",le]]);export{ft as default};
