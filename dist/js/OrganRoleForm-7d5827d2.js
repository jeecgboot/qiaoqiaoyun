var se=Object.defineProperty;var E=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var V=(e,s,t)=>s in e?se(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,P=(e,s)=>{for(var t in s||(s={}))ae.call(s,t)&&V(e,t,s[t]);if(E)for(var t of E(s))ie.call(s,t)&&V(e,t,s[t]);return e};var f=(e,s,t)=>new Promise((y,g)=>{var _=r=>{try{n(t.next(r))}catch(u){g(u)}},m=r=>{try{n(t.throw(r))}catch(u){g(u)}},n=r=>r.done?y(r.value):Promise.resolve(r.value).then(_,m);n((t=t.apply(e,s)).next())});import{d as le,f as z,c as ne,r as $,w as j,e as re,a3 as de,a4 as ce,a5 as a,V as p,a6 as B,a7 as A,F as q,k as l,ai as c,am as pe,a8 as me,ak as L,z as ue,q as fe,E as K,A as _e}from"./vue-vendor-24c7dc61.js";import{O as ge,l as he,d as ve}from"./OrganRoleAddModal-9ba15c43.js";import"./index-1c3affea.js";import{p as Re,M as ye}from"./antd-vue-vendor-0d72f01e.js";import we from"./BasicTable-d435f501.js";import{u as ke}from"./useListPage-62a041ef.js";import{m as Ce,n as be,o as Se,p as Ie}from"./organization.api-98a6e46c.js";import{b as Me}from"./organization.data-23f4609c.js";import{U as Te}from"./UserSelectModal-d78c1490.js";import{e as X,a as Ue,l as Fe}from"./index-831af9dd.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./pinyin-pro-vendor-c1fd58fc.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./index-621e597c.js";import"./renderUtils-7ad8f436.js";const ze=le({name:"OrganRoleForm",components:{OrganRoleAddModal:ge,BasicTable:we,UserSelectModal:Te},props:{tenantId:{type:Number,default:0}},setup(e){const{createMessage:s}=Ue(),t=z(""),y=ne("myTenantInfo",$);j(y,o=>{o&&(t.value=o.id)},{immediate:!0,deep:!0});const g=z(""),_=z([]),m=re(()=>{let o=g.value,i=_.value;return o?i.filter(h=>h.roleName.indexOf(o)>=0):i}),n=$({id:"",roleName:""}),[r,{openModal:u}]=X();function b(){u(!0,{isUpdate:!1,record:{tenantId:t.value}})}function S(o,i){o.key==="edit"?u(!0,{isUpdate:!0,record:P({},i)}):ye.confirm({title:"确定要删除此角色？",content:"删除后无法恢复",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>f(this,null,function*(){yield w(i.id)})})}function w(o){return f(this,null,function*(){let i={id:o};if(N()){s.warn("已存在用户，无法删除!");return}yield ve(i,I)})}function I(){return f(this,null,function*(){yield F();let o=m.value;o&&o.length>0&&U(o[0])})}const{prefixCls:O,tableContext:M,onExportXls:d,onImportXls:k}=ke({tableProps:{api:Ce,beforeFetch(o){n.id&&(o.roleId=n.id)},columns:Me,canResize:!1,showTableSetting:!1,showActionColumn:!1,useSearchForm:!1,immediate:!1,formConfig:{showActionButtonGroup:!1}},exportConfig:{name:"组织角色导出",url:be}}),[G,{reload:C,getPaginationRef:H},{rowSelection:J,selectedRowKeys:T}]=M;function N(){try{return H().total||""}catch(o){return""}}function U(o){Object.keys(n).map(i=>{n[i]=o[i]}),C()}function D(){(T.value=[])&&C()}j(t,()=>f(this,null,function*(){if(t.value){yield F();let o=_.value;o.length>0&&U(o[0])}}),{immediate:!0});function F(){return f(this,null,function*(){let o={order:"desc",column:"createTime",pageSize:200,tenantId:t.value},v=(yield he(o)).records||[],h=[];for(let oe of v){let te=Re(oe,"id","roleCode","roleName","description","tenantId");h.push(te)}_.value=h})}const[Q,{openModal:W,closeModal:Y}]=X();function Z(o){return f(this,null,function*(){if(o&&o.length>0){let i=o.map(h=>h.id),v={roleId:n.id,userIdList:i};yield Se(v),yield C()}Y()})}function x(){W(!0,{list:[]})}function ee(){return f(this,null,function*(){let o=T.value;if(o&&o.length>0){let i={roleId:n.id,userIds:o.join(",")};yield Ie(i),D()}})}return{searchRoleValue:g,loadRoleList:F,roleList:_,showRoleList:m,activeRole:n,registerModal:r,getPageSize:N,registerTable:G,rowSelection:J,reload:C,selectedRowKeys:T,roleItemClick:U,createRoleClick:b,handleSuccess:D,addUserClick:x,removeUser:ee,onRoleAction:S,onExportXls:d,onImportXls:k,registerUserModal:Q,onSelected:Z}}});const R=e=>(de("data-v-f2f19c50"),e=e(),ce(),e),Be={class:"role-container"},Ae={class:"role-left"},Le=R(()=>a("div",{class:"font-size15 font-blob700 margin-bottom20 padding-left24"}," 组织角色 ",-1)),Oe={class:"search-role"},Ne={class:"role-box"},De=R(()=>a("span",{style:{"margin-left":"10px"}}," 创建角色 ",-1)),Ee={class:"role-list"},Ve={class:"role-pos"},Pe={class:"role-content"},$e=["onClick"],je={class:"role-name word-break ellipsis font-size12"},qe=R(()=>a("span",{class:"role-edit font-size14"},"编辑",-1)),Ke=R(()=>a("span",{class:"role-delete font-size14"},"删除",-1)),Xe={class:"role-right"},Ge={class:"role-header font-size15"},He={class:"font-blob700"},Je={class:"font-color9e margin-left10"},Qe=R(()=>a("div",{style:{height:"0"}},null,-1));function We(e,s,t,y,g,_){const m=p("Icon"),n=p("a-input"),r=p("a-tooltip"),u=p("a-menu-item"),b=p("a-menu"),S=p("a-dropdown"),w=p("a-button"),I=p("BasicTable"),O=p("OrganRoleAddModal"),M=p("user-select-modal");return B(),A(q,null,[a("div",Be,[a("div",Ae,[Le,a("div",Oe,[l(n,{class:"role-input",value:e.searchRoleValue,"onUpdate:value":s[0]||(s[0]=d=>e.searchRoleValue=d),placeholder:"搜索角色",allowClear:""},{prefix:c(()=>[l(m,{style:{color:"#9d9d9d"},icon:"ant-design:search-outlined"})]),_:1},8,["value"])]),a("div",Ne,[a("span",{class:"add-role pointer",onClick:s[1]||(s[1]=(...d)=>e.createRoleClick&&e.createRoleClick(...d))},[l(m,{icon:"ant-design:plus-outlined",style:{position:"relative"}}),De])]),a("div",Ee,[a("div",Ve,[a("div",Pe,[(B(!0),A(q,null,pe(e.showRoleList,d=>(B(),A("div",{class:me(["role-item font-size12",e.activeRole.id==d.id?"active":""]),onClick:k=>e.roleItemClick(d)},[a("span",je,L(d.roleName),1),l(r,{title:d.description},{default:c(()=>[l(m,{icon:"ant-design:info-circle-outlined",style:{color:"#bdbdbd",display:"inline-block","margin-right":"0 !important","vertical-align":"middle"}})]),_:2},1032,["title"]),l(S,{trigger:["click"]},{overlay:c(()=>[l(b,{onClick:k=>e.onRoleAction(k,d),style:{width:"100px"}},{default:c(()=>[l(u,{key:"edit"},{default:c(()=>[qe]),_:1}),l(u,{key:"delete"},{default:c(()=>[Ke]),_:1})]),_:2},1032,["onClick"])]),default:c(()=>[a("a",{class:"ant-dropdown-link",onClick:s[2]||(s[2]=ue(()=>{},["stop"]))},[l(m,{icon:"ant-design:ellipsis-outlined",class:"drop-ellipsis"})])]),_:2},1024)],10,$e))),256))])])])]),fe(a("div",Xe,[a("div",Ge,[a("span",He,L(e.activeRole.roleName),1),a("span",Je,L(e.getPageSize()),1)]),l(I,{onRegister:e.registerTable,rowSelection:e.rowSelection},{tableTitle:c(()=>[l(w,{type:"primary",onClick:e.addUserClick},{default:c(()=>[K("添加成员")]),_:1},8,["onClick"]),l(w,{onClick:e.removeUser,disabled:e.selectedRowKeys.length==0},{default:c(()=>[K(" 移出")]),_:1},8,["onClick","disabled"])]),tableTop:c(()=>[Qe]),_:1},8,["onRegister","rowSelection"])],512),[[_e,e.activeRole.id]])]),l(O,{onRegister:e.registerModal,onSuccess:e.loadRoleList},null,8,["onRegister","onSuccess"]),l(M,{multi:!0,onRegister:e.registerUserModal,onSelected:e.onSelected},null,8,["onRegister","onSelected"])],64)}const Yo=Fe(ze,[["render",We],["__scopeId","data-v-f2f19c50"]]);export{Yo as default};
