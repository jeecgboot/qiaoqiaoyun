var Z=Object.defineProperty,K=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var V=(o,n,s)=>n in o?Z(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,k=(o,n)=>{for(var s in n||(n={}))te.call(n,s)&&V(o,s,n[s]);if(B)for(var s of B(n))ae.call(n,s)&&V(o,s,n[s]);return o},T=(o,n)=>K(o,ee(n));import{d as W,f as b,o as ne,w as le,S as se,l as c,a6 as oe,a7 as re,a5 as A,a8 as ie}from"./vue-vendor-24c7dc61.js";import{C as de}from"./codemirror-17b6f671.js";import{a as _e,q as I,D as ce}from"./antd-vue-vendor-0d72f01e.js";import{r as pe}from"./searchcursor-9651c8d5.js";import"./codemirror-26b29690.js";var Te=pe();const S=/\$([^$]+)\$/,me=new RegExp(S,"g"),ue={class:"j-calclate-input"},fe=W({name:"j-calclate-input"}),be=W(T(k({},fe),{props:{value:String,options:{type:Array,default:()=>[]},formList:{type:Array,default:()=>[]},bizType:{type:String,default:"calculate"},allowInput:{type:Boolean,default:!0}},emits:["update:value"],setup(o,{expose:n,emit:s}){const m=o,x=I.Item,y={common:"常规",sum:"求和",max:"最大值",min:"最小值",avg:"平均值"};let i=null,u="",M=[];const $=b(),E=b(!1),N=b();ne(()=>{G()});function G(){i=de.fromTextArea(N.value,{lineWrapping:!0}),i.on("change",F),i.on("beforeChange",D),i.on("focus",()=>{E.value=!0}),i.on("blur",()=>{E.value=!1}),le(()=>m.value,O,{immediate:!0})}function j(){if(!i)throw new Error("editor is not ready");return i}function w(e){let a=j();a.replaceSelection(e),a.focus()}function D(e,a){if(!m.allowInput&&a.origin==="+input"){let t=a.text.join("");t=t.replace(me,""),t&&a.cancel()}}function F(e,a){let{from:t}=a,l=T(k({},t),{ch:0});z(e,l),u=e.getValue(),s("update:value",u)}function O(e){u!==e&&(u=e,i.setValue(e))}function z(e,a){let t=e.getSearchCursor(S,a,{multiline:"disable"});for(;t.findNext();)if(e.findMarks(t.from(),t.to()).length===0){let d=t.from(),r=t.to(),p=e.getRange(d,r).match(S),v=J(p[1]);M.push(v),e.markText(d,r,{replacedWith:v,atomic:!0})}}function q(e,a){let t=document.createElement("div");t.classList.add("flexRow"),t.classList.add("tagDiv"),t.classList.add("valignWrapper");let l=document.createElement("span");l.classList.add("Font12"),t.appendChild(l),a.appendChild(t);let d=e.split("@")[0],r=e.split("@")[1];return m.options.find(p=>p.id===r)?l.innerText=d||e:(a.classList.add("deleted"),a.innerText="字段已删除"),a}function J(e){let a=m.options||[],t=m.formList||[],l=document.createElement("div");if(l.classList.add("tagWidget"),m.bizType=="validate")l=q(e,l);else{let d=document.createElement("div");d.classList.add("box");let r=document.createElement("div");r.classList.add("table-name"),r.classList.add("ellipsis");let L=document.createElement("div");L.classList.add("arrow"),L.classList.add("arrow-top");let p=document.createElement("div");p.classList.add("arrow"),p.classList.add("arrow-bottom");let v=document.createElement("span");r.appendChild(L),r.appendChild(p),r.appendChild(v);let f=document.createElement("div"),R=document.createElement("span"),C=document.createElement("span");C.classList.add("Font12"),C.classList.add("mLeft5");let _=document.createElement("span");_.classList.add("mLeft5"),f.classList.add("field-name"),f.classList.add("ellipsis"),f.appendChild(R),f.appendChild(C),f.appendChild(_),d.appendChild(r),d.appendChild(f),l.appendChild(d);let H=e.split("@")[0],P=e.split("@")[1],Q=e.split("@")[2],g=e.split("@")[3]?e.split("@")[3]:"common",U=t.find(h=>h.value===Q);a.find(h=>h.model===P)?(v.innerText=U.label,R.innerText=H||e,C.innerText=y[g]&&g!="common"?`(${y[g]})`:""):(l.classList.add("deleted"),l.innerText="字段已删除"),se({setup(){return()=>c(ce,{trigger:["click"]},{default:()=>c("i",{class:"down-icon"}),overlay:()=>c(I,{onClick:({key:h})=>{if(e.split("@").length>3){let X=e.lastIndexOf("@"),Y=e.substring(0,X+1)+h;i.setValue(u.replace(e,Y))}else i.setValue(u.replace(e,`${e}@${h}`))}},[c(x,{key:"common"},"常规"),c(x,{key:"sum"},"求和"),c(x,{key:"max"},"最大值"),c(x,{key:"min"},"最小值"),c(x,{key:"avg"},"平均值")])})}}).mount(_)}return l}return n({insertContent:w}),(e,a)=>(oe(),re("div",ue,[A("div",{ref_key:"tagRef",ref:$,class:ie(["tag-textarea",{borderColorBlue:E.value}])},[A("textarea",{ref_key:"textareaRef",ref:N},null,512)],2)]))}}));export{be as default};
