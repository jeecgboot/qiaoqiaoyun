var O=Object.defineProperty;var F=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(e,s,n)=>s in e?O(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,b=(e,s)=>{for(var n in s||(s={}))R.call(s,n)&&k(e,n,s[n]);if(F)for(var n of F(s))z.call(s,n)&&k(e,n,s[n]);return e};var B=(e,s,n)=>new Promise((g,h)=>{var m=i=>{try{f(n.next(i))}catch(a){h(a)}},d=i=>{try{f(n.throw(i))}catch(a){h(a)}},f=i=>i.done?g(i.value):Promise.resolve(i.value).then(m,d);f((n=n.apply(e,s)).next())});import{f as l,u,d as G,a3 as Q,a4 as J,a5 as p,V as K,q as W,a6 as X,a7 as Y,k as E,ai as I,E as L,A as Z}from"./vue-vendor-24c7dc61.js";import{a8 as D,be as ee,l as se}from"./antd-vue-vendor-0d72f01e.js";import{C as ne}from"./index-f99b266a.js";import{a as te,o as oe,d as ie,a7 as ae,k as S,l as re}from"./index-831af9dd.js";import"./vxe-table-vendor-8813019a.js";function ue(e){const{createMessage:s,notification:n}=te(),{t:g}=oe(),h=ie(),m=ae(),d=l(""),f=l({}),i=l(!1),a=l(!1),y=l(""),T=l(!1),_=l(""),v=l("");function U(t){let o=`${h.uploadUrl}/sys/thirdLogin/render/${t}`;window.open(o,`login ${t}`,"height=500, width=500, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no"),d.value=t,f.value={},i.value=!1;let c=function(q){let r=q.data;if(typeof r=="string")if(r==="登录失败")s.warning(r);else if(r.includes("绑定手机号")){a.value=!0;let H=r.split(",");y.value=H[1],e("type",{loginType:"thirdLogin"})}else w(r);else typeof r=="object"?r.isObj===!0&&(T.value=!0,f.value=b({},r)):s.warning("不识别的信息传递");window.removeEventListener("message",u(c),!1)};window.addEventListener("message",c,!1)}function w(t){u(i)===!1&&(i.value=!0,m.ThirdLogin({token:t,thirdType:u(d)}).then(o=>{o&&o.userInfo?n.success({message:g("sys.login.loginSuccessTitle"),description:`${g("sys.login.loginSuccessDesc")}: ${o.userInfo.realname}`,duration:3}):x(o)}))}function x(t){n.error({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})}function A(){u(_)||C("请输入手机号"),u(v)||C("请输入验证码");let t={mobile:u(_),captcha:u(v),thirdUserUuid:u(y)};S.post({url:"/sys/thirdLogin/bindingThirdPhone",params:t},{isTransformResponse:!1}).then(o=>{o.success?(a.value=!1,w(o.result)):s.warning(o.message)}).catch(o=>{s.warning(o.message)})}function C(t){n.error({message:"登录失败",description:t,duration:4})}function P(){e("type",{loginType:"login"})}function V(){e("type",{loginType:"register"})}function M(){a.value=!1}function N(t){return B(this,null,function*(){let o=b({},t);o.thirdUserUuid=u(y),yield S.put({url:"/sys/thirdLogin/registerBindThirdAccount",params:o},{isTransformResponse:!1}).then(c=>{c.success?(a.value=!1,w(c.result)):s.warning(c.message)}).catch(c=>{s.warning(c.message)})})}function j(t){_.value=t.mobile,v.value=t.sms,A()}return{thirdConfirmShow:T,bindingAccount:a,thirdHandleOk:A,thirdPhone:_,thirdCaptcha:v,onThirdLogin:U,loginAccountClick:P,registerAccountClick:V,hideBindThirdAccount:M,bindThirdAccount:j,createAccountBindThird:N}}const ce=D.Item,le=se.Password,de=G({name:"AppThirdForm",components:{FormItem:ce,Form:D,InputPassword:le,CountdownInput:ne,QuestionCircleFilled:ee},setup(e,{emit:s}){return b({},ue(s))}});const $=e=>(Q("data-v-972a5ae0"),e=e(),J(),e),pe={class:"third-account"},fe={class:"content"},ge=$(()=>p("div",{class:"bind-title"},[p("span",null,"还未绑定敲敲云账号")],-1)),he=$(()=>p("div",{class:"bind-title-desc"},[p("span",null,"请选择绑定已有帐户，或创建新帐号")],-1)),me={class:"enter-x bind-btn"},_e={class:"enter-x bind-btn",style:{"margin-top":"20px"}};function ve(e,s,n,g,h,m){const d=K("a-button");return W((X(),Y("div",pe,[p("div",fe,[ge,he,p("div",me,[E(d,{type:"primary",onClick:e.loginAccountClick},{default:I(()=>[L("登录并绑定")]),_:1},8,["onClick"])]),p("div",_e,[E(d,{type:"primary",onClick:e.registerAccountClick},{default:I(()=>[L("注册新账号")]),_:1},8,["onClick"])])])],512)),[[Z,e.bindingAccount]])}const Fe=re(de,[["render",ve],["__scopeId","data-v-972a5ae0"]]);export{Fe as default};
