var de=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var W=(e,a,s)=>a in e?de(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,b=(e,a)=>{for(var s in a||(a={}))pe.call(a,s)&&W(e,s,a[s]);if(z)for(var s of z(a))fe.call(a,s)&&W(e,s,a[s]);return e},P=(e,a)=>ue(e,ce(a));var H=(e,a,s)=>new Promise((B,v)=>{var m=n=>{try{d(s.next(n))}catch(u){v(u)}},f=n=>{try{d(s.throw(n))}catch(u){v(u)}},d=n=>n.done?B(n.value):Promise.resolve(n.value).then(m,f);d((s=s.apply(e,a)).next())});import{d as ge,as as ve,f as p,e as w,u as _e,a3 as be,a4 as ye,a5 as C,V as y,a6 as R,a7 as Ce,F as he,k,ap as we,aq as ke,ai as I,ak as Ie,q as Be,A as De,ae as Me,af as j,W as G}from"./vue-vendor-24c7dc61.js";import{B as Fe}from"./index-1c3affea.js";import{H as Q,q as Te,d as Se,c2 as Ne,j as $e,b as X,k as Ae,a as Ee,c as Pe,cw as Re,l as Je}from"./index-831af9dd.js";import qe from"./DesignerButtonDrawer-04cdfd92.js";import"./BasicModal-58413bab.js";import"./antd-vue-vendor-0d72f01e.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./ZdyanDrawer-58ee121b.js";import"./ButtonColorSelector-58fbd93b.js";import"./ButtonConditions-9a9a88d5.js";import"./type.definition-4eb605ee.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./useCustomButton-fa741dda.js";import"./FilterFiledListNew-bbda127c.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";import"./ButtonConfirmText-527dd2f0.js";import"./FilterFiledList-8a929f88.js";import"./ButtonFormConfig-7880f3ed.js";import"./FormFieldSelect-9cf3f019.js";const Ue=ge({name:"FormDesignerIframeModal",components:{BasicModal:Fe,DesignerButtonDrawer:qe},props:{templet:Q.bool.def(!1),isLowApp:Q.bool.def(!0)},emits:["register","success","close","reload-menu"],setup(e,{emit:a}){const s=Te(),B=Se(),v=ve(),m=Ee(),f=p(),d=p(),n=Ne(16),u=p("design"),_=p(!1),c=p(!0),N=p(""),D=p(!1),l=p();let $=!1,M=null;const[Z,{closeModal:x,setModalProps:ee}]=$e(se),oe=w(()=>{var o,t;return e.templet?(o=l.value)==null?void 0:o.templetCode:(t=l.value)==null?void 0:t.desformCode}),J=w(()=>{var o,t;return e.templet?(o=l.value)==null?void 0:o.templetName:(t=l.value)==null?void 0:t.desformName}),te=w(()=>{let t={title:`${J.value} - 表单设计器`,width:800,zIndex:999,bodyStyle:{padding:"0"},wrapClassName:"design-form-modal",confirmLoading:c.value,footer:null,closable:_.value,draggable:!1,maskClosable:!1,canFullscreen:!1,destroyOnClose:!0,defaultFullscreen:!0};return P(b(b(b({keyboard:!1},t),_e(s)),e),{onCancel:re,onRegister:Z})}),ae=w(()=>e.templet?{add:"/desform/templet/add",edit:"/desform/templet/edit"}:{add:"/desform/add",edit:"/desform/edit"}),A=w(()=>e.templet?"templetJson":"desformDesignJson");window.addEventListener("message",function(o){let t=o.data;if(`${n}`===t.messageId)switch(t.type){case"created":_.value=!0,c.value=!1,D.value=!1;break;case"mounted":T("load-data",{token:X()});break;case"closing":ie(t.data);break;case"modal":le(t.data);break;case"request":U(t.data);break;case"request-save":let{designJson:r,refTableDefaultValDbSync:g,settings:h}=t.data;U(r,g,h);break;case"custom-button:add":d.value.doAdd();break;case"custom-button:edit":d.value.doEdit(t.data.record);break;case"reload:menu":a("reload-menu");break}},!1);function se(o){var t;l.value=o==null?void 0:o.record,l.value&&(M=l.value[A.value]),N.value=q((t=l.value)==null?void 0:t.id),$=!1,_.value=!1,c.value=!0,setTimeout(()=>{c.value&&(D.value=!0)},2e3)}function F(){N.value="",x(),M=null,D.value=!1,u.value="design",$&&a("success"),a("close")}function re(){ee({visible:!0}),T("try-close")}function ne(o){u.value=o,T("change-page",{type:o})}function q(o){let{domainUrl:t}=B,r=X(),g=Pe(),i=t+"/desform/index";return o&&(i+="/"+o),i+=`?isTemplet=${e.templet}&messageId=${n}`,i+=`&token=${r}`,e.isLowApp?v.params.appId&&(i+=`&lowAppId=${v.params.appId}`):i+="&isLowApp=false",Re(g)||(i+=`&tenantId=${g}`),i+=`&originUrl=${encodeURIComponent(window.location.origin)}`,i}function le(o){let t=null;o.type==="alert-warning"?t=m.createWarningModal:o.type==="alert-error"?t=m.createErrorModal:o.type==="alert-info"&&(t=m.createInfoModal),t!=null&&t(b({title:o.title,content:o.content},o.options))}function ie(o){o.list.length===0||JSON.stringify(o)===(M||(l.value||{})[A.value])?F():m.createConfirm({title:"警告",iconType:"warning",content:"系统可不会保存您的更改，确定要关闭吗？",okText:"关闭",okButtonProps:{type:"default",danger:!0},cancelText:"取消",onOk:()=>F()})}function T(o,t={}){var r,g;(g=(r=f.value)==null?void 0:r.contentWindow)==null||g.postMessage({messageId:n,type:o,data:t},"*")}function U(g){return H(this,arguments,function*(o,t={},r={}){var i,L,V,K,O;c.value=!0;let h=JSON.parse(o).config.onlineForm;try{let S=yield Ae.put({url:ae.value.edit,params:{id:(i=l.value)==null?void 0:i.id,[A.value]:o,cgformCode:h||void 0,updateCount:(V=(L=l.value)==null?void 0:L.updateCount)!=null?V:0,refTableDefaultValDbSync:t}},{successMessageMode:"none",isTransformResponse:!1});if(S.success){$=!0,M=o;let E=(K=r==null?void 0:r.successTip)!=null?K:"保存成功";m.createMessage.success(E),l.value.updateCount=S.result.updateCount}else{let E=(O=r==null?void 0:r.successTip)!=null?O:"保存失败";m.createErrorModal({title:E,content:S.message})}}catch(S){}finally{c.value=!1}})}function me(o){T("custom-button:command",P(b({},o),{type:"custom-button:"+o.type}))}return{iframeFormSrcUrl:N,iframeRef:f,model:l,getProps:te,headerActiveKey:u,initial:_,loading:c,desformCode:oe,desformName:J,showCloseButton:D,close:F,onTabChange:ne,onButtonDrawerCommand:me,getAutoDesFormUrl:q,buttonDrawerRef:d}}});const Y=e=>(be("data-v-ea5fed0f"),e=e(),ye(),e),Le={class:"desform-modal-header"},Ve={class:"desform-modal-title"},Ke={class:"desform-modal-tabs"},Oe=Y(()=>C("div",{class:"desform-modal-right"},null,-1)),ze=["src"],We=Y(()=>C("span",null,"关闭",-1));function He(e,a,s,B,v,m){const f=y("a-tab-pane"),d=y("a-tabs"),n=y("a-spin"),u=y("a-button"),_=y("BasicModal"),c=y("DesignerButtonDrawer");return R(),Ce(he,null,[k(_,we(ke(e.getProps)),{title:I(()=>[C("div",Le,[C("div",Ve,Ie(e.getProps.title),1),Be(C("div",Ke,[k(d,{activeKey:e.headerActiveKey,onChange:e.onTabChange},{default:I(()=>[k(f,{tab:"设计表单",key:"design"}),k(f,{tab:"表单设置",key:"setting"})]),_:1},8,["activeKey","onChange"])],512),[[De,e.initial]]),Oe])]),default:I(()=>[k(n,{spinning:e.loading},{default:I(()=>[C("iframe",{ref:"iframeRef",src:e.iframeFormSrcUrl,frameborder:"0",allow:"geolocation *; microphone *; camera *; midi *; encrypted-media *;",style:Me({width:"100%","min-height":"calc(100vh - 47px)"})},null,12,ze)]),_:1},8,["spinning"]),e.loading&&e.showCloseButton?(R(),j(u,{key:0,class:"btn-loading-close",type:"primary",danger:"",onClick:e.close},{default:I(()=>[We]),_:1},8,["onClick"])):G("",!0)]),_:1},16),e.desformCode!=null&&e.desformCode!=""?(R(),j(c,{key:0,ref:"buttonDrawerRef",desformCode:e.desformCode,desformName:e.desformName,designForm:e.model,onCommand:e.onButtonDrawerCommand},null,8,["desformCode","desformName","designForm","onCommand"])):G("",!0)],64)}const tt=Je(Ue,[["render",He],["__scopeId","data-v-ea5fed0f"]]);export{tt as default};
