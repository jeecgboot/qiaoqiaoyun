var w=(o,C,s)=>new Promise((_,d)=>{var m=i=>{try{c(s.next(i))}catch(p){d(p)}},h=i=>{try{c(s.throw(i))}catch(p){d(p)}},c=i=>i.done?_(i.value):Promise.resolve(i.value).then(m,h);c((s=s.apply(o,C)).next())});import{d as q,f as y,u as O,V as u,a6 as f,a7 as L,F as P,a5 as G,a8 as v,k as b,ai as k,E as z,af as U,am as W,ak as X,W as j}from"./vue-vendor-24c7dc61.js";import{h as K,e as Q,l as Y}from"./index-831af9dd.js";import{u as Z}from"./index-3c281896.js";import"./index-1c3affea.js";import{d as x}from"./vuedraggable-vendor-6ef4bc68.js";import{h as F,f as H}from"./low.app.api-97fc250a.js";import{R as ee}from"./index-a964241b.js";import oe from"./LowAppModal-936d2524.js";import te from"./LowAppProcess-de121b40.js";import ae from"./LowAppListItem-d25b23f8.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./LowAppIcon-e49e90b9.js";import"./LowAppIconChoose-64241fb5.js";const ne=q({name:"LowAppHome",components:{Draggable:x,LowAppModal:oe,LowAppProcess:te,LowAppListItem:ae},setup(){const{prefixCls:o}=K("low-app-home"),{createJPrompt:C}=Z(),s=y(!0),_=y(!1),d=y(""),m=y([]),h=y([]),[c,{openModal:i}]=Q();p();function p(){return w(this,null,function*(){try{let e=yield F.listByGroup();h.value=e.labelList,m.value=e.groupList}finally{s.value=!1}})}function E(){i(!0,{isUpdate:!1})}function A(e){i(!0,{isUpdate:!0,record:e})}function M(e){window.open(`/${ee}/${e.id}`)}function V(e,n){e.key==="edit-item"&&A(n)}function r(e){e.label!=="无分组"&&C({title:"重命名分组",defaultValue:e.label,placeholder:"请输入分组名称",rules:R(e.label),onOk(l){return w(this,null,function*(){let t=l,g=e.label;t!==g&&(yield F.groupRename(t,g),p())})}})}function I(e,n){var l;if(_.value=!0,d.value=n.label,n.label==="无分组"){let t=(l=m.value[m.value.length-2])==null?void 0:l.label;t&&(d.value=t)}}function a(){_.value=!1}function D(e,n){const{added:l,moved:t}=e;l?$(0,1,n):t&&$(t.oldIndex,t.newIndex,n)}function J({added:e},n){if(!e)return;const{element:l}=e;C({title:"新建分组",defaultValue:"",placeholder:"请输入分组名称",rules:R(""),onOk(g){return w(this,null,function*(){try{yield H.update({id:l.id,appLabel:g,orderNum:0})}finally{p()}})},onCancel:()=>p()})}function R(e,n){return[{required:!0,message:"分组名称不能为空！"},{max:10,message:"分组名称不能超过10个字符！"},{validator:(l,t)=>w(this,null,function*(){var g;if(["未命名分组","无分组"].includes(t))throw"非法的分组名！";if(O(e)!==t&&((g=O(m))==null?void 0:g.find(T=>T.label===t))!=null)throw"分组名已存在！";n&&(n.value=t)})}]}function $(g,T,go){return w(this,arguments,function*(e,n,{list:l,label:t}){if(e!==n){let B=[];l.forEach((N,S)=>{(N.orderNum!==S||N.appLabel!==t)&&B.push({id:N.id,orderNum:S,appLabel:t==="无分组"?"":t})});try{yield H.updateBatch(B)}finally{p()}}})}return{prefixCls:o,loading:s,dragging:_,draggingGroup:d,groupList:m,labelList:h,loadData:p,onOpenApp:M,onCreateApp:E,onGroupRename:r,onItemMenuClick:V,onDraggableStart:I,onDraggableEnd:a,onDraggableChange:D,onAddNewGroup:J,registerModal:c}}});const ie={key:2,class:"app-group-box"},pe={class:"app-group-item"},re=["onClick"],le={key:0,class:"app-group-create"};function se(o,C,s,_,d,m){const h=u("LowAppProcess"),c=u("a-button"),i=u("a-skeleton"),p=u("a-empty"),E=u("LowAppListItem"),A=u("Draggable"),M=u("a-card"),V=u("LowAppModal");return f(),L(P,null,[G("div",{class:v([o.prefixCls])},[b(h),b(M,{class:"app-list-card",title:"全部应用"},{extra:k(()=>[b(c,{type:"primary",shape:"round",preIcon:"bx:plus",onClick:o.onCreateApp},{default:k(()=>[z("创建应用")]),_:1},8,["onClick"])]),default:k(()=>[o.loading?(f(),U(i,{key:0,active:""})):o.groupList.length===0?(f(),U(p,{key:1,description:"暂无应用",style:{"margin-bottom":"12px"}})):(f(),L("div",ie,[(f(!0),L(P,null,W(o.groupList,(r,I)=>(f(),L("div",pe,[G("div",{class:v(["group-label",{disabled:r.label==="无分组"}])},[G("span",{onClick:a=>o.onGroupRename(r),title:"重命名分组"},X(r.label),9,re)],2),b(A,{class:v(["app-list",{dragging:o.dragging}]),modelValue:r.list,"onUpdate:modelValue":a=>r.list=a,handle:".app-list-item",animation:200,"item-key":"id",group:"low-app","ghost-class":"app-item-ghost",onStart:a=>o.onDraggableStart(a,r),onEnd:a=>o.onDraggableEnd(a,r),onChange:a=>o.onDraggableChange(a,r)},{item:k(({element:a})=>[b(E,{item:a,onClick:D=>o.onOpenApp(a),onDeleted:o.loadData,onMenuClick:D=>o.onItemMenuClick(D,a)},null,8,["item","onClick","onDeleted","onMenuClick"])]),_:2},1032,["class","modelValue","onUpdate:modelValue","onStart","onEnd","onChange"]),o.dragging&&o.draggingGroup===r.label?(f(),L("div",le,[b(A,{class:v(["app-list","app-list-new"]),list:[],"item-key":"id",group:"low-app","ghost-class":"app-item-ghost",onChange:a=>o.onAddNewGroup(a,I)},{item:k(()=>[]),_:2},1032,["onChange"])])):j("",!0)]))),256))]))]),_:1})],2),b(V,{onRegister:o.registerModal,onSuccess:o.loadData},null,8,["onRegister","onSuccess"])],64)}const mo=Y(ne,[["render",se]]);export{mo as default};
