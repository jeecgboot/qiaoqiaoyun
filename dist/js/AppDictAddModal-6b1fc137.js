var L=(e,l,u)=>new Promise((B,w)=>{var g=r=>{try{f(u.next(r))}catch(C){w(C)}},n=r=>{try{f(u.throw(r))}catch(C){w(C)}},f=r=>r.done?B(r.value):Promise.resolve(r.value).then(g,n);f((u=u.apply(e,l)).next())});import{B as Z}from"./index-1c3affea.js";import{d as ee,f as p,e as te,u as b,n as F,a3 as oe,a4 as ae,a5 as s,V as v,a6 as M,a7 as N,F as z,k as d,ai as m,ak as le,am as ie,a8 as se,ae as O}from"./vue-vendor-24c7dc61.js";import{b0 as y,k as T,j as de,a as ne,l as ue}from"./index-831af9dd.js";import re from"./BasicTable-d435f501.js";import{h as ce}from"./antd-vue-vendor-0d72f01e.js";import{N as me,C as R,g as pe,a as P}from"./DictColors-73058d23.js";const fe=[{title:"id",key:"id",type:y.hidden},{title:"选项值",key:"itemValue",type:y.hidden},{title:"排序",key:"sortOrder",type:y.hidden,width:50},{title:"颜色",key:"itemColor",type:y.slot,slotName:"itemColor",width:20},{title:"选项",key:"itemText",type:y.input,showOverflow:!0,validateRules:[{required:!0,message:"请输入${title}"}]},{title:"操作",key:"action",width:"50px",align:"center",type:y.slot,slotName:"action"}],ve=[{title:"id",key:"id",type:y.hidden},{title:"字典项",key:"itemText",showOverflow:!0},{title:"字典项值",key:"itemValue",type:y.inputNumber,validateRules:[{unique:!0,message:"${title}不能重复"},{required:!0,message:"请输入${title}"}]},{title:"排序",key:"sortOrder",type:y.hidden}];const je=()=>T.get({url:"/sys/dict/getDictListByLowAppId"},{isTransformResponse:!1}),ye=e=>T.post({url:"/sys/dict/addDictByLowAppId",params:e},{joinParamsToUrl:!0}),Ce=e=>T.put({url:"/sys/dict/editDictByLowAppId",params:e},{joinParamsToUrl:!0}),ze=(e,l)=>T.delete({url:"/sys/dict/delete",params:e},{joinParamsToUrl:!0}).then(()=>{l()}),ge=ee({name:"AppDictAddModal",components:{BasicTable:re,BasicModal:Z},emits:["success","register"],setup(e,{emit:l}){const u=p({dictName:"",id:"",dictCode:""}),B=ne(),w=te(()=>b(g)?"编辑数据字典":"新增数据字典"),g=p(!1),n=p(),f=p(),[r,{closeModal:C}]=de(t=>{c.value=[{sortOrder:1,itemText:"字典项1",itemValue:"1",itemColor:R[0][0]},{sortOrder:2,itemText:"字典项2",itemValue:"2",itemColor:R[1][0]}],o.value=2,g.value=t.isUpdate,u.value={dictName:"",id:"",dictCode:""},b(g)&&(u.value=t.record,c.value=ce(t.record.dictItemsList))}),D=p(""),_=p(!1),c=p([{sortOrder:1,itemText:"字典项1",itemValue:"1"},{sortOrder:2,itemText:"字典项2",itemValue:"2"}]),V=p(!1),I=p([]),o=p(0);function h(){E("字典项",!0)}function S(){D.value="",_.value=!0}function $(){F(()=>{if(b(D)){let t=D.value.split(`
`),i=[];for(let a=0;a<t.length;a++)i.indexOf(t[a])==-1&&(i.push(t[a]),E(t[a]))}_.value=!1})}function E(t,i=!1){let a=0;b(c).length>0&&(a=Math.max.apply(Math,c.value.map(Y=>parseInt(Y.itemValue))));let k=P(o.value).next(),W=P(o.value).getIndex(),U=t;i&&(U=t+(a+1));let j={sortOrder:a+1,itemText:U,itemValue:(a+1).toString(),itemColor:k[0]};o.value=W+1;let X=[j];c.value.push(j),n.value.pushRows(X)}function q(t){var i;(i=n.value)==null||i.removeRows(t.row),c.value.splice(t.params.$rowIndex,1)}function x(){return L(this,null,function*(){if(!b(u).dictName){B.createMessage.warning("字典名称不能为空");return}n.value.validateTable().then(t=>{t||F(()=>L(this,null,function*(){let i=n.value.getTableData();i&&i.length>0&&G(i);let a={dictName:b(u).dictName,dictItemsList:i};b(g)?(a.id=u.value.id,yield Ce(a)):yield ye(a),l("success"),C()}))})})}function H(){I.value=[],n.value.validateTable().then(t=>{t||F(()=>{I.value=n.value.getTableData(),V.value=!0})})}function J(){f.value.validateTable().then(t=>{t||(c.value=f.value.getTableData(),V.value=!1)})}function K({row:t}){c.value.push(t)}function G(t){let i=Math.max.apply(Math,t.map(a=>a.itemValue?parseInt(a.itemValue):0));for(let a=0;a<t.length;a++){let k=t[a];k.itemValue||(k.itemValue=(i+1).toString(),i++)}}function Q(t,i,a){var k;(k=n.value)==null||k.setValues([{rowKey:a.row.id,values:{itemColor:i[0]}}])}return{registerModal:r,getTitle:w,dataSource:c,columns:fe,columnsItemColumn:ve,addDictItemClick:h,tableRef:n,addDictItemValue:D,bathAddDictClick:S,bathAddDictVisible:_,batchAddDictOk:$,dictDeleteClick:q,handleSuccessOk:x,formState:u,scoringClick:H,bathAddDictValueVisible:V,copyDataSource:I,batchAddDictValueOk:J,tableValueRef:f,insertedDict:K,NONE_COLOR:me,Colors:R,itemColorClick:Q,getItemColor:pe}}});const A=e=>(oe("data-v-dea6df27"),e=e(),ae(),e),De=A(()=>s("div",{class:"dict-title"}," 字典名称 ",-1)),he={style:{"margin-top":"20px"}},ke={class:"dict-title"},be={class:"item-tool"},Ie=["onClick"],we=A(()=>s("div",{class:"item-color-border"},null,-1)),_e={class:"operation"},Ve=A(()=>s("span",{style:{"padding-left":"5px"}},"添加字典项",-1)),Ae={class:"batch-padding"},Be=A(()=>s("div",{class:"batch-desc"},"每一项需要换行,并去掉重复值",-1)),Oe={class:"batch-padding"},Te=A(()=>s("div",{class:"batch-desc"},"自定义字典项，并且值不重复",-1));function Se(e,l,u,B,w,g){const n=v("a-row"),f=v("a-input"),r=v("a-tooltip"),C=v("Icon"),D=v("JVxeTable"),_=v("a-form"),c=v("BasicModal"),V=v("a-textarea"),I=v("a-modal");return M(),N(z,null,[d(c,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSuccessOk,destroyOnClose:""},{default:m(()=>[d(_,null,{default:m(()=>[d(n,{span:24},{default:m(()=>[De]),_:1}),d(n,null,{default:m(()=>[d(f,{placeholder:"字典名称",value:e.formState.dictName,"onUpdate:value":l[0]||(l[0]=o=>e.formState.dictName=o)},null,8,["value"])]),_:1}),s("div",he,[s("div",ke,le("字典项("+e.dataSource.length+")"),1),d(D,{ref:"tableRef",dragSort:"",sortKey:"sortOrder",maxHeight:480,columns:e.columns,dataSource:e.dataSource,border:"none","show-header":!1,onInserted:e.insertedDict},{itemColor:m(o=>[d(r,{placement:"bottom",trigger:"click",color:"#FFFFFF"},{title:m(()=>[s("div",be,[(M(!0),N(z,null,ie(e.Colors,(h,S)=>(M(),N("div",{class:se([o.row.itemColor===h[0]?"item-active":"","item-color"]),style:O({color:h[0]}),onClick:$=>e.itemColorClick(S,h,o)},[we,s("div",{class:"item-back",style:O({background:h[0]})},null,4)],14,Ie))),256))])]),default:m(()=>[s("div",{class:"item-dict",style:O({background:o.row.itemColor?o.row.itemColor:e.NONE_COLOR[0]})},[s("div",{class:"triangle",style:O({"border-top-color":e.getItemColor(o.row.itemColor)})},null,4)],4)]),_:2},1024)]),action:m(o=>[d(r,{title:"删除",placement:"bottom"},{default:m(()=>[d(C,{class:"dict-delete",icon:"ant-design:close-outlined",onClick:h=>e.dictDeleteClick(o)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["columns","dataSource","onInserted"]),s("div",_e,[s("div",{class:"add-operation",onClick:l[1]||(l[1]=(...o)=>e.addDictItemClick&&e.addDictItemClick(...o))},[d(C,{icon:"ant-design:plus-outlined"}),Ve]),s("div",{class:"bath-add-operation",onClick:l[2]||(l[2]=(...o)=>e.bathAddDictClick&&e.bathAddDictClick(...o))}," 批量编辑 "),s("div",{class:"scoring-operation",onClick:l[3]||(l[3]=(...o)=>e.scoringClick&&e.scoringClick(...o))}," 字典项 ")])])]),_:1})]),_:1},8,["onRegister","title","onOk"]),d(I,{open:e.bathAddDictVisible,"onUpdate:open":l[5]||(l[5]=o=>e.bathAddDictVisible=o),title:"批量添加",onOk:e.batchAddDictOk,destroyOnClose:""},{default:m(()=>[s("div",Ae,[Be,d(V,{autoSize:{minRows:12},value:e.addDictItemValue,"onUpdate:value":l[4]||(l[4]=o=>e.addDictItemValue=o)},null,8,["value"])])]),_:1},8,["open","onOk"]),d(I,{open:e.bathAddDictValueVisible,"onUpdate:open":l[6]||(l[6]=o=>e.bathAddDictValueVisible=o),width:"800px",title:"字典项",onOk:e.batchAddDictValueOk,destroyOnClose:""},{default:m(()=>[s("div",Oe,[Te,d(D,{ref:"tableValueRef","data-source":e.copyDataSource,columns:e.columnsItemColumn,size:"small",bordered:!1,striped:!1,maxHeight:480},null,8,["data-source","columns"])])]),_:1},8,["open","onOk"])],64)}const Le=ue(ge,[["render",Se],["__scopeId","data-v-dea6df27"]]),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));export{Le as A,Pe as a,ze as d,je as g};
