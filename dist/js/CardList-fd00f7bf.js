var Ue=Object.defineProperty,je=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var Ie=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var xe=(o,u,f)=>u in o?Ue(o,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):o[u]=f,ge=(o,u)=>{for(var f in u||(u={}))He.call(u,f)&&xe(o,f,u[f]);if(Ie)for(var f of Ie(u))Je.call(u,f)&&xe(o,f,u[f]);return o},Le=(o,u)=>je(o,ze(u));var b=(o,u,f)=>new Promise((e,D)=>{var k=I=>{try{S(f.next(I))}catch(M){D(M)}},V=I=>{try{S(f.throw(I))}catch(M){D(M)}},S=I=>I.done?e(I.value):Promise.resolve(I.value).then(k,V);S((f=f.apply(o,u)).next())});import{aC as Ke,bU as qe,bR as We,a$ as Xe,E as Ye}from"./antd-vue-vendor-0d72f01e.js";import{f as w,r as Ze,u as ye,w as Ce,h as $e,n as et,a3 as Yt,a4 as Zt,V as T,a6 as m,a7 as C,F as De,a5 as x,ae as Fe,af as Y,am as Te,ak as ie,k as B,ai as he,W as be,z as Se,al as Ae}from"./vue-vendor-24c7dc61.js";import{a as Re,ae as tt,r as at,k as Ve,U as ot,e as it,ap as Ee,bI as nt,l as lt}from"./index-831af9dd.js";import{a as rt}from"./LinkRecordSelect-385d0eae.js";import{p as st}from"./auto.desform.api-839115ed.js";import{u as dt,a as Be}from"./useAuth-d62eecf0.js";import{g as ut}from"./useSuperQueryCurd-0a66a14b.js";import"./index-1c3affea.js";import{_ as ct}from"./DemoModal-7f7a51bd.js";import{d as mt}from"./vuedraggable-vendor-6ef4bc68.js";import ft from"./AutoDesformDataFullScreen-bd93fbb9.js";import{c as pt}from"./index-d508f1f4.js";import gt from"./TableImage-14ca1f5d.js";import yt from"./CardCellFile-92b3c8c8.js";import{c as ht}from"./useCustomButton-fa741dda.js";import vt from"./SubTableTag-81763fd6.js";import _t from"./CardTypeBody-646a78e6.js";import{u as wt}from"./useViewCommon-0bf8ef6c.js";import"./vxe-table-vendor-8813019a.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./renderUtils-7ad8f436.js";const{createConfirm:Ct}=Re(),Oe=["rgb(33, 150, 243)","rgb(0, 195, 69)","rgb(250, 173, 20)","rgb(250, 140, 22)","rgb(255, 87, 0)","rgb(245, 34, 45)","rgb(235, 47, 150)","rgb(128, 128, 128)","rgb(153, 62, 186)","rgb(78, 82, 206)"];function Dt(o,u,f){const e=w(!1),D=w(),k=w([]),V=w({}),S=w({}),I=w(),M={setProps(){}},Z=Ze({notDesignForm:!1}),{allColumns:z,allColumnKeys:ne,loadColumnsInfo:$}=rt({desformCode:D,translData:V,remoteOptionsMap:S,dynamicConfig:o.dynamicConfig,desformName:I,notBaseList:1},{loadData:N,openLinkRecord:te,tableAction:M},Z);function N(){}const{getFormAuthOnce:Q}=dt(),{hasUpdateAuth:ee}=Be();function te(t,d){return b(this,null,function*(){t=ye(t);const g=ye(u),n=ye(o.viewId);yield Q(g,t),f.openModal(!0,{mode:"edit",desformCode:t,dataId:d,isOnline:!1,viewId:n,lowAppId:g,setMode({record:r}){let y=r!=null&&r.desformData?r.desformData:r;return ee(t,n,[y])?"edit":"detail"}})})}tt(()=>{o.code?D.value=o.code:D.value=at.currentRoute.value.params.code}),Ce(D,re,{immediate:!0}),Ce(()=>o.timestamp,t=>{t&&re()},{immediate:!1});const F=w(),E=w(""),A=w(""),l=w({name:"",label:"",compType:""}),H=w([]),p=w(!1),O=w({name:"",label:""}),le=w(!1);$e(()=>{let t=o.dynamicConfig;if(t){A.value=t.groupField,E.value=t.filterGroupType,p.value=t.showLabel,le.value=t.coverView;let d=z.value,g=t.titleField,n=J(g,d);n&&(l.value={name:n.name,label:n.label,compType:n.compType});let r=t.coverField;if(r=="none")O.value={name:"",label:""};else{let h=J(r,d);h&&(O.value={name:h.name,label:h.label})}let y=t.cardColumnList;if(y){let h=[];for(let L of y)if(L.show===!0&&L.field!=g){let P=J(L.field,d);P&&h.push({name:P.name,label:P.label,compType:P.compType})}H.value=h}}});function J(t,d){let g=d.filter(n=>n.key==t);return g&&g.length>0?{name:g[0].dataIndex,label:g[0].title,compType:g[0].compType}:""}function re(){return b(this,null,function*(){if(D.value)try{e.value=!0;const t=yield $(D.value);F.value=t.dictCountList,yield W()}finally{e.value=!1}else return})}const ae=w({});Ce(()=>o.superQuery,t=>{t&&(ae.value={matchType:t.matchType,superQueryParams:t.superQueryParams}),W()},{immediate:!1,deep:!0});const K=w({}),ve="/desform/data/cardList",q=20,se=t=>Ve.get({url:ve,params:t,timeout:3e4});function W(){return b(this,null,function*(){let t=ue();const d=yield se(t);!d||d.length==0?k.value=[]:me(d)})}function de(t,d){return b(this,null,function*(){let g=ue({groupTypes:t,pageNo:d});const n=yield se(g);if(n&&n.length>0){let r=me(n,!0);k.value.forEach(y=>{const h=r.find(L=>L.value===y.value);h&&h.data&&y.data&&(h.data.length<q&&(y.paging.isEnd=!0),y.count=h.count,y.title=h.title,y.data=y.data.concat(h.data),y.paging.current=d)})}})}function ue(t={}){return ge({code:D.value,appId:ye(u),superQuery:ut(ae.value,K.value),global_keyword:o.keyword,listViewId:o.dynamicConfig.id,pageNo:1,pageSize:q},t)}function ce(t){let d="";return Oe.length>t?d=Oe[t]:d=fe(),d}function me(t,d=!1){let g=[];if(!E.value||E.value=="all"){t.sort(function(n,r){return n.title-r.title});for(let n=0;n<t.length;n++){let{count:r,title:y,value:h,dataList:L}=t[n];g.push({title:y||"未知项",value:h,color:ce(n),count:r,data:L,paging:{current:1,size:q,isEnd:!1,isChange:!0}})}}else{let n=F.value;if(n)for(let r=0;r<n.length;r++){let{count:y,title:h,value:L}=n[r],P={title:h,value:L,count:y,color:ce(r),paging:{current:1,size:q,isEnd:!1,isChange:!0}};for(let X=0;X<t.length;X++)if(t[X].value==L){P.data=t[X].dataList;break}g.push(P)}}if(g=g.sort((n,r)=>((n==null?void 0:n.title)||"").localeCompare((r==null?void 0:r.title)||"")),d)return g;k.value=g}function fe(){return"#"+function(){let t=Math.floor(Math.random()*16777215).toString(16);return t.length==6?t:"rgb(33, 150, 243)"}()}function oe(){return b(this,null,function*(){})}function pe(g){return b(this,arguments,function*({id:t,type:d}){const n="/desform/data/edit";let r={_id:t,[A.value]:d,__CFG_PART_EDIT:!0},y={desformCode:D.value,desformDataJson:JSON.stringify(r),id:t};yield Ve.put({url:n,params:y})})}function _e(t){Ct({iconType:"warning",title:"删除",content:"确定要删除吗？",onOk:()=>b(this,null,function*(){yield st.delete(D.value,t.id),W()})})}function we(t){return b(this,null,function*(){})}function U(t){K.value={},K.value.matchType=t.matchType,K.value.superQueryGroup=t.conditions}return{loading:e,getRandomColor:fe,initGroupList:oe,typeArray:k,updateType:pe,loadAll:W,loadNext:de,deleteOne:_e,copyOne:we,allColumns:z,groupType:E,groupField:A,titleField:l,itemFieldList:H,showLabel:p,coverField:O,coverView:le,routeCode:D,superQueryParams:ae,setSuperQueryGroup:U}}const Ft={name:"CardList",components:{PlusOutlined:Ke,DemoModal:ct,draggable:mt,EllipsisOutlined:qe,CopyOutlined:We,DeleteOutlined:Xe,AutoDesformDataFullScreen:ft,TableImage:gt,Dropdown:ot,CardCellFile:yt,SubTableTag:vt,CardTypeBody:_t},props:{code:String,timestamp:{type:Number,default:0},keyword:{type:String,default:""},superQuery:{type:Object,default:()=>{}},dynamicConfig:{type:Object,default:()=>{}},viewId:{type:String,default:""},customButtonsAuth:Object},setup(o){const{createMessage:u}=Re(),f=w({}),e=w(0);e.value=window.innerHeight-70-100;const[D,{openModal:k}]=it(),{appId:V,showComment:S,showFiles:I,showDataLog:M,showCreateBtn:Z,showRecordShare:z,showRecordSysPrint:ne,showDesignFormBtn:$,dataPageTotal:N,currentIndex:Q}=wt(),{loading:ee,routeCode:te,superQueryParams:F,allColumns:E,typeArray:A,loadAll:l,loadNext:H,updateType:p,deleteOne:O,copyOne:le,groupField:J,coverField:re,coverView:ae,showLabel:K,titleField:ve,itemFieldList:q,setSuperQueryGroup:se}=Dt(o,V,{openModal:k});function W(){let a=o.dynamicConfig;return a&&a.groupField?a.groupField:""}const{hasUpdateAuth:de,hasDeleteAuth:ue,hasCreateAuth:ce}=Be();function me(){return ce(o.code)}function fe(a){let i=W();i?f.value={[i]:a}:f.value={},k(!0,{mode:"add",desformCode:o.code,dataId:"",isOnline:!1,viewId:o.viewId,lowAppId:V.value})}const oe=w(null);function pe(a,i,v){Q.value=i,N.value=v.data.length,oe.value=v;let s=a!=null&&a.desformData?a.desformData:a;de(o.code,o.viewId,[s])===!0?k(!0,{mode:"edit",desformCode:o.code,dataId:a.id,isOnline:!1,viewId:o.viewId,lowAppId:V.value}):k(!0,{mode:"detail",desformCode:o.code,dataId:a.id,isOnline:!1,viewId:o.viewId,lowAppId:V.value})}function _e(a,i){let v=E.value,s=a[i];for(let _ of v)if(_.dataIndex===i){_.customRender&&(s=_.customRender({text:s,record:a}));break}return s}const we={name:"demo",pull:!0,put:!0};let U={};function t(a){if(a.draggedContext.element._id==="empty")return!1;let i=a.draggedContext.element;i=i!=null&&i.desformData?i.desformData:i;let v=de(o.code,o.viewId,[i]);return U={id:a.draggedContext.element.id,type:a.relatedContext.element.desformData[J.value],status:v},v!==!1}function d(){return b(this,null,function*(){U.status!==!1&&U.id&&(yield p(U),U={},g())})}function g(){let a=A.value;for(let i of a){let v=i.data;if(!v||v.length==0)v.push({_id:"empty",desformData:{[J.value]:i.value}}),i.count=0;else{let s=v.filter(_=>_._id!="empty");s.length==0||(i.data=s),i.count=s.length}}A.value=a}function n(a){return b(this,null,function*(){a.isLinkRecordForm===!0&&(yield Pe(a.currentRecordId,a.dataId,a.customButtonId)),setTimeout(()=>{l()},500)})}function r(v){return b(this,arguments,function*({id:a,index:i}){let s=oe.value;if(!s||!s.data){u.error("数据不存在");return}let _=s.data;if(a){let R=_.findIndex(c=>c.id===a);if(R==-1){yield l(),yield et();let c=A.value.find(G=>G.value===s.value);if(!c||!c.data){u.error("数据不存在");return}if(N.value=c.data.length,oe.value=c,_=c.data,N.value=_.length,R=_.findIndex(G=>G.id===a),R==-1){u.error("数据不存在");return}s=c}i=R}if(Q.value=i,!s||!s.data[i]){u.error("数据不存在");return}pe(s.data[i],i,s)})}function y(a,i){if(a[i]){let v=a[i];if(v.length>0){let{url:s,status:_}=v[0];if(s&&_=="success")return Ee(s)}}return""}function h(a,i){if(ae.value===!0&&a[i]){let v=[],s=a[i];if(s.length>0)for(let _ of s){let{url:R,status:c}=_;R&&c=="success"&&v.push(Ee(R))}pt({imageList:v})}}const L=["slider","rate","switch","link-record"];function P(a){return L.indexOf(a.compType)>=0}const{designButtonList:X,getCustomButtons:Me,addLinkRecordData:Pe}=ht(o,{openModal:k},{value:o.code});function ke(a,...i){return b(this,null,function*(){typeof a=="function"&&(yield a(...i)),yield nt(500),yield l()})}function Ge(a){var R;let i=[],v=a!=null&&a.desformData?a.desformData:a;ue(o.code,o.viewId,[v])===!0&&i.push({label:"删除",icon:"ant-design:delete-outlined",iconColor:"#f44336",onClick:()=>O(a)});let _=Me(a,X);if(_&&_.length>0)for(let c of _){if((R=c==null?void 0:c.popConfirm)!=null&&R.confirm){let G=c.popConfirm.confirm;c.popConfirm.confirm=ke.bind(null,G)}else if(c.onClick){let G=c.onClick;c.onClick=ke.bind(null,G)}i.unshift(c)}return i.map((c,G)=>{const{label:Qe,popConfirm:j}=c;return Le(ge(ge({},c),j),{onConfirm:j==null?void 0:j.confirm,onCancel:j==null?void 0:j.cancel,text:Qe,divider:G<i.length-1})})}function Ne(){return b(this,null,function*(){let a={code:te.value,superQuery:JSON.stringify(F.value),listViewId:o.dynamicConfig?o.dynamicConfig.id:"",global_keyword:o.keyword},i=o.dynamicConfig.name;return{columns:E.value,queryParams:a,viewName:i}})}return{loading:ee,containerHeight:e,typeArray:A,titleField:ve,itemFieldList:q,currentIndex:Q,dataPageTotal:N,loadNext:H,handleAdd:fe,handleEdit:pe,getFieldValue:_e,dragGroup:we,onDragEnd:d,onMove:t,deleteOne:O,copyOne:le,showLabel:K,coverField:re,simpleImage:Ye.PRESENTED_IMAGE_SIMPLE,registerDataModal:D,onSuccess:n,onGoToRecord:r,getImageUrl:y,viewOnlineCellImage:h,defaultFormData:f,isComponent:P,getOperationList:Ge,ifAdd:me,getTableColumns:Ne,showComment:S,showFiles:I,showDataLog:M,showCreateBtn:Z,showRecordShare:z,showRecordSysPrint:ne,showDesignFormBtn:$,setSuperQueryGroup:se}}};const bt={class:"mask"},kt={key:2,class:"content",style:{overflow:"hidden","overflow-x":"auto"}},It={class:"card-column"},xt={class:"header"},Lt={class:"type-num"},Tt={key:0,class:"item empty",style:{height:"120px"}},St={key:1,class:"item"},At={style:{position:"relative",display:"flex"}},Vt={key:0,style:{cursor:"pointer",display:"flex","flex-direction":"column","justify-content":"center",width:"96px","border-right":"1px solid #f0f0f0"}},Et=["src","onClick"],Ot={class:"info",style:{flex:"1"}},Rt=["onClick"],Bt={class:"title"},Mt={key:1},Pt={class:"others card-other-field-info"},Gt={style:{display:"flex"}},Nt={key:0,style:{"margin-right":"5px"}},Qt={key:2},Ut={key:3},jt={key:4},zt={key:6},Ht={class:"icon-div"},Jt=["onClick"];function Kt(o,u,f,e,D,k){const V=T("a-skeleton"),S=T("a-empty"),I=T("TableImage"),M=T("card-cell-file"),Z=T("sub-table-tag"),z=T("a-tooltip"),ne=T("ellipsis-outlined"),$=T("Dropdown"),N=T("draggable"),Q=T("CardTypeBody"),ee=T("PlusOutlined"),te=T("DesformViewModal");return m(),C(De,null,[x("div",{class:"card-container",style:Fe({height:e.containerHeight+"px"})},[x("div",bt,[e.loading?(m(),Y(V,{key:0,active:""})):e.typeArray.length===0?(m(),Y(S,{key:1,description:"暂无数据",style:{"margin-top":"50px"}})):(m(),C("div",kt,[(m(!0),C(De,null,Te(e.typeArray,F=>{var E,A;return m(),C("div",It,[x("div",xt,[x("div",{class:"type-name",style:Fe({backgroundColor:F.color})},ie(F.title),5),x("div",Lt,ie((A=F.count)!=null?A:(E=F.data)==null?void 0:E.length),1)]),B(Q,{class:"body",cardType:F,loadNext:e.loadNext},{default:he(()=>[B(N,{modelValue:F.data,"onUpdate:modelValue":l=>F.data=l,"item-key":"id",move:e.onMove,onEnd:e.onDragEnd,group:e.dragGroup,animation:"300",dragClass:"dragClass",ghostClass:"ghostClass",chosenClass:"chosenClass"},{item:he(({element:l,index:H})=>[l._id==="empty"?(m(),C("div",Tt,[B(S,{description:"暂无数据",image:e.simpleImage},null,8,["image"])])):(m(),C("div",St,[x("div",At,[e.coverField.name?(m(),C("div",Vt,[e.getImageUrl(l.desformData,e.coverField.name)?(m(),C("img",{key:0,title:"点击预览",src:e.getImageUrl(l.desformData,e.coverField.name),onClick:p=>e.viewOnlineCellImage(l.desformData,e.coverField.name)},null,8,Et)):(m(),Y(S,{key:1,image:e.simpleImage,description:"暂无图片"},null,8,["image"]))])):be("",!0),x("div",Ot,[x("div",{class:"detail",onClick:Se(p=>e.handleEdit(l,H,F),["prevent"])},[x("div",Bt,[e.isComponent(e.titleField)&&e.getFieldValue(l.desformData,e.titleField.name)?(m(),Y(Ae(e.getFieldValue(l.desformData,e.titleField.name)),{key:0})):(m(),C("span",Mt,ie(e.getFieldValue(l.desformData,e.titleField.name)||"无标题"),1))]),x("div",Pt,[(m(!0),C(De,null,Te(e.itemFieldList,p=>(m(),C("div",Gt,[e.showLabel?(m(),C("span",Nt,ie(p.label)+":",1)):be("",!0),e.isComponent(p)&&e.getFieldValue(l.desformData,p.name)?(m(),Y(Ae(e.getFieldValue(l.desformData,p.name)),{key:1})):p.compType=="imgupload"?(m(),C("div",Qt,[B(I,{text:e.getFieldValue(l.desformData,p.name)},null,8,["text"])])):p.compType=="file-upload"?(m(),C("div",Ut,[B(M,{text:e.getFieldValue(l.desformData,p.name)},null,8,["text"])])):p.compType=="sub-table-design"?(m(),C("div",jt,[B(Z,{text:e.getFieldValue(l.desformData,p.name)},null,8,["text"])])):p.compType=="color"&&e.getFieldValue(l.desformData,p.name)?(m(),Y(z,{key:5,placement:"top",title:e.getFieldValue(l.desformData,p.name),getPopupContainer:O=>O==null?void 0:O.parentNode},{default:he(()=>[x("div",{style:Fe({width:"20px",height:"20px",backgroundColor:e.getFieldValue(l.desformData,p.name)})},null,4)]),_:2},1032,["title","getPopupContainer"])):(m(),C("span",zt,ie(e.getFieldValue(l.desformData,p.name)),1))]))),256))])],8,Rt),x("div",Ht,[B($,{trigger:["hover"],dropMenuList:e.getOperationList(l),overlayStyle:{width:"150px"},popconfirm:""},{default:he(()=>[B(ne)]),_:2},1032,["dropMenuList"])])])])]))]),_:2},1032,["modelValue","onUpdate:modelValue","move","onEnd","group"])]),_:2},1032,["cardType","loadNext"]),e.ifAdd()?(m(),C("div",{key:0,class:"footer",onClick:Se(l=>e.handleAdd(F.value),["prevent"])},[B(ee)],8,Jt)):be("",!0)])}),256))]))])],4),x("div",null,[B(te,{index:e.currentIndex,total:e.dataPageTotal,showComment:e.showComment,showFiles:e.showFiles,showDataLog:e.showDataLog,showRecordCopy:e.showCreateBtn,showRecordShare:e.showRecordShare,showRecordSysPrint:e.showRecordSysPrint,showDesignFormBtn:e.showDesignFormBtn,defaultFormData:e.defaultFormData,onRegister:e.registerDataModal,onSuccess:e.onSuccess,onGotoRecord:e.onGoToRecord},null,8,["index","total","showComment","showFiles","showDataLog","showRecordCopy","showRecordShare","showRecordSysPrint","showDesignFormBtn","defaultFormData","onRegister","onSuccess","onGotoRecord"])])],64)}const mo=lt(Ft,[["render",Kt],["__scopeId","data-v-1846d27d"]]);export{mo as default};
