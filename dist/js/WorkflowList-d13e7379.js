var $e=Object.defineProperty,He=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var te=(l,r,i)=>r in l?$e(l,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[r]=i,oe=(l,r)=>{for(var i in r||(r={}))Le.call(r,i)&&te(l,i,r[i]);if(ee)for(var i of ee(r))Pe.call(r,i)&&te(l,i,r[i]);return l},ne=(l,r)=>He(l,Ie(r));var F=(l,r,i)=>new Promise((c,b)=>{var p=k=>{try{z(i.next(k))}catch(D){b(D)}},g=k=>{try{z(i.throw(k))}catch(D){b(D)}},z=k=>k.done?c(k.value):Promise.resolve(k.value).then(p,g);z((i=i.apply(l,r)).next())});import{d as ie,av as Be,c as Oe,f as _,r as A,w as Ae,o as We,V as y,a6 as T,a7 as j,k as a,ai as f,a5 as o,ae as $,u as d,E as Re,z as Ve,F as W,am as qe,a8 as se,ak as M,af as ae,q as Qe,A as Ge,a3 as Je,a4 as Ke}from"./vue-vendor-24c7dc61.js";import Xe from"./RightChat-d63bc999.js";import{e as le,a as Ze,b3 as et,k as tt,l as ot}from"./index-831af9dd.js";import{l as H}from"./Workflow.data-a3a9f000.js";import{g as nt,a as st,b as at,o as lt,c as it,d as ct,e as rt}from"./Workflow.api-9dbd14ca.js";import ut from"./WorkflowForm-9c13d667.js";import"./index-1c3affea.js";import{U as dt}from"./UserAvatar-1a3df675.js";import{u as pt}from"./useAppInfo-0243bc57.js";import ft from"./DeleteConfirm-a2711ca5.js";import{a as ce,c as re,n as mt,bL as _t}from"./antd-vue-vendor-0d72f01e.js";import vt from"./HeaderUserIcon-36774302.js";import{u as ht}from"./useUndeveloped-598c4bd7.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./low.app.api-97fc250a.js";import"./useAppTheme-3409245c.js";var I={exports:{}},go=I.exports;(function(l,r){(function(i,c){l.exports=c()})(re,function(){"use strict";return function(i,c,b){c.prototype.isYesterday=function(){var p="YYYY-MM-DD",g=b().subtract(1,"day");return this.format(p)===g.format(p)}}})})(I,I.exports);var wt=I.exports;const yt=ce(wt);var L={exports:{}},ko=L.exports;(function(l,r){(function(i,c){l.exports=c()})(re,function(){"use strict";return function(i,c,b){c.prototype.isToday=function(){var p="YYYY-MM-DD",g=b();return this.format(p)===g.format(p)}}})})(L,L.exports);var gt=L.exports;const kt=ce(gt),R=l=>(Je("data-v-b2f5744f"),l=l(),Ke(),l),xt={class:"container"},bt={style:{display:"flex","flex-direction":"column"}},Ct={class:"align-item-center pointer gray-bd flex-flow"},Tt=R(()=>o("div",{class:"top-application-name flex"},[o("span",null,"自动化工作流")],-1)),Dt={class:"top-right"},St={class:"search icon-mask"},Mt={class:"help icon-mask"},Yt={href:"http://help.qiaoqiaoyun.com",target:"_blank"},Nt={style:{"margin-left":"10px"}},Ft={class:"workflow-header flex-column"},jt=["onClick"],zt={class:"workflow-label ellipsis flex"},Et={class:"gray-9e workflow-num"},Ut={key:1,class:"workflow-line"},$t={class:"workflow-right"},Ht={class:"workflow-right-box"},It={class:"workflow-right-search"},Lt=R(()=>o("div",{class:"workflow-search",style:{width:"200px"}},null,-1)),Pt={style:{width:"200px",float:"right"}},Bt=R(()=>o("div",{class:"workflow-right-title"},[o("div",{class:"flow-name"},"流程名称"),o("div",{class:"flow-type"},"类型"),o("div",{class:"flow-type"},"表单名称"),o("div",{class:"flow-status"},"状态"),o("div",{class:"flow-createby"},"创建者"),o("div",{class:"flow-action-title"})],-1)),Ot=["onClick"],At=["title"],Wt={class:"flow-type"},Rt={class:"flow-type"},Vt={class:"flow-status"},qt={style:{"font-size":"12px",color:"#9e9e9e","margin-left":"10px","vertical-align":"middle"}},Qt={class:"flow-createby"},Gt={class:"flow-action-title flow-action"},Jt=ie({name:"workflow-list"}),Kt=ie(ne(oe({},Jt),{props:{applicationName:{type:String,default:"自动化工作流"},applicationIcon:{type:String,default:"ant-design:appstore-outlined"},iconBackground:{type:String,default:"rgb(76, 175, 80)"}},setup(l){const r=l;Be(e=>({"5c096490":O.value}));const{tipUndeveloped:i}=ht(),c=Oe("$dayjs");c.extend(kt),c.extend(yt);function b(e){let t="",n="YYYY-MM-DD hh:mm:ss",u=!1,w=!1,U=!1;if(e.processDeployTime){if(w=!0,t=c(e.processDeployTime,n),e.updateTime){let S=c(e.processDeployTime).unix();c(e.updateTime).unix()>S&&(U=!0,t=c(e.updateTime,n))}}else e.updateTime?(t=c(e.updateTime,n),u=!0):e.createTime&&(t=c(e.createTime,n));if(!t)return"";let C="";if(U?C="更新未发布":C=w?" 发布":u?" 更新":" 创建",t.isToday())return"今天 "+t.format("H:mm")+C;if(t.isYesterday())return"昨天 "+t.format("H:mm")+C;{let S=c().year();return S&&t.year()==S?t.format("M月D日 H:mm")+C:t.format("YY年M月D日 H:mm")+C}}const{lowAppInfo:p,backAppMain:g,initLowAppInfo:z}=pt();function k(e){E.value=!1,H.forEach((t,n)=>{t.startType==e&&(Y.value=n)}),h(e)}const{createMessage:D,createInfoModal:ue}=Ze(),V=_([]),Y=_(0),P=_(!1),x=_({total:0,current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:(e,t)=>t[0]+"-"+t[1]+" 共"+e+"条",showQuickJumper:!0,showSizeChanger:!0,onChange:me,showSizeChange:_e}),v=A({tableEvent:0,timerEvent:0,dateFieldEvent:0,userEvent:0,subEvent:0,buttonEvent:0,manual:0,all:0});function de(e){let t=v.all;return e.startType&&(t=v[e.startType]),t>0?t:""}const q=_("ant-design:table-outlined"),[pe,{openModal:Q}]=le(),N=A({processName:"",processType:""}),E=_(!1),fe=_(),G=_(0),J=_(0);h("tableEvent");function me(e,t){x.value.current=e,x.value.pageSize=t,h()}function _e(e,t){x.value.pageSize=t,h()}function h(e){P.value=!0;let t={column:"createTime",order:"desc",pageNo:x.value.current,pageSize:x.value.pageSize,processDesginType:"mini",processName:`${N.processName}`,processType:N.processType};e||(e=H[Y.value].startType),e?(t.startType=e,v[e]=0):v.all=0,nt(t).then(n=>{n.success?(V.value=n.result.records,x.value.total=n.result.total,e?v[e]=n.result.total:v.all=n.result.total):D.warn(n.message)}).finally(()=>{P.value=!1})}function ve(e,t){Y.value=e,q.value=t.icon;let n=t.startType;x.value.current=1,h(n)}const he=[{value:"add|update",label:"当新增或更新记录时"},{value:"update",label:"仅更新记录时"},{value:"add",label:"仅新增记录时"},{value:"delete",label:"删除记录时"}];function we(e,t){return t.startType=="buttonEvent"?e?"表单按钮点击时":"按钮点击时":et(he,e)}function ye(e,t){t=="1"?lt(e):it(e)}function Xt(e){N.processType=e,h()}function ge(e){x.value.current=1,h()}function ke(e){Q(!0,{isUpdate:!0,id:e.id,startType:e.startType,toHistory:1})}function xe(e){ue({title:`复制工作流“${e.processName}”`,content:"将复制目标工作流的所有节点和配置",width:480,okText:"复制",cancelText:"取消",okCancel:!0,onOk:function(){be(e.id)},onCancel:function(){}})}function be(e){return F(this,null,function*(){yield ct({id:e}),h()})}const[Ce,{openModal:Te}]=le(),K=A({title:"",text:"工作流将被彻底删除，且无法恢复。请确认您要执行此操作"});function De(e){K.title=`删除工作流“${e.processName}”`,Te(!0,{id:e.id})}function Se(e){return F(this,null,function*(){yield rt(e),h()})}function Me(e){Q(!0,{isUpdate:!0,id:e.id,startType:e.startType})}function Ye(){if(d(G)>d(J)){D.error("流程创建已达上限，请升级会员");return}E.value=!0}function Ne(){E.value=!1}const B=_(window.innerHeight-70);function X({startType:e}){let t=H.filter(n=>n.startType==e);return t.length>0?t[0].icon:q.value}Ae(p,e=>{e&&e.id&&Fe(e.id)},{immediate:!0,deep:!0});function Fe(e){return F(this,null,function*(){Object.keys(v).map(w=>{v[w]=0});let t=0;const n=yield st(e);if(n&&n.length>0)for(let w of n)v[w.startType]=w.count,t=t+w.count;v.all=t;const u=yield at();u&&(G.value=u.appFlowCountUsed?u.appFlowCountUsed:0,J.value=u.maxWorkFlowCount?u.maxWorkFlowCount:0)})}function je(e){return F(this,null,function*(){const t="/act/process/extActProcess/deployProcess";let n={id:e.id};yield tt.put({url:t,params:n}),h()})}const O=_("300px");return O.value=window.innerHeight-250+"px",We(()=>{window.onresize=()=>(()=>{O.value=window.innerHeight-250+"px",B.value=window.innerHeight-70})()}),(e,t)=>{const n=y("Icon"),u=y("a-tooltip"),w=y("a-button"),U=y("a-input"),C=y("a-switch"),S=y("a-list-item"),Z=y("a-list"),ze=y("a-layout-content"),Ee=y("a-layout"),Ue=y("mini-des-flow-modal");return T(),j(W,null,[a(Ee,{style:{height:"100%"}},{default:f(()=>[a(ze,null,{default:f(()=>[o("div",xt,[o("div",bt,[o("div",{class:"top-header flex-flow align-item-center",style:$({background:d(p).iconBackColor})},[o("div",Ct,[a(n,{icon:"ant-design:left-outlined",style:{"font-size":"16px"},onClick:d(g)},null,8,["onClick"])]),o("div",{class:"top-application pointer",onClick:t[0]||(t[0]=(...s)=>d(g)&&d(g)(...s))},[a(u,{title:"应用："+d(p).appName,placement:"bottom"},{default:f(()=>[a(n,{icon:d(p).iconType,style:{"font-size":"23px","border-radius":"6px"}},null,8,["icon"])]),_:1},8,["title"])]),Tt,o("div",null,[a(w,{class:"top-application-button",preIcon:"ant-design:plus-outlined",style:$({background:d(p).iconBackColor}),onClick:Ye},{default:f(()=>[Re("新建工作流")]),_:1},8,["style"])]),o("div",Dt,[o("div",St,[a(u,{title:"搜索",placement:"bottom"},{default:f(()=>[a(d(mt),{onClick:t[1]||(t[1]=Ve(s=>d(i)(),["prevent"]))})]),_:1})]),o("div",Mt,[o("a",Yt,[a(u,{title:"帮助",placement:"bottom"},{default:f(()=>[a(d(_t))]),_:1})])]),o("div",Nt,[a(vt)])])],4)]),o("div",{class:"workflow-list",style:$({height:B.value+"px"})},[o("div",{class:"list-shadow",style:$({height:B.value+"px"})},[o("ul",Ft,[(T(!0),j(W,null,qe(d(H),(s,m)=>(T(),j(W,null,[s.label!=="diagonalLine"?(T(),j("li",{key:0,onClick:Zt=>ve(m,s),class:se(m==Y.value?"active":"")},[o("span",{class:se(m==Y.value?"active-line":"")},null,2),a(n,{icon:s.icon,class:"workflow-icon"},null,8,["icon"]),o("span",zt,M(s.label),1),o("span",Et,M(de(s)),1)],10,jt)):(T(),j("div",Ut))],64))),256))]),o("div",$t,[o("div",Ht,[o("div",It,[Lt,o("div",Pt,[a(U,{placeholder:"请输入流程名称",value:N.processName,"onUpdate:value":t[2]||(t[2]=s=>N.processName=s),onChange:ge},null,8,["value"])])]),a(Z,{class:"list-background","data-source":V.value,loading:P.value,pagination:x.value},{header:f(()=>[Bt]),renderItem:f(({item:s})=>[a(S,{class:"flow-list-item"},{default:f(()=>[o("div",{class:"flow-name",onClick:m=>Me(s)},[s.openStatus==0?(T(),ae(n,{key:0,icon:X(s),class:"flow-item-icon item-close-icon"},null,8,["icon"])):(T(),ae(n,{key:1,icon:X(s),class:"flow-item-icon item-open-icon"},null,8,["icon"])),o("span",{class:"ellipsis flow-item-name",title:s.processName},M(s.processName),9,At)],8,Ot),o("div",Wt,M(we(s.startEventType,s)),1),o("div",Rt,M(s.formTableTxt),1),o("div",Vt,[a(C,{"checked-children":"开启","un-checked-children":"暂停","checked-value":1,"un-checked-value":0,checked:s.openStatus,"onUpdate:checked":m=>s.openStatus=m,onChange:m=>ye(s.processKey,m)},null,8,["checked","onUpdate:checked","onChange"]),o("span",qt,M(b(s)),1)]),o("div",Qt,[a(dt,{username:s.createBy},null,8,["username"])]),o("div",Gt,[a(u,{title:"发布",placement:"bottom"},{default:f(()=>[a(n,{icon:"ant-design:send-outlined",class:"pointer flow-action-icon",onClick:m=>je(s)},null,8,["onClick"])]),_:2},1024),a(u,{title:"历史",placement:"bottom"},{default:f(()=>[a(n,{icon:"ant-design:history-outlined",class:"pointer flow-action-icon",onClick:m=>ke(s)},null,8,["onClick"])]),_:2},1024),a(u,{title:"复制",placement:"bottom"},{default:f(()=>[a(n,{icon:"ant-design:copy-outlined",class:"pointer flow-action-icon",onClick:m=>xe(s)},null,8,["onClick"])]),_:2},1024),a(u,{title:"删除",placement:"bottom"},{default:f(()=>[a(n,{icon:"ant-design:delete-outlined",class:"pointer flow-action-icon",onClick:m=>De(s)},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)]),_:1},8,["data-source","loading","pagination"])])])],4)],4)])]),_:1}),a(Xe,{titleHeight:0})]),_:1}),Qe(o("div",null,[a(ut,{ref_key:"workflowRef",ref:fe,onBack:Ne,onClose:k},null,512)],512),[[Ge,E.value]]),a(Ue,{onRegister:d(pe)},null,8,["onRegister"]),a(ft,{deleteText:K,onRegister:d(Ce),onDelete:Se},null,8,["deleteText","onRegister"])],64)}}}));const xo=ot(Kt,[["__scopeId","data-v-b2f5744f"]]);export{xo as default};
