var S=(t,l,m)=>new Promise((y,B)=>{var g=a=>{try{p(m.next(a))}catch(_){B(_)}},o=a=>{try{p(m.throw(a))}catch(_){B(_)}},p=a=>a.done?y(a.value):Promise.resolve(a.value).then(g,o);p((m=m.apply(t,l)).next())});import{c8 as A}from"./antd-vue-vendor-0d72f01e.js";import{d as z,c as $,f as b,r as P,a3 as V,a4 as H,a5 as u,V as F,a6 as f,af as D,ai as i,k as n,E as c,a7 as E,F as R,am as U,ak as O,W as M,a8 as N}from"./vue-vendor-24c7dc61.js";import{B as j}from"./index-1c3affea.js";import T from"./HeaderTag-d6c7596f.js";import{C as q}from"./ComponentIcon-f1bbb90f.js";import{j as W,a as G,l as J}from"./index-831af9dd.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const K=z({name:"ImportFieldSetModal",components:{BasicModal:j,CloudUploadOutlined:A,HeaderTag:T,ComponentIcon:q},emits:["register","back","next"],setup(t,{emit:l}){let m=$("globalColumnList",void 0);const y=b([]),B=b([]),g=b([]),o=P({status:!1,type:"skip",field:[],triggerProcess:!1,skipErrorRow:!1}),[p,{closeModal:a}]=W(s=>S(this,null,function*(){let v=[];if(s.titleList&&s.titleList.length>0)for(let d of s.titleList)v.push(d);y.value=v,_(),g.value=s.viewFieldOptions}));function _(){let s=[],v=y.value;if(m)for(let d of m.value){let k=[];v.indexOf(d.name)>=0&&(k=d.name);let r={name:d.name,model:d.model,type:d.type,disabled:C(d),excelColumn:k};d.type=="link-record"&&(r.link="title"),s.push(r)}B.value=s}function h(){a(),l("back")}const{createMessage:x,notification:w}=G();function I(){let s=B.value,v={},d=!1;for(let r of s)r.excelColumn&&r.excelColumn.length>0&&(d=!0,r.type=="link-record"&&r.link=="id"?v[r.name+"_"+r.link]=r.excelColumn:v[r.name]=r.excelColumn);if(d===!1){x.warning("未配置excel的列映射");return}let k={relationMap:v,duplicateCheckStatus:!1,duplicateDataHandle:"",duplicateBasisField:"",triggerProcess:o.triggerProcess,skipErrorRow:o.skipErrorRow};if(o.status===!0)if(o.field&&o.field.length>0)k.duplicateCheckStatus=!0,k.duplicateDataHandle=o.type,k.duplicateBasisField=o.field;else{x.warning("请选择依据字段");return}l("next",k)}function e(s){return s.type=="link-record"}function C(s){return s.type=="sub-table-design"||s.type=="link-record"&&s.isSubTable===!0}return{registerModal:p,closeModal:a,next:I,back:h,fieldList:B,leftSelectOptions:y,duplicateCheckInfo:o,viewFieldOptions:g,isLinkRecord:e}}});const L=t=>(V("data-v-50c4ea79"),t=t(),H(),t),Q={style:{display:"flex","flex-direction":"column",margin:"0 10px"}},X=L(()=>u("div",{style:{"font-weight":"700",display:"flex"}},[u("div",{style:{flex:"1"}},"Excel列"),u("div",{style:{width:"100px"}}),u("div",{style:{flex:"1"}},"工作表字段")],-1)),Y={style:{"margin-top":"10px",position:"relative",overflow:"hidden",height:"270px"}},Z={class:"field-list-container",style:{right:"-10px","z-index":"9999"}},ee={class:"item"},te={style:{flex:"1"}},ue={class:"right",style:{flex:"1"}},le={class:"content"},oe={style:{"margin-left":"10px",flex:"1"},class:"ellipsis"},ie={key:0,style:{color:"#9e9e9e","font-size":"12px"}},ne={key:1,style:{display:"flex","align-items":"center","flex-direction":"row"}},se=L(()=>u("span",null," 匹配字段: ",-1)),ae={style:{"margin-top":"5px",display:"flex","flex-direction":"row","align-items":"center"}},de=L(()=>u("div",{style:{"margin-left":"5px"}},"依据字段",-1)),re={style:{"margin-left":"5px"}},ce={style:{"margin-left":"30px"}},pe={style:{"margin-top":"10px",display:"flex"}};function fe(t,l,m,y,B,g){const o=F("a-select-option"),p=F("a-select"),a=F("Icon"),_=F("ComponentIcon"),h=F("a-checkbox"),x=F("a-tooltip"),w=F("a-button"),I=F("BasicModal");return f(),D(I,{maxHeight:500,title:"数据导入 - 建立映射（3/3）",onRegister:t.registerModal,width:960,canFullscreen:!1,destroyOnClose:"",closable:""},{footer:i(()=>[n(w,{onClick:l[5]||(l[5]=e=>t.back())},{default:i(()=>[c("上一步 ")]),_:1}),n(w,{style:{"margin-left":"15px"},type:"primary",onClick:l[6]||(l[6]=e=>t.next())},{default:i(()=>[c("开始导入 ")]),_:1})]),default:i(()=>[u("div",Q,[X,u("div",Y,[u("div",Z,[(f(!0),E(R,null,U(t.fieldList,e=>(f(),E("div",ee,[u("div",te,[e.disabled?M("",!0):(f(),D(p,{key:0,style:{width:"100%"},placeholder:"请选择",value:e.excelColumn,"onUpdate:value":C=>e.excelColumn=C,allowClear:""},{default:i(()=>[(f(!0),E(R,null,U(t.leftSelectOptions,C=>(f(),D(o,{value:C},{default:i(()=>[c(O(C),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value"]))]),u("div",{class:N(["center-arrow",e.excelColumn&&e.excelColumn.length>0?"active":""])},[e.disabled?M("",!0):(f(),D(a,{key:0,icon:"ant-design:arrow-left-outlined",size:22}))],2),u("div",ue,[u("div",le,[u("div",null,[n(_,{type:e.type},null,8,["type"])]),u("div",oe,O(e.name),1),e.disabled?(f(),E("div",ie," 此字段不支持建立映射 ")):t.isLinkRecord(e)?(f(),E("div",ne,[se,n(p,{value:e.link,"onUpdate:value":C=>e.link=C,size:"small",style:{width:"100px","margin-left":"10px"}},{default:i(()=>[n(o,{value:"id"},{default:i(()=>[c("记录ID")]),_:1}),n(o,{value:"title"},{default:i(()=>[c("标题字段")]),_:1})]),_:2},1032,["value","onUpdate:value"])])):M("",!0)])])]))),256))])]),u("div",ae,[u("div",null,[n(h,{checked:t.duplicateCheckInfo.status,"onUpdate:checked":l[0]||(l[0]=e=>t.duplicateCheckInfo.status=e)},{default:i(()=>[c("识别重复记录")]),_:1},8,["checked"])]),u("div",null,[n(p,{value:t.duplicateCheckInfo.type,"onUpdate:value":l[1]||(l[1]=e=>t.duplicateCheckInfo.type=e),style:{width:"85px","margin-left":"5px"}},{default:i(()=>[n(o,{value:"skip",title:"忽略重复数据"},{default:i(()=>[c("跳过")]),_:1}),n(o,{value:"cover",title:"对重复记录更新为excel中的数据，其他数据新增"},{default:i(()=>[c("覆盖")]),_:1}),n(o,{value:"update",title:"仅对工作表中已有数据更新，其他数据不予处理"},{default:i(()=>[c("仅更新")]),_:1})]),_:1},8,["value"])]),de,u("div",re,[n(p,{value:t.duplicateCheckInfo.field,"onUpdate:value":l[2]||(l[2]=e=>t.duplicateCheckInfo.field=e),placeholder:"请选择依据字段",style:{width:"150px"},options:t.viewFieldOptions},null,8,["value","options"])]),u("div",ce,[n(h,{checked:t.duplicateCheckInfo.triggerProcess,"onUpdate:checked":l[3]||(l[3]=e=>t.duplicateCheckInfo.triggerProcess=e)},{default:i(()=>[c("导入触发工作流")]),_:1},8,["checked"])])]),u("div",pe,[u("span",null,[n(h,{checked:t.duplicateCheckInfo.skipErrorRow,"onUpdate:checked":l[4]||(l[4]=e=>t.duplicateCheckInfo.skipErrorRow=e)},{default:i(()=>[c(" 跳过错误行 ")]),_:1},8,["checked"])]),u("span",null,[n(x,{placement:"top",title:"未勾选时，对于错误的数据仅跳过错误字段，其他字段仍然导入。勾选后将跳过整行数据。"},{default:i(()=>[n(a,{icon:"ant-design:question-circle-outlined",size:16,style:{color:"#555","margin-top":"2px"}})]),_:1})])])])]),_:1},8,["onRegister"])}const Ee=J(K,[["render",fe],["__scopeId","data-v-50c4ea79"]]);export{Ee as default};
