var re=Object.defineProperty;var W=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var G=(n,s,t)=>s in n?re(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t,j=(n,s)=>{for(var t in s||(s={}))de.call(s,t)&&G(n,t,s[t]);if(W)for(var t of W(s))ue.call(s,t)&&G(n,t,s[t]);return n};var T=(n,s,t)=>new Promise((e,I)=>{var g=l=>{try{y(t.next(l))}catch(m){I(m)}},c=l=>{try{y(t.throw(l))}catch(m){I(m)}},y=l=>l.done?e(l.value):Promise.resolve(l.value).then(g,c);y((t=t.apply(n,s)).next())});import{B as _e}from"./index-1c3affea.js";import{aP as V,aQ as fe,av as ee,aR as ye,aS as me,aT as he,n as pe,m as ve}from"./antd-vue-vendor-0d72f01e.js";import{e as R,r as xe,h as Se,I as te,a5 as x,V as a,a6 as v,af as k,ai as f,k as u,ae as B,ak as A,a7 as E,W as M,f as U,w as ne,u as J,E as X,F as Y,am as Z,a8 as H}from"./vue-vendor-24c7dc61.js";import{ap as se,l as P,k as N,a7 as Ue,j as ge}from"./index-831af9dd.js";const Le={name:"UserList",props:{multi:{type:Boolean,default:!1},dataList:{type:Array,default:()=>[]},depart:{type:Boolean,default:!1},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]}},components:{UserOutlined:V},emits:["selected","unSelect"],setup(n,{emit:s}){function t(i,h){i&&l(i),y[h.id]===!0?s("unSelect",h.id):s("selected",te(h))}function e(i){return i?i.substr(0,2):""}const I=R(()=>n.depart===!0?{flex:1}:{display:"none"}),g=R(()=>n.depart===!0?{width:"200px"}:{flex:1});function c(i){}const y=xe({});Se(()=>{let i=n.dataList;if(!i||i.length===0)return;let h=n.selectedIdList;for(let L of i)h.indexOf(L.id)>=0?y[L.id]=!0:y[L.id]=!1});function l(i){i.preventDefault(),i.stopPropagation()}const m=R(()=>n.dataList);return{onClickUser:t,getTwoText:e,departStyle:I,nameStyle:g,onChangeChecked:c,checkStatus:y,showDataList:m,getFileAccessHttpUrl:se}}};const Ie=["onClick"],ke={style:{"margin-left":"10px"}},Ce=["title"],we=x("div",{style:{width:"1px"}},null,-1);function De(n,s,t,e,I,g){const c=a("a-checkbox"),y=a("a-radio"),l=a("a-avatar"),m=a("Icon"),i=a("UserOutlined"),h=a("a-list-item"),L=a("a-list");return v(),k(L,{"item-layout":"horizontal","data-source":e.showDataList},{renderItem:f(({item:r})=>[u(h,{style:{padding:"3px 0"}},{default:f(()=>[x("div",{class:"user-select-user-info",onClick:p=>e.onClickUser(p,r)},[x("div",ke,[t.multi?(v(),k(c,{key:0,checked:e.checkStatus[r.id],"onUpdate:checked":p=>e.checkStatus[r.id]=p},null,8,["checked","onUpdate:checked"])):(v(),k(y,{key:1,checked:e.checkStatus[r.id],"onUpdate:checked":p=>e.checkStatus[r.id]=p},null,8,["checked","onUpdate:checked"]))]),x("div",null,[r.avatar?(v(),k(l,{key:0,src:e.getFileAccessHttpUrl(r.avatar)},null,8,["src"])):r.avatarIcon?(v(),k(l,{key:1,class:"ant-btn-primary"},{icon:f(()=>[u(m,{icon:"ant-design:"+r.avatarIcon,style:{"margin-top":"4px","font-size":"24px"}},null,8,["icon"])]),_:2},1024)):(v(),k(l,{key:2},{icon:f(()=>[u(i)]),_:1}))]),x("div",{style:B(e.nameStyle)},A(r.realname),5),x("div",{style:B(e.departStyle),class:"ellipsis",title:r.orgCodeTxt},A(r.orgCodeTxt),13,Ce),we],8,Ie)]),_:2},1024)]),_:1},8,["data-source"])}const q=P(Le,[["render",De]]);const Te={name:"SelectedUserItem",components:{UserOutlined:V,MinusCircleFilled:fe,CloseOutlined:ee,TagsOutlined:ye,TeamOutlined:me},props:{info:{type:Object,default:()=>{}},query:{type:Boolean,default:!1}},emits:["unSelect"],setup(n,{emit:s}){function t(I){I.preventDefault(),I.stopPropagation(),s("unSelect",n.info.id)}return{showClose:R(()=>n.query===!0),removeSelect:t,getFileAccessHttpUrl:se}}},be={class:"user-selected-item"},Oe={style:{display:"flex","flex-direction":"row",height:"24px","border-radius":"12px","padding-right":"10px","vertical-align":"middle","background-color":"#f5f5f5"}},Ke={style:{width:"24px",height:"24px","line-height":"20px","margin-right":"3px",display:"inline-block"}},Re={style:{height:"24px","line-height":"24px"},class:"ellipsis"},Fe={key:0,class:"icon-close"},ze={key:0,class:"icon-remove"};function Be(n,s,t,e,I,g){const c=a("a-avatar"),y=a("Icon"),l=a("team-outlined"),m=a("TagsOutlined"),i=a("UserOutlined"),h=a("CloseOutlined"),L=a("MinusCircleFilled");return v(),E("div",be,[x("div",Oe,[x("span",Ke,[t.info.avatar?(v(),k(c,{key:0,src:e.getFileAccessHttpUrl(t.info.avatar),size:24},null,8,["src"])):t.info.avatarIcon?(v(),k(c,{key:1,class:"ant-btn-primary",size:24},{icon:f(()=>[u(y,{icon:"ant-design:"+t.info.avatarIcon,style:{"font-size":"16px","margin-top":"4px"}},null,8,["icon"])]),_:1})):t.info.selectType=="sys_role"?(v(),k(c,{key:2,size:24,style:{"background-color":"rgb(255, 173, 0)"}},{icon:f(()=>[u(l,{style:{"font-size":"16px"}})]),_:1})):t.info.selectType=="sys_position"?(v(),k(c,{key:3,size:24,style:{"background-color":"rgb(245, 34, 45)"}},{icon:f(()=>[u(m,{style:{"font-size":"16px"}})]),_:1})):(v(),k(c,{key:4,size:24},{icon:f(()=>[u(i)]),_:1}))]),x("div",Re,A(t.info.realname||t.info.name),1),e.showClose?(v(),E("div",Fe,[u(h,{onClick:e.removeSelect},null,8,["onClick"])])):M("",!0)]),e.showClose?M("",!0):(v(),E("div",ze,[u(L,{onClick:e.removeSelect},null,8,["onClick"])]))])}const Ae=P(Te,[["render",Be]]),Ee={name:"DepartUserList",components:{UserList:q,FolderFilled:he},props:{searchText:{type:String,default:""},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]},multi:{type:Boolean,default:!1}},emits:["loaded","selected","unSelect"],setup(n,{emit:s}){function t(d){return T(this,null,function*(){const S="/sys/sysDepart/queryDepartTreeSync";let _={};return d&&(_.pid=d),yield N.get({url:S,params:_},{isTransformResponse:!1})})}function e(){return T(this,null,function*(){const d=yield t();if(d.success){let S=d.result;g.value=S,I(S)}i()})}function I(d){let S=[];d&&d.length>0&&(S=d.map(_=>({value:_.id,label:_.departName}))),s("loaded",S)}e();const g=U([]),c=U([]),y=U([]),l=U("");function m(d,S){let _=S.node.dataRef;c.value=[_.key];let F=d[0];l.value=F,w()}function i(){l.value=""}function h(d){return T(this,null,function*(){const S=yield t(d.eventKey);if(S.success){let _=S.result;d.dataRef.children=[..._],g.value=[...g.value]}})}const L=U(300);L.value=window.innerHeight-300;const r=R(()=>({"overflow-y":"auto","max-height":L.value+"px"})),p=U([]);function w(){return T(this,null,function*(){const d="/sys/user/selectUserList";let S={pageNo:1,pageSize:99};n.searchText&&(S.keyword=n.searchText),l.value&&(S.departId=l.value),n.excludeUserIdList&&n.excludeUserIdList.length>0&&(S.excludeUserIdList=n.excludeUserIdList.join(","));const _=yield N.get({url:d,params:S},{isTransformResponse:!1});if(_.success){const{records:F}=_.result;p.value=F}})}ne(()=>n.searchText,()=>{w()});function D(d){s("selected",d)}function b(d){s("unSelect",d)}return{containerStyle:r,treeData:g,selectedKeys:c,expandedKeys:y,onSelect:m,loadChildren:h,onSelectUser:D,unSelectUser:b,userDataList:p}}},Me={style:{"margin-left":"5px"}};function Ne(n,s,t,e,I,g){const c=a("FolderFilled"),y=a("a-tree"),l=a("a-col"),m=a("user-list"),i=a("a-row");return v(),k(i,null,{default:f(()=>[u(l,{span:12},{default:f(()=>[x("div",{style:B(e.containerStyle)},[e.treeData.length>0?(v(),k(y,{key:0,"load-data":e.loadChildren,showIcon:"",autoExpandParent:"",treeData:e.treeData,selectedKeys:e.selectedKeys,expandedKeys:e.expandedKeys,"onUpdate:expandedKeys":s[0]||(s[0]=h=>e.expandedKeys=h),onSelect:e.onSelect},{title:f(({title:h,key:L})=>[u(c,{style:{color:"#9e9e9e"}}),x("span",Me,A(h),1)]),_:1},8,["load-data","treeData","selectedKeys","expandedKeys","onSelect"])):M("",!0)],4)]),_:1}),u(l,{span:12,style:{"padding-left":"10px"}},{default:f(()=>[x("div",{style:B(e.containerStyle)},[u(m,{multi:t.multi,excludeUserIdList:t.excludeUserIdList,dataList:e.userDataList,selectedIdList:t.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["multi","excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])],4)]),_:1})]),_:1})}const Pe=P(Ee,[["render",Ne]]),je={name:"RoleUserList",components:{UserList:q,UserOutlined:V},props:{searchText:{type:String,default:""},selectedIdList:{type:Array,default:()=>[]},excludeUserIdList:{type:Array,default:()=>[]},multi:{type:Boolean,default:!1}},emits:["selected","unSelect"],setup(n,{emit:s}){const t=U([]);function e(){return T(this,null,function*(){const r="/sys/role/listByTenant";let p={order:"desc",column:"createTime",pageSize:200},w=[];const D=yield N.get({url:r,params:p},{isTransformResponse:!1});if(D.success){const{records:b}=D.result;w=b.map(d=>({title:d.roleName,id:d.id,key:d.id}))}t.value=w})}e();const I=U([]),g=U("");function c(r,p){let w=p.node.dataRef;I.value=[w.key];let D=r[0];g.value=D,l()}const y=U([]);function l(){return T(this,null,function*(){const r="/sys/user/selectUserList";let p={pageNo:1,pageSize:99};n.searchText&&(p.keyword=n.searchText),g.value&&(p.roleId=g.value),n.excludeUserIdList&&n.excludeUserIdList.length>0&&(p.excludeUserIdList=n.excludeUserIdList.join(","));const w=yield N.get({url:r,params:p},{isTransformResponse:!1});if(w.success){const{records:D}=w.result;y.value=D}})}ne(()=>n.searchText,()=>{l()});function m(r){s("selected",r)}function i(r){s("unSelect",r)}const h=U(300);return h.value=window.innerHeight-300,{containerStyle:R(()=>({"overflow-y":"auto","max-height":h.value+"px"})),treeData:t,selectedKeys:I,onSelect:c,onSelectUser:m,unSelectUser:i,userDataList:y}}},He={style:{"margin-left":"5px"}};function Ve(n,s,t,e,I,g){const c=a("UserOutlined"),y=a("a-tree"),l=a("a-col"),m=a("user-list"),i=a("a-row");return v(),k(i,null,{default:f(()=>[u(l,{span:12},{default:f(()=>[x("div",{style:B(e.containerStyle)},[e.treeData.length>0?(v(),k(y,{key:0,showIcon:"",treeData:e.treeData,selectedKeys:e.selectedKeys,onSelect:e.onSelect},{title:f(({title:h,key:L})=>[u(c,{style:{color:"#9e9e9e"}}),x("span",He,A(h),1)]),_:1},8,["treeData","selectedKeys","onSelect"])):M("",!0)],4)]),_:1}),u(l,{span:12,style:{"padding-left":"10px"}},{default:f(()=>[x("div",{style:B(e.containerStyle)},[u(m,{multi:t.multi,excludeUserIdList:t.excludeUserIdList,dataList:e.userDataList,selectedIdList:t.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["multi","excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])],4)]),_:1})]),_:1})}const qe=P(je,[["render",Ve]]),$="#{sys_user_code}",Qe={id:$,username:$,realname:"当前用户",avatarIcon:"idcard-outlined",avatarColor:"rgb(75 176 79)"},We=ve,Ge={name:"UserSelectModal",components:{BasicModal:_e,SearchOutlined:pe,CloseOutlined:ee,SelectedUserItem:Ae,UserList:q,DepartUserList:Pe,RoleUserList:qe,APagination:We},props:{multi:{type:Boolean,default:!1},getContainer:{type:Function,default:null},izExcludeMy:{type:Boolean,default:!1},inSuperQuery:{type:Boolean,default:!1}},emits:["selected","register"],setup(n,{emit:s}){const t=U("1"),e=U([]),I=Ue(),g=R(()=>{let o=e.value;return!o||o.length==0?[]:o.map(C=>C.id)}),c=U([]),[y]=ge(o=>{let C=o.list;C&&C.length>0?e.value=[...C]:e.value=[],o.excludeUserIdList?c.value=o.excludeUserIdList:c.value=[],n.izExcludeMy&&c.value.push(I.getUserInfo.id),z()});function l(){let o=te(e.value);s("selected",o)}const m=U(""),i=U([]);function h(o){i.value=[{value:"",label:"全部用户"},...o],m.value=""}function L(){z()}const r=U(!1),p=U("");function w(o){o&&Q(o),r.value=!0}function D(){z()}function b(o){o&&Q(o),p.value="",r.value=!1,z()}const d=U(1),S=U(0),_=U([]);function F(){return T(this,null,function*(){yield z()})}function z(){return T(this,null,function*(){const o="/sys/user/selectUserList";let C={pageNo:d.value,pageSize:10};p.value&&(C.keyword=p.value),m.value&&(C.departId=m.value),J(c)&&J(c).length>0&&(C.excludeUserIdList=c.value.join(","));const O=yield N.get({url:o,params:C},{isTransformResponse:!1});if(O.success){let{records:K,total:ie}=O.result;S.value=ie,ae(K),_.value=K}})}function ae(o){d.value==1&&n.inSuperQuery===!0&&o.unshift(j({},Qe))}function le(o){if(n.multi===!0){let C=e.value;g.value.indexOf(o.id)<0&&(C.push(j({},o)),e.value=C)}else e.value=[j({},o)]}function oe(o){let C=e.value,O=-1;for(let K=0;K<C.length;K++)if(C[K].id===o){O=K;break}O>=0&&(C.splice(O,1),e.value=C)}function ce(o){t.value=o}function Q(o){o.preventDefault(),o.stopPropagation()}return z(),{selectedDepart:m,departOptions:i,initDepartOptions:h,onDepartChange:L,register:y,handleOk:l,searchText:p,searchInputStatus:r,showSearchInput:w,onSearchUser:D,clearSearch:b,myActiveKey:t,onChangeTab:ce,pageNo:d,totalRecord:S,onPageChange:F,userDataList:_,selectedUserList:e,selectedIdList:g,onSelectUser:le,unSelectUser:oe,excludeUserIdList:c}}};const Je={style:{position:"relative","min-height":"350px"}},Xe={class:"my-tabs"},Ye={class:"selected-users",style:{width:"100%","overflow-x":"hidden"}},Ze={style:{display:"flex","justify-content":"space-between",width:"100%"}},$e={class:"select-user-page-info"};function et(n,s,t,e,I,g){const c=a("a-select-option"),y=a("a-select"),l=a("SearchOutlined"),m=a("CloseOutlined"),i=a("a-input"),h=a("user-list"),L=a("a-tab-pane"),r=a("depart-user-list"),p=a("role-user-list"),w=a("a-tabs"),D=a("SelectedUserItem"),b=a("a-pagination"),d=a("a-button"),S=a("BasicModal");return v(),k(S,{onRegister:e.register,getContainer:t.getContainer,canFullscreen:!1,title:"选择用户",width:600,wrapClassName:"j-user-select-modal2"},{footer:f(()=>[x("div",Ze,[x("div",$e,[e.myActiveKey=="1"?(v(),k(b,{key:0,current:e.pageNo,"onUpdate:current":s[3]||(s[3]=_=>e.pageNo=_),size:"small",total:e.totalRecord,"show-quick-jumper":"",onChange:e.onPageChange},null,8,["current","total","onChange"])):M("",!0)]),u(d,{type:"primary",onClick:e.handleOk},{default:f(()=>[X("确 定")]),_:1},8,["onClick"])])]),default:f(()=>[u(y,{value:e.selectedDepart,"onUpdate:value":s[0]||(s[0]=_=>e.selectedDepart=_),style:{width:"100%"},class:"depart-select",onChange:e.onDepartChange},{default:f(()=>[(v(!0),E(Y,null,Z(e.departOptions,_=>(v(),k(c,{value:_.value},{default:f(()=>[X(A(_.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"]),x("div",Je,[x("div",{class:H(e.searchInputStatus?"my-search all-width":"my-search")},[x("span",{class:H(e.searchInputStatus?"hidden":""),style:{"margin-left":"10px"}},[u(l,{style:{color:"#c0c0c0"},onClick:e.showSearchInput},null,8,["onClick"])],2),x("div",{style:{width:"100%"},class:H(e.searchInputStatus?"":"hidden")},[u(i,{value:e.searchText,"onUpdate:value":s[1]||(s[1]=_=>e.searchText=_),onPressEnter:e.onSearchUser,style:{width:"100%"},placeholder:"请输入用户名按回车搜索"},{prefix:f(()=>[u(l,{style:{color:"#c0c0c0"}})]),suffix:f(()=>[u(m,{title:"退出搜索",onClick:e.clearSearch},null,8,["onClick"])]),_:1},8,["value","onPressEnter"])],2)],2),x("div",Xe,[u(w,{activeKey:e.myActiveKey,"onUpdate:activeKey":s[2]||(s[2]=_=>e.myActiveKey=_),centered:!0,onChange:e.onChangeTab},{default:f(()=>[u(L,{key:"1",tab:"全部",forceRender:""},{default:f(()=>[u(h,{multi:t.multi,excludeUserIdList:e.excludeUserIdList,dataList:e.userDataList,selectedIdList:e.selectedIdList,depart:"",onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["multi","excludeUserIdList","dataList","selectedIdList","onSelected","onUnSelect"])]),_:1}),u(L,{key:"2",tab:"按部门",forceRender:""},{default:f(()=>[u(r,{searchText:e.searchText,selectedIdList:e.selectedIdList,excludeUserIdList:e.excludeUserIdList,onLoaded:e.initDepartOptions,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["searchText","selectedIdList","excludeUserIdList","onLoaded","onSelected","onUnSelect"])]),_:1}),u(L,{key:"3",tab:"按角色",forceRender:""},{default:f(()=>[u(p,{excludeUserIdList:e.excludeUserIdList,searchText:e.searchText,selectedIdList:e.selectedIdList,onSelected:e.onSelectUser,onUnSelect:e.unSelectUser},null,8,["excludeUserIdList","searchText","selectedIdList","onSelected","onUnSelect"])]),_:1})]),_:1},8,["activeKey","onChange"])]),x("div",Ye,[(v(!0),E(Y,null,Z(e.selectedUserList,_=>(v(),k(D,{info:_,onUnSelect:e.unSelectUser},null,8,["info","onUnSelect"]))),256))])])]),_:1},8,["onRegister","getContainer"])}const ot=P(Ge,[["render",et]]);export{Ae as S,ot as U,Qe as a,$ as m};
