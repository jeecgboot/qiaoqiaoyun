var Z=Object.defineProperty,j=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var $=(e,r,o)=>r in e?Z(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,y=(e,r)=>{for(var o in r||(r={}))te.call(r,o)&&$(e,o,r[o]);if(L)for(var o of L(r))oe.call(r,o)&&$(e,o,r[o]);return e},N=(e,r)=>j(e,ee(r));var C=(e,r,o)=>new Promise((h,P)=>{var S=i=>{try{a(o.next(i))}catch(g){P(g)}},l=i=>{try{a(o.throw(i))}catch(g){P(g)}},a=i=>i.done?h(i.value):Promise.resolve(i.value).then(S,l);a((o=o.apply(e,r)).next())});import{d as se,f as v,r as re,e as ne,o as ae,V as d,v as ie,a6 as m,a7 as w,F as O,q as le,af as T,a8 as pe,ai as V,k as b,W as B,a5 as H,ae as ce,ak as me,am as ue,ap as de,aq as ge}from"./vue-vendor-24c7dc61.js";import{m as fe}from"./antd-vue-vendor-0d72f01e.js";import{H as R,h as he,e as Pe,a as ye,k as ve,l as Se}from"./index-831af9dd.js";import"./index-1c3affea.js";import ke from"./ProcessItem-423aff3d.js";import{P as Ce,p as q}from"./ProcessTaskHandleModal-eae90b3c.js";import{B as we,u as _e}from"./useForm-14b2bc77.js";import"./index-52c8c841.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./LowAvatar-f808b87b.js";import"./NotifyMeListModal-d0556f41.js";import"./index-621e597c.js";import"./BasicTable-d435f501.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./helper-22dafba0.js";import"./useListPage-62a041ef.js";import"./useTaskNotify-d72aa8b0.js";import"./index-44229d9b.js";import"./ProcessGraphicDrawer-0a29e434.js";import"./ProcessGraphic-c05758c8.js";import"./bpmn-js-vendor-09dcfbc9.js";import"./TaskRejectModal-889160a8.js";import"./TaskAddSignModal-0519a829.js";import"./TaskAddSignReasonModal-a13ee4d2.js";import"./MyTaskNotifyModal-dbffa8d1.js";import"./NotifyForm-a0d0e258.js";import"./NotifyList-a4ff3498.js";const Te=se({name:"ProcessList",components:{BasicForm:we,ProcessTaskHandleModal:Ce,ProcessItem:ke,Pagination:fe},props:{api:R.func,actionType:R.string,searchSchemas:R.any},emits:["register"],setup(e){const{prefixCls:r}=he("low-app-process"),o=v(!1),h=v([]),P=v({}),S=v(),l=v([]),a=re({current:1,pageSize:8,showQuickJumper:!0,total:0,showSizeChanger:!0,pageSizeOptions:["8","10","20","50","100"],getStartEnd(){let t=(a.current-1)*a.pageSize+1,n=t+h.value.length;return{start:t,end:n}},showTotal:t=>`共${t}条数据 `,ifShow(){let{start:t,end:n}=a.getStartEnd();return t<n},onChange:W}),i={xs:24,sm:12,md:12,lg:8,xl:8,xxl:6},[g,{openModal:F}]=Pe(),[I,D]=_e({compact:!0,labelWidth:120,autoSubmitOnEnter:!0,rowProps:{gutter:8},baseColProps:y({},i),labelCol:{xs:24,sm:8,md:6,lg:8,xl:6,xxl:6},wrapperCol:{},showAdvancedButton:!0,autoAdvancedCol:3,submitOnReset:!0,actionColOptions:N(y({},i),{style:{textAlign:"left"}})}),_=ne(()=>y(y({},e),S.value));function M(t){S.value=t}function f(t){return C(this,null,function*(){let n=_.value.api;if(typeof n=="function"){o.value=!0;try{let s=yield n(y({pageNo:a.current,pageSize:a.pageSize},t));h.value=s.records,a.total=s.total}finally{o.value=!1}}})}function u(t){return C(this,null,function*(){F(!0,{record:t})})}function W(t,n){a.current=t,a.pageSize!=n&&(a.current=1,a.pageSize=n),f(P.value)}function J(t){a.current=1,P.value=t,f(t)}function Q(t,n){let s=l.value;if(t===!0)s.push(n);else{let p=-1;for(let c=0;c<s.length;c++)if(s[c].id===n.id){p=c;break}s.splice(p,1)}l.value=s}const{createMessage:E,createConfirm:x}=ye();function G(){let t=l.value;!t||t.length==0||x({iconType:"info",title:"提示",content:`您确认要通过选择的${t.length}个审批事项?`,onOk:()=>C(this,null,function*(){K(t)})})}function K(t){return C(this,null,function*(){let n=[];for(let s of t){let p=yield q.getProcessNodeInfo(s.id);if(p.taskIsHandel!==!0){let c=p.records.BPM_INST_ID,A=(yield q.getProcessTaskTransInfo(s.id,c)).transitionList;if(A&&A.length>0){let Y={taskId:s.id,reason:"批量审批通过",nextnode:A[0].nextnode,processModel:1};n.push(U(Y,s.title))}}}n.length>0&&Promise.all(n).then(()=>{E.success("处理完成"),l.value=[],f()}).catch(s=>{E.error(s)})})}function U(t,n){const s="/act/task/processComplete";return new Promise((p,c)=>{ve.post({url:s,params:t},{isTransformResponse:!1}).then(k=>{k.success===!0?p(1):c(k.message+" 任务标题："+n)}).catch(k=>{c(k)})})}function X(t){let s=l.value.filter(p=>p.id==t.id);return!!(s&&s.length>0)}const z=v(300);return z.value=window.innerHeight-202,ae(()=>{window.onresize=()=>(()=>{z.value=window.innerHeight-202})()}),{prefixCls:r,list:h,loading:o,reload:f,setProps:M,getProps:_,pagination:a,onClickProcess:u,onSearchChange:J,registerModal:g,registerForm:I,selectedRows:l,onSelect:Q,batchPass:G,getSelected:X,maxHeight:z}},mounted(){this.$emit("register",this)}});const be={key:0,style:{"margin-bottom":"10px"}},Fe={key:0,style:{width:"100%","margin-bottom":"10px"}},Ie={key:1,class:"process-page"};function Me(e,r,o,h,P,S){const l=d("BasicForm"),a=d("a-alert"),i=d("a-skeleton"),g=d("ProcessItem"),F=d("a-empty"),I=d("Pagination"),D=d("a-card"),_=d("ProcessTaskHandleModal"),M=ie("loading");return m(),w(O,null,[le((m(),T(D,{bordered:!1,class:pe([e.prefixCls])},{default:V(()=>{var f;return[e.getProps.searchSchemas&&e.getProps.searchSchemas.length>0?(m(),w("div",be,[b(l,{schemas:e.getProps.searchSchemas,onRegister:e.registerForm,onSubmit:e.onSearchChange},null,8,["schemas","onRegister","onSubmit"])])):B("",!0),H("div",{class:"process-list",style:ce({height:e.maxHeight+"px","overflow-y":"auto"})},[e.selectedRows.length>0?(m(),w("div",Fe,[b(a,{type:"info","show-icon":""},{message:V(()=>[H("span",null,"已选中"+me(e.selectedRows.length)+"条数据",1),H("span",{class:"batch-pass",onClick:r[0]||(r[0]=(...u)=>e.batchPass&&e.batchPass(...u))}," 批量通过 ")]),_:1})])):B("",!0),e.list?((f=e.list)==null?void 0:f.length)>0?(m(!0),w(O,{key:2},ue(e.list,u=>(m(),T(g,{key:u.id,record:u,onClick:()=>e.onClickProcess(u),actionType:e.getProps.actionType,selected:e.getSelected(u),onSelect:e.onSelect},null,8,["record","onClick","actionType","selected","onSelect"]))),128)):(m(),T(F,{key:3,description:"这里空空如也"})):(m(),T(i,{key:1,active:""}))],4),e.pagination.ifShow()?(m(),w("div",Ie,[b(I,de(ge(e.pagination)),null,16)])):B("",!0)]}),_:1},8,["class"])),[[M,e.loading]]),b(_,{actionType:e.getProps.actionType,onRegister:e.registerModal,onSuccess:e.reload},null,8,["actionType","onRegister","onSuccess"])],64)}const Nt=Se(Te,[["render",Me]]);export{Nt as default};
