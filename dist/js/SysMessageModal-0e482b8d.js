var A=(x,i,d)=>new Promise((e,g)=>{var b=l=>{try{s(d.next(l))}catch(f){g(f)}},m=l=>{try{s(d.throw(l))}catch(f){g(f)}},s=l=>l.done?e(l.value):Promise.resolve(l.value).then(b,m);s((d=d.apply(x,i)).next())});import{l as Y,Z as $,_ as ee,j as ae,e as B}from"./index-831af9dd.js";import{B as te}from"./index-1c3affea.js";import{cn as se,av as ne,cy as le,cz as oe,aC as re}from"./antd-vue-vendor-0d72f01e.js";import{J as ie,U as ce}from"./JSelectUser-a44af43a.js";import{f as p,r as L,e as O,u as de,a5 as t,V as c,a6 as h,a7 as y,F,k as o,ai as _,a8 as P,ae as fe,ak as T,af as V,am as _e,W as ge}from"./vue-vendor-24c7dc61.js";import he from"./DetailModal-e4466009.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./useFormItem-86503382.js";const me={name:"SysMessageModal",components:{BasicModal:te,FilterOutlined:se,CloseOutlined:ne,BellFilled:le,ExclamationOutlined:oe,JSelectUser:ie,SysMessageList:$(()=>ee(()=>import("./SysMessageList-7be13651.js"),["js/SysMessageList-7be13651.js","js/antd-vue-vendor-0d72f01e.js","js/vue-vendor-24c7dc61.js","js/useSysMessage-3c166e50.js","js/index-831af9dd.js","js/vxe-table-vendor-8813019a.js","assets/index-3d0fbd8d.css","js/index-1c3affea.js","js/BasicModal-58413bab.js","js/useWindowSizeFn-8f085f6f.js","assets/BasicModal-d929f5ce.css","assets/index-ad7edbf1.css","js/useComment-c2ce47e3.js","js/index-d508f1f4.js","assets/index-27837f17.css","js/index-4b5608cc.js","assets/SysMessageList-bc825e8c.css"])),UserSelectModal:ce,PlusOutlined:re,DetailModal:he},emits:["register","refresh"],setup(x,{emit:i}){const d=p(),e=p(),g=p("all");function b(a,n){g.value=n,l()}function m(a){g.value=a}const s=L({fromUser:"",realname:"",rangeDateKey:"7day",rangeDate:[]});function l(){let a={fromUser:s.fromUser,rangeDateKey:s.rangeDateKey,rangeDate:s.rangeDate};g.value=="all"?W(d).then(()=>{d.value.reload(a)}):e.value.reload(a)}const f=p(!1),[C,{closeModal:M}]=ae(a=>A(this,null,function*(){l(),a?f.value=a.isLowApp||!1:f.value=!1})),k=p(!1);function D(a,n){k.value=!0}const u=L([{key:"jt",text:"今天",active:!1},{key:"zt",text:"昨天",active:!1},{key:"qt",text:"前天",active:!1},{key:"bz",text:"本周",active:!1},{key:"sz",text:"上周",active:!1},{key:"by",text:"本月",active:!1},{key:"sy",text:"上月",active:!1},{key:"7day",text:"七日",active:!0},{key:"zdy",text:"自定义",active:!1}]);function S(a){for(let n of u)n.key!=a.key&&(n.active=!1);a.active=!a.active,a.active==!1?s.rangeDateKey="":s.rangeDateKey=a.key,a.key=="zdy"?a.active==!1&&(s.rangeDate=[],l()):l()}const w=O(()=>{let a=u.filter(n=>n.active==!0);return!!(a&&a.length>0&&a[0].text=="自定义")}),R=p([]);function r(a,n){s.rangeDate=[...n],l()}function z(a){i("refresh",a)}const E=O(()=>{const{fromUser:a,rangeDateKey:n,realname:U}=s;if(!a&&!n)return"";let v=[];if(a&&v.push(U),n){let K=u.filter(X=>X.key==n);K&&K.length>0&&v.push(K[0].text)}return v.join("、")}),[N,{openModal:j}]=B();function I(a,n){a&&a.length>0&&(s.fromUser=n,s.realname=a[0].label)}function G(){j(!0,{})}function J(){s.fromUser="",s.realname=""}function q(){s.fromUser="",s.realname="",s.rangeDateKey="",s.rangeDate=[];for(let a of u)a.active=!1;l()}function W(a){return new Promise(n=>{(function U(){let v=a.value;v?n(v):setTimeout(()=>{U()},100)})()})}const[Z,{openModal:H}]=B();function Q(a){H(!0,{record:de(a),isUpdate:!0})}return{conditionStr:E,regModal:N,getSelectedUser:I,openSelectPerson:G,clearSearchParamsUser:J,clearAll:q,registerModal:C,activeKey:g,handleChangePanel:m,handleChangeTab:b,showSearch:k,searchParams:s,handleChangeSearchPerson:D,dateTags:u,handleClickDateTag:S,showRangeDate:w,searchRangeDate:R,handleChangeSearchDate:r,closeModal:M,hrefThenClose:z,allMessageRef:d,starMessageRef:e,registerDetail:Z,showDetailModal:Q,isLowApp:f}}},ue={class:"sys-msg-modal-title"},ve=t("div",{class:"title"},null,-1),pe={class:"ant-tabs-nav-wrap"},ye={class:"ant-tabs-nav-scroll"},ke={class:"ant-tabs-nav ant-tabs-nav-animated"},be={class:"icon-right"},Ce={class:"icons"},De=t("span",{class:"search-label"},"回复、提到我的人?：",-1),xe={style:{display:"inline-block"}},Me={key:0,class:"selected-user"},Se={class:"clear-user-icon"},we={class:"search-date"},Re=t("div",{class:"date-label"},"时间：",-1),Ue={class:"date-tags"},Ke={class:"tags-container"},Pe=["onClick"],Te={key:0,class:"cust-range-date"},ze={key:0,class:"anticon filtera"},Ae={style:{"font-size":"12px","margin-left":"3px"}},Be={style:{display:"flex",margin:"0 5px"}},Le={class:"sys-message-card"},Oe=t("div",null,null,-1);function Fe(x,i,d,e,g,b){const m=c("close-outlined"),s=c("plus-outlined"),l=c("a-button"),f=c("a-range-picker"),C=c("filter-outlined"),M=c("a-popover"),k=c("sys-message-list"),D=c("a-tab-pane"),u=c("a-tabs"),S=c("BasicModal"),w=c("user-select-modal"),R=c("DetailModal");return h(),y(F,null,[o(S,{canFullscreen:!1,draggable:!1,closable:!1,onRegister:e.registerModal,wrapClassName:"sys-msg-modal",width:800,footer:null,destroyOnClose:""},{title:_(()=>[t("div",ue,[ve,t("div",pe,[t("div",ye,[t("div",ke,[t("div",null,[t("div",{onClick:i[0]||(i[0]=r=>e.handleChangeTab(r,"all")),role:"tab","aria-disabled":"false","aria-selected":"false",class:P(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="all"}])}," 全部消息 ",2),t("div",{onClick:i[1]||(i[1]=r=>e.handleChangeTab(r,"star")),role:"tab","aria-disabled":"false","aria-selected":"true",class:P(["ant-tabs-tab",{"ant-tabs-tab-active":e.activeKey=="star"}])}," 标星消息 ",2)]),t("div",{class:"ant-tabs-ink-bar ant-tabs-ink-bar-animated",style:fe({transform:e.activeKey=="all"?"translate3d(130px, 0px, 0px)":"translate3d(215px, 0px, 0px)",display:"block",width:"88px",height:"1px"})},null,4)])])]),t("div",be,[t("div",Ce,[o(M,{placement:"bottomRight",overlayStyle:{width:"400px"},trigger:"click",open:e.showSearch,"onUpdate:open":i[3]||(i[3]=r=>e.showSearch=r)},{content:_(()=>[t("div",null,[De,t("span",xe,[e.searchParams.fromUser?(h(),y("div",Me,[t("span",null,T(e.searchParams.realname),1),t("span",Se,[o(m,{style:{"font-size":"12px"},onClick:e.clearSearchParamsUser},null,8,["onClick"])])])):(h(),V(l,{key:1,type:"dashed",shape:"circle",onClick:e.openSelectPerson},{default:_(()=>[o(s)]),_:1},8,["onClick"]))])]),t("div",we,[Re,t("div",Ue,[t("div",Ke,[(h(!0),y(F,null,_e(e.dateTags,r=>(h(),y("div",{class:P(r.active==!0?"tag active":"tag"),onClick:z=>e.handleClickDateTag(r)},T(r.text),11,Pe))),256))]),e.showRangeDate?(h(),y("div",Te,[o(f,{value:e.searchRangeDate,"onUpdate:value":i[2]||(i[2]=r=>e.searchRangeDate=r),onChange:e.handleChangeSearchDate},null,8,["value","onChange"])])):ge("",!0)])])]),default:_(()=>[e.conditionStr?(h(),y("span",ze,[o(C),t("span",Ae,T(e.conditionStr),1),t("span",Be,[o(m,{style:{"font-size":"12px"},onClick:e.clearAll},null,8,["onClick"])])])):(h(),V(C,{key:1}))]),_:1},8,["open"]),o(m,{onClick:e.closeModal},null,8,["onClick"])])])])]),default:_(()=>[t("div",Le,[o(u,{activeKey:e.activeKey,center:"",onTabClick:e.handleChangePanel,animated:""},{renderTabBar:_(()=>[Oe]),default:_(()=>[o(D,{tab:"全部消息",key:"all",forceRender:""},{default:_(()=>[o(k,{isLowApp:e.isLowApp,ref:"allMessageRef",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["isLowApp","onClose","onDetail"])]),_:1}),o(D,{tab:"标星消息",key:"star",forceRender:""},{default:_(()=>[o(k,{isLowApp:e.isLowApp,ref:"starMessageRef",star:"",onClose:e.hrefThenClose,onDetail:e.showDetailModal},null,8,["isLowApp","onClose","onDetail"])]),_:1})]),_:1},8,["activeKey","onTabClick"])])]),_:1},8,["onRegister"]),o(w,{isRadioSelection:"",showButton:!1,labelKey:"realname",rowKey:"username",onRegister:e.regModal,onGetSelectResult:e.getSelectedUser},null,8,["onRegister","onGetSelectResult"]),o(R,{onRegister:e.registerDetail,zIndex:1001},null,8,["onRegister"])],64)}const $e=Y(me,[["render",Fe]]);export{$e as default};
