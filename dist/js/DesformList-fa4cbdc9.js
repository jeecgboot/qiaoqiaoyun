var x=(t,R,c)=>new Promise((d,h)=>{var w=s=>{try{a(c.next(s))}catch(m){h(m)}},g=s=>{try{a(c.throw(s))}catch(m){h(m)}},a=s=>s.done?d(s.value):Promise.resolve(s.value).then(w,g);a((c=c.apply(t,R)).next())});import"./index-621e597c.js";import{d as lo,e as ao,a5 as K,V as i,a6 as L,a7 as mo,a8 as po,k as r,ag as co,ai as p,E as uo,af as fo,W as go}from"./vue-vendor-24c7dc61.js";import{N as Do,e as D,r as O,l as ho}from"./index-831af9dd.js";import"./index-1c3affea.js";import{u as q}from"./index-44229d9b.js";import{u as Mo}from"./useListPage-62a041ef.js";import{p as b}from"./desform.api-4c557ed3.js";import{c as Ro,s as wo}from"./desform.data-92c54dbe.js";import Co from"./DesformModal-7f8690b0.js";import _o from"./FormDesignerIframeModal-44ee0d5b.js";import bo from"./DesformAddressModal-746bc946.js";import Ao from"./DesformAuthDrawer-ff08434e.js";import To from"./DesformAuthBatchModal-b091589a.js";import ko from"./DesformRouteDrawer-aa07df09.js";import Io from"./DesformRedoIndexModal-87599399.js";import vo from"./DesformIndexToolsModal-fe414507.js";import yo from"./BasicTable-d435f501.js";import{T as Bo}from"./componentMap-c857637c.js";import"./antd-vue-vendor-0d72f01e.js";import"./vxe-table-vendor-8813019a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./useMethods-f689b480.js";import"./user.api-ffaaa05b.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./useFormItem-86503382.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./JPopup-2a779923.js";import"./EasyCronInput-b2123242.js";import"./JCheckbox-0b89d32a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./JImageUpload-d644253a.js";import"./pinyin-pro-vendor-c1fd58fc.js";import"./DesignerButtonDrawer-04cdfd92.js";import"./ZdyanDrawer-58ee121b.js";import"./ButtonColorSelector-58fbd93b.js";import"./ButtonConditions-9a9a88d5.js";import"./type.definition-4eb605ee.js";import"./LinkRecordSelect-385d0eae.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./useCustomButton-fa741dda.js";import"./FilterFiledListNew-bbda127c.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./ButtonConfirmText-527dd2f0.js";import"./FilterFiledList-8a929f88.js";import"./ButtonFormConfig-7880f3ed.js";import"./FormFieldSelect-9cf3f019.js";import"./DataAuthTab-fc074e7f.js";import"./auth.data-0f6cd267.js";import"./auth.api-15f2ddd8.js";import"./useDesformAuth-fbf3ee83.js";import"./DataAuthModal-e287ce29.js";import"./SettingAuthModal-8ccbd5e1.js";import"./ButtonAuthTab-9bf86c4c.js";import"./FieldAuthTab-4bdda080.js";import"./FieldAuthTable-0d4d7166.js";import"./FieldAuthSettingModal-56af33f0.js";import"./AuthBatchTransfer-ba68ad38.js";import"./RouteModal-91c43680.js";import"./ChangeDataTool-cb128ec4.js";import"./useIndexTools-1e9159b7.js";import"./ChangeModelTool-99ede1e0.js";const So=lo({name:"online-desform",components:{BasicTable:yo,TableAction:Bo,DesformModal:Co,FormDesignerIframeModal:_o,DesformAddressModal:bo,DesformAuthDrawer:Ao,DesformAuthBatchModal:To,DesformRouteDrawer:ko,DesformRedoIndexModal:Io,DesformIndexToolsModal:vo},setup(t,{emit:R}){const{close:c}=Do(),d=Mo({tableProps:{api:b.list,columns:Ro,formConfig:{schemas:wo},actionColumn:{width:360},isTreeTable:!0,beforeFetch:J,afterFetch:X,onExpand:Y}}),{prefixCls:h,tableContext:w,doRequest:g,doDeleteRecord:a}=d,[s,{reload:m,collapseAll:A,getDataSource:T},{rowSelection:k,selectedRowKeys:l}]=w,[I,C]=D(),[v,y]=D(),[B,S]=D(),[F,_]=q(),[P,U]=D(),[W,j]=q(),[z,G]=D(),[H,xo]=D(),M=ao(()=>O.currentRoute.value.query.open);let u="";M.value&&(u=M.value);function J(o){M.value&&(o.desformCode=M.value)}function Q(){M.value&&c()}function X(o){A();let e=null;for(const n of o)n.hasChildren&&(n.children=[{id:`${n.id}_loadChild`,desformName:"loading...",isLoading:!0}]),u&&n.desformCode===u&&(e=n);u&&(e?N(e):d.createWarningModal({title:"无法打开设计页面",content:`<span>无法找到新增的表单“${u}”，可能是设置了查询条件导致查询不到该条数据导致的，请手动打开设计页面。</span>`}),u="")}function Y(o,e){return x(this,null,function*(){if(o&&e.children[0].isLoading===!0){let{records:n}=yield b.list({parentId:e.id});n.length===0?e.children=null:e.children=n}})}function Z(o){o.openDesign&&(u=o.desformCode),m()}function N(o){y.openModal(!0,{record:o})}function oo(){C.openModal(!0,{isUpdate:!1})}function E(o,e="default"){C.openModal(!0,{isUpdate:!0,record:o,action:e})}function eo(o){return x(this,null,function*(){o.children?d.createErrorModal({content:"请删除完所有的子视图以后再删除主视图！"}):a(()=>b.delete(o.id))})}function to(){const o=(n,$)=>{for(let f of $){if(f.id===n)return f;if(f.children)return o(n,f.children)}};let e=[];l.value.forEach((n,$)=>{let f=o(n,T());f&&f.children&&e.push($)}),e.reverse();for(let n of e)l.value.splice(n,1);l.value.length===0?d.createErrorModal({content:"请删除完所有的子视图以后再删除主视图！"}):g(()=>b.batchDelete(l.value))}function ro(){V(0)}function no(){V(1)}function V(o){let e="";l.value&&l.value.length>0&&(e=l.value.join(",")),G.openModal(!0,{modeIndex:o,selections:e})}function io(o){let e=[{label:"编辑",onClick:()=>E(o)},{label:"设计表单",icon:"ant-design:setting",onClick:()=>N(o)}];return e.push({label:"表单数据",class:["low-app-hide"],onClick:()=>O.push(`/online/desform/list/${o.desformCode}`)}),e.push({label:"配置地址",class:["low-app-hide"],onClick:()=>S.openModal(!0,{record:o})},{label:"流程管理",icon:"uim:process",class:["low-app-show"],onClick:()=>R("action-click",{type:"process-manage",record:o})}),e}function so(o){const e=o.desformType===2;return[{label:"权限控制",onClick:()=>_.openDrawer(!0,{record:o})},{label:"角色授权",onClick:()=>U.openModal(!0,{record:o})},{label:"路由配置",onClick:()=>j.openDrawer(!0,{record:o})},{label:"复制视图",onClick:()=>E(o,"copy-view"),ifShow:!e},{label:"复制表单",onClick:()=>E(o,"copy"),ifShow:!e},{label:"删除",popConfirm:{title:"确定要删除吗？",placement:"left",confirm:()=>eo(o)}}]}return{prefixCls:h,rowSelection:k,selectedRowKeys:l,reload:m,onModalOk:Z,onAddRecord:oo,onDeleteBatch:to,onRedoIndex:ro,onRedoIndexForce:no,onFormDesignerClose:Q,getTableAction:io,getDropDownAction:so,registerTable:s,registerDesformModal:I,registerFormDesignerIframeModal:v,registerAddressModal:B,registerAuthDrawer:F,registerAuthBatchModal:P,registerRouteDrawer:W,registerRedoIndexModal:z,registerIndexToolsModal:H}}}),Fo=K("span",null,"删除",-1),Eo=K("span",null,"批量操作",-1);function $o(t,R,c,d,h,w){const g=i("a-button"),a=i("a-icon"),s=i("a-menu-item"),m=i("a-menu"),A=i("a-dropdown"),T=i("TableAction"),k=i("BasicTable"),l=i("DesformModal"),I=i("FormDesignerIframeModal"),C=i("DesformAuthDrawer"),v=i("DesformAuthBatchModal"),y=i("DesformAddressModal"),B=i("DesformRouteDrawer"),S=i("DesformRedoIndexModal"),F=i("DesformIndexToolsModal");return L(),mo("div",{class:po(t.prefixCls)},[r(k,co({onRegister:t.registerTable,rowSelection:t.rowSelection},t.$attrs),{tableTitle:p(()=>[r(g,{onClick:t.onAddRecord,type:"primary",preIcon:"ant-design:plus"},{default:p(()=>[uo("新增")]),_:1},8,["onClick"]),t.selectedRowKeys.length>0?(L(),fo(A,{key:0},{overlay:p(()=>[r(m,null,{default:p(()=>[r(s,{key:"1",onClick:t.onDeleteBatch},{default:p(()=>[r(a,{type:"delete"}),Fo]),_:1},8,["onClick"])]),_:1})]),default:p(()=>[r(g,null,{default:p(()=>[Eo,r(a,{type:"down"})]),_:1})]),_:1})):go("",!0)]),action:p(({record:_})=>[r(T,{actions:t.getTableAction(_),dropDownActions:t.getDropDownAction(_)},null,8,["actions","dropDownActions"])]),_:1},16,["onRegister","rowSelection"]),r(l,{onRegister:t.registerDesformModal,onSuccess:t.onModalOk},null,8,["onRegister","onSuccess"]),r(I,{onRegister:t.registerFormDesignerIframeModal,onSuccess:t.reload,onClose:t.onFormDesignerClose,isLowApp:!1},null,8,["onRegister","onSuccess","onClose"]),r(C,{onRegister:t.registerAuthDrawer},null,8,["onRegister"]),r(v,{onRegister:t.registerAuthBatchModal,authScopeType:"role"},null,8,["onRegister"]),r(y,{onRegister:t.registerAddressModal},null,8,["onRegister"]),r(B,{onRegister:t.registerRouteDrawer},null,8,["onRegister"]),r(S,{onRegister:t.registerRedoIndexModal},null,8,["onRegister"]),r(F,{onRegister:t.registerIndexToolsModal},null,8,["onRegister"])],2)}const St=ho(So,[["render",$o]]);export{St as default};
