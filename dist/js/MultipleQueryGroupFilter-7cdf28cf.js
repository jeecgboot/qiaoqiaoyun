var me=Object.defineProperty,ce=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var oe=(e,i,h)=>i in e?me(e,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[i]=h,P=(e,i)=>{for(var h in i||(i={}))ve.call(i,h)&&oe(e,h,i[h]);if(le)for(var h of le(i))ye.call(i,h)&&oe(e,h,i[h]);return e},J=(e,i)=>ce(e,fe(i));import{d as he,f as D,h as _e,e as ge,a3 as Ce,a4 as ke,a5 as a,V as _,a6 as n,a7 as m,F as w,am as I,af as M,ai as c,k as r,E as g,ak as T,z as ne,W as L,a8 as Fe}from"./vue-vendor-24c7dc61.js";import{aC as we,n as qe,av as Be,aZ as Me,cm as Te,p as ie}from"./antd-vue-vendor-0d72f01e.js";import{s as se,d as Le}from"./type.definition-4eb605ee.js";import De from"./SuperQueryValComponent-97f284a9.js";import{c as Ee,u as Se}from"./LinkRecordSelect-385d0eae.js";import{C as be}from"./ComponentIcon-f1bbb90f.js";import{cx as Ie,a as $e,l as Qe}from"./index-831af9dd.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";const Oe=he({name:"MultipleQueryGroupFilter",components:{PlusOutlined:we,SearchOutlined:qe,CloseOutlined:Be,TableOutlined:Me,OnlineSuperQueryValComponent:De,SaveOutlined:Te,ComponentIcon:be,DesformDataLinkageModal:Ie},emits:["save"],props:{columnList:{type:Array,default:()=>[]},info:{type:Object,require:!1,default:{}},desformCode:String},setup(e,{emit:i}){const{createMessage:h}=$e(),{getSchema:X}=Ee(e),{getConditionOptions:Y,getDefaultRule:x,getDefaultVal:E}=Se(),S=D(""),$=D([]),R=D();function b(t){if(!t||t.length==0){$.value=[];return}$.value=t.filter(l=>Le.includes(l.type)?l.type==="link-field"?l.saveType==="save":!1:!0)}const N=D(!1),s=D([]),C=D("and"),k=D([]);_e(()=>{let t=e.columnList;b(t);let l=e.info;if(C.value=l.matchType,l.conditions&&l.conditions.length>0){let d=!0,u=[],v=l.conditions,B=[];if(v&&v.length>0){for(let q of v){k.value.push({showPop:!1});let Q=[],O=q.queryItems;if(O&&O.length>0){for(const U of O){let W=ie(U,"field","rule","val","type"),te=V(U.field,t,U);te&&Q.push(J(P({},W),{name:te}))}B.push({matchType:q.matchType,queryItems:Q}),d=!1}else{let U=ie(q,"field","rule","val","type"),W=V(q.field,t,q);W&&u.push(J(P({},U),{name:W})),d=!0}}d&&B.push({matchType:l.conditionType||"and",queryItems:u})}s.value=B}else s.value=[]});function V(t,l,d){let u="";if(l&&l.length>0){let v=l.filter(B=>B.model==t);v&&v.length>0&&(u=v[0].name)}if(!u){let v=se.filter(B=>B.field==t);v&&v.length>0&&(u=v[0].name)}if(u)return u}function A(t,l=0){let d=t.field||t.model,u=s.value[l],v=x(t.type),B=E(t.type),q=[],Q={field:d,rule:v,val:B,type:t.type,name:t.name,multiple:t.multiple};if(u&&u.queryItems&&u.queryItems.length>0){let O=u.queryItems;O.push(P({},Q)),s.value[l].queryItems=O}else u?(q.push(P({},Q)),s.value[l].queryItems=q):(q.push(P({},Q)),s.value.push({matchType:"and",queryItems:q}));k.value[l]&&(k.value[l].showPop=!1),N.value=!1}const z=D("");function Z(t){let l=z.value;return l?t?t.name.indexOf(l)>=0:!1:!0}function p(){if(s.value.length>0)if(s.value.length==1){let t=s.value[0].queryItems,l=s.value[0].matchType;i("save",{conditionType:l,conditions:t})}else i("save",{matchType:C.value,conditions:s.value})}const y=ge(()=>s.value.flatMap(d=>d.queryItems).find(d=>["link-record"].includes(d.type))!=null);function o(t,l){l==="linkage"?F(t):t.rule=l}function F(t){var d,u;const l=e.columnList.find(v=>v.model===t.field);if(!l){h.warning("字段不存在");return}(u=R.value)==null||u.open({desformCode:l.code,needSystemFields:!0,widgetKey:l.key,widgetKeys:[],rules:(d=t.val)==null?void 0:d.rules,callback:v=>{t.rule="linkage",t.val=v}})}function G(t,l){let d=s.value[t];d.queryItems.splice(l,1),s.value[t]=d,s.value.length==1&&s.value[0].queryItems.length==0&&(C.value="and",i("save",{matchType:C.value,conditionType:C.value,conditions:[]}))}function K(t){let l=s.value;l.splice(t,1),s.value.length==0&&s.value[0].queryItems.length==0&&l.splice(0,1),l.length==0&&(C.value="and",i("save",{matchType:C.value,conditionType:C.value,conditions:[]}))}function f(t){const{type:l,multiple:d}=t;let u=Y(l,d,!0);return!u||u.length==0?[]:u}function H(t,l,d){d.val=l}function ae(t,l,d){let u=s.value[l];u.matchType=t}function ue(){if(s.value.length==0)for(let t=0;t<2;t++)ee();else ee()}function ee(){k.value.push({showPop:!1}),s.value.push({matchType:"and",queryItems:[]})}function re(t){k.value[t]&&(k.value[t].showPop=!0)}function pe(t){S.value=t}function de(){S.value=""}return{linkageModalRef:R,conditionList:s,systemFields:se,showPop:N,filterValue:z,onSelectField:A,isFilterItem:Z,saveCondition:p,showDataLinkage:y,openLinkageModal:F,onChangeConditionRule:o,onRemove:G,getOptions:f,getSchema:X,setFormModel:H,filterColumnList:$,matchTypeChange:ae,addFilterGroup:ue,onConRemove:K,queryIndex:S,mouseMoveQuery:pe,mouseLeaveQuery:de,popArr:k,showPopField:re,conditionRelation:C}}});const j=e=>(Ce("data-v-0b9d8e98"),e=e(),ke(),e),Pe={class:"inner-content"},Re=j(()=>a("div",{class:"title"},"数据过滤",-1)),Ve=j(()=>a("div",{class:"tip"},"添加筛选条件，限制出现在此视图中的记录",-1)),Ae={class:"config-detail",style:{width:"320px","padding-top":"0"}},Ue={class:"condition-item",style:{"margin-top":"15px"}},Ne={key:0,style:{display:"flex"}},ze={style:{"font-size":"13px"}},Ge={class:"icon-remove",style:{position:"relative",top:"4px"}},Ke={class:"children-query",style:{"margin-top":"20px"}},We=["onMousemove"],je={style:{flex:"1"}},Ze={style:{"margin-right":"10px","max-width":"100px","font-weight":"bold"}},He={class:"condition-select"},Je={class:"condition-val"},Xe={style:{width:"calc(100% - 70px)"}},Ye=["onClick"],xe={class:"condition-rela"},et={key:1,style:{color:"rgb(117, 117, 117)",display:"inline-block",width:"40px"}},tt={class:"field-list"},lt=["onClick"],ot=j(()=>a("div",{class:"split"},null,-1)),nt=["onClick"],it=["onClick"],st={class:"field-list"},at=["onClick"],ut=j(()=>a("div",{class:"split"},null,-1)),rt=["onClick"],pt={style:{width:"100%","text-align":"right",position:"relative"}};function dt(e,i,h,X,Y,x){const E=_("a-select-option"),S=_("a-select"),$=_("a-divider"),R=_("close-outlined"),b=_("component-icon"),N=_("online-super-query-val-component"),s=_("search-outlined"),C=_("a-input"),k=_("PlusOutlined"),V=_("a-popover"),A=_("a-button"),z=_("save-outlined"),Z=_("DesformDataLinkageModal");return n(),m("div",Pe,[Re,Ve,a("div",Ae,[(n(!0),m(w,null,I(e.conditionList,(p,y)=>(n(),m("div",Ue,[y>0?(n(),m("div",Ne,[y===1?(n(),M($,{key:0,style:{margin:"0"}},{default:c(()=>[r(S,{style:{width:"50px"},size:"small",value:e.conditionRelation,"onUpdate:value":i[0]||(i[0]=o=>e.conditionRelation=o)},{default:c(()=>[r(E,{value:"and"},{default:c(()=>[g("且")]),_:1}),r(E,{value:"or"},{default:c(()=>[g("或")]),_:1})]),_:1},8,["value"])]),_:1})):(n(),M($,{key:1,style:{margin:"0"}},{default:c(()=>[a("span",ze,T(e.conditionRelation==="and"?"且":"或"),1)]),_:1})),a("div",Ge,[r(R,{onClick:ne(o=>e.onConRemove(y),["prevent"])},null,8,["onClick"])])])):L("",!0),(n(!0),m(w,null,I(p.queryItems,(o,F)=>{var G,K;return n(),m("div",Ke,[a("div",{style:{display:"flex"},onMousemove:f=>e.mouseMoveQuery(y+"-"+F),onMouseleave:i[1]||(i[1]=(...f)=>e.mouseLeaveQuery&&e.mouseLeaveQuery(...f))},[a("div",je,[r(b,{type:o.type,style:{color:"rgb(158, 158, 158)"},"data-idx":1,item:o},null,8,["type","item"]),a("span",Ze,T(o.name),1),a("span",He,[r(S,{value:o.rule,size:"small",style:{"min-width":"70px"},dropdownStyle:{minWidth:"120px"},onChange:f=>e.onChangeConditionRule(o,f)},{default:c(()=>[(n(!0),m(w,null,I(e.getOptions(o),f=>(n(),M(E,{value:f.value},{default:c(()=>[g(T(f.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onChange"])])]),a("div",{class:Fe(e.queryIndex===y+"-"+F?"icon-children-show":"icon-children-hide")},[r(R,{onClick:ne(f=>e.onRemove(y,F),["prevent"])},null,8,["onClick"])],2)],40,We),a("div",Je,[a("div",Xe,[o.rule==="linkage"?(n(),m("div",{key:0,class:"condition-val-linkage-box",onClick:f=>e.openLinkageModal(o)},[a("span",null,"已配置 "+T((K=(G=o.val)==null?void 0:G.rules)==null?void 0:K.length)+" 个条件",1)],8,Ye)):(n(),M(N,{key:1,style:{width:"100%"},schema:e.getSchema(o,F),formModel:o,setFormModel:(f,H)=>{e.setFormModel(f,H,o)}},null,8,["schema","formModel","setFormModel"]))]),a("div",xe,[F===0?(n(),M(S,{key:0,style:{width:"50px"},size:"small",value:p.matchType,"onUpdate:value":f=>p.matchType=f,onChange:f=>e.matchTypeChange(f,y,F)},{default:c(()=>[r(E,{value:"and"},{default:c(()=>[g("且")]),_:1}),r(E,{value:"or"},{default:c(()=>[g("或")]),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])):(n(),m("span",et,T(p.matchType==="and"?"且":"或"),1))])])])}),256)),e.conditionList.length>1?(n(),M(V,{key:1,overlayClassName:"view-pop-field-select",open:e.popArr[y].showPop,"onUpdate:open":o=>e.popArr[y].showPop=o,trigger:"click"},{content:c(()=>[a("div",tt,[(n(!0),m(w,null,I(e.filterColumnList,o=>(n(),m(w,null,[e.isFilterItem(o)?(n(),m("div",{key:0,class:"field-item",onClick:F=>e.onSelectField(o,y)},[a("div",null,[r(b,{type:o.type,"data-idx":2,item:o},null,8,["type","item"]),g(" "+T(o.name),1)])],8,lt)):L("",!0)],64))),256)),ot,(n(!0),m(w,null,I(e.systemFields,o=>(n(),m(w,null,[e.isFilterItem(o)?(n(),m("div",{key:0,class:"field-item",onClick:F=>e.onSelectField(o,y)},[a("div",null,[r(b,{type:o.type,"data-idx":3,item:o},null,8,["type","item"]),g(" "+T(o.name),1)])],8,nt)):L("",!0)],64))),256))])]),title:c(()=>[r(C,{placeholder:"搜索字段",class:"my-input",value:e.filterValue,"onUpdate:value":i[2]||(i[2]=o=>e.filterValue=o)},{prefix:c(()=>[r(s,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:c(()=>[a("span",{class:"add-button",style:{"margin-top":"20px",cursor:"pointer"},onClick:o=>e.showPopField(y)},[r(k),g(" 筛选 ")],8,it)]),_:2},1032,["open","onUpdate:open"])):L("",!0)]))),256)),e.conditionList.length<=1?(n(),M(V,{key:0,overlayClassName:"view-pop-field-select",open:e.showPop,"onUpdate:open":i[4]||(i[4]=p=>e.showPop=p),trigger:"click"},{content:c(()=>[a("div",st,[(n(!0),m(w,null,I(e.filterColumnList,p=>(n(),m(w,null,[e.isFilterItem(p)?(n(),m("div",{key:0,class:"field-item",onClick:y=>e.onSelectField(p)},[a("div",null,[r(b,{type:p.type,"data-idx":4,item:p},null,8,["type","item"]),g(" "+T(p.name),1)])],8,at)):L("",!0)],64))),256)),ut,(n(!0),m(w,null,I(e.systemFields,p=>(n(),m(w,null,[e.isFilterItem(p)?(n(),m("div",{key:0,class:"field-item",onClick:y=>e.onSelectField(p)},[a("div",null,[r(b,{type:p.type,"data-idx":5,item:p},null,8,["type","item"]),g(" "+T(p.name),1)])],8,rt)):L("",!0)],64))),256))])]),title:c(()=>[r(C,{placeholder:"搜索字段",class:"my-input",value:e.filterValue,"onUpdate:value":i[3]||(i[3]=p=>e.filterValue=p)},{prefix:c(()=>[r(s,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:c(()=>[r(A,{class:"add-button",style:{"margin-top":"20px"}},{default:c(()=>[r(k),g(" 添加筛选条件 ")]),_:1})]),_:1},8,["open"])):L("",!0),r(A,{class:"add-button",style:{"margin-top":"20px","margin-left":"20px"},onClick:e.addFilterGroup},{default:c(()=>[r(k),g(" 筛选组 ")]),_:1},8,["onClick"]),a("div",pt,[e.conditionList.length>0?(n(),M(A,{key:0,onClick:e.saveCondition,type:"primary",style:{color:"#fff","border-radius":"20px",right:"-38px",top:"-33px"}},{default:c(()=>[r(z),g(" 保 存 ")]),_:1},8,["onClick"])):L("",!0)])]),e.showDataLinkage?(n(),M(Z,{key:0,ref:"linkageModalRef",desformCode:e.desformCode},null,8,["desformCode"])):L("",!0)])}const pl=Qe(Oe,[["render",dt],["__scopeId","data-v-0b9d8e98"]]);export{pl as default};
