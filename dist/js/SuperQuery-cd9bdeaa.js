var ye=Object.defineProperty,he=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var se=(p,r,f)=>r in p?ye(p,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):p[r]=f,ne=(p,r)=>{for(var f in r||(r={}))Ee.call(r,f)&&se(p,f,r[f]);if(re)for(var f of re(r))Fe.call(r,f)&&se(p,f,r[f]);return p},ue=(p,r)=>he(p,ge(r));import{f as O,r as de,I as ce,as as Ce,w as ae,a3 as ke,a4 as be,a5 as E,V as c,a6 as b,a7 as fe,F as pe,af as B,ai as o,k as a,E as y,D as Se,W as we,a8 as ie,q as me,A as _e,am as De,ak as Be}from"./vue-vendor-24c7dc61.js";import{B as Oe}from"./index-1c3affea.js";import{a as ve,j as Ie,c2 as le,m as xe,e as Ae,l as Te}from"./index-831af9dd.js";import{M as Me,aB as Re,aC as Ve,by as Pe,ck as Qe,cl as je,_ as Ne,E as qe}from"./antd-vue-vendor-0d72f01e.js";import{F as Le}from"./FormSchemaFactory-ec827fa7.js";import Ue from"./SuperQueryValComponent-97f284a9.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";const Je={password:"text",file:"text",image:"text",textarea:"text",umeditor:"text",markdown:"text",checkbox:"list_multi",radio:"list"},Ke="JSuperQuerySaved_";function We(){const{createMessage:p}=ve(),r=O(),f=de({values:[]}),t=O("and"),[W,{setModalProps:te}]=Ie(()=>{te({confirmLoading:!1})}),T=Object.assign({},{link_down:"text"},Je);function H(){}function F(){}function z(e,l,i){i.val=l}const M=O({}),R=O([]);function V(e){let{allFields:l,treeData:i}=u(e);M.value=l,R.value=i}function v(e){let l={field:void 0,rule:"eq",val:"",key:le(16)};e===!1?(f.values=[],f.values.push(l)):e===!0?f.values.length==0&&f.values.push(l):f.values.splice(++e,0,l)}function j(e){let l=ce(f.values),i=-1;for(let n=0;n<l.length;n++)if(e.key==l[n].key){i=n;break}i!=-1&&f.values.splice(i,1)}const w={field:"val",label:"测试",component:"Input"};function N(e,l){let n=M.value[e.field];if(!n)return w;T[n.view]&&(n.view=T[n.view]);let d=Le.createFormSchema(e.field,n);d.noChange(),d.asSearchForm(),d.updateField(e.field+l);const m=g=>{e.val=g[e.field]};d.setFunctionForFieldValue(m);let _=d.getFormItemSchema();if(["empty","not_empty"].includes(e.rule)&&(_.componentProps=ue(ne({},_.componentProps),{disabled:!0})),linkTableCard2Select(_),_&&_.component==="InputNumber"&&(e.curLineAlign="start"),(_==null?void 0:_.component)==="JTreeSelect"){let g=_.componentProps;g?g.getPopupContainer=()=>document.body:_.componentProps={getPopupContainer:()=>document.body}}return _}const P=O(""),I=xe(),C=de({visible:!1,title:"",content:"",saveCode:""}),G=O(!1),q=Ce();ae(()=>q.fullPath,e=>{L()});const h=O([]);ae(()=>h.value,e=>{let l=[];e&&e.length>0&&e.map(i=>{let n=le(16);l.push({title:i.title,slots:{icon:"custom"},value:n})}),P.value=l},{immediate:!0,deep:!0});function L(){let e=Ke+q.fullPath;C.saveCode=e;let l=I.get(e);l&&l instanceof Array&&(h.value=l)}L();function Y(){let e=U();if(!e){p.warning("空条件不能保存");return}let l=JSON.stringify(e);X(l)}function X(e){C.visible=!0,C.title="",C.content=e}function Z(){let{title:e,content:l,saveCode:i}=C,n=x(e);const d=60*60*24*30;n>=0?Me.confirm({title:"提示",content:`${e} 已存在，是否覆盖？`,okText:"确认",cancelText:"取消",onOk:()=>{h.value.splice(n,1,{content:l,title:e,type:t.value}),I.set(i,h.value,d),C.visible=!1,p.success("保存成功")}}):(h.value.push({content:l,title:e,type:t.value}),I.set(i,h.value,d),C.visible=!1,p.success("保存成功"))}function x(e){let l=h.value,i=-1;for(let n=0;n<l.length;n++)if(l[n].title==e){i=n;break}return i}function U(e=!1){var d;let l=f.values;if(!l||l.length==0)return!1;let i=[],n=M.value;for(let m of l){let _=["empty","not_empty"].includes(m.rule);if(m.field&&(_||m.val||m.val===0)&&m.rule){let g=n[m.field],S=(d=g==null?void 0:g.formatValue)!=null?d:Q=>Q,D=ce(m.val);D instanceof Array?D=D.map(Q=>S(Q)).join(","):D=S(D);let K={field:A(m),rule:m.rule,val:D};if(e===!0){let Q=n[m.field];Q&&(K.type=Q.view,K.dbType=Q.type)}i.push(K)}}return i.length==0?!1:i}function A(e){let l=e.field;return l.indexOf("@")>0&&(l=l.replace("@",",")),l}function $(e,{node:l}){let i=l.dataRef.title,n=h.value.filter(d=>d.title==i);if(n&&n.length>0){let{content:d,type:m}=n[0],_=JSON.parse(d),g=[];for(let S of _)S.field=S.field.replace(",","@"),g.push(Object.assign({},{key:le(16)},S));f.values=g,t.value=m}}function ee(e){let l=x(e);l>=0&&(h.value.splice(l,1),I.set(C.saveCode,h.value))}function u(e){let l={},i=1,n=[];return e.properties&&(e=e.properties),Object.keys(e).map(d=>{let m=e[d];if(m.view=="table"){let _=m.properties||m.fields,g=i*100,S={title:m.title,value:d,disabled:!0,children:[],order:g};Object.keys(_).map(D=>{let J=_[D];J.order=g+J.order;let K=d+"@"+D;l[K]=J,S.children.push({title:J.title,value:K,isLeaf:!0,order:J.order})}),k(S),n.push(S),i++}else{let _=d;l[_]=m,n.push({title:m.title,value:_,isLeaf:!0,order:m.order})}}),k(n),{allFields:l,treeData:n}}function k(e){(e.children||e).sort(function(i,n){return i.order-n.order})}function s(e){const{params:l,matchType:i}=e;if(l){let n=[];for(let d of l)n.push(Object.assign({},{key:le(16)},d));f.values=n,i.value=i}}return{formRef:r,init:V,dynamicRowValues:f,matchType:t,registerModal:W,handleSubmit:H,handleCancel:F,handleSave:Y,doSaveQueryInfo:Z,saveInfo:C,saveTreeData:P,handleRemoveSaveInfo:ee,handleTreeSelect:$,fieldTreeData:R,addOne:v,removeOne:j,setFormModel:z,getSchema:N,loading:G,getQueryInfo:U,initDefaultValues:s}}const He={name:"OnlineSuperQuery",props:{config:{type:Object,default:[]},status:{type:Boolean,default:!1},online:{type:Boolean,default:!1}},components:{BasicModal:Oe,MinusCircleOutlined:Re,PlusOutlined:Ve,OnlineSuperQueryValComponent:Ue,FileTextOutlined:Pe,CloseCircleOutlined:Qe,AppstoreTwoTone:je,Divider:Ne},emits:["search"],setup(p,{emit:r}){const[f,t]=Ae(),{createMessage:W}=ve(),te=O(!0);function T(){t.closeModal()}function H(){if(p.online===!0){let s=x(!0);s&&s.length>0?(r("search",s,v.value),T()):W.warning("空条件无法查询！")}else{let s=x(!0);if(s&&s.length>0){let e=F(s);r("search",e)}else W.warning("空条件无法查询！")}}function F(s){let e=[];for(let i of s){let n=i.field,d=i.val;d instanceof Array&&(d=d.join(",")),e.push(ue(ne({},i),{field:n,val:d}))}return e.length>0?A.value=!0:A.value=!1,{superQueryMatchType:v.value,superQueryParams:encodeURI(JSON.stringify(e))}}function z(){V.values=[],h(!1);let s=F([]);r("search",s)}const{formRef:M,init:R,dynamicRowValues:V,matchType:v,registerModal:j,handleSave:w,doSaveQueryInfo:N,saveInfo:P,saveTreeData:I,handleTreeSelect:C,handleRemoveSaveInfo:G,fieldTreeData:q,addOne:h,removeOne:L,setFormModel:Y,getSchema:X,loading:Z,getQueryInfo:x,initDefaultValues:U}=We(),A=O(!1);ae(()=>p.status,s=>{A.value=s},{immediate:!0});function $(){t.openModal(),h(!0)}function ee(){return document.getElementsByClassName("jee-super-query-form")[0]}function u(s){}function k(s){s.val=""}return ae(()=>p.config,s=>{s&&R(s)},{immediate:!0}),{formRef:M,registerFormModal:f,init:R,handleChangeField:k,dynamicRowValues:V,matchType:v,historyCollapsed:te,registerModal:j,handleSubmit:H,handleCancel:T,handleSave:w,handleReset:z,doSaveQueryInfo:N,saveInfo:P,saveTreeData:I,handleTreeSelect:C,handleRemoveSaveInfo:G,fieldTreeData:q,addOne:h,removeOne:L,setFormModel:Y,getSchema:X,loading:Z,onFinish:u,getPopupContainer:ee,superQueryFlag:A,handleOpen:$,initDefaultValues:U,simpleImage:qe.PRESENTED_IMAGE_SIMPLE}}};const oe=p=>(ke("data-v-a07a59e4"),p=p(),be(),p),ze={class:"j-super-query-button"},Ge=oe(()=>E("span",null,"已有高级查询条件生效",-1)),Ye=oe(()=>E("span",null,"高级查询",-1)),Xe={style:{float:"left"}},Ze={slot:"description"},$e=oe(()=>E("span",null,"没有任何查询条件",-1)),et=oe(()=>E("div",null,"保存的查询",-1)),tt=["title"],lt={class:"icon-cancle"},at={style:{height:"80px","line-height":"75px",width:"100%","text-align":"center"}};function ot(p,r,f,t,W,te){const T=c("divider"),H=c("AppstoreTwoTone"),F=c("a-button"),z=c("a-button-group"),M=c("a-tooltip"),R=c("a-divider"),V=c("a-empty"),v=c("a-select-option"),j=c("a-select"),w=c("a-form-item"),N=c("a-col"),P=c("a-row"),I=c("a-tree-select"),C=c("online-super-query-val-component"),G=c("PlusOutlined"),q=c("MinusCircleOutlined"),h=c("a-space"),L=c("a-form"),Y=c("close-circle-outlined"),X=c("file-text-outlined"),Z=c("a-tree"),x=c("Icon"),U=c("a-card"),A=c("BasicModal"),$=c("a-input"),ee=c("a-modal");return b(),fe(pe,null,[E("div",ze,[t.superQueryFlag?(b(),B(M,{key:0,mouseLeaveDelay:.2},{title:o(()=>[Ge,a(T,{type:"vertical",style:{"background-color":"#fff"}}),E("a",{onClick:r[0]||(r[0]=(...u)=>t.handleReset&&t.handleReset(...u))},"清空")]),default:o(()=>[a(z,null,{default:o(()=>[a(F,{type:"primary",onClick:t.handleOpen},{default:o(()=>[a(H,{spin:!0}),Ye]),_:1},8,["onClick"])]),_:1})]),_:1})):(b(),B(F,{key:1,type:"primary",preIcon:"ant-design:filter-outlined",onClick:t.handleOpen},{default:o(()=>[y(" 高级查询 ")]),_:1},8,["onClick"]))]),(b(),B(Se,{to:"body"},[a(A,{title:"高级查询构造器",canFullscreen:!1,width:750,onRegister:t.registerFormModal,onOk:t.handleSubmit},{footer:o(()=>[E("div",Xe,[a(F,{loading:t.loading,onClick:t.handleReset},{default:o(()=>[y("重置")]),_:1},8,["loading","onClick"]),a(F,{loading:t.loading,onClick:t.handleSave},{default:o(()=>[y("保存查询")]),_:1},8,["loading","onClick"])]),a(F,{key:"submit",type:"primary",onClick:t.handleSubmit},{default:o(()=>[y("确定")]),_:1},8,["onClick"]),a(F,{key:"back",onClick:t.handleCancel},{default:o(()=>[y("关闭")]),_:1},8,["onClick"])]),default:o(()=>[t.dynamicRowValues.values.length==0?(b(),B(V,{key:0},{default:o(()=>[E("div",Ze,[$e,a(R,{type:"vertical"}),E("a",{onClick:r[1]||(r[1]=u=>t.addOne(-1))},"点击新增")])]),_:1})):we("",!0),a(P,{class:ie("j-super-query-modal-content")},{default:o(()=>[a(N,{sm:24,md:24},{default:o(()=>[me(a(P,null,{default:o(()=>[a(N,{md:12,xs:24},{default:o(()=>[a(w,{label:"匹配模式",labelCol:{md:6,xs:24},wrapperCol:{md:18,xs:24},style:{width:"100%"}},{default:o(()=>[a(j,{value:t.matchType,"onUpdate:value":r[2]||(r[2]=u=>t.matchType=u),getPopupContainer:u=>u==null?void 0:u.parentNode,style:{width:"100%"}},{default:o(()=>[a(v,{value:"and"},{default:o(()=>[y("AND（所有条件匹配）")]),_:1}),a(v,{value:"or"},{default:o(()=>[y("OR（任意一个匹配）")]),_:1})]),_:1},8,["value","getPopupContainer"])]),_:1})]),_:1})]),_:1},512),[[_e,t.dynamicRowValues.values.length>0]]),me(a(L,{ref:"formRef",class:ie("jee-super-query-form"),model:t.dynamicRowValues,onFinish:t.onFinish},{default:o(()=>[(b(!0),fe(pe,null,De(t.dynamicRowValues.values,(u,k)=>(b(),B(h,{key:u.key,style:{display:"flex","margin-bottom":"8px"},align:u.curLineAlign?u.align:"baseline"},{default:o(()=>[a(w,{name:["values",k,"field"],style:{width:"150px"}},{default:o(()=>[a(I,{style:{width:"100%"},placeholder:"请选择字段",value:u.field,"onUpdate:value":s=>u.field=s,"show-search":"","tree-node-filter-prop":"title","allow-clear":"","tree-default-expand-all":"","dropdown-style":{maxHeight:"180px",overflow:"auto"},listHeight:160,onChange:s=>t.handleChangeField(u),"tree-data":t.fieldTreeData},null,8,["value","onUpdate:value","onChange","tree-data"])]),_:2},1032,["name"]),a(w,{name:["values",k,"rule"],style:{width:"100px"}},{default:o(()=>[a(j,{style:{width:"100%"},placeholder:"请选择匹配规则",value:u.rule,"onUpdate:value":s=>u.rule=s},{default:o(()=>[a(v,{value:"eq"},{default:o(()=>[y("等于")]),_:1}),a(v,{value:"like"},{default:o(()=>[y("模糊")]),_:1}),a(v,{value:"right_like"},{default:o(()=>[y("以..开始")]),_:1}),a(v,{value:"left_like"},{default:o(()=>[y("以..结尾")]),_:1}),a(v,{value:"in"},{default:o(()=>[y("在...中")]),_:1}),a(v,{value:"ne"},{default:o(()=>[y("不等于")]),_:1}),a(v,{value:"gt"},{default:o(()=>[y("大于")]),_:1}),a(v,{value:"ge"},{default:o(()=>[y("大于等于")]),_:1}),a(v,{value:"lt"},{default:o(()=>[y("小于")]),_:1}),a(v,{value:"le"},{default:o(()=>[y("小于等于")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"]),a(w,{name:["values",k,"val"],style:{width:"300px"}},{default:o(()=>[a(C,{style:{width:"100%"},schema:t.getSchema(u,k),formModel:u,setFormModel:(s,e)=>{t.setFormModel(s,e,u)},onSubmit:t.handleSubmit},null,8,["schema","formModel","setFormModel","onSubmit"])]),_:2},1032,["name"]),a(w,null,{default:o(()=>[a(F,{onClick:s=>t.addOne(k),style:{"margin-right":"6px"}},{default:o(()=>[a(G)]),_:2},1032,["onClick"]),a(F,{onClick:s=>t.removeOne(u)},{default:o(()=>[a(q)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["align"]))),128))]),_:1},8,["model","onFinish"]),[[_e,t.dynamicRowValues.values.length>0]])]),_:1})]),_:1}),a(U,{class:ie(["j-super-query-history-card",{collapsed:t.historyCollapsed}]),bordered:!1},{title:o(()=>[et]),default:o(()=>[t.saveTreeData.length===0?(b(),B(V,{key:0,class:"j-super-query-history-empty",image:t.simpleImage,description:"没有保存的查询"},null,8,["image"])):(b(),B(Z,{key:1,class:"j-super-query-history-tree",treeData:t.saveTreeData,selectedKeys:[],"show-icon":!0,onSelect:t.handleTreeSelect},{title:o(({title:u})=>[E("div",null,[E("span",{title:u},Be(u.length>10?u.substring(0,10)+"...":u),9,tt),E("span",lt,[a(Y,{onClick:k=>t.handleRemoveSaveInfo(u)},null,8,["onClick"])])])]),custom:o(()=>[a(X)]),_:1},8,["treeData","onSelect"])),E("div",{class:"collapse-box",onClick:r[3]||(r[3]=u=>t.historyCollapsed=!t.historyCollapsed)},[t.historyCollapsed?(b(),B(x,{key:0,icon:"ant-design:caret-left"})):(b(),B(x,{key:1,icon:"ant-design:caret-right"}))])]),_:1},8,["class"])]),_:1},8,["onRegister","onOk"])])),a(ee,{title:"请输入保存的名称",open:t.saveInfo.visible,onCancel:r[5]||(r[5]=u=>t.saveInfo.visible=!1),onOk:t.doSaveQueryInfo},{default:o(()=>[E("div",at,[a($,{value:t.saveInfo.title,"onUpdate:value":r[4]||(r[4]=u=>t.saveInfo.title=u),style:{width:"90%"},placeholder:"请输入保存的名称"},null,8,["value"])])]),_:1},8,["open","onOk"])],64)}const Ut=Te(He,[["render",ot],["__scopeId","data-v-a07a59e4"]]);export{Ut as default};
