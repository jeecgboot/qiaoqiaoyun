var _=(c,w,d)=>new Promise((f,I)=>{var x=s=>{try{U(d.next(s))}catch(r){I(r)}},D=s=>{try{U(d.throw(s))}catch(r){I(r)}},U=s=>s.done?f(s.value):Promise.resolve(s.value).then(x,D);U((d=d.apply(c,w)).next())});import{d as ne,f as u,w as se,V as y,a6 as m,af as h,ai as a,k as i,E as P,a8 as O,a7 as z,am as E,ak as R,F as $,W,ag as G,u as e,a3 as re,a4 as le,a5 as K}from"./vue-vendor-24c7dc61.js";import{B as oe}from"./index-1c3affea.js";import{e as ue,s as ie}from"./depart.api-339f4da6.js";import{k as ce,c as Le,a7 as de,a as fe,l as ve}from"./index-831af9dd.js";import{M as Ie}from"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";const ge=c=>ce.get({url:"/sys/tenant/getCurrentUserTenant",params:c});const Q=c=>(re("data-v-9b3269b0"),c=c(),le(),c),ye=Q(()=>K("span",null,"您隶属于多租户，请选择当前所属租户",-1)),me=Q(()=>K("span",null,"您隶属于多部门，请选择当前所在部门",-1)),pe=ne({__name:"DepartSelect",props:{title:{type:String,default:"部门选择"},closable:{type:Boolean,default:!1},username:{type:String,default:""}},setup(c,{expose:w}){const d=c,f=de(),{createMessage:I,notification:x}=fe(),D={labelCol:{span:4},wrapperCol:{span:18}},U={maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},s=u(""),r=u(!1),k=u(""),v=u(),S=u([]),b=u(""),g=u(!1),L=u(""),p=u(""),N=u([]),B=u(""),C=u(!1);function X(){return _(this,null,function*(){yield j(),yield Y(),e(r)&&e(g)?s.value="切换租户和部门":e(r)?s.value=e(k)&&e(k).length>0?`租户切换（当前租户 :${e(k)}）`:d.title:e(g)&&(s.value=e(L)&&e(L).length>0?`部门切换（当前部门 :${e(L)}）`:d.title),(e(r)||e(g))&&(C.value=!0)})}function j(){return _(this,null,function*(){const t=yield ue();if(!t.list||t.list.length==0)return;let n=t.list.filter(o=>o.orgCode==t.orgCode);N.value=t.list,p.value=n&&n.length>0?t.orgCode:"",L.value=n&&n.length>0?n[0].departName:"",g.value=!0})}function Y(){return _(this,null,function*(){const t=yield ge();if(!t.list||t.list.length==0)return;let n=f.getTenant,o=t.list.filter(T=>T.id==n);k.value=o&&o.length>0?o[0].name:"",S.value=t.list,v.value=n,r.value=!0})}function Z(){return _(this,null,function*(){if(e(r)&&e(v)==null)return b.value="error",!1;if(e(g)&&!e(p))return B.value="error",!1;A().then(()=>{e(r)&&f.setTenant(e(v)),I.success("切换成功"),window.location.reload()}).catch(t=>{}).finally(()=>{e(r)&&f.setTenant(e(v)),M()})})}function A(){return new Promise((t,n)=>_(this,null,function*(){if(!e(g))t();else{const o=yield ie({username:f.getUserInfo.username,orgCode:e(p),loginTenantId:e(v)});if(o.userInfo){const T=o.userInfo;f.setUserInfo(T),t()}else ee(o),f.logout(),n()}}))}function ee(t){x.error({message:"登录失败",description:((t.response||{}).data||{}).message||t.message||"请求出现错误，请稍后再试",duration:4})}function M(){te()}function te(){s.value="",r.value=!1,k.value="",v.value="",S.value=[],b.value="",g.value=!1,L.value="",p.value="",N.value=[],B.value="",C.value=!1}return se(()=>d.username,t=>{t&&j()}),w({show:X}),(t,n)=>{const o=y("a-avatar"),T=y("a-tooltip"),q=y("Icon"),F=y("a-select-option"),V=y("a-select"),H=y("a-form-item"),ae=y("a-form"),J=y("a-button");return m(),h(e(oe),G(U,{maxHeight:500,title:s.value,visible:C.value,"onUpdate:visible":n[2]||(n[2]=l=>C.value=l),wrapClassName:"loginSelectModal"}),{footer:a(()=>[i(J,{onClick:M},{default:a(()=>[P("关闭")]),_:1}),i(J,{onClick:Z,type:"primary"},{default:a(()=>[P("确认")]),_:1})]),default:a(()=>[i(ae,G({ref:"formRef"},D,{colon:!1,class:"loginSelectForm"}),{default:a(()=>[r.value?(m(),h(H,{key:0,"validate-status":b.value},{label:a(()=>[i(T,{placement:"topLeft"},{title:a(()=>[ye]),default:a(()=>[i(o,{style:{"background-color":"#87d068"},size:30},{default:a(()=>[P(" 租户 ")]),_:1})]),_:1})]),default:a(()=>[i(V,{value:v.value,"onUpdate:value":n[0]||(n[0]=l=>v.value=l),placeholder:"请选择登录部门",class:O({"valid-error":b.value=="error"})},{suffixIcon:a(()=>[i(q,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),z($,null,E(S.value,l=>(m(),h(F,{key:l.id,value:l.id},{default:a(()=>[P(R(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):W("",!0),g.value?(m(),h(H,{key:1,"validate-status":B.value},{label:a(()=>[i(T,{placement:"topLeft"},{title:a(()=>[me]),default:a(()=>[i(o,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:a(()=>[P(" 部门 ")]),_:1})]),_:1})]),default:a(()=>[i(V,{value:p.value,"onUpdate:value":n[1]||(n[1]=l=>p.value=l),placeholder:"请选择登录部门",class:O({"valid-error":B.value=="error"})},{suffixIcon:a(()=>[i(q,{icon:"ant-design:gold-outline"})]),default:a(()=>[(m(!0),z($,null,E(N.value,l=>(m(),h(F,{key:l.orgCode,value:l.orgCode},{default:a(()=>[P(R(l.departName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","class"])]),_:1},8,["validate-status"])):W("",!0)]),_:1},16)]),_:1},16,["title","visible"])}}});const we=ve(pe,[["__scopeId","data-v-9b3269b0"]]);export{we as default};
