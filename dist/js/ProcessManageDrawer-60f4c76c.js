var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var N=(o,s,t)=>s in o?Q(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t,B=(o,s)=>{for(var t in s||(s={}))Y.call(s,t)&&N(o,t,s[t]);if(T)for(var t of T(s))Z.call(s,t)&&N(o,t,s[t]);return o},q=(o,s)=>W(o,X(s));var f=(o,s,t)=>new Promise((i,c)=>{var g=r=>{try{n(t.next(r))}catch(a){c(a)}},d=r=>{try{n(t.throw(r))}catch(a){c(a)}},n=r=>r.done?i(r.value):Promise.resolve(r.value).then(g,d);n((t=t.apply(o,s)).next())});import{f as k,o as ee,j as oe,V as w,a6 as b,af as L,ag as se,ai as C,k as I,a5 as $,d as te,e as R,l as u,w as re,u as S,ap as ne,aq as ae,E as ie}from"./vue-vendor-24c7dc61.js";import{_ as le,a0 as pe}from"./antd-vue-vendor-0d72f01e.js";import{B as ce}from"./index-1c3affea.js";import{l as F,j as de,b as ue,c as me,q as fe,h as ge,e as ye,a as we}from"./index-831af9dd.js";import{u as _e}from"./index-3c281896.js";import{B as ve,a as De}from"./index-44229d9b.js";import{D as he,u as ke}from"./index-39efa5fe.js";import{p as v}from"./low.app.api-97fc250a.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./vxe-table-vendor-8813019a.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";const Ce={name:"ProcessDesignModal",components:{BasicModal:ce},props:{lowAppId:{type:String,required:!0}},emits:["success","register"],setup(o,{emit:s}){const t={padding:"0",height:window.innerHeight-25+"px"},i=k(!1),c=k(""),g=window.innerHeight-5+"px",[d]=de(l=>{i.value=!0,r(l.id)});function n(){i.value=!1}function r(l){let m=ue(),_="&tenantId="+me();const P=window._CONFIG.domianURL+"/act/designer/index";l!=null&&l!==""?c.value=P+"?id="+l+"&token="+m+"&lowAppId="+o.lowAppId+_:c.value=P+"?token="+m+"&lowAppId="+o.lowAppId+_}ee(()=>{window.addEventListener("message",a)}),oe(()=>{window.removeEventListener("message",a)});function a(l){const m=l.data;m.cmd==="saveProcessDef"&&s("success",m)}return{registerModal:d,bodyStyle:t,spinningLoading:i,iframeSrc:c,iframeHeight:g,iframeLoaded:n}}},Pe=["src","height"];function Me(o,s,t,i,c,g){const d=w("a-spin"),n=w("BasicModal");return b(),L(n,se(o.$attrs,{onRegister:i.registerModal,wrapClassName:"jee-process-modal",width:"100%",style:{top:"0",padding:"0"},bodyStyle:i.bodyStyle,footer:null,canFullscreen:!1,keyboard:"",defaultFullscreen:"",destroyOnClose:""}),{default:C(()=>[I(d,{spinning:i.spinningLoading},{default:C(()=>[$("iframe",{id:"processDesign",src:i.iframeSrc,height:i.iframeHeight,onLoad:s[0]||(s[0]=(...r)=>i.iframeLoaded&&i.iframeLoaded(...r)),frameborder:"0",width:"100%",scrolling:"auto"},null,40,Pe)]),_:1},8,["spinning"])]),_:1},16,["onRegister","bodyStyle"])}const Be=F(Ce,[["render",Me]]),be=te({name:"ProcessManageDrawer",components:{BasicDrawer:ve,Description:he,LowProcessDesignModal:Be},emits:["register"],props:{lowAppId:{type:String,required:!0}},setup(o){const s=fe(),{prefixCls:t}=ge("process-manage-drawer"),{createMessage:i,createConfirm:c}=we(),{createJPrompt:g}=_e(),d=k(!1),n=k(),r=k(null),a=k(null),l=R(()=>a.value!=null),[m,{closeDrawer:_,setDrawerProps:P}]=De(j),[O,U]=ye(),A=u(le,{type:"vertical"}),[V]=ke({data:a,schema:[{field:"processName",label:"流程名称"},{field:"processKey",label:"流程编码"},{field:"processType",label:"流程类型"},{field:"titleExp",label:"业务标题",render:()=>{var h;let e=[],p=((h=r.value)==null?void 0:h.titleExp)||"";return e.push(u("span",{title:p},p)),e.push(A),e.push(u("a",{onClick:G},"修改")),u("div",{class:[`${t}-title-exp`]},e)}},{field:"processStatus",label:"发布状态",render:e=>{let p=[],h=e===1?"green":"#CCCCCC";return p.push(u(pe,{color:h,style:{margin:0}},()=>e===1?"已发布":"未发布")),p.push(A),e===0?p.push(u("a",{key:"deploy",onClick:E},"立即发布")):p.push(u("a",{key:"deploy",onClick:E},"重新发布")),u("div",{key:e},p)}},{field:"createTime",label:"创建时间"},{field:"action",label:"",render(){let e=[];return e.push(u("a",{key:"design",onClick:x},"设计流程")),e.push(A),e.push(u("a",{key:"delete",onClick:z,style:{color:"red"}},"删除流程")),u("div",{},e)}}],column:1,labelStyle:{textAlign:"right",width:"120px"}}),H=R(()=>{let e={width:500,title:"流程管理",confirmLoading:S(d)};return q(B(B(B({},S(s)),e),o),{onOk:_,onCancel:_,onRegister:m})});re(n,()=>D(),{immediate:!0});function j(e){n.value=e==null?void 0:e.record}function D(){return f(this,null,function*(){if(n.value){y(!0);try{r.value=yield v.queryFormLinkByTableName(n.value.desformCode),r.value?a.value=yield v.queryById(r.value.processId):a.value=null}finally{y(!1)}}})}function y(e){d.value=e,P({confirmLoading:e})}function x(){let e=l.value?a.value.id:"";U.openModal(!0,{id:e})}function J(e){e.cmd==="saveProcessDef"&&K(e.processkey)}function K(e){return f(this,null,function*(){if(!S(l))try{let h;y(!0);let p=yield v.queryProcessByKey(e);if(!p){i.error("流程定义不存在");return}g({title:"业务标题表达式",defaultValue:`${n.value.desformName}【】`,placeholder:"请输入标题表达式",required:!0,closable:!1,maskClosable:!1,cancelButtonProps:{style:{display:"none"}},onOk(M){return f(this,null,function*(){yield v.formAddLink({processId:p.id,formDealStyle:"default",formType:"2",formTableName:n.value.desformCode,relationCode:`desform_${n.value.desformCode}`,flowStatusCol:"bpm_status",titleExp:M}),D()})}})}finally{y(!1)}})}function E(){return f(this,null,function*(){c({title:"发布流程",iconType:"info",content:"确定要发布流程吗？",onOk(){return f(this,null,function*(){try{y(!0),yield v.deployProcess(a.value.id),yield D()}finally{y(!1)}})}})})}function z(){return f(this,null,function*(){c({title:"删除流程",iconType:"warning",content:"删除要发布流程吗？删除后不可恢复！",onOk(){return f(this,null,function*(){try{y(!0),yield v.deleteProcess(a.value.id),yield D()}finally{y(!1)}})}})})}function G(){var e;g({title:"修改业务标题表达式",defaultValue:((e=r.value)==null?void 0:e.titleExp)||"",placeholder:"请输入标题表达式",required:!0,onOk(h){return f(this,null,function*(){var M;yield v.formEditLink({id:(M=r.value)==null?void 0:M.id,titleExp:h}),D()})}})}return{getProps:H,loading:d,processData:a,loadData:D,onDesignSuccess:J,openDesignModal:x,registerDesc:V,registerDesignModal:O}}});function Le(o,s,t,i,c,g){const d=w("Description"),n=w("a-divider"),r=w("a-empty"),a=w("a-spin"),l=w("LowProcessDesignModal"),m=w("BasicDrawer");return b(),L(m,ne(ae(o.getProps)),{default:C(()=>[I(a,{spinning:o.loading},{default:C(()=>[o.processData!=null?(b(),L(d,{key:0,onRegister:o.registerDesc},null,8,["onRegister"])):(b(),L(r,{key:1,style:{"margin-top":"80px"}},{description:C(()=>[ie(" 尚未设计流程 "),I(n,{type:"vertical"}),$("a",{onClick:s[0]||(s[0]=(..._)=>o.openDesignModal&&o.openDesignModal(..._))},"点击设计")]),_:1}))]),_:1},8,["spinning"]),I(l,{onRegister:o.registerDesignModal,onSuccess:o.onDesignSuccess,lowAppId:o.lowAppId},null,8,["onRegister","onSuccess","lowAppId"])]),_:1},16)}const Mo=F(be,[["render",Le]]);export{Mo as default};
