var ge=Object.defineProperty;var q=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var G=(d,a,r)=>a in d?ge(d,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[a]=r,S=(d,a)=>{for(var r in a||(a={}))ve.call(a,r)&&G(d,r,a[r]);if(q)for(var r of q(a))_e.call(a,r)&&G(d,r,a[r]);return d};var z=(d,a,r)=>new Promise((e,y)=>{var v=f=>{try{A(r.next(f))}catch(D){y(D)}},C=f=>{try{A(r.throw(f))}catch(D){y(D)}},A=f=>f.done?e(f.value):Promise.resolve(f.value).then(v,C);A((r=r.apply(d,a)).next())});import{f as U,I as j,a3 as Ce,a4 as Ae,a5 as n,ay as Fe,V as m,a6 as p,a7 as g,F as _,k as c,ak as O,ai as h,E as b,am as H,af as L,W as T}from"./vue-vendor-24c7dc61.js";import ye from"./BasicTable-d435f501.js";import{r as De}from"./application.data-33c48cb5.js";import{u as be,c as Ee}from"./application.api-4e2bde90.js";import{u as ke}from"./useRoleAuth-039fb12a.js";import Ie from"./ViewCurdAuthTable-7d5707fb.js";import Be from"./RoleAuthDrawer-e478a562.js";import xe from"./FormAuthDrawer-ec07a39e.js";import{u as we}from"./index-44229d9b.js";import{l as Re}from"./index-831af9dd.js";import"./antd-vue-vendor-0d72f01e.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./helper-22dafba0.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./useListPage-62a041ef.js";import"./index-621e597c.js";import"./RoleCheckBox-ff98d496.js";import"./AuthRecord-c2685ecc.js";import"./AuthOperation-f0820b93.js";import"./AuthField-ed45cd67.js";import"./ComponentIcon-f1bbb90f.js";const Le={name:"RoleInfo",components:{BasicTable:ye,ViewCurdAuthTable:Ie,RoleAuthDrawer:Be,FormAuthDrawer:xe},props:{appId:{type:String,default:""}},emits:["ok","cancel","tab-change"],setup(d,{emit:a}){const r=U(),{roleInfo:e,easyAuthRecord:y,easyAuthOperations:v,selectOptions:C,checkboxOptions:A,initDictData:f,initAuthInfo:D,resetForm:N,selectAllEasyAuthOperations:V,superAuthFormData:x,superAuthRecordData:E,superAuthOperationData:k,superAuthFieldData:I,subordinateBool:B,menuList:K}=ke(d),o=U(!1);function J(t){return z(this,null,function*(){t.code=="admin"?Object.keys(e).map(i=>{e[i]=t[i]}):(yield f(),yield D(t)),o.value=!1})}function Q(){return z(this,null,function*(){let t=P();t.id=e.id,yield be(t),a("ok",e.id)})}function X(){N(),o.value=!1}function Y(){return z(this,null,function*(){let t=P();const i=yield Ee(t);a("ok",i)})}function P(){let t={name:e.name,description:e.description,authMode:e.authMode,appId:d.appId,orderNum:e.orderNum};if(e.authMode=="easy"){let i=[];i.push({scopeKey:y.scopeKey,subordinate:y.subordinate}),t.recordAuthList=i;let u=[];if(v.value.length>0)for(let l of v.value)u.push({opKey:l,opType:"easy",opStatus:1});t.operationAuthList=u}else{let i=r.value.getSaveData();t.formAuthList=i;let u=j(E.value);t.recordAuthList=u;let l=j(k.value);t.operationAuthList=l;let s=j(I.value);t.fieldAuthList=s}return t}function Z(){a("cancel")}function $(){}const w=U(!0);function ee(){w.value===!0?v.value=[]:V(),w.value=!w.value,o.value=!0}function te(t){t.length==0&&(w.value=!1),o.value=!0}function oe(t){if(o.value=!0,t=="readonly"){let i=v.value,u=i.indexOf("add");u>=0&&(i.splice(u,1),v.value=i)}}function ae(t){o.value=!0}function ne(t){o.value=!0}function ie(t){o.value=!0}function ue(t){o.value=!0}const[le,{openDrawer:re}]=we();function se(t,i){let{fieldAuthList:u,operationAuthList:l,recordAuthList:s}=de(t.code);re(!0,{title:t.title,code:t.code,status:i,recordAuthList:s,operationAuthList:l,fieldAuthList:u})}function de(t){let i=E.value,u=[];i&&i.length>0&&(u=i.filter(R=>R.designFormCode==t));let l=k.value,s=[];l&&l.length>0&&(s=l.filter(R=>R.designFormCode==t));let M=I.value,W=[];return M&&M.length>0&&(W=M.filter(R=>R.designFormCode==t)),{fieldAuthList:W,operationAuthList:s,recordAuthList:u}}function ce(t,i){let u=E.value,l=[];u&&u.length>0&&(l=u.filter(s=>s.designFormCode!=t));for(let s of i)l.push(S({},s));E.value=l,o.value=!0}function pe(t,i){let u=k.value,l=[];u&&u.length>0&&(l=u.filter(s=>s.designFormCode!=t));for(let s of i)l.push(S({},s));k.value=l,o.value=!0}function he(t,i){let u=I.value,l=[];u&&u.length>0&&(l=u.filter(s=>s.designFormCode!=t));for(let s of i)l.push(S({},s));I.value=l,o.value=!0}function fe(){o.value=!0}function me(t){t.preventDefault(),t.stopPropagation(),a("tab-change")}return{roleInfo:e,createRole:$,show:J,roleColumns:De,onFormSetting:se,registerDrawer:le,selectOptions:C,checkboxOptions:A,handleCheckChange:te,easyAuthRecord:y,easyAuthOperations:v,allCheck:w,changeAllSelect:ee,onChangeName:ae,onChangeDescription:ne,onChangeScopeKey:oe,onChangeMode:ie,onChangeSubordinate:ue,goRoleUserTab:me,back:Z,createInfo:Y,resetInfo:X,saveInfo:Q,dataChangeStatus:o,superAuthFormData:x,curdAuthTableRef:r,subordinateBool:B,onAuthRecordChange:ce,onAuthOperationChange:pe,onAuthFieldChange:he,onAuthFormDataChange:fe,menuList:K}}};const F=d=>(Ce("data-v-139d31ed"),d=d(),Ae(),d),Se={class:"role-right flex flex-column",style:{position:"relative"}},ze={class:"right-form"},Oe={style:{"max-width":"1250px"}},Te={class:"align-center flex-flow"},Ne=F(()=>n("div",{class:"font-size14 font-blob700 flex"},"角色名称",-1)),Ve=F(()=>n("span",{style:{"margin-left":"5px"}},"查看用户",-1)),Ke={class:"margin-top8"},Me={class:"role-name"},Ue=Fe('<div class="font-size14 margin-top25 font-blob700" data-v-139d31ed> 描述 </div><div class="margin-top8" data-v-139d31ed><div class="role-desc" data-v-139d31ed> 应用管理员可以配置应用，管理应用下所有数据和人员 </div></div><div class="font-size14 margin-top25 font-blob700" data-v-139d31ed> 权限 </div><div class="des-role" data-v-139d31ed> 拥有所有权限<span style="color:#9e9e9e;" data-v-139d31ed>（应用管理员为系统内置角色，不可修改）</span></div>',4),je={class:"margin-top8"},Pe={style:{width:"300px"}},We=F(()=>n("div",{class:"font-size14 margin-top25 font-blob700"}," 描述 ",-1)),qe={class:"margin-top8"},Ge=F(()=>n("div",{class:"font-size14 margin-top25 font-blob700"}," 分发哪些应用项 ",-1)),He={class:"margin-top8 font-size14"},Je=F(()=>n("div",{class:"font-size14 margin-top25 font-blob700"}," 权限 ",-1)),Qe={class:"margin-top8 font-size14"},Xe={class:"select-auth"},Ye=F(()=>n("div",{style:{"margin-top":"15px"}},null,-1)),Ze={class:"font-size14 margin-top25 font-blob700"},$e=F(()=>n("span",null,"操作权限",-1)),et={class:"margin-top8 font-size14"},tt=F(()=>n("div",{class:"font-size14",style:{"margin-top":"32px",color:"#757575"}}," 可以访问的视图和数据操作权限 ",-1)),ot={class:"margin-top8 font-size14"},at={key:0,class:"footer flex-flow",style:{"align-items":"center",padding:"0","padding-left":"48px",height:"80px"}},nt={style:{"margin-right":"20px"}},it={style:{"margin-right":"20px"}};function ut(d,a,r,e,y,v){const C=m("Icon"),A=m("a-input"),f=m("a-radio"),D=m("a-radio-group"),N=m("a-select-option"),V=m("a-select"),x=m("a-tooltip"),E=m("a-checkbox"),k=m("a-checkbox-group"),I=m("ViewCurdAuthTable"),B=m("a-button"),K=m("FormAuthDrawer");return p(),g(_,null,[n("div",Se,[n("div",ze,[n("div",Oe,[n("div",Te,[Ne,n("span",{class:"see-user font-size14 pointer flex-flow align-center",onClick:a[0]||(a[0]=(...o)=>e.goRoleUserTab&&e.goRoleUserTab(...o))},[c(C,{icon:"ant-design:team-outlined"}),Ve])]),e.roleInfo.code=="admin"?(p(),g(_,{key:0},[n("div",Ke,[n("div",Me,O(e.roleInfo.name),1)]),Ue],64)):(p(),g(_,{key:1},[n("div",je,[n("div",Pe,[c(A,{value:e.roleInfo.name,"onUpdate:value":a[1]||(a[1]=o=>e.roleInfo.name=o),onChange:e.onChangeName},null,8,["value","onChange"])])]),We,n("div",qe,[n("div",null,[c(A,{value:e.roleInfo.description,"onUpdate:value":a[2]||(a[2]=o=>e.roleInfo.description=o),style:{width:"100%"},onChange:e.onChangeDescription},null,8,["value","onChange"])])]),Ge,n("div",He,[c(D,{value:e.roleInfo.authMode,"onUpdate:value":a[3]||(a[3]=o=>e.roleInfo.authMode=o),onChange:e.onChangeMode},{default:h(()=>[c(f,{value:"easy"},{default:h(()=>[b("分发所有应用项（简单）")]),_:1}),c(f,{value:"super"},{default:h(()=>[b("分发有选择的应用项（高级）")]),_:1})]),_:1},8,["value","onChange"])]),e.roleInfo.authMode==="easy"?(p(),g(_,{key:0},[Je,n("div",Qe,[n("div",null,[c(V,{value:e.easyAuthRecord.scopeKey,"onUpdate:value":a[4]||(a[4]=o=>e.easyAuthRecord.scopeKey=o),style:{width:"100%"},onChange:e.onChangeScopeKey},{default:h(()=>[(p(!0),g(_,null,H(e.selectOptions,o=>(p(),L(N,{value:o.value},{default:h(()=>[n("span",Xe,O(o.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","onChange"])]),Ye]),n("div",Ze,[$e,n("span",{class:"all-check pointer",onClick:a[5]||(a[5]=(...o)=>e.changeAllSelect&&e.changeAllSelect(...o))},O(e.allCheck?"取消全选":"全选"),1)]),n("div",et,[c(k,{value:e.easyAuthOperations,"onUpdate:value":a[6]||(a[6]=o=>e.easyAuthOperations=o),onChange:e.handleCheckChange},{default:h(()=>[(p(!0),g(_,null,H(e.checkboxOptions,o=>(p(),L(E,{value:o.value,disabled:o.value==="add"&&e.easyAuthRecord.scopeKey==="readonly"},{default:h(()=>[b(O(o.label)+" ",1),o.value=="share"?(p(),L(x,{key:0,title:"包含记录分享、视图分享",placement:"top"},{default:h(()=>[c(C,{icon:"ant-design:info-circle-outlined",color:"#9e9e9e",size:14})]),_:1})):T("",!0),o.value=="comment"?(p(),L(x,{key:1,title:"包含工作表讨论、记录讨论",placement:"top"},{default:h(()=>[c(C,{icon:"ant-design:info-circle-outlined",color:"#9e9e9e",size:14})]),_:1})):T("",!0),o.value=="log"?(p(),L(x,{key:2,title:"包含工作表日志、记录日志",placement:"top"},{default:h(()=>[c(C,{icon:"ant-design:info-circle-outlined",color:"#9e9e9e",size:14})]),_:1})):T("",!0)]),_:2},1032,["value","disabled"]))),256))]),_:1},8,["value","onChange"])])],64)):(p(),g(_,{key:1},[tt,n("div",ot,[c(I,{ref:"curdAuthTableRef",appId:r.appId,authData:e.superAuthFormData,menuList:e.menuList,onDataChange:e.onAuthFormDataChange,onSetting:e.onFormSetting},null,8,["appId","authData","menuList","onDataChange","onSetting"])])],64))],64))])]),e.roleInfo.code!="admin"?(p(),g("div",at,[e.roleInfo.id?(p(),g(_,{key:0},[n("div",nt,[c(B,{type:"primary",onClick:e.saveInfo,disabled:!e.dataChangeStatus},{default:h(()=>[b(" 保存 ")]),_:1},8,["onClick","disabled"])]),n("div",null,[c(B,{onClick:e.resetInfo,disabled:!e.dataChangeStatus},{default:h(()=>[b(" 取消 ")]),_:1},8,["onClick","disabled"])])],64)):(p(),g(_,{key:1},[n("div",it,[c(B,{type:"primary",onClick:e.createInfo},{default:h(()=>[b(" 创建 ")]),_:1},8,["onClick"])]),n("div",null,[c(B,{onClick:e.back},{default:h(()=>[b(" 删除 ")]),_:1},8,["onClick"])])],64))])):T("",!0)]),c(K,{onRegister:e.registerDrawer,onRecordChange:e.onAuthRecordChange,onOperationChange:e.onAuthOperationChange,onFieldChange:e.onAuthFieldChange},null,8,["onRegister","onRecordChange","onOperationChange","onFieldChange"])],64)}const fo=Re(Le,[["render",ut],["__scopeId","data-v-139d31ed"]]);export{fo as default};
