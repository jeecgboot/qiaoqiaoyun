var O=Object.defineProperty,z=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var R=(o,r,e)=>r in o?O(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e,B=(o,r)=>{for(var e in r||(r={}))G.call(r,e)&&R(o,e,r[e]);if(V)for(var e of V(r))I.call(r,e)&&R(o,e,r[e]);return o},T=(o,r)=>z(o,E(r));var y=(o,r,e)=>new Promise((m,d)=>{var p=a=>{try{l(e.next(a))}catch(u){d(u)}},n=a=>{try{l(e.throw(a))}catch(u){d(u)}},l=a=>a.done?m(a.value):Promise.resolve(a.value).then(p,n);l((e=e.apply(o,r)).next())});import{B as U}from"./index-1c3affea.js";import"./index-52c8c841.js";import{d as x,f as F,e as $,u as k,V as g,a6 as C,af as q,ap as H,aq as J,ai as A,k as M,a7 as Q,F as W,am as X}from"./vue-vendor-24c7dc61.js";import{h as Y}from"./antd-vue-vendor-0d72f01e.js";import{q as Z,j as tt,l as et}from"./index-831af9dd.js";import{settingAuth as ot}from"./auth.data-0f6cd267.js";import{s as L}from"./auth.api-15f2ddd8.js";import{B as rt,u as at}from"./useForm-14b2bc77.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./vxe-table-vendor-8813019a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";import"./index-b845562c.js";import"./desformUtils-c7daaa89.js";import"./helper-22dafba0.js";const it=x({name:"FieldAuthSettingModal",components:{BasicForm:rt,BasicModal:U},emits:["register"],setup(o){const r=Z(),e=F(!1),m=F(),d=F("1"),p=F([]),n=new Map,l=$(()=>{var t;return`授权（${(t=m.value)==null?void 0:t.authTitle}）`}),[a,{closeModal:u,setModalProps:b}]=tt(j);w("1","可见"),w("2","可编辑");const c=$(()=>{let t={width:800,title:k(l),confirmLoading:k(e)};return T(B(B(B({},k(r)),t),o),{onOk:D,onCancel:P,onRegister:a})});function S(t){return y(this,null,function*(){var s;h(!0);let{desformCode:i,authComKey:f}=t;try{let _=yield L.queryByCodeAndAuthComKey(i,f);for(let v of p.value)for(let K of _)if(v.key===K.authType){(s=n.get(v.key))==null||s.setFieldsValue(K);break}}finally{h(!1)}})}function w(t,i){const[f,s]=at({schemas:ot.formSchemas,showActionButtonGroup:!1});p.value.push({key:t,text:i,registerForm:f}),n.set(t,s)}function j(t){return y(this,null,function*(){yield N(i=>i.resetFields()),m.value=Y(t==null?void 0:t.record),S(m.value)})}function P(){u()}function D(){return y(this,null,function*(){var t;try{let{desformCode:i,authComKey:f}=m.value,s=[];for(let _ of p.value){let v=Object.assign({desformCode:i,authComKey:f,authType:_.key},yield(t=n.get(_.key))==null?void 0:t.validate());s.push(v)}h(!0),yield L.updateBatch(s),P()}finally{h(!1)}})}function h(t){e.value=t,b({confirmLoading:t})}function N(t){return y(this,null,function*(){let i={};for(let[f,s]of n.entries())i[f]=yield t(s);return i})}return{authTypes:p,tabActiveKey:d,getProps:c,loading:e}}});function st(o,r,e,m,d,p){const n=g("BasicForm"),l=g("a-tab-pane"),a=g("a-tabs"),u=g("a-spin"),b=g("BasicModal");return C(),q(b,H(J(o.getProps)),{default:A(()=>[M(u,{wrapperClassName:"p-2",spinning:o.loading},{default:A(()=>[M(a,{modelValue:o.tabActiveKey,"onUpdate:modelValue":r[0]||(r[0]=c=>o.tabActiveKey=c)},{default:A(()=>[(C(!0),Q(W,null,X(o.authTypes,c=>(C(),q(l,{tab:c.text,key:c.key,forceRender:""},{default:A(()=>[M(n,{onRegister:c.registerForm},null,8,["onRegister"])]),_:2},1032,["tab"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["spinning"])]),_:1},16)}const ee=et(it,[["render",st]]);export{ee as default};
