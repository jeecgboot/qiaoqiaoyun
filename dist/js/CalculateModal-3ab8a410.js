var N=Object.defineProperty,R=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var E=(a,e,t)=>e in a?N(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,S=(a,e)=>{for(var t in e||(e={}))J.call(e,t)&&E(a,t,e[t]);if(O)for(var t of O(e))V.call(e,t)&&E(a,t,e[t]);return a},M=(a,e)=>R(a,A(e));var w=(a,e,t)=>new Promise((l,v)=>{var m=n=>{try{i(t.next(n))}catch(d){v(d)}},f=n=>{try{i(t.throw(n))}catch(d){v(d)}},i=n=>n.done?l(n.value):Promise.resolve(n.value).then(m,f);i((t=t.apply(a,e)).next())});import{r as T,f as _,H as j,I as z,a3 as H,a4 as W,a5 as s,E as U,V as r,a6 as h,af as k,ai as c,k as p,a7 as I,F as L,am as D,ak as X,W as $}from"./vue-vendor-24c7dc61.js";import{B as q}from"./index-1c3affea.js";import G from"./JCalclateInput-0d22db8c.js";import{n as P,b4 as Q}from"./antd-vue-vendor-0d72f01e.js";import{b as Y}from"./aggregation.api-c441389c.js";import{j as Z,X as ee,l as te}from"./index-831af9dd.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./searchcursor-9651c8d5.js";import"./vxe-table-vendor-8813019a.js";const oe={name:"CalculateModal",components:{BasicModal:q,SearchOutlined:P,CaretRightOutlined:Q,JCalclateInput:G},emits:["success","register"],setup(a,{emit:e}){const t=T({id:"",name:"公式",formulas:""}),l=_(""),v=_(""),m=_(!1),f=_([]),i=_([]),n=_(),[d,{closeModal:g}]=Z(o=>w(this,null,function*(){yield F(),m.value=o.isUpdate,i.value=JSON.parse(JSON.stringify(o.relationForms.formList)),yield x(),m.value?Object.assign(t,o.record):t.id=ee()}));function F(){t.id="",t.name="公式",t.formulas=""}function x(){i.value.forEach(o=>w(this,null,function*(){const u=yield Y(o.value,{subTable:!0});let y=(u==null?void 0:u.fields)||[];y.length>0&&(o.fieldOptions=y.filter(B=>["number","integer","money","formula","summary"].includes(B.type))),f.value.push(...o.fieldOptions)}))}function b(o,u){n.value.insertContent(`$${o.name}@${o.model}@${u.value}@common$`)}function C(){e("success",z(t),m.value),g()}return M(S({searchText:l,activeKey:v,registerModal:d,formList:i,tagInput:n,allFields:f},j(t)),{addField:b,handleSubmit:C})}};const K=a=>(H("data-v-c526b615"),a=a(),W(),a),ae={style:{display:"flex"}},se={style:{width:"320px",height:"500px",background:"rgb(250, 250, 250)"}},le={style:{"max-height":"450px","overflow-y":"auto"}},ne={style:{"max-height":"500px","overflow-y":"auto","list-style":"none","padding-inline-start":"0"}},ie=["onClick"],re={class:"title overflow_ellipsis"},de={style:{flex:"1 1 0%",display:"flex","flex-direction":"column"}},ue={style:{flex:"1 1 0%",height:"260px",padding:"10px","border-bottom":"1px solid rgb(238, 238, 238)"}},ce={style:{"font-size":"20px","font-weight":"bold"}},pe=K(()=>s("span",{style:{width:"10%","margin-left":"10px"}},"=",-1)),me={style:{"margin-top":"10px"}},fe=K(()=>s("div",{style:{height:"200px",padding:"10px 30px","overflow-y":"auto"}},[s("ul",null,[s("li",null,"请从左侧面板选择要计算的字段名"),s("li",{style:{"margin-top":"10px"}},[U("公式编辑样式举例："),s("span",{class:"example-field"},"入库数量"),U(" - "),s("span",{class:"example-field"},"出库数量")])])],-1));function _e(a,e,t,l,v,m){const f=r("SearchOutlined"),i=r("a-input"),n=r("caret-right-outlined"),d=r("a-collapse-panel"),g=r("a-collapse"),F=r("a-tab-pane"),x=r("a-tabs"),b=r("JCalclateInput"),C=r("BasicModal");return h(),k(C,{onRegister:l.registerModal,title:"添加公式",width:1e3,height:500,canFullscreen:!1,destroyOnClose:"",onOk:l.handleSubmit},{default:c(()=>[s("div",ae,[s("div",se,[p(x,{centered:""},{default:c(()=>[p(F,{key:"1",tab:"字段"},{default:c(()=>[s("div",null,[p(i,{placeholder:"搜索"},{suffix:c(()=>[p(f,{style:{color:"rgba(0, 0, 0, 0.45)"}})]),_:1})]),s("div",le,[p(g,{ghost:"",accordion:"",activeKey:l.activeKey,"onUpdate:activeKey":e[0]||(e[0]=o=>l.activeKey=o),bordered:!1},{expandIcon:c(({isActive:o})=>[p(n,{rotate:o?90:0},null,8,["rotate"])]),default:c(()=>[(h(!0),I(L,null,D(l.formList,(o,u)=>(h(),k(d,{key:u,header:o.label,forceRender:""},{default:c(()=>[s("ul",ne,[(h(!0),I(L,null,D(o.fieldOptions,(y,B)=>(h(),I("li",{class:"fieldItem pointer",key:B,onClick:he=>l.addField(y,o)},[s("span",re,X(y.name),1)],8,ie))),128))])]),_:2},1032,["header"]))),128))]),_:1},8,["activeKey"])])]),_:1})]),_:1})]),s("div",de,[s("div",ue,[s("div",ce,[p(i,{value:a.name,"onUpdate:value":e[1]||(e[1]=o=>a.name=o),style:{width:"80%"}},null,8,["value"]),pe]),s("div",me,[l.allFields.length>0?(h(),k(b,{key:0,ref:"tagInput",value:a.formulas,"onUpdate:value":e[2]||(e[2]=o=>a.formulas=o),options:l.allFields,"onUpdate:options":e[3]||(e[3]=o=>l.allFields=o),formList:l.formList},null,8,["value","options","formList"])):$("",!0)])]),fe])])]),_:1},8,["onRegister","onOk"])}const Se=te(oe,[["render",_e],["__scopeId","data-v-c526b615"]]);export{Se as default};
