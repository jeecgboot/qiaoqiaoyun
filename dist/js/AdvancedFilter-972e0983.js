var _e=Object.defineProperty,Ce=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ne=(t,i,h)=>i in t?_e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:h}):t[i]=h,g=(t,i)=>{for(var h in i||(i={}))we.call(i,h)&&ne(t,h,i[h]);if(oe)for(var h of oe(i))Ie.call(i,h)&&ne(t,h,i[h]);return t},F=(t,i)=>Ce(t,ke(i));import{d as qe,f as Q,h as Fe,e as ie,w as se,I as H,n as be,a3 as Te,a4 as Se,a5 as c,V as I,a6 as a,a7 as d,F as q,am as $,af as M,ai as f,k as u,E as _,ak as P,z as ae,W as B,a8 as Be,O as Pe,ap as Re,aq as Ge}from"./vue-vendor-24c7dc61.js";import{aC as Oe,n as $e,av as Me,aZ as Ve,cm as Le,p as V}from"./antd-vue-vendor-0d72f01e.js";import{D as De,a as Qe,l as Ue}from"./index-831af9dd.js";import{s as Y,d as re}from"./type.definition-4eb605ee.js";import{c as Ee,u as Ae}from"./LinkRecordSelect-385d0eae.js";import{C as ze}from"./ComponentIcon-f1bbb90f.js";import Ne from"./SuperQueryValComponent-97f284a9.js";import"./vxe-table-vendor-8813019a.js";import"./index-1c3affea.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./SelectItem-04dd2229.js";import"./lowAppUtils-56892d30.js";import"./auto.desform.api-839115ed.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./componentMap-c857637c.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./useMethods-f689b480.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./TableImage-14ca1f5d.js";import"./SubTableTag-81763fd6.js";import"./CardCellFile-92b3c8c8.js";import"./helper-22dafba0.js";const je=qe({name:"AdvancedFilter",components:{PlusOutlined:Oe,SearchOutlined:$e,CloseOutlined:Me,TableOutlined:Ve,OnlineSuperQueryValComponent:Ne,SaveOutlined:Le,ComponentIcon:ze},emits:["save","copy","search","update:clear"],props:{columnList:{type:Array,default:()=>[]},info:{type:Object,require:!1,default:{}},saveButton:{type:Boolean,default:!0},clear:{type:Boolean,default:!1},emitChange:{type:String,default:""},parentContainer:{type:String,default:""}},setup(t,{emit:i}){const{getConditionOptions:h,getDefaultRule:x,getDefaultVal:ee}=Ae(),N=Q([]);function R(e){if(!e||e.length==0){N.value=[];return}let l=e.filter(o=>re.includes(o.type)||re.includes(o.realType)?o.type=="link-field"||o.realType==="link-field"?o.saveType==="save":!1:!0);N.value=l}const G=Q(!1),C=Q("and"),n=Q([]),{getSchema:O,getFieldConfig:J}=Ee(t,!0,t.parentContainer),{createMessage:j}=Qe();Fe(()=>{const e=t.columnList;R(e);const l=t.info;C.value=l.conditionType?l.conditionType:"and";let o;if(Array.isArray(l.conditions)&&l.conditions.length>0?o=l.conditions:o=l.conditionsGroup,o&&o.length>0){let r=!0,k=[],E=[];for(let w of o){let D=w.queryItems;if(D&&D.length>0){let b=[];for(const T of w.queryItems){let S="",A;if(A=e==null?void 0:e.find(z=>z.model==T.field),A||(A=Y.find(z=>z.field==T.field)),A&&(S=A.name),S){let z=V(T,"field","rule","val","type","timestamp");b.push(F(g({},z),{name:S,reloading:!1}))}}E.push({matchType:w.matchType,queryItems:b}),r=!1}else{let b="",T;if(T=e==null?void 0:e.find(S=>S.model==w.field),T||(T=Y.find(S=>S.field==w.field)),T&&(b=T.name),b){let S=V(w,"field","rule","val","type","timestamp");k.push(F(g({},S),{name:b,reloading:!1}))}r=!0}r&&E.push({matchType:w.conditionType||"and",queryItems:k})}n.value=E}else n.value=[]});function W(e,l=0){let o=e.field||e.model,r=n.value[l],k=x(e.type),E=ee(e.type),w=[],D=F(g({},V(e,"name","type","timestamp")),{field:o,rule:k,val:E});if(r&&r.queryItems&&r.queryItems.length>0){let b=r.queryItems;b.push(g({},D)),n.value[l].queryItems=b}else r?(w.push(g({},D)),n.value[l].queryItems=w):(w.push(g({},D)),n.value.push({matchType:"and",queryItems:w}));n.value[l]&&(n.value[l].showPop=!1),G.value=!1}const L=Q("");function Z(e){let l=L.value;return l?e?e.name.indexOf(l)>=0:!1:!0}function U(){let e=[];for(const l of n.value){const o=[];for(const r of l.queryItems)if(y(r)){const k=V(r,"field","rule","type","timestamp");o.push(F(g({},k),{val:H(r.val)}))}o.length>0&&e.push(F(g({},l),{queryItems:o}))}e.length>0?i("save",{conditions:null,conditionsGroup:e,conditionType:C.value?C.value:"and"}):j.warning("没有有效的条件值，不可保存！")}function p(){let e=[];for(let l of n.value)if(l.queryItems){const o=[];for(const r of l.queryItems)if(y(r)){let k=V(r,"field","rule","type","timestamp");o.push(F(g({},k),{val:H(r.val)}))}o.length>0&&e.push(F(g({},l),{queryItems:o}))}else if(y(l)){let o=V(l,"field","rule","type","timestamp");e.push(F(g({},o),{val:H(l.val)}))}e.length>0&&i("copy",{conditionsGroup:e,conditionType:C.value})}function v(e,l){let o=n.value[e];o.queryItems.splice(l,1),n.value[e]=o,n.value.length===1&&n.value[0].queryItems&&n.value[0].queryItems.length==0&&(n.value=[]),i("search",{conditions:[],conditionsGroup:n.value,conditionType:C.value})}function s(e){let l=n.value;l.splice(e,1),n.value.length==1&&n.value[0].queryItems.length==0&&l.splice(0,1),i("search",{conditions:[],conditionsGroup:n.value,conditionType:C.value}),n.value.length==0&&i("update:clear",!1)}function y(e){return e.val==="0"||e.val===0||e.val?!0:e.rule==="empty"||e.rule==="not_empty"}const m=ie(()=>{if(t.saveButton===!1)return!1;let e=n.value;if(!e||e.length==0)return!1;for(const l of e)if(!l.queryItems||l.queryItems.length==0)return!1;return!0}),K=ie(()=>{let e=n.value;if(!e||e.length==0)return!1;let l=!1;for(let o=0;o<e.length;o++)if(e[o].queryItems){if(e[o].queryItems.length==0){l=!1;break}for(let r=0;r<e[o].queryItems.length;r++){let k=e[o].queryItems[r];if(y(k))l=!0;else return l=!1,l}}else if(y(e[o]))l=!0;else{l=!1;break}return l});se(()=>t.clear,e=>{e===!0&&(n.value=[],G.value=!0)},{immediate:!0});function pe(e,l,o){o.val=l}function de(e){const l=J(e.field);let o=e.type,r=h(o,l.multiple);return!r||r.length==0?[]:r}function fe(){let e=[];for(let l of n.value){let o=[];for(const r of l.queryItems){let k=V(r,"field","rule","type","timestamp");o.push(F(g({},k),{val:H(r.val)}))}e.push({queryItems:o,matchType:l.matchType})}e.length>0&&i("search",{matchType:C.value,conditionType:C.value,conditionsGroup:e})}const te=De(fe,800);se(n.value,()=>{te()},{deep:!0});function ce(){te()}function me(e,l){e.reloading=!0,be(()=>{e.reloading=!1,n.value[l]&&(n.value[l].showPop=!1)})}function ve(){if(n.value.length==0)for(let e=0;e<2;e++)le();else le()}function le(){n.value.push({matchType:"and",showPop:!1,queryItems:[]})}const X=Q("");function ye(e){X.value=e}function he(){X.value=""}function ge(e){n.value[e]&&(n.value[e].showPop=!0)}return{conditionsGroupList:n,getOptions:de,conditionRelation:C,systemFields:Y,showPop:G,filterValue:L,onSelectField:W,isFilterItem:Z,saveCondition:U,copyCondition:p,onRemove:v,showSave:m,getSchema:O,saveable:K,setFormModel:pe,filterColumnList:N,onRelationChange:ce,onConditionRuleChange:me,addFilterGroup:ve,queryIndex:X,mouseMoveQuery:ye,mouseLeaveQuery:he,showPopField:ge,onConRemove:s}}});const ue=t=>(Te("data-v-20cfc742"),t=t(),Se(),t),We={class:"config-detail",style:{"padding-top":"0"}},Ze={class:"condition-item",style:{"margin-top":"12px",padding:"0 16px"}},He={key:0,style:{display:"flex"}},Je={style:{"font-size":"13px"}},Ke={class:"icon-remove",style:{position:"relative",top:"4px"}},Xe={class:"children-query",style:{"margin-top":"20px"}},Ye=["onMousemove"],xe={style:{width:"50px"}},et={key:0,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0 0 6px"}},tt={key:1,class:"condition-rela"},lt={key:2,style:{color:"rgb(117, 117, 117)",display:"inline-block",margin:"6px 0 0 7px"}},ot={style:{display:"flex",flex:"1","flex-direction":"column"}},nt={style:{"margin-bottom":"2px",display:"flex"}},it={style:{flex:"1"}},st={style:{"margin-right":"10px","max-width":"100px","font-weight":"bold"}},at={class:"condition-select",style:{width:"100px"}},rt={style:{width:"100%","margin-top":"0"},class:"condition-val"},ut={class:"field-list"},pt=["onClick"],dt=ue(()=>c("div",{class:"split"},null,-1)),ft=["onClick"],ct=["onClick"],mt={class:"field-list"},vt=["onClick"],yt=ue(()=>c("div",{class:"split"},null,-1)),ht=["onClick"],gt={style:{width:"100%","text-align":"right",position:"relative"}};function _t(t,i,h,x,ee,N){const R=I("a-select-option"),G=I("a-select"),C=I("a-divider"),n=I("close-outlined"),O=I("component-icon"),J=I("online-super-query-val-component"),j=I("search-outlined"),W=I("a-input"),L=I("PlusOutlined"),Z=I("a-popover"),U=I("a-button");return a(),d("div",We,[(a(!0),d(q,null,$(t.conditionsGroupList,(p,v)=>(a(),d("div",Ze,[v>0?(a(),d("div",He,[v===1?(a(),M(C,{key:0,style:{margin:"0"}},{default:f(()=>[u(G,{class:"no-select-boder",style:{width:"50px"},size:"small",value:t.conditionRelation,"onUpdate:value":i[0]||(i[0]=s=>t.conditionRelation=s),onChange:t.onRelationChange},{default:f(()=>[u(R,{value:"and"},{default:f(()=>[_("且")]),_:1}),u(R,{value:"or"},{default:f(()=>[_("或")]),_:1})]),_:1},8,["value","onChange"])]),_:1})):(a(),M(C,{key:1,style:{margin:"0"}},{default:f(()=>[c("span",Je,P(t.conditionRelation==="and"?"且":"或"),1)]),_:1})),c("div",Ke,[u(n,{onClick:ae(s=>t.onConRemove(v),["prevent"])},null,8,["onClick"])])])):B("",!0),(a(!0),d(q,null,$(p.queryItems,(s,y)=>(a(),d("div",Xe,[c("div",{style:{display:"flex"},onMousemove:m=>t.mouseMoveQuery(v+"-"+y),onMouseleave:i[1]||(i[1]=(...m)=>t.mouseLeaveQuery&&t.mouseLeaveQuery(...m))},[c("div",xe,[y===0?(a(),d("span",et,"当")):y===1?(a(),d("div",tt,[u(G,{style:{width:"50px"},size:"small",value:p.matchType,"onUpdate:value":m=>p.matchType=m,onChange:t.onRelationChange},{default:f(()=>[u(R,{value:"and"},{default:f(()=>[_("且")]),_:1}),u(R,{value:"or"},{default:f(()=>[_("或")]),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])])):(a(),d("span",lt,P(p.matchType==="and"?"且":"或"),1))]),c("div",ot,[c("div",nt,[c("div",it,[u(O,{type:s.type,style:{color:"rgb(158, 158, 158)"}},null,8,["type"]),c("span",st,P(s.name),1),c("span",at,[u(G,{style:{"min-width":"70px"},size:"small",value:s.rule,"onUpdate:value":m=>s.rule=m,dropdownStyle:{minWidth:"120px"},onChange:m=>t.onConditionRuleChange(s,v)},{default:f(()=>[(a(!0),d(q,null,$(t.getOptions(s),m=>(a(),M(R,{value:m.value},{default:f(()=>[_(P(m.label),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value","onChange"])])]),c("div",{class:Be(t.queryIndex==v+"-"+y?"icon-children-show":"icon-children-hide")},[u(n,{onClick:ae(m=>t.onRemove(v,y),["prevent"])},null,8,["onClick"])],2)]),c("div",rt,[s.reloading?B("",!0):(a(),M(J,{key:0,style:{width:"100%"},schema:t.getSchema(s,y),formModel:s,setFormModel:(m,K)=>{t.setFormModel(m,K,s)}},null,8,["schema","formModel","setFormModel"]))])])],40,Ye)]))),256)),t.conditionsGroupList.length>1?(a(),M(Z,{key:1,overlayClassName:"view-pop-field-select",visible:p.showPop,"onUpdate:visible":s=>p.showPop=s,trigger:"click"},{content:f(()=>[c("div",ut,[(a(!0),d(q,null,$(t.filterColumnList,s=>(a(),d(q,null,[t.isFilterItem(s)?(a(),d("div",{key:0,class:"field-item",onClick:y=>t.onSelectField(s,v)},[c("div",null,[u(O,{type:s.type},null,8,["type"]),_(P(s.name),1)])],8,pt)):B("",!0)],64))),256)),dt,(a(!0),d(q,null,$(t.systemFields,s=>(a(),d(q,null,[t.isFilterItem(s)?(a(),d("div",{key:0,class:"field-item",onClick:y=>t.onSelectField(s,v)},[c("div",null,[u(O,{type:s.type},null,8,["type"]),_(P(s.name),1)])],8,ft)):B("",!0)],64))),256))])]),title:f(()=>[u(W,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":i[2]||(i[2]=s=>t.filterValue=s)},{prefix:f(()=>[u(j,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:f(()=>[c("span",{class:"add-button",style:{"margin-top":"20px",cursor:"pointer",width:"80px"},onClick:s=>t.showPopField(v)},[u(L),_(" 筛选 ")],8,ct)]),_:2},1032,["visible","onUpdate:visible"])):B("",!0)]))),256)),t.conditionsGroupList.length<=1?(a(),M(Z,{key:0,overlayClassName:"view-pop-field-select",visible:t.showPop,"onUpdate:visible":i[4]||(i[4]=p=>t.showPop=p),trigger:"click"},{content:f(()=>[c("div",mt,[(a(!0),d(q,null,$(t.filterColumnList,p=>(a(),d(q,null,[t.isFilterItem(p)?(a(),d("div",{key:0,class:"field-item",onClick:v=>t.onSelectField(p)},[c("div",null,[u(O,{type:p.type},null,8,["type"]),_(" "+P(p.name),1)])],8,vt)):B("",!0)],64))),256)),yt,(a(!0),d(q,null,$(t.systemFields,p=>(a(),d(q,null,[t.isFilterItem(p)?(a(),d("div",{key:0,class:"field-item",onClick:v=>t.onSelectField(p)},[c("div",null,[u(O,{type:p.type},null,8,["type"]),_(P(p.name),1)])],8,ht)):B("",!0)],64))),256))])]),title:f(()=>[u(W,{placeholder:"搜索字段",class:"my-input",value:t.filterValue,"onUpdate:value":i[3]||(i[3]=p=>t.filterValue=p)},{prefix:f(()=>[u(j,{style:{color:"#c0c0c0"}})]),_:1},8,["value"])]),default:f(()=>[u(U,{class:"add-button add-filter",style:{"margin-top":"20px"},type:"text"},{default:f(()=>[u(L),_(" 添加筛选条件 ")]),_:1})]),_:1},8,["visible"])):B("",!0),u(U,{class:"add-button add-filter",style:{"margin-top":"20px","margin-left":"20px"},type:"text",onClick:t.addFilterGroup},{default:f(()=>[u(L),_(" 筛选组 ")]),_:1},8,["onClick"]),c("div",gt,[t.showSave?(a(),M(U,{key:0,class:"save-button",onClick:t.saveCondition,style:{right:"14px"}},{default:f(()=>[_("保存")]),_:1},8,["onClick"])):B("",!0),Pe(t.$slots,"save-button",Re(Ge({saveable:t.saveable})),void 0,!0)])])}const gl=Ue(je,[["render",_t],["__scopeId","data-v-20cfc742"]]);export{gl as default};
