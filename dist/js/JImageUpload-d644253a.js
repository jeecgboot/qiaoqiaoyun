import{d as J,f as l,e as I,w as j,n as z,a3 as de,a4 as ue,V as u,a6 as i,a7 as y,k as b,ai as _,af as U,a5 as O,ak as L,W as w,E as D}from"./vue-vendor-24c7dc61.js";import{ak as H,aO as R}from"./antd-vue-vendor-0d72f01e.js";import{u as W}from"./useFormItem-86503382.js";import{H as C,q as G,aL as K,ap as V,aM as Q,aN as X,a as Y,l as Z}from"./index-831af9dd.js";const{createMessage:F,createErrorModal:me}=Y(),x=J({name:"JImageUpload",components:{LoadingOutlined:H,UploadOutlined:R},inheritAttrs:!1,props:{value:C.oneOfType([C.string,C.array]),listType:{type:String,required:!1,default:"picture-card"},text:{type:String,required:!1,default:"上传"},bizPath:{type:String,required:!1,default:"temp"},disabled:{type:Boolean,required:!1,default:!1},fileMax:{type:Number,required:!1,default:1}},emits:["options-change","change","update:value"],setup(a,{emit:o,refs:M}){const T=l([]),k=G(),[c]=W(a,"value","change",T),m=e=>{if(e.lastIndexOf("\\")>=0){let t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)},p=K(),g=l(!1),r=l(!0);let s=l([]);const d=l(""),h=l(!1),N=I(()=>a.fileMax>1),S=I(()=>s.value.length<a.fileMax);j(()=>a.value,(e,t)=>{e&&e instanceof Array&&(e=e.join(",")),r.value==!0&&q(e)},{immediate:!0});function q(e){if(!e||e.length==0){s.value=[];return}let t=[];e.split(",").forEach(n=>{let f=V(n);t.push({uid:Q(10),name:m(n),status:"done",url:f,response:{status:"history",message:n}})}),s.value=t}function E(e){if(e.type.indexOf("image")<0)return F.info("请上传图片"),!1}function P({file:e,fileList:t,event:B}){r.value=!1,e.status==="error"&&F.error(`${e.name} 上传失败.`);let n=[],f=0;e.status!="uploading"&&(t.forEach(v=>{v.status==="done"&&n.push(v.response.message),v.status!="uploading"&&f++}),e.status==="removed"&&void 0,f==t.length&&(c.value=n.join(","),o("update:value",n.join(",")),z(()=>{r.value=!0})))}function le(e){}function $(e){d.value=e.url||e.thumbUrl,h.value=!0}function ie(){if(s.length>0){let e=s[0].url;return V(e,null)}}function A(){h.value=!1}return{state:c,attrs:k,previewImage:d,previewVisible:h,uploadFileList:s,multiple:N,headers:p,loading:g,uploadUrl:X,beforeUpload:E,uploadVisible:S,handlePreview:$,handleCancel:A,handleChange:P}}});const ee={class:"clearfix"},ae={key:0},te={key:0},se={class:"ant-upload-text"},ne=["src"];function oe(a,o,M,T,k,c){const m=u("LoadingOutlined"),p=u("UploadOutlined"),g=u("a-button"),r=u("a-upload"),s=u("a-modal");return i(),y("div",ee,[b(r,{listType:a.listType,accept:"image/*",multiple:a.multiple,action:a.uploadUrl,headers:a.headers,data:{biz:a.bizPath},fileList:a.uploadFileList,"onUpdate:fileList":o[0]||(o[0]=d=>a.uploadFileList=d),beforeUpload:a.beforeUpload,disabled:a.disabled,onChange:a.handleChange,onPreview:a.handlePreview},{default:_(()=>[a.uploadVisible?(i(),y("div",ae,[a.listType=="picture-card"?(i(),y("div",te,[a.loading?(i(),U(m,{key:0})):(i(),U(p,{key:1})),O("div",se,L(a.text),1)])):w("",!0),a.listType=="picture"?(i(),U(g,{key:1,disabled:a.disabled},{default:_(()=>[b(p),D(" "+L(a.text),1)]),_:1},8,["disabled"])):w("",!0)])):w("",!0)]),_:1},8,["listType","multiple","action","headers","data","fileList","beforeUpload","disabled","onChange","onPreview"]),b(s,{open:a.previewVisible,footer:null,onCancel:o[1]||(o[1]=d=>a.handleCancel())},{default:_(()=>[O("img",{alt:"example",style:{width:"100%"},src:a.previewImage},null,8,ne)]),_:1},8,["open"])])}const ge=Z(x,[["render",oe],["__scopeId","data-v-44ab81e5"]]);export{ge as J};
