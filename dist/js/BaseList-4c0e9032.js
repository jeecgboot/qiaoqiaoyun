var Ct=Object.defineProperty,vt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable;var Ce=(e,a,s)=>a in e?Ct(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,C=(e,a)=>{for(var s in a||(a={}))bt.call(a,s)&&Ce(e,s,a[s]);if(he)for(var s of he(a))Ft.call(a,s)&&Ce(e,s,a[s]);return e},v=(e,a)=>vt(e,St(a));var p=(e,a,s)=>new Promise((R,b)=>{var i=n=>{try{f(s.next(n))}catch(F){b(F)}},w=n=>{try{f(s.throw(n))}catch(F){b(F)}},f=n=>n.done?R(n.value):Promise.resolve(n.value).then(i,w);f((s=s.apply(e,a)).next())});import"./index-621e597c.js";import{u as Re,G as Dt,w as M,d as Rt,as as Tt,f as c,e as Q,r as It,n as kt,a3 as Bt,a4 as At,a5 as U,V as g,a6 as I,a7 as x,F as Lt,af as oe,W as E,a8 as Pt,ae as ve,q as _t,k as D,ai as S,E as Qt,A as Et}from"./vue-vendor-24c7dc61.js";import"./index-1c3affea.js";import{u as Mt}from"./useListPage-62a041ef.js";import{a as Vt,d as Ot,e as Nt}from"./LinkRecordSelect-385d0eae.js";import{p as ae}from"./auto.desform.api-839115ed.js";import Gt from"./AutoDesformDataFullScreen-bd93fbb9.js";import $t from"./AutoColumnSettings-6fbd3a04.js";import{C as Kt}from"./clipboard-695289c6.js";import{a as jt,e as xt,ap as Se,bI as be,l as Ut}from"./index-831af9dd.js";import{d as Xt}from"./renderUtils-7ad8f436.js";import qt from"./LeftFilterList-b1ddac5e.js";import Jt from"./TableImage-14ca1f5d.js";import zt from"./TableSummary-2b572a70.js";import{c as Ht}from"./useCustomButton-fa741dda.js";import Wt from"./SubTableTag-81763fd6.js";import Yt from"./TopButtonDrawer-2ab1cffa.js";import{u as Zt,a as eo}from"./useAuth-d62eecf0.js";import{u as to}from"./useViewCommon-0bf8ef6c.js";import{g as oo}from"./useSuperQueryCurd-0a66a14b.js";import ao from"./BasicTable-d435f501.js";import{T as no}from"./componentMap-c857637c.js";import"./antd-vue-vendor-0d72f01e.js";import"./BasicModal-58413bab.js";import"./useWindowSizeFn-8f085f6f.js";import"./useMethods-f689b480.js";import"./SelectItem-04dd2229.js";import"./vxe-table-vendor-8813019a.js";import"./lowAppUtils-56892d30.js";import"./desformUtils-c7daaa89.js";import"./LinkRecordTags-cf4c2463.js";import"./type.definition-4eb605ee.js";import"./FormSchemaFactory-ec827fa7.js";import"./index-bff0b654.js";import"./JUpload-76e119c7.js";import"./index-d508f1f4.js";import"./lowAppAuth-3d637b7d.js";import"./useFuncSwitch-b7681246.js";import"./DictColors-73058d23.js";import"./CardCellFile-92b3c8c8.js";import"./index-b845562c.js";import"./BatchUpdateModal-e973d8c0.js";import"./ComponentIcon-f1bbb90f.js";import"./SuperQueryValComponent-97f284a9.js";import"./helper-22dafba0.js";import"./useFormItem-86503382.js";import"./download-1ac6acce.js";import"./index-f99b266a.js";import"./JSelectUser-a44af43a.js";import"./useSelectBiz-2f560b0b.js";import"./props-8a7ac45b.js";import"./JSelectBiz-55a9591f.js";import"./JImageUpload-d644253a.js";import"./JDictSelectTag-54dc3bdb.js";import"./JSelectDept-a90caee3.js";import"./index-f2fd5a28.js";import"./useContextMenu-810f9346.js";import"./areaDataUtil-cdeee717.js";import"./china-area-data-vendor-556d14ee.js";import"./JPopup-2a779923.js";import"./JCheckbox-0b89d32a.js";import"./JSelectUserByDept-bd619076.js";import"./UserSelectByDepModal-db060ece.js";import"./depart.api-339f4da6.js";import"./index-6507b9cd.js";import"./index-4d0525a5.js";import"./UserSelectModal-d78c1490.js";import"./index-52c8c841.js";import"./useForm-14b2bc77.js";import"./JAreaLinkage-173780c9.js";import"./JCodeEditor-66bd225e.js";import"./codemirror-17b6f671.js";import"./codemirror-26b29690.js";import"./active-line-512fef49.js";import"./EasyCronInput-b2123242.js";import"./JEditor-249b2194.js";const ne="copy-this-text",Fe="data-clipboard-text";function so(){return{createCopyModal:ro}}const{createMessage:De,createConfirm:io}=jt();function ro(e){var s,R,b,i,w;let a=io(v(C({},e),{iconType:(s=e.iconType)!=null?s:"info",width:(R=e.width)!=null?R:500,title:(b=e.title)!=null?b:"复制",maskClosable:(i=e.maskClosable)!=null?i:!0,okText:(w=e.okText)!=null?w:"复制",okButtonProps:v(C({},e.okButtonProps),{class:ne,[Fe]:Re(e.copyText)}),onOk(){return new Promise(f=>{const n=new Kt("."+ne);n.on("success",()=>{n.destroy(),De.success("复制成功"),f()}),n.on("error",()=>{De.error("该浏览器不支持自动复制"),n.destroy(),f()})})}}));return Dt(e.copyText)&&M(e.copyText,f=>{a.update({okButtonProps:v(C({},e.okButtonProps),{class:ne,[Fe]:f})})}),a}const lo=Rt({name:"BaseList",components:{BasicTable:ao,TableAction:no,AutoColumnSettings:$t,AutoDesformDataFullScreen:Gt,LeftFilterList:qt,TableImage:Jt,TableSummary:zt,SubTableTag:Wt,TopButtonDrawer:Yt},props:{queryDesformCode:String,customButtonsAuth:Object,timestamp:{type:Number,default:0},keyword:{type:String,default:""},searchTime:{type:Number,default:0},superQuery:{type:Object,default:()=>{}},dynamicConfig:{type:Object,default:()=>{}},viewId:{type:String,default:""},code:{type:String,default:""}},emits:["left-select","action-click","buttons-auth-change","export"],setup(e,{emit:a}){const{createCopyModal:s}=so(),R=Tt(),b=c(!1),i=c(),w=c(!0),f=c(),n=c(),F=c({}),V=c(!1),T=c({}),A=c({}),X=c({}),L=c(""),O=c([]),q=Mt({designScope:"auto-desform-data-list",tableProps:{immediate:!1,api:ze,useSearchForm:!1,actionColumn:{width:150,fixed:"right"},scroll:{x:"max-content"},showIndexColumn:!0,showTableSetting:!1,indexColumnProps:{title:"#",fixed:"left"},tableSetting:{setting:!1},maxColumnWidth:300,beforeFetch(t){e.dynamicConfig&&e.dynamicConfig.leftFilterField&&(t[e.dynamicConfig.leftFilterField]=L.value)},formConfig:{labelWidth:120,schemas:[],autoAdvancedCol:3,actionColOptions:{style:{textAlign:"left"}}}},exportConfig:{name:()=>{var t;return(t=f.value)!=null?t:""},url:()=>`/desform/data/exportXls/${n.value}`},importConfig:{url:()=>`/desform/data/importXls/${n.value}`}}),{prefixCls:r,tableContext:h,doDeleteRecord:Te,doRequest:Ie,createMessage:J,onExportXls:ke,onImportXls:Be}=q,[Ae,d,{rowSelection:se,selectedRowKeys:z,selectedRows:Le}]=h,[Pe,H]=xt(),{appId:W,showComment:_e,showFiles:Qe,showDataLog:Ee,showCreateBtn:Me,showRecordShare:Ve,showRecordSysPrint:Oe,showDesignFormBtn:Ne,dataPageTotal:Y,currentIndex:P}=to(),{designButtonList:ie,getCustomButtons:Ge,addLinkRecordData:$e,executeFlow:Ke}=Ht(e,H,i,W),re=c({add:!1,import:!1,export:!1,superQuery:!1,batchAction:!1,customColumn:!1,detail:!1,edit:!1,delete:!1,getUrl:!1,startProcess:!1}),k=Q({get(){return e.customButtonsAuth?e.customButtonsAuth:re.value},set(t){re.value=t}}),N=It({notDesignForm:!1}),{allColumns:le,allColumnKeys:je,superQueryFields:xe,loadColumnsInfo:Ue,linkRecordDataMap:Xe,extendConfig:qe}=Vt({buttonsAuth:k,desformCode:n,desformName:f,translData:F,remoteOptionsMap:X,dynamicConfig:e.dynamicConfig},{loadData:G,openLinkRecord:He,tableAction:d},N),Je=Q(()=>!(w.value||N.notDesignForm));M(()=>e.code,t=>{t&&(i.value=e.code,Z())},{immediate:!0}),M(()=>e.timestamp,t=>{if(t){let o=!1;e.searchTime!=null&&(o=t-e.searchTime<=50),Z(o)}},{immediate:!1}),M(()=>e.superQuery,t=>{t&&(T.value={matchType:t.matchType,superQueryParams:t.superQueryParams}),d.reload()},{immediate:!1,deep:!0}),M(k,t=>a("buttons-auth-change",t));function Z(t=!1){return p(this,null,function*(){if(i.value){N.notDesignForm=!1;try{yield Ue(i.value,null,t)}finally{w.value=!1}}})}const ue=c(!0);function ze(t){return p(this,null,function*(){Xe.value={};let o=yield ae.list(v(C({},t),{desformCode:i.value,superQuery:oo(T.value,A.value),listViewId:e.dynamicConfig?e.dynamicConfig.id:"",global_keyword:e.keyword,appId:R.params.appId})),l=[];return o.result.records.forEach(u=>{let y=v(C({},JSON.parse(u.desformDataJson)),{id:u.id,_record:u});l.push(y)}),o.result.translData&&(F.value=o.result.translData),o.result.hasSuperQuery!=null&&(V.value=o.result.hasSuperQuery),o.message!=="查询成功"&&J.warn(o.message),o.result.records=l,Y.value=l.length,ue.value=l.length>0,O.value=o.result.summaryList||[],o.result})}function G(){d.reload()}function $(t){b.value=!0,d.setLoading(t)}function _(t="add",o=null){H.openModal(!0,{mode:t,desformCode:i.value,dataId:o,isOnline:!1,viewId:e.viewId,lowAppId:W.value})}function He(t,o){return p(this,null,function*(){const l=Re(W);yield st(l,t),H.openModal(!0,{mode:"edit",desformCode:t,dataId:o,isOnline:!1,viewId:e.viewId,lowAppId:l,setMode({record:u}){let y=u!=null&&u.desformData?u.desformData:u;return me(t,e.viewId,[y])?"edit":"detail"}})})}function We(t){d.setColumns(t.columns),d.setProps({showIndexColumn:t.showIndex,showActionColumn:t.showAction})}function Ye(){_()}function Ze(t){return p(this,null,function*(){Te(()=>ae.delete(n.value,t.id))})}function et(){Ie(()=>ae.batchDelete(n.value,z.value),{confirm:!1})}function tt(){return p(this,null,function*(){yield d.clearSelectedRowKeys(),yield K()})}function ot(t){return p(this,null,function*(){if(t.isLinkRecordForm===!0){let o=t.currentRecordId;t.linkRecordId&&(o=t.linkRecordId),yield $e(o,t.dataId,t.customButtonId)}t.flowStatus===!0&&(yield Ke({id:t.currentRecordId},t.processId,!0)),yield K()})}function at(u){return p(this,arguments,function*({id:t,index:o,mode:l}){var B,ge,we;let y=d.getRawDataSource(),m=(B=y==null?void 0:y.records)!=null?B:[];if(t){let j=m.findIndex(te=>te.id===t);if(j==-1&&(yield d.reload(),yield kt(),m=(we=(ge=d.getRawDataSource())==null?void 0:ge.records)!=null?we:[],Y.value=m.length,j=m.findIndex(te=>te.id===t),j==-1)){J.error("数据不存在");return}P.value=j,_(l,t);return}if(P.value=o,!m||!m[o]){J.error("数据不存在");return}_(l,m[o].id)})}function K(){return p(this,null,function*(){V.value&&($(!0),yield be(1e3)),G()})}function nt(t){$(!0);let o=0;for(let l of t){let u=Se(l.url);o++;try{Xt(u)}finally{--o===0&&$(!1)}}}const{getFormAuthOnce:st}=Zt(),{hasUpdateAuth:me,hasDeleteAuth:it,hasBatchAuth:rt}=eo(),lt=Q(()=>{let t=i.value;return rt(t)===!0?se:null});function ut(t,o){let l=[{label:"查看",onClick:()=>{P.value=o,_("detail",t.id)},ifShow:()=>k.value.detail}];return me(i.value,e.viewId,[t])===!0&&l.push({label:"编辑",onClick:()=>{P.value=o,_("edit",t.id)},ifShow:()=>k.value.edit}),l}function ce(t,...o){return p(this,null,function*(){typeof t=="function"&&(yield t(...o)),$(!0),yield be(500),yield K()})}function mt(t){var y;let o=[];it(i.value,e.viewId,[t])===!0&&o.push({label:"删除",popConfirm:{title:"确定要删除吗？",placement:"left",confirm:()=>Ze(t)},ifShow:()=>k.value.delete});let u=Ge(t,ie);if(u&&u.length>0)for(let m of u){if((y=m==null?void 0:m.popConfirm)!=null&&y.confirm){let B=m.popConfirm.confirm;m.popConfirm.confirm=ce.bind(null,B)}else if(m.onClick){let B=m.onClick;m.onClick=ce.bind(null,B)}o.unshift(m)}return o}function ct(t){T.value={matchType:t.superQueryMatchType,superQueryParams:t.superQueryParams},Z()}const{tableColumns:de}=Ot(e,d,le);Nt(d);const ee=c(!0);function dt(t){ee.value=t}const fe=Q(()=>!!(e.dynamicConfig&&e.dynamicConfig.leftFilterField)),ft=Q(()=>fe.value===!1?{width:"100%"}:ee.value==!0?{width:"calc(100% - 220px)"}:{width:"calc(100% - 30px)"});function pt(t){if(L.value=t,G(),e.dynamicConfig&&e.dynamicConfig.addFormDefaultStatus===!0&&e.dynamicConfig.leftFilterField){let o={[e.dynamicConfig.leftFilterField]:L.value};a("left-select",o)}}const pe=c();function yt(l){return p(this,arguments,function*({type:t,field:o}){let u=yield d.getForm().getFieldsValue(),y=v(C({},u),{summaryType:t,summaryField:o,code:i.value,superQuery:JSON.stringify(T.value),listViewId:e.dynamicConfig?e.dynamicConfig.id:"",global_keyword:e.keyword});pe.value.loadFieldSummary(y)})}function ye(){return p(this,null,function*(){let t=yield d.getForm().getFieldsValue(),o=v(C({},t),{code:i.value,superQuery:JSON.stringify(T.value),listViewId:e.dynamicConfig?e.dynamicConfig.id:"",global_keyword:e.keyword}),l=e.dynamicConfig.name;return{columns:de.value,queryParams:o,viewName:l}})}function gt(){return p(this,null,function*(){let t=yield ye(),o=v(C({},t),{designFormViewName:e.dynamicConfig.name,designFormCode:e.code,idList:z.value});a("export",o)})}function wt(){d.clearSelectedRowKeys()}function ht(t){A.value.matchType=t.matchType,A.value.superQueryGroup=t.conditions}return{prefixCls:r,showTable:Je,pageLoading:w,desformCode:n,rowSelection:se,selectedRowKeys:z,buttonsAuth:k,currentIndex:P,dataPageTotal:Y,getTableColumns:ye,allColumns:le,allColumnKeys:je,superQueryFields:xe,errorTips:N,loadData:G,getTableAction:ut,getDropDownAction:mt,getFileAccessHttpUrl:Se,downloadRowFile:nt,onAddRecord:Ye,onExportXls:ke,onImportXls:Be,onDeleteBatch:et,onSuccess:ot,onGoToRecord:at,onColumnsChange:We,onSuperQuery:ct,registerTable:Ae,registerDataModal:Pe,expandStatus:ee,tableStyle:ft,onExpandChange:dt,extendConfig:qe,onSelectLeftItem:pt,showLeft:fe,tableColumns:de,summaryRef:pe,initSummaryList:O,putParams:yt,showSummary:ue,selectedRows:Le,routeCode:i,onUpdateSuccess:tt,showComment:_e,showFiles:Qe,showDataLog:Ee,showCreateBtn:Me,showRecordShare:Ve,showRecordSysPrint:Oe,showDesignFormBtn:Ne,onSelectExport:gt,onClearSelected:wt,designButtonList:ie,myRowSelection:lt,onDataHandleSuccess:K,setSuperQueryGroup:ht}}});const uo=e=>(Bt("data-v-1668e4ac"),e=e(),At(),e),mo={style:{display:"flex"}},co={key:1,class:"error-tip"},fo=uo(()=>U("div",{style:{height:"0"}},null,-1)),po={key:0,class:"j-table-slot-view"},yo={key:0,class:"j-table-slot-view"};function go(e,a,s,R,b,i){const w=g("left-filter-list"),f=g("a-skeleton"),n=g("sub-table-tag"),F=g("TableImage"),V=g("a-button"),T=g("a-tooltip"),A=g("TableAction"),X=g("table-summary"),L=g("BasicTable"),O=g("DesformViewModal"),q=g("TopButtonDrawer");return I(),x(Lt,null,[U("div",mo,[e.showLeft?(I(),oe(w,{key:0,status:e.expandStatus,dynamicConfig:e.extendConfig,onLoad:e.onSelectLeftItem,onExpand:e.onExpandChange},null,8,["status","dynamicConfig","onLoad","onExpand"])):E("",!0),U("div",{class:Pt([e.prefixCls,"p-2"]),style:ve(e.tableStyle)},[e.pageLoading?(I(),oe(f,{key:0,active:""})):e.errorTips.notDesignForm?(I(),x("p",co,"你还没有设计任何表单项，不能查看表单数据！")):E("",!0),_t(D(L,{onRegister:e.registerTable,rowSelection:e.myRowSelection},{tableTop:S(()=>[fo]),"view-sub-table":S(({text:r})=>[D(n,{text:r},null,8,["text"])]),"view-picture":S(({text:r,index:h})=>[Array.isArray(r)&&r.length>0?(I(),x("div",po,[D(F,{text:r},null,8,["text"])])):E("",!0)]),"view-file":S(({text:r})=>[Array.isArray(r)&&r.length>0?(I(),x("div",yo,[D(V,{type:"primary",preIcon:"ant-design:download",size:"small",ghost:"",onClick:h=>e.downloadRowFile(r)},{default:S(()=>[Qt("下载")]),_:2},1032,["onClick"])])):E("",!0)]),"view-color":S(({text:r})=>[r?(I(),oe(T,{key:0,placement:"top",title:r,getPopupContainer:h=>h==null?void 0:h.parentNode},{default:S(()=>[U("div",{class:"j-table-slot-view-color",style:ve({backgroundColor:r})},null,4)]),_:2},1032,["title","getPopupContainer"])):E("",!0)]),action:S(({record:r,index:h})=>[D(A,{actions:e.getTableAction(r,h),dropDownActions:e.getDropDownAction(r,h)},null,8,["actions","dropDownActions"])]),summary:S(()=>[D(X,{ref:"summaryRef",show:e.showSummary,dataList:e.initSummaryList,tableColumns:e.tableColumns,dynamicConfig:e.dynamicConfig,onLoad:e.putParams},null,8,["show","dataList","tableColumns","dynamicConfig","onLoad"])]),_:1},8,["onRegister","rowSelection"]),[[Et,e.showTable]]),D(O,{index:e.currentIndex,total:e.dataPageTotal,showComment:e.showComment,showFiles:e.showFiles,showDataLog:e.showDataLog,showRecordCopy:e.showCreateBtn,showRecordShare:e.showRecordShare,showRecordSysPrint:e.showRecordSysPrint,showDesignFormBtn:e.showDesignFormBtn,dynamicConfig:e.dynamicConfig,onRegister:e.registerDataModal,onSuccess:e.onSuccess,onGotoRecord:e.onGoToRecord},null,8,["index","total","showComment","showFiles","showDataLog","showRecordCopy","showRecordShare","showRecordSysPrint","showDesignFormBtn","dynamicConfig","onRegister","onSuccess","onGotoRecord"])],6)]),D(q,{selectedRowKeys:e.selectedRowKeys,selectedRows:e.selectedRows,viewId:e.viewId,designFormCode:e.routeCode,tableColumns:e.tableColumns,designButtonList:e.designButtonList,dynamicConfig:e.dynamicConfig,onDelete:e.onDeleteBatch,onSuccess:e.onUpdateSuccess,onExport:e.onSelectExport,onClear:e.onClearSelected,onReload:e.onDataHandleSuccess},null,8,["selectedRowKeys","selectedRows","viewId","designFormCode","tableColumns","designButtonList","dynamicConfig","onDelete","onSuccess","onExport","onClear","onReload"])],64)}const Ga=Ut(lo,[["render",go],["__scopeId","data-v-1668e4ac"]]);export{Ga as default};
