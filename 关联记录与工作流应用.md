# 关联记录与工作流应用实践指南

## 概述

本指南介绍如何使用敲敲云零代码平台的**关联记录控件**、**计算控件**、**函数表达式**和**工作流**等核心功能，构建智能化的业务系统。以采购业务为例，实现从采购单自动生成供应商应收款单，到入库自动更新库存的完整自动化流程。

---

## 核心技术组件

### 1. 关联记录控件
- **功能**：实现跨表数据关联引用
- **优势**：避免重复录入，保证数据一致性
- **应用**：采购单关联供应商、产品等基础信息

### 2. 计算控件
- **功能**：字段自动计算（加减乘除、汇总等）
- **优势**：自动计算金额、数量，减少人为错误
- **应用**：采购金额 = 数量 × 单价，总金额汇总

### 3. 函数表达式
- **功能**：复杂逻辑判断、条件分支、数据处理
- **优势**：灵活处理业务规则，支持动态决策
- **应用**：数据映射、条件判断、格式处理

### 4. 工作流引擎
- **功能**：驱动业务自动化流转
- **优势**：自动生成单据、更新数据、触发审批
- **应用**：采购单提交后自动生成应收款单

---

## 典型应用场景

### 场景一：采购单自动生成应收款单

**业务流程**：
1. 采购单通过关联记录控件选择供应商和产品
2. 明细行使用计算控件自动计算金额（数量 × 单价）
3. 表头汇总计算总金额
4. 提交后触发工作流"增"节点，自动创建供应商应收款单

**技术实现**：
```
表单设计 → 关联记录控件（供应商、产品）
明细计算 → 计算控件（金额 = 数量 × 单价）
总额汇总 → 计算控件（SUM明细金额）
流程触发 → 工作流"增"节点 + 函数表达式数据映射
```

### 场景二：入库单自动更新库存

**业务流程**：
1. 入库单关联产品信息
2. 计算入库数量汇总
3. 确认后触发工作流查询现有库存
4. 自动更新库存数量（累加或新增记录）

**技术实现**：
```
表单设计 → 关联记录控件（产品信息）
数量汇总 → 计算控件（SUM入库数量）
库存更新 → 工作流"查+循环+改/增"节点
数据处理 → 函数表达式（库存数量 += 入库数量）
```

---

## 工作流节点说明

| 节点类型 | 功能说明 | 使用场景 |
|----------|----------|----------|
| 增（Create） | 新建记录 | 自动生成应收款单、创建库存记录 |
| 查（Query） | 查询数据 | 检查库存是否存在、获取基础数据 |
| 改（Update） | 更新记录 | 库存数量累加、状态更新 |
| 删（Delete） | 删除记录 | 冲销操作、数据清理 |
| 循环（Loop） | 批量处理 | 遍历明细行、批量更新库存 |

---

## 实施要点

### 数据设计
- 合理规划表结构和字段关系
- 使用关联记录控件建立外键引用
- 设置必要的唯一标识和索引

### 计算逻辑
- 在表单层完成基础计算（金额、数量等）
- 使用函数表达式处理复杂业务规则
- 注意数据精度和空值处理

### 流程设计
- 采用"查→判断→增/改"的标准模式
- 加入异常处理和人工审批节点
- 确保流程的幂等性，避免重复执行

### 测试验证
- 覆盖单条和批量处理场景
- 测试异常情况（库存不足、数据缺失等）
- 验证数据一致性和计算准确性

---

## 业务价值

- **🔗 数据互联**：打破信息孤岛，实现数据自动关联
- **🤖 自动计算**：减少手工计算错误，提高数据准确性
- **⚡ 流程自动化**：消除重复操作，提升业务效率
- **📊 实时更新**：库存、财务数据实时同步更新
- **🔄 业务闭环**：从采购到库存的完整自动化闭环

---

## 扩展应用

基于相同的技术架构，可以快速扩展到：
- **销售管理**：销售单→客户应收款单→库存出库
- **财务管理**：费用申请→审批流程→财务记账
- **项目管理**：项目立项→任务分配→进度跟踪
- **人事管理**：入职申请→审批流程→员工档案

---

## 流程节点示意图

![工作流节点图](https://oscimg.oschina.net/oscnet/up-8068a15d1c0e07dd6982cbacda66bcdc1be.png)

---

> 💡 **提示**：本指南提供的是通用实践方法，具体实施时请根据企业实际业务需求进行调整和优化。
